var gInitialTextBoxWidth,gInitialTextBoxContainerWidth,gInitialTextBoxContainerLeft,pdf,gOriginalWidthBeforePDFExport,gDialogRenderingFonts,gShowAdvancedControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,STAFFSPACEMIN=0,STAFFSPACEDEFAULT=10,STAFFSPACEMAX=200,STAFFSPACEOFFSET=40,gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,gIsIOS=!1,gIsIPad=!1,gIsIPhone=!1,gIsSafari=!1,gIsChrome=!1,gIsAndroid=!1,gRenderingPDF=!1,gTheQRCode=null,MAXQRCODEURLLENGTH=2300,ALLTITLESMAXLENGTH=70,HEADERFOOTERFONTSIZE=12,QRCODECAPTIONPDFFONTSIZE=12,gShowShareControls=!1,gAllowSave=!1,gAllowURLSave=!1,gAllowQRCodeSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gCapo=0,gIsMaximized=!1,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gDisplayedName="",gShowTabNames=!0,gAllowShowTabNames=!1,gWhistleFontPrepared=!1,DEBOUNCEMS=280,AUTOSCROLLDEBOUNCEMS=250,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsFirstRender=!0,gIsOneColumn=!0,gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gLocalStorageAvailable=!1,gPDFQuality=.75,gQualitaet=1200,gPDFFont="Times",gPDFFontStyle="",gPDFOrientation="portrait",gPDFPaperSize="letter",gPageWidth=535,gRenderPixelRatio=2,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gAddTOCLinkback=!1,gAddIndexLinkback=!1,gTuneHyperlinks=[],gAddTheSessionHyperlinks=!1,gAddPlaybackHyperlinks=!1,gAddPlaybackHyperlinksIncludePrograms=!1,gPlaybackHyperlinkMelodyProgram="",gPlaybackHyperlinkBassProgram="",gPlaybackHyperlinkChordProgram="",gPlaybackHyperlinkSoundFont="",gAddTunebookPlaybackHyperlinks=!1,gInjectEditDisabled=!1,gDisableEditFromPlayLink=!1,gFullScreenScaling=50,gAngloButtonNames=[],gRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tablabelfont:"Trebuchet MS 14",tabnumberfont:"Arial 12",tabgracefont:"Arial 8",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"},gMP3Bitrate=224,gDefaultSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/",gTheActiveSoundFont=gDefaultSoundFont,gAutoscrollPlayer=!0,gAutoSwingHornpipes=!0,gAutoSwingFactor=.25,gAllSwingHornpipesRequested=!1,gAllSwingHornpipesSwingFactor=.25,gAllNoSwingHornpipesRequested=!1,gUseCustomGMSounds=!0,gTipJarCount=0,gSaveLastAutoSnapShot=!1,gIncipitsColumns=1,gUseComhaltasABC=!1,gZoomBannerHidden=!1,gForceInitialTextBoxRecalc=!1,gGotWindowResizeWhileMaximized=!1,gNotationLeftMarginBeforeMaximize="auto",gTheNotation=document.getElementById("notation-holder"),gAllowMIDIInput=!1,gIsFromShare=!1,gIsDirty=!1,gIsFirstRun=!1,gAllowRawMode=!1,gRawMode=!1,gRawVisual=null,gRawIsDragging=!1,gRawLastIndex=-1,gRawFirstTime=!0,gRawHighlightColor="#F00000",gPlayerStatusOnLeft=!1,gRoll2DefaultParams="0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0",gRoll3DefaultParams="1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0",gDisableNotationRendering=!1,gDisableSelectedPlay=!1,gMixedNotationAndQRCode=!1,gFeaturesShowSearch=!0,gFeaturesShowExamples=!0,gFeaturesShowTemplates=!0,gFeaturesShowTablatures=!0,gFeaturesShowExplorers=!0,gFeaturesShowTabButtons=!0,gForceTabSave=!1,gTheABC=document.getElementById("abc");function getTuneTitle(e){var t=escape(e),n=t.split("%0D%0A");n=t.split("%0A");for(var o="",a=0;a<n.length;++a){n[a]=unescape(n[a]);var r=n[a].split("");if("T"==r[0]&&":"==r[1])return(o=n[a].slice(2)).trim()}return"No Title"}function removeABCTuneHeaders(e){let t=e.replace(/^(X:|T:|M:|K:|L:|Q:|W:|Z:|R:|C:|A:|O:|P:|N:|G:|H:|B:|D:|F:|S:|I:|:[A-Za-z]:)[^\r\n]*\r?\n?/gm,"");return t}function isSectionHeader(e){var t=e.match(/^T:\s*\*.*$/m);return!!t&&!!(t.length>0)}function findTuneOffsetByIndex(e){var t=gTheABC.value;if(0==e){var n=t.search(/^X:.*[\r\n]*/m);return -1==n?0:n}for(var o=t.split(/^X:/gm),a=o[0].length,r=1;r<=e;++r)a+=o[r].length+2;return a}function findTuneByOffset(e){var t=gTheABC.value.split(/^X:/gm),n=t.length,o=0;o=t[0].length;for(var a=1;a<n;++a)if(e<(o+=t[a].length+2))return a-1;return n-2}function getTuneByIndex(e){return"X:"+gTheABC.value.split(/^X:/gm)[e+1]}function getSelectedText(e){var t=document.getElementById(e),n=t.selectionStart,o=t.selectionEnd;return t.value.substring(n,o)}function findSelectedTune(){var e=gTheABC.value,t=gTheABC.selectionStart;if(0==t&&(t=e.indexOf("X:")+2),0==t)return"";var n=e.length;t==n&&(t=n-1);var o=e.split(/^X:/gm),a=o.length,r=0;r=o[0].length;for(var l=1;l<a;++l)if(t<(r+=o[l].length+2)){var s="X:"+o[l];return s.trimEnd()}return""}function GetFirstTuneTitle(){for(var e="",t=gTheABC.value,n=(t=escape(t)).split("%0A"),o=0;o<n.length;++o){n[o]=unescape(n[o]);var a=n[o].split("");if("T"==a[0]&&":"==a[1]){e=(e=(e=(e=(e=n[o].slice(2)).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\'/g,"_");break}}return e}function CountTunes(){var e=gTheABC.value.split(/^X:.*$/gm).length-1;return gTotalTunes=e,e}function GetAllTuneTitles(){var e=[],t=escape(gTheABC.value),n=t.split("%0D%0A");for(i=0,n=t.split("%0A");i<n.length;++i){n[i]=unescape(n[i]);var o=n[i].split("");if("T"==o[0]&&":"==o[1]){var a=n[i].slice(2);a=a.trim(),e.push(a)}}var r=e.length,l="";if(r>0)for(i=0;i<r;++i){if((l+=e[i]).length>ALLTITLESMAXLENGTH){var s=r-i-1;s>0&&(l=l+" + "+s+" more");break}i!=r-1&&(l+=" / ")}return l}function SetupRawModeUI(){if(gRawMode=!1,gRawLastIndex=-1,gAllowRawMode){var e=document.getElementById("rawmodebutton");e.value="Highlighting Off",gTheABC.style.backgroundColor="white",e.classList.remove("rawmodebutton"),e.classList.add("rawmodebuttondisabled"),e.classList.add("btn-rawmode-off"),e.classList.remove("btn-rawmode-on")}else{var e=document.getElementById("rawmodebutton");e.value="Highlighting Off",e.classList.remove("rawmodebutton"),e.classList.add("rawmodebuttondisabled"),e.classList.add("btn-rawmode-off"),e.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white"}}function ShowHighlightingExplanation(){sendGoogleAnalytics("dialog","ShowHighlightingExplanation");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">About Highlighting</p>';e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Since this is your first time using Highlighting, here is some important information:</p>',e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">When Highlighting is turned on:</p>',e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Select ABC text to highlight the corresponding notes in red in the notation.</p>',e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Click any element in the notation to select the corresponding ABC text in the editor.</p>',e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">Highlighting requires redrawing all tunes on each change to the ABC.</p>',e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">This may be slow on large numbers of tunes.</p>',e+='<p style="font-size:14pt;line-height:22pt;font-family:helvetica">All pre-processing of the ABC at notation drawing time is turned off. Any hiding of Annotations/Text/Chords selected in the Advanced dialog as well as automatic injection of staff separation space will be disabled. Your settings will be restored when you turn highlighting off.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function ToggleRawMode(){if(gDisableNotationRendering){var e="Highlighting not possible with rendering disabled.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}if(!isMobileBrowser()&&0!=CountTunes()){gRawMode=!gRawMode;var t=document.getElementById("rawmodebutton");gRawLastIndex=-1,gRawMode?(gRawFirstTime&&(ShowHighlightingExplanation(),gRawFirstTime=!1,SaveConfigurationSettings()),t.value="Highlighting On",t.classList.add("btn-rawmode-on"),t.classList.remove("btn-rawmode-off"),gTheABC.style.backgroundColor="#F8FDF8"):(t.value="Highlighting Off",t.classList.add("btn-rawmode-off"),t.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white"),RenderAsync(!0,null)}}function getTuneRangeForTranspose(){var e=gTheABC.value,t=gTheABC,n=t.selectionStart;0==n&&(n=e.indexOf("X:")+2);var o=t.selectionEnd;0==o&&(o=e.indexOf("X:")+2);var a=findTuneByOffset(n),r=findTuneByOffset(o);return{start:a,end:r}}function resetSelectionAfterTranspose(e,t){var n=findTuneOffsetByIndex(e),o=getTuneByIndex(t),a=findTuneOffsetByIndex(t)+(o.length-1);gTheABC.selectionStart=n,gTheABC.selectionEnd=a,FocusAfterOperation()}function Transpose(e){if(gDisableNotationRendering){var t="Transpose not possible with rendering disabled.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}if(!gRenderingPDF){sendGoogleAnalytics("action","Transpose");var n=CountTunes(),o=getTuneRangeForTranspose();document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){for(var t,a=gTheABC.value,r=GetABCJSParams(),l=a.split(/^X:/gm),s=[],g=0;g<n;++g)t="notation"+g,s.push(t),document.getElementById(t).style.opacity=0;for(var c=FindPreTuneHeader(a),g=1;g<=n;++g){l[g]="X:"+l[g];var d=null;if(g-1>=o.start&&g-1<=o.end)try{d=ABCJS.renderAbc(s[g-1],l[g],r),c+=ABCJS.strTranspose(l[g],d,e)}catch(u){var p="Unable to tranpose one or more tunes.";p=makeCenteredPromptString(p),DayPilot.Modal.alert(p,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),c+=l[g]}else c+=l[g]}gTheABC.value=c,gIsDirty=!0,resetSelectionAfterTranspose(o.start,o.end),RenderAsync(!0,null,function(){setTimeout(function(){for(var e=0;e<n;++e)document.getElementById(t).style.opacity=1},100)})},100)}}function TransposeUp(e){var t=1;e.shiftKey&&(t=2),e.altKey&&(t=12),Transpose(t)}function TransposeDown(e){var t=-1;e.shiftKey&&(t=-2),e.altKey&&(t=-12),Transpose(t)}function GetAllTuneTags(e,t){var n,o=[];for(n=0;n<t;++n){var a=getTuneByIndex(n),r=escape(a),l=r.split("%0D%0A");l=r.split("%0A");for(var s=!1,g=0;g<l.length;++g){l[g]=unescape(l[g]);var c=l[g].split("");if(c[0]==e&&":"==c[1]){var d=l[g].slice(2);d=d.trim(),o.push(d),s=!0;break}}s||o.push(" ")}return o}function SortTunesByTag(e){let t=[{name:"C|",weight:1},{name:"C",weight:2},{name:"2/2",weight:10},{name:"3/2",weight:11},{name:"2/4",weight:7},{name:"3/4",weight:8},{name:"4/4",weight:3},{name:"5/4",weight:12},{name:"6/4",weight:9},{name:"7/4",weight:13},{name:"2/8",weight:14},{name:"3/8",weight:15},{name:"5/8",weight:16},{name:"6/8",weight:4},{name:"7/8",weight:17},{name:"9/8",weight:5},{name:"10/8",weight:18},{name:"12/8",weight:6}];var n,o=gTheABC.value,a=o.split(/(^X:.*$)/gm),r=(a.length-1)/2;if(!(r<2)){var l=a[0],s=GetAllTuneTags(e,a.length-1),g=s.length;if("M"==e){for(var c=[],n=0;n<g;++n){for(var d=s[n],u=19,p=0;p<t.length;++p)if(d==t[p].name){u=t[p].weight;break}c.push(u)}s=c}var m=[],h=0;for(n=0;n<r;++n)void 0!=a[2*n+1]&&(thisTag=s[h],h++,m.push({tag:thisTag,tune:a[2*n+1]+a[2*n+2]}));for(m.sort((e,t)=>{let n=e.tag,o=t.tag;return n<o?-1:n>o?1:0}),o="",o+=l,n=0;n<h;++n)o+=m[n].tune;gTheABC.value=o,gIsDirty=!0,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}}function DoSortTunesByMeter(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting by Meter"),setTimeout(function(){SortTunesByTag("M"),RenderAsync(!0,null,function(){var e=document.getElementById("sortbutton");e&&(e.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Specific Tag")},1e3)})},750)}}function DoSortTunesByKey(){if(!gRenderingPDF){var e=document.getElementById("sortbutton");e&&(e.value="Sorting by Key"),setTimeout(function(){SortTunesByTag("K"),RenderAsync(!0,null,function(){var e=document.getElementById("sortbutton");e&&(e.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Specific Tag")},1e3)})},750)}}function SortTunes(e){var t,n,o=gTheABC.value,a=o.split(/(^X:.*$)/gm),r=(a.length-1)/2;if(!(r<2)){var l=a[0];totalTunes=r;var s=GetTunebookIndexTitles(),g=[],c=0;for(t=0;t<r;++t)void 0!=a[2*t+1]&&(0==(n=s[c]).indexOf("The ")&&(n=n.substring(4,n.length)+", The"),e&&(0==n.indexOf("An ")&&(n=n.substring(3,n.length)+", An"),0==n.indexOf("A ")&&(n=n.substring(2,n.length)+", A")),c++,g.push({title:n,tune:a[2*t+1]+a[2*t+2]}));for(g.sort((e,t)=>{let n=e.title.toUpperCase(),o=t.title.toUpperCase();return n<o?-1:n>o?1:0}),o="",o+=l,t=0;t<c;++t)o+=g[t].tune;gTheABC.value=o,gIsDirty=!0,gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}}function DoSortTunesByName(e){if(!gRenderingPDF){var t=document.getElementById("sortbutton");t&&(t.value="Sorting by Name"),setTimeout(function(){SortTunes(e),RenderAsync(!0,null,function(){var e=document.getElementById("sortbutton");e&&(e.value="   Sorted!   "),setTimeout(function(){var e=document.getElementById("sortbutton");e&&(e.value="Sort by Specific Tag")},1e3)})},750)}}var gLastSortOrder="0";function SortDialog(){sendGoogleAnalytics("dialog","SortDialog");let e={configure_sort:gLastSortOrder};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Sort by Specific Tag&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#sort_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will sort the tunes based on the ABC tag you select:</p>'},{name:"Tag to sort by:",id:"configure_sort",type:"select",options:[{name:"  Sort by Name (T:)",id:"0"},{name:'  Sort by Name (T:) - Ignore "A"and "An"',id:"1"},{name:"  Sort by Key (K:)",id:"2"},{name:"  Sort by Meter (M:)",id:"3"},],cssClass:"configure_sort_settings_select"},{html:'<p style="font-size:12pt;font-family:helvetica">&nbsp;</p>'},],e,{theme:"modal_flat",top:200,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled)switch(gLastSortOrder=e.result.configure_sort,e.result.configure_sort){case"0":default:DoSortTunesByName(!1);break;case"1":DoSortTunesByName(!0);break;case"2":DoSortTunesByKey();break;case"3":DoSortTunesByMeter()}})}function Clear(){if(!gRenderingPDF){sendGoogleAnalytics("action","Clear");var e="Are you sure you want to erase all the ABC and start over?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){if(!e.canceled){gIsFromShare=!1,gIsDirty=!1;var t=document.getElementById("rawmodebutton");t.value="Highlighting Off",t.classList.remove("rawmodebutton"),t.classList.add("rawmodebuttondisabled"),t.classList.add("btn-rawmode-off"),t.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white",gRawMode=!1,gRawLastIndex=-1,RestoreSavedStaffSpacing(),ClearNoRender(),RenderAsync(!0,null),gTheABC.focus()}})}}function ClearNoRender(){gTheABC.value="",gDisplayedName="No ABC file selected",gABCFromFile=!1,RestoreDefaults()}function RestoreSavedStaffSpacing(){if(gLocalStorageAvailable){var e=localStorage.abcStaffSpacing;e&&(gStaffSpacing=STAFFSPACEOFFSET+parseInt(e))}}function DoSaveLastAutoSnapShot(){if(gLocalStorageAvailable){var e=gTheABC.value;localStorage.LastAutoSnapShot=e}}function SaveSnapshot(){if(gLocalStorageAvailable){sendGoogleAnalytics("action","SaveSnapshot");var e=gTheABC.value;localStorage.SavedSnapshot=e,document.getElementById("snapshotbutton").value="  Saved!  ",setTimeout(function(){document.getElementById("snapshotbutton").value="Snapshot"},1e3)}else{sendGoogleAnalytics("action","SaveSnapshot_Fail");var t="Snapshot storage not available on this browser.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}function RestoreSnapshot(e,t){if(gLocalStorageAvailable){var n,o,a;sendGoogleAnalytics("action","RestoreSnapshot"),gTheABC.value,e?(n=localStorage.LastAutoSnapShot,o="Replace the contents of the ABC editor with the Auto-Snapshot?",a="No saved Auto-Snapshot available to restore."):(n=localStorage.SavedSnapshot,o="Replace the contents of the ABC editor with the Snapshot?",a="No saved Snapshot available to restore."),o=makeCenteredPromptString(o),n&&""!=n?DayPilot.Modal.confirm(o,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(o){if(!o.canceled){if(t){var a;e?(a=document.getElementById("dialogrestoreautobutton"))&&(a.value="Restoring from Auto-Snapshot"):(a=document.getElementById("dialogrestorebutton"))&&(a.value="Restoring from Snapshot"),setTimeout(function(){gTheABC.value=n,gIsFromShare=!1,gIsDirty=!0,RestoreSavedStaffSpacing(),RenderAsync(!0,null,function(){var t;e?(t=document.getElementById("dialogrestoreautobutton"))&&(t.value="Restored from Auto-Snapshot"):(t=document.getElementById("dialogrestorebutton"))&&(t.value="Restored from Snapshot"),setTimeout(function(){var t;e?(t=document.getElementById("dialogrestoreautobutton"))&&(t.value="Restore from Auto-Snapshot"):(t=document.getElementById("dialogrestorebutton"))&&(t.value="Restore from Snapshot")},1e3)})},750)}else document.getElementById("restorebutton").value="Restoring",setTimeout(function(){gTheABC.value=n,gIsFromShare=!1,RestoreSavedStaffSpacing(),gIsDirty=!0,RenderAsync(!0,null,function(){document.getElementById("restorebutton").value="Restored",setTimeout(function(){document.getElementById("restorebutton").value="Restore"},1e3)})},750)}}):(sendGoogleAnalytics("action","RestoreSnapshot_Fail_1"),DayPilot.Modal.alert('<p style="text-align:center;font-size:18px;">'+a+"</p>",{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}))}else{sendGoogleAnalytics("action","RestoreSnapshot_Fail_2");var o="Snapshot storage not available on this browser.";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}}var gPAGENUMBERTOP=296,PAGETOPOFFSET=32,PAGEBOTTOMOFFSET=24,PAGELEFTOFFSET=37,PAGELEFTOFFSETA4=29,PAGEHEIGHTLETTER=792,PAGEHEIGHTA4=842,PAGEHEIGHTLETTER_LANDSCAPE=580,PAGEHEIGHTA4_LANDSCAPE=565,BETWEENTUNESPACE=20,gBetweenTuneSpace=20,gGotBetweenTuneSpace=!1,running_height=PAGETOPOFFSET,column_number=0,theCurrentPageNumber=1,isFirstPage=!0,tunesProcessed=0,totalTunes=0,thePageHeader="",thePageFooter="",thePageHeaderURL="",thePageFooterURL="",theRenderTime="",theHeaderFooterTuneNames="",thePageNumberVerticalOffset=0,gQRCodeRequested=!1,gQRCodeURLOverride="",gDoForceQRCodeURLOverride=!1,gQRCodeCaptionOverride="",gDoForceQRCodeCaptionOverride=!1,TunebookIndexRequested=!1,theTunebookIndexTitle="",TunebookSortedIndexRequested=!1,theTunebookSortedIndexTitle="",TunebookIndexHeaderRequested=!1,theTunebookIndexHeader="",TunebookTOCRequested=!1,theTunebookTOCTitle="",TunebookSortedTOCRequested=!1,theTunebookSortedTOCTitle="",TunebookTOCHeaderRequested=!1,theTunebookTOCHeader="",TunebookTPRequested=!1,theTunebookTP="",theTunebookTPURL="",TunebookTPSTRequested=!1,theTunebookTPST="",theTunebookTPSTURL="",TunebookTOCWithNoPageNumbers=!1,TunebookIndexWithNoPageNumbers=!1,theTunePageMap=[],PDFJPGQUALITY=.8,PDFSCALEFACTOR=1.55,theOffscreen=null,gPDFCancelRequested=!1,gPDFTabselected="noten";function GetTunebookIndexTitles(){var e,t=[];for(e=0;e<totalTunes;++e){var n=getTuneByIndex(e),o=escape(n),a=o.split("%0D%0A");a=o.split("%0A");for(var r=!1,l=0;l<a.length;++l){a[l]=unescape(a[l]);var s=a[l].split("");if("T"==s[0]&&":"==s[1]){titel=(titel=a[l].slice(2)).trim(),t.push(titel),r=!0;break}}r||t.push("No Title")}return t}var TPTITLESIZE=24,TPSTTITLESIZE=16,gTPTOPOFFSET=435,TPSTOFFSET=24;function AppendTuneTitlePage(e,t,n,o){if(e.setPage(1),""!=n){if(e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TPTITLESIZE),theTunebookTPURL&&""!=theTunebookTPURL){var a=e.getTextWidth(n);e.textWithLink(n,e.internal.pageSize.getWidth()/3.1-a/2,gTPTOPOFFSET,{align:"center",url:theTunebookTPURL})}else e.text(n,e.internal.pageSize.getWidth()/3.1,gTPTOPOFFSET,{align:"center"})}if(""!=o){if(e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TPSTTITLESIZE),theTunebookTPSTURL&&""!=theTunebookTPSTURL){var a=e.getTextWidth(o);e.textWithLink(o,e.internal.pageSize.getWidth()/3.1-a/2,gTPTOPOFFSET+TPSTOFFSET,{align:"center",url:theTunebookTPSTURL})}else e.text(o,e.internal.pageSize.getWidth()/3.1,gTPTOPOFFSET+TPSTOFFSET,{align:"center"})}}var gTEXTINCIPITTOPOFFSET=330,TEXTINCIPITBOTTOMOFFSET=12,gTEXTINCIPITLEFTMARGIN=65,gTEXTINCIPITRIGHTMARGIN=190,TEXTINCIPITFONTSIZE=12,TEXTINCIPITLINESPACING=10,TEXTINCIPITGUTTER=5;function fitIncipitsTitle(e,t,n,o){var a,r=t;if(""==t)return r="No title",""!=n&&(r+=" ("+n+")"),r;r=r.trim(),""!=n&&(r+=" ("+n+")"),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var l=e.getTextWidth(r);if(""==t||l<=o)return r;var s="...";""!=n&&(s+=" ("+n+")"),o-=e.getTextWidth(s),o-=e.getTextWidth("W");for(var g="",c=r.length,d=0;d<c&&(g+=r[d],!((a=e.getTextWidth(g))>o));++d);return g+s}function cleanIncipitLine(e){return searchRegExp=/\[V:\s*\d+\]/gm,e=e.replace(searchRegExp,""),searchRegExp=/V:\s+\S+\s/gm,e=e.replace(searchRegExp,""),searchRegExp=/V:[^ ]+ /gm,e=e.replace(searchRegExp,""),searchRegExp=/![^!\n]*!/gm,e=(e=(e=(e=(e=e.replace(searchRegExp,"")).replaceAll(":","")).replaceAll("[","")).replaceAll("]","")).replaceAll("\\","")}function GenerateTextIncipits(e,t,n,o,a,r,l){var s=e.internal.pageSize.getHeight(),g=e.internal.pageSize.getWidth()/1.55,c=s-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),d=gTEXTINCIPITTOPOFFSET,u=GetTunebookIndexTitles();e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var p=[];for(h=0;h<totalTunes;++h){for(f=0,A=getTuneByIndex(h),A=StripTabOne(A=StripChordsOne(A=StripTextAnnotationsOne(A=StripAnnotationsOne(A)))),v=/^M:.*[\r\n]*/gm,S=(C=(A=escape(A=A.replace(v,""))).split("%0A")).length,P="";f<S&&-1==(P=unescape(C[f])).indexOf("K:");++f);for(f=0,P=(P=(P=(P=(P=(P=(P=(P=(P=(P=(P=P.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");f<S;++f)if(-1==(y=unescape(C[f])).indexOf("%%score")&&-1!=y.indexOf("|")){if(f<=S-2)for(T=f+1;T<S;++T){var m=unescape(C[T]);if(-1!=m.indexOf("|")){y+=m;break}}break}for(f=0,b=(y=cleanIncipitLine(y)).split("|"),I=[],B=b.length;f<B;++f)""!=b[f]&&I.push(b[f]);for((B=I.length)>3&&(B=3),E="",f=0;f<B;++f)I[f]=I[f].trim(),E+=I[f],f!=B-1&&(E+=" | ");0==(y=E).indexOf(" | ")&&(y=y.substring(3,y.length)),y=y.replaceAll("  "," "),_=u[h],y=y.length>40?(y=y.substring(0,40)).trim():y.trim(),l&&0==_.indexOf("The ")&&(_=_.substring(4,_.length)+", The"),_=fitIncipitsTitle(e,_,P,g-gTEXTINCIPITRIGHTMARGIN-gTEXTINCIPITLEFTMARGIN-TEXTINCIPITGUTTER),p.push({title:_,incipit:y,index:h})}if(l){var h,f,T,A,y,b,I,v,C,S,B,E,_,P,M=[];for(h=0;h<totalTunes;++h)M.push({title:p[h].title,incipit:p[h].incipit,index:p[h].index});for(M.sort((e,t)=>{var n=e.title.toUpperCase(),o=t.title.toUpperCase();return n<o?-1:n>o?1:0}),h=0;h<totalTunes;++h)p[h].title=M[h].title,p[h].incipit=M[h].incipit,p[h].index=M[h].index}for(h=0;h<totalTunes;++h){_=p[h].title;var F,w=!1;0==_.indexOf("*")&&(_=(_=_.replaceAll("*","")).trim(),w=!0,d+=TEXTINCIPITLINESPACING),y=p[h].incipit,e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE);var D=e.getTextWidth(_);w?(0!=h&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE),d=gTEXTINCIPITTOPOFFSET),e.setFont(gPDFFont,"bold","normal"),e.setFontSize(TEXTINCIPITFONTSIZE),D=e.getTextWidth(_),e.text(_,e.internal.pageSize.getWidth()/3.1-D/2,d,{align:"left"})):(e.text(_,gTEXTINCIPITLEFTMARGIN,d,{align:"left"}),e.setFont("Courier","normal","normal"),e.setFontSize(TEXTINCIPITFONTSIZE),e.text(y,g-gTEXTINCIPITRIGHTMARGIN,d,{align:"left"})),r.push(theCurrentPageNumber),"portrait"==gPDFOrientation?(F=119,"a4"==a&&(F=125),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*gTEXTINCIPITLEFTMARGIN,y:1.55*d-(gTEXTINCIPITTOPOFFSET+F),width:1.55*D,height:1.55*TEXTINCIPITLINESPACING,url:""})):(F=78,"a4"==a&&(F=82),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*gTEXTINCIPITLEFTMARGIN,y:(d-TEXTINCIPITLINESPACING)*1.55-(gTEXTINCIPITTOPOFFSET+F),width:1.55*D,height:1.55*TEXTINCIPITLINESPACING,url:""})),d+=TEXTINCIPITLINESPACING,w&&(d+=TEXTINCIPITLINESPACING),h!=totalTunes-1&&d>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TEXTINCIPITFONTSIZE),d=gTEXTINCIPITTOPOFFSET)}if(l){var L=[];for(h=0;h<totalTunes;++h)for(f=0;f<totalTunes;++f)if(p[f].index==h){L.push(gTuneHyperlinks[f]);break}gTuneHyperlinks=L}return r}var FULLTEXTINCIPITFONTSIZE=11,FULLTEXTINCIPITLINESPACING=9,FULLTEXTINCIPITLEFTMARGIN=45;function GenerateFullTextIncipits(e,t,n,o,a,r,l,s){var g=e.internal.pageSize.getHeight();e.internal.pageSize.getWidth();var c=g-(PAGETOPOFFSET+TEXTINCIPITBOTTOMOFFSET),d=gTEXTINCIPITTOPOFFSET;FULLTEXTINCIPITFONTSIZE=11,FULLTEXTINCIPITLINESPACING=9,FULLTEXTINCIPITLEFTMARGIN=35,s&&(FULLTEXTINCIPITFONTSIZE=10,FULLTEXTINCIPITLINESPACING=8,FULLTEXTINCIPITLEFTMARGIN=30);var u=GetTunebookIndexTitles();e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE);var p=[];for(h=0;h<totalTunes;++h){for(A=getTuneByIndex(h),s&&0!=u[h].indexOf("*")&&(A=ceoltasABCTransformer(A,!1,!0)),A=StripTabOne(A=StripChordsOne(A=StripTextAnnotationsOne(A=StripAnnotationsOne(A)))),v=/^M:.*[\r\n]*/gm,S=(C=(A=escape(A=A.replace(v,""))).split("%0A")).length,P="",f=0;f<S&&-1==(P=unescape(C[f])).indexOf("K:");++f);P=(P=(P=(P=(P=(P=(P=(P=(P=(P=(P=P.replace("K:","")).trim()).replace("Major","maj")).replace("Minor","min")).replace("Dorian","dor")).replace("Mixolydian","mix")).replace("major","maj")).replace("minor","min")).replace("dorian","dor")).replace("mixolydian","mix")).replace(" ","");var m=[];for(T=0;T<S;++T)if(-1!=(y=unescape(C[T])).indexOf("|")){for(f=0,b=(y=cleanIncipitLine(y)).split("|"),I=[],B=b.length;f<B;++f)""!=b[f]&&I.push(b[f]);for(f=0,B=I.length,E="";f<B;++f)I[f]=I[f].trim(),E+=I[f],f!=B-1&&(E+=" | ");0==(y=E).indexOf(" | ")&&(y=y.substring(3,y.length)),m.push(y)}_=(_=u[h]).trim(),""!=P&&(_+=" ("+P+")"),p.push({title:_,incipits:m})}for(h=0;h<totalTunes;++h){_=p[h].title;var h,f,T,A,y,b,I,v,C,S,B,E,_,P,M,F=!1;0==_.indexOf("*")&&(_=(_=_.replaceAll("*","")).trim(),F=!0,0!=h&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),d=gTEXTINCIPITTOPOFFSET));var m=p[h].incipits,S=m.length,w=1.5*FULLTEXTINCIPITLINESPACING;S>0&&(w+=(S-1)*FULLTEXTINCIPITLINESPACING),d+w>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),d=gTEXTINCIPITTOPOFFSET),r.push(theCurrentPageNumber),e.setFont(gPDFFont,"bold","normal"),e.setFontSize(1.1*FULLTEXTINCIPITFONTSIZE),e.text(_,FULLTEXTINCIPITLEFTMARGIN,d,{align:"left"});var D=e.getTextWidth(_);"portrait"==gPDFOrientation?(M=117,"a4"==a&&(M=124),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*FULLTEXTINCIPITLEFTMARGIN,y:1.55*d-(gTEXTINCIPITTOPOFFSET+M),width:1.55*D,height:1.5*FULLTEXTINCIPITLINESPACING*1.55,url:""})):(M=83,"a4"==a&&(M=83),gTuneHyperlinks.push({page:theCurrentPageNumber,x:1.55*FULLTEXTINCIPITLEFTMARGIN,y:(d-FULLTEXTINCIPITLINESPACING)*1.55-(gTEXTINCIPITTOPOFFSET+M),width:1.55*D,height:1.8*FULLTEXTINCIPITLINESPACING*1.55,url:""})),d+=1.5*FULLTEXTINCIPITLINESPACING;for(var f=0;f<S;++f){var y=m[f];e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),e.text(y,FULLTEXTINCIPITLEFTMARGIN,d,{align:"left"}),f==S-1&&h!=totalTunes-1&&(d+=FULLTEXTINCIPITLINESPACING),d+=FULLTEXTINCIPITLINESPACING,h!=totalTunes-1&&d>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),d=gTEXTINCIPITTOPOFFSET)}F&&(d+=FULLTEXTINCIPITLINESPACING),h!=totalTunes-1&&d>c&&(theCurrentPageNumber++,e.addPage(a,gPDFOrientation),e.setFont("Courier","normal","normal"),e.setFontSize(FULLTEXTINCIPITFONTSIZE),d=gTEXTINCIPITTOPOFFSET)}return r}function processSingleTunePlaybackInjectsQR(e){if(gAllNoSwingHornpipesRequested){if(tuneIsHornpipe(e)&&-1==e.indexOf("%swing")){var t=/^X:.*[\r\n]*/gm;e="X:1\n%noswing\n"+(e=e.replace(t,""))}}else if(gAllSwingHornpipesRequested&&tuneIsHornpipe(e)&&-1==e.indexOf("%noswing")){var t=/^X:.*[\r\n]*/gm;e="X:1\n%swing "+gAllSwingHornpipesSwingFactor+"\n"+(e=e.replace(t,""))}if(gAddPlaybackHyperlinksIncludePrograms){var t=/^X:.*[\r\n]*/gm;e="X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n"+(e=e.replace(t,""))}return e}function PostProcessMixedNotationAndQRCode(e,t,n,o,a,r,l){IntermixTuneQRCodes(e,o,a,r,function e(){l()})}function IntermixTuneQRCodes(e,t,n,o,a){if(0!=totalTunes){var r,l=GetTunebookIndexTitles();gTuneHyperlinks=[],!function s(g){if(gPDFCancelRequested||g==totalTunes){a();return}document.getElementById("statustunecount").innerHTML="Adding Tune QR Code "+(g+1)+" of "+totalTunes,r=getTuneByIndex(g),gAddPlaybackHyperlinks&&(r=processSingleTunePlaybackInjectsQR(r)),theCurrentPageNumber=g!=totalTunes-1?n[g+1]-1:o,e.setPage(theCurrentPageNumber),AppendPDFTuneQRCode(pdf,t,r,l[g],function e(){s(++g)})}(0)}}function GenerateFullTuneQRCodes(e,t,n,o,a,r,l){if(0==totalTunes){l([]);return}var s,g=GetTunebookIndexTitles();!function t(n){if(gPDFCancelRequested||n==totalTunes){l(r);return}document.getElementById("statustunecount").innerHTML="Adding Tune QR Code "+(n+1)+" of "+totalTunes,n>0&&e.addPage(a,gPDFOrientation),s=getTuneByIndex(n),gAddPlaybackHyperlinks&&(s=processSingleTunePlaybackInjectsQR(s)),AppendPDFTuneQRCode(pdf,a,s,g[n],function e(){r.push(theCurrentPageNumber),n!=totalTunes-1&&theCurrentPageNumber++,t(++n)})}(0)}var gINDEXTOPOFFSET=330,INDEXBOTTOMOFFSET=16,INDEXTITLEOFFSET=35,INDEXLEFTMARGIN=90,INDEXRIGHTMARGIN=105,INDEXTITLESIZE=18,INDEXFONTSIZE=13,INDEXLINESPACING=12;function AppendTunebookIndex(e,t,n,o,a,r,l,s,g,c){e.addPage(o,gPDFOrientation),TunebookIndexHeaderRequested&&AddPageTextHeader(e,o,theTunebookIndexHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(INDEXTITLESIZE),""!=r&&e.text(r,e.internal.pageSize.getWidth()/3.1,gINDEXTOPOFFSET,{align:"center"});var d=GetTunebookIndexTitles(),u=pdf.internal.pageSize.getHeight(),p=pdf.internal.pageSize.getWidth()/1.55,m=u-(PAGETOPOFFSET+INDEXBOTTOMOFFSET),h=gINDEXTOPOFFSET+INDEXTITLEOFFSET;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(INDEXFONTSIZE);var f=[];for(T=0;T<totalTunes;++T)f.push(a[T]);if(l){for(T=0;T<totalTunes;++T)0==(y=d[T]).indexOf("The ")&&(y=y.substring(4,y.length)+", The",d[T]=y);var T,A,y,b=[];for(T=0;T<totalTunes;++T)b.push({name:d[T],pageNumber:f[T]});for(b.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return n<o?-1:n>o?1:0}),T=0;T<totalTunes;++T)d[T]=b[T].name,s||(f[T]=b[T].pageNumber)}var I=!0;for(T=0;T<totalTunes;++T){var v=A=f[T];if(g&&(v+=c),0!=d[T].indexOf("*")){if(TunebookIndexWithNoPageNumbers){var C=e.getTextWidth(d[T]);g?e.textWithLink(d[T],e.internal.pageSize.getWidth()/3.1-C/2,h,{align:"left",pageNumber:v}):e.text(d[T],e.internal.pageSize.getWidth()/3.1-C/2,h,{align:"left"})}else g?e.textWithLink(d[T],INDEXLEFTMARGIN,h,{align:"left",pageNumber:v}):e.text(d[T],INDEXLEFTMARGIN,h,{align:"left"}),g?e.textWithLink(""+A,p-INDEXRIGHTMARGIN,h,{align:"left",pageNumber:v}):e.text(""+A,p-INDEXRIGHTMARGIN,h,{align:"left"});h+=INDEXLINESPACING}else{var S=d[T];S=(S=S.replaceAll("*","")).trim();var C=e.getTextWidth(S);!l&&(I||(h+=INDEXLINESPACING,I=!0),I&&(I=!1)),g?e.textWithLink(S,e.internal.pageSize.getWidth()/3.1-C/2,h,{align:"left",pageNumber:v}):e.text(S,e.internal.pageSize.getWidth()/3.1-C/2,h,{align:"left"}),l?h+=INDEXLINESPACING:h+=2*INDEXLINESPACING}T!=totalTunes-1&&h>m&&(theCurrentPageNumber++,e.addPage(o,gPDFOrientation),TunebookIndexHeaderRequested&&AddPageTextHeader(e,o,theTunebookIndexHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(INDEXFONTSIZE),h=gINDEXTOPOFFSET+INDEXTITLEOFFSET),I=!1}theCurrentPageNumber++}function PostProcessHeadersAndFooters(e,t,n,o,a,r,l){for(var s=n;s<n+o;++s)e.setPage(s),AddPageHeaderFooter(e,t,s-n+1,a,r,l)}var gAcrobatURLLimitExceeded=[],ACROBATMAXURLLENGTH=2076,gGotURLLengthWarning=!1;function GetAllTuneHyperlinks(e){function t(e){if(gAllNoSwingHornpipesRequested){if(tuneIsHornpipe(e)&&-1==e.indexOf("%swing")){var t=/^X:.*[\r\n]*/gm;e="X:1\n%noswing\n"+(e=e.replace(t,""))}}else if(gAllSwingHornpipesRequested&&tuneIsHornpipe(e)&&-1==e.indexOf("%noswing")){var t=/^X:.*[\r\n]*/gm;e="X:1\n%swing "+gAllSwingHornpipesSwingFactor+"\n"+(e=e.replace(t,""))}if(gAddPlaybackHyperlinksIncludePrograms){var t=/^X:.*[\r\n]*/gm;e="X:1\n%abcjs_soundfont "+gPlaybackHyperlinkSoundFont+"\n%%MIDI program "+gPlaybackHyperlinkMelodyProgram+"\n%%MIDI bassprog "+gPlaybackHyperlinkBassProgram+"\n%%MIDI chordprog "+gPlaybackHyperlinkChordProgram+"\n"+(e=e.replace(t,""))}return e}function n(){for(var e=CountTunes(),n=FindPreTuneHeader(gTheABC.value),a=0;a<e;++a){var r=getTuneByIndex(a);0==o[a].indexOf("*")||(r=t(r)),n+=r}return n}gGotURLLengthWarning=!1,gAcrobatURLLimitExceeded=[];var o,a=CountTunes();if(o=GetTunebookIndexTitles(),a!=e.length)return!1;for(var r=0;r<a;++r){var l=getTuneByIndex(r);if(0!=o[r].indexOf("*")){var s="";if(gAddPlaybackHyperlinks){var g=l;g=gAddTunebookPlaybackHyperlinks?n():t(g);var c=FillUrlBoxWithAbcInLZW(g,!1);c.length>=8100?!gGotURLLengthWarning&&(gGotURLLengthWarning=!0,gAddTunebookPlaybackHyperlinks&&DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:12pt;">Share URL for entire tunebook is too long to add to the tunes.</p>',{theme:"modal_flat",top:230,scrollWithPage:AllowDialogsToScroll()})):(c+="&play=1",gAddTunebookPlaybackHyperlinks&&(c+="&index="+r),gInjectEditDisabled&&(c+="&dx=1"),c.length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[r],urllength:c.length}),e[r].url=c)}else gAddTheSessionHyperlinks&&(e[r].url="https://thesession.org/tunes/search?q="+encodeURIComponent(o[r]));var d=/^%add_link_to_thesession.*$/m,u=l.match(d);u&&u.length>0&&(e[r].url="https://thesession.org/tunes/search?q="+encodeURIComponent(o[r])),d=/^%add_playback_link.*$/m;var p=l.match(d);if(p&&p.length>0){var g=l,m=p[0].replace("%add_playback_link","").match(/\b(\w+)\b/g),h=gTheMelodyProgram,f=gTheBassProgram,T=gTheChordProgram,A="fluid";-1!=gDefaultSoundFont.indexOf("Fluid")?A="fluid":-1!=gDefaultSoundFont.indexOf("Musyng")?A="musyng":-1!=gDefaultSoundFont.indexOf("FatBoy")?A="fatboy":-1!=gDefaultSoundFont.indexOf("canvas")?A="canvas":-1!=gDefaultSoundFont.indexOf("mscore")&&(A="mscore"),gAddPlaybackHyperlinks&&(A=gPlaybackHyperlinkSoundFont,h=gPlaybackHyperlinkMelodyProgram,f=gPlaybackHyperlinkBassProgram,T=gPlaybackHyperlinkChordProgram);var y=!1;if(m&&m.length>0&&(m.length>=1&&(h=(h=m[0]).trim()),m.length>=2&&(f=(f=m[1]).trim()),m.length>=3&&(T=(T=m[2]).trim()),m.length>=4&&(A=(A=m[3]).trim()),y=!0),y){var d=/^X:.*[\r\n]*/gm;g="X:1\n%abcjs_soundfont "+A+"\n%%MIDI program "+h+"\n%%MIDI bassprog "+f+"\n%%MIDI chordprog "+T+"\n"+(g=g.replace(d,""))}var c=FillUrlBoxWithAbcInLZW(g,!1);gInjectEditDisabled&&(c+="&dx=1"),(c+="&play=1").length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[r],urllength:c.length}),e[r].url=c}d=/^%hyperlink.*$/m;var b=l.match(d);b&&b.length>0&&((s=(s=b[0].replace("%hyperlink","")).trim()).length>ACROBATMAXURLLENGTH&&gAcrobatURLLimitExceeded.push({name:o[r],urllength:s.length}),e[r].url=s)}}return!0}function PostProcessTuneHyperlinks(e,t,n,o){if(t){if(GetAllTuneHyperlinks(t)){e.internal.pageSize.getWidth(),e.internal.pageSize.getHeight(),e.setFont("Verdana","","normal"),e.setFontSize(18);for(var a=t.length,r=-1,l=0;l<a;++l){var s=t[l];if(""!=s.url){var g=s.page;g!=r&&(e.setPage(g+o-1),r=g);var c={left:s.x,top:s.y,width:s.width,height:s.height};c=pageRect2LinkRect(e,c,n),e.link(c.left,c.top,c.width,c.height,{url:s.url})}}}}}function PostProcessTOCAndIndexLinks(e,t,n,o,a,r,l){for(var s=t;s<=n;++s){e.setPage(s),e.setFont("Verdana","","normal"),e.setFontSize(18);var g=e.internal.pageSize.getWidth(),c=e.internal.pageSize.getHeight();if(o&&e.textWithLink("<<",5,c/1.55,{align:"left",pageNumber:a}),r){var d=e.getTextWidth(">>");e.textWithLink(">>",g/1.55-(d+5),c/1.55,{align:"left",pageNumber:l})}}}function AddPageTextHeader(e,t,n){var o=gPAGENUMBERTOP;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(HEADERFOOTERFONTSIZE),e.text(n,e.internal.pageSize.getWidth()/3.1,o,{align:"center"})}var gTOCTOPOFFSET=330,TOCBOTTOMOFFSET=16,TOCTITLEOFFSET=35,TOCLEFTMARGIN=90,TOCRIGHTMARGIN=105,TOCTITLESIZE=18,TOCFONTSIZE=13,TOCLINESPACING=12;function AppendTuneTOC(e,t,n,o,a,r,l,s,g,c,d){var u=d;e.setPage(u),TunebookTOCHeaderRequested&&AddPageTextHeader(e,o,theTunebookTOCHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TOCTITLESIZE),""!=r&&e.text(r,e.internal.pageSize.getWidth()/3.1,gTOCTOPOFFSET,{align:"center"});var p=GetTunebookIndexTitles(),m=pdf.internal.pageSize.getHeight(),h=pdf.internal.pageSize.getWidth()/1.55,f=m-(PAGETOPOFFSET+TOCBOTTOMOFFSET),T=gTOCTOPOFFSET+TOCTITLEOFFSET;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TOCFONTSIZE);var A=[];for(y=0;y<totalTunes;++y)A.push(a[y]);if(l){for(y=0;y<totalTunes;++y)0==(I=p[y]).indexOf("The ")&&(I=I.substring(4,I.length)+", The",p[y]=I);var y,b,I,v=[];for(y=0;y<totalTunes;++y)v.push({name:p[y],pageNumber:A[y]});for(v.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return n<o?-1:n>o?1:0}),y=0;y<totalTunes;++y)p[y]=v[y].name,s||(A[y]=v[y].pageNumber)}var C=!0;for(y=0;y<totalTunes;++y){if(b=A[y],0!=p[y].indexOf("*")){if(TunebookTOCWithNoPageNumbers){var S=e.getTextWidth(p[y]);g?e.textWithLink(p[y],e.internal.pageSize.getWidth()/3.1-S/2,T,{align:"left",pageNumber:b+c}):e.tex(p[y],e.internal.pageSize.getWidth()/3.1-S/2,T,{align:"left"})}else g?e.textWithLink(p[y],TOCLEFTMARGIN,T,{align:"left",pageNumber:b+c}):e.text(p[y],TOCLEFTMARGIN,T,{align:"left"}),g?e.textWithLink(""+b,h-TOCRIGHTMARGIN,T,{align:"left",pageNumber:b+c}):e.text(""+b,h-TOCRIGHTMARGIN,T,{align:"left"});T+=TOCLINESPACING}else{var B=p[y];B=(B=B.replaceAll("*","")).trim();var S=e.getTextWidth(B);!l&&(C||(T+=TOCLINESPACING,C=!0),C&&(C=!1)),g?e.textWithLink(B,e.internal.pageSize.getWidth()/3.1-S/2,T,{align:"left",pageNumber:b+c}):e.text(B,e.internal.pageSize.getWidth()/3.1-S/2,T,{align:"left"}),l?T+=TOCLINESPACING:T+=2*TOCLINESPACING}y!=totalTunes-1&&T>f&&(u++,e.setPage(u),TunebookTOCHeaderRequested&&AddPageTextHeader(e,o,theTunebookTOCHeader),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(TOCFONTSIZE),T=gTOCTOPOFFSET+TOCTITLEOFFSET),C=!1}}function DryRunAddTuneTOC(e,t,n,o,a,r,l,s){e.addPage(o,gPDFOrientation);var g=GetTunebookIndexTitles(),c=pdf.internal.pageSize.getHeight();pdf.internal.pageSize.getWidth();var d=c-(PAGETOPOFFSET+TOCBOTTOMOFFSET),u=gTOCTOPOFFSET+TOCTITLEOFFSET,p=[];for(m=0;m<totalTunes;++m)p.push(a[m]);if(l){for(m=0;m<totalTunes;++m)0==(h=g[m]).indexOf("The ")&&(h=h.substring(4,h.length)+", The",g[m]=h);var m,h,f=[];for(m=0;m<totalTunes;++m)f.push({name:g[m],pageNumber:p[m]});for(f.sort((e,t)=>{var n=e.name.toUpperCase(),o=t.name.toUpperCase();return n<o?-1:n>o?1:0}),m=0;m<totalTunes;++m)g[m]=f[m].name,s||(p[m]=f[m].pageNumber)}var T=!0;for(m=0;m<totalTunes;++m)0!=g[m].indexOf("*")?u+=TOCLINESPACING:l?u+=TOCLINESPACING:(T?u+=2*TOCLINESPACING:u+=3*TOCLINESPACING,T&&(T=!1)),m!=totalTunes-1&&u>d&&(theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1),u=gTOCTOPOFFSET+TOCTITLEOFFSET,e.addPage(o,gPDFOrientation));theCurrentPageNumber++,e.movePage(theCurrentPageNumber,1)}function pageRect2LinkRect(e,t,n){var o=26;return"a4"==n&&(o=27),t.left=t.left/1.55,t.top=e.internal.pageSize.getHeight()/3.1+o+t.top/1.55,t.width=t.width/1.55,t.height=t.height/1.55,t}function pageVOffset2LinkVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),e.internal.pageSize.getHeight()/3.1+o+t/1.55}function linkVOffset2PageVOffset(e,t,n){var o=26;return"a4"==n&&(o=27),t-=e.internal.pageSize.getHeight()/3.1+o,t*=1.55}function AppendPDFTuneQRCode(e,t,n,o,a){r=FillUrlBoxWithAbcInLZW(n,!1),gAddPlaybackHyperlinks&&(r+="&play=1");var r,l=!0;r.length>2300&&(r=FillUrlBoxWithAbcInLZW("X:1\nT:"+o+"\nT:Tune ABC was too long to generate a valid QR Code\n",!1),l=!1),null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:r,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(r)),setTimeout(function(){var n=document.querySelectorAll('div[id="qrcode"] > img');if(n&&n[0]){s="portrait"==gPDFOrientation?"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1-18:e.internal.pageSize.getWidth()/3.1-22:"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1+12:e.internal.pageSize.getWidth()/3.1+24;var s,g,c,d=(n=n[0]).src;s-=64,"portrait"==gPDFOrientation?(e.addImage(d,"PNG",s,150,384,384,void 0,"FAST"),g={left:s,top:150,width:384,height:384}):(e.addImage(d,"PNG",s,86,384,384,void 0,"FAST"),g={left:s,top:75,width:384,height:384}),gTuneHyperlinks.push({page:theCurrentPageNumber,x:g.left,y:g.top,width:g.width,height:g.height,url:r}),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(QRCODECAPTIONPDFFONTSIZE),"portrait"==gPDFOrientation?(c=558,"a4"==t&&(c=575),c+=80):(c=500,"a4"==t&&(c=500),c+=32);var u=o;l||(u=o+" - Tune is too long to generate a QR Code. Click to open instead.");var p=e.internal.pageSize.getWidth(),m=e.getTextWidth(u);e.text(u,p/3.1-m/2,c,{align:"left"}),gTheQRCode.clear(),a()}else gTheQRCode.clear(),a()},25)}function AppendQRCode(e,t,n){var o;if(gDoForceQRCodeURLOverride)o=gQRCodeURLOverride;else if(o=FillUrlBoxWithAbcInLZW(null,!1),!gAllowQRCodeSave){n(!1);return}null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:o,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(o)),setTimeout(function(){var a=document.querySelectorAll('div[id="qrcode"] > img');if(a&&a[0]){e.addPage(t,gPDFOrientation),r="portrait"==gPDFOrientation?"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1-18:e.internal.pageSize.getWidth()/3.1-22:"letter"==gPDFPaperSize?e.internal.pageSize.getWidth()/3.1+12:e.internal.pageSize.getWidth()/3.1+24;var r,l,s,g=(a=a[0]).src;r-=64,"portrait"==gPDFOrientation?(e.addImage(g,"PNG",r,150,384,384,void 0,"FAST"),l={left:r,top:150,width:384,height:384}):(e.addImage(g,"PNG",r,86,384,384,void 0,"FAST"),l={left:r,top:75,width:384,height:384}),l=pageRect2LinkRect(e,l,t),e.link(l.left,l.top,l.width,l.height,{url:o}),e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(QRCODECAPTIONPDFFONTSIZE),"portrait"==gPDFOrientation?(s=558,"a4"==t&&(s=575),s+=80):(s=500,"a4"==t&&(s=500),s+=32);var c=theHeaderFooterTuneNames;gDoForceQRCodeCaptionOverride&&(c=gQRCodeCaptionOverride);var d=e.internal.pageSize.getWidth(),u=e.getTextWidth(c);e.textWithLink(c,d/3.1-u/2,s,{align:"left",url:o}),gTheQRCode.clear(),n(!0)}else gTheQRCode.clear(),n(!1)},1e3)}function getDescriptiveFileName(e,t){var n="";if(gABCFromFile?n=(n=(n=(n=(n=gDisplayedName).trim()).replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).replace(/\s/g,"_")).replace(/\..+$/,""):(n=GetFirstTuneTitle(),e>1&&(n+="_Set")),t){var o=GetRadioValue("notenodertab"),a="";switch(o){case"noten":a="";break;case"notenames":a="_Note_Names";break;case"mandolin":a="_Mandolin";break;case"gdad":a="_GDAD";break;case"cgdae":a="_CGDAE";break;case"guitare":a="_Guitar";break;case"guitard":a="_DADGAD";break;case"uke":a="_Ukulele";break;case"whistle":a="_Whistle"}switch(n+=a,a="",o){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"cgdae":case"guitare":case"guitard":case"uke":gCapo>0&&(a="_Capo_"+gCapo)}n+=a}return n}function ProcessTunesForContinuousLayout(e,t,n){var o=e.length;if(o<=1)return e;var a=[];for(r=0;r<o;++r){g=(s=document.getElementById("notation"+r)).offsetHeight/PDFSCALEFACTOR;var r,l,s,g,c,d,u=[],p=s.children,m=p.length,h=1;n&&(m>2&&(m=2),2==gIncipitsColumns&&(h=2));var f=0;for(l=0;l<m;++l)c=(d=p.item(l)).offsetHeight/PDFSCALEFACTOR,u.push(c/=h),f+=c;n&&(g=f);var T={theElement:s,height:g,staffHeights:u};a.push(T)}var A=t-(PAGETOPOFFSET+PAGEBOTTOMOFFSET),y=A+BETWEENTUNESPACE,b=!0;for(r=0;r<o;++r){0!=r&&e[r-1]&&(y=A+BETWEENTUNESPACE);var I=a[r].height;"landscape"==gPDFOrientation&&(I="letter"==gPDFPaperSize?718*I/535:785*I/535);var v=I+a[r].staffHeights.length/h;if(v>y){if(0!=r&&(e[r-1]=!0),y=A+BETWEENTUNESPACE,v>A){var v,C,S,B=a[r].staffHeights.length;for(l=0;l<B;++l)(C=y-(S=a[r].staffHeights[l]+1))<0&&(y=A),y-=S;y-=BETWEENTUNESPACE/h,b=!1}else y=A+BETWEENTUNESPACE,y-=v,y-=BETWEENTUNESPACE/h,b=!0}else b&&(b=!1),y-=v,y-=BETWEENTUNESPACE/h}return e}function scanTunesForPageBreaks(e,t,n){switch(gPDFOrientation){case"portrait":o=PAGEHEIGHTLETTER,"a4"==t&&(o=PAGEHEIGHTA4);break;case"landscape":o=PAGEHEIGHTLETTER_LANDSCAPE,"a4"==t&&(o=PAGEHEIGHTA4_LANDSCAPE)}var o,a=[],r=gTheABC.value.split(/^X:.*$/gm),l=r.length-1;if(0==l)return a;if(n)for(var s=1;s<=l;++s)a.push(!1);else for(var s=1;s<=l;++s)s>1&&isSectionHeader(r[s])&&(a[s-2]=!0),-1!=r[s].indexOf("%%newpage")?a.push(!0):a.push(!1);return ProcessTunesForContinuousLayout(a,o,n)}function formatDate(e){var t=new Date,n=""+(t.getMonth()+1),o=""+t.getDate(),a=t.getFullYear();return(n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),0==e)?[n,o,a].join("-"):[a,n,o].join("-")}function formatTime(){if(""!=theRenderTime)return theRenderTime;var e=new Date,t=e.getHours(),n=e.getMinutes(),o=" AM";0==t&&(t=12),t>12&&(t-=12,o=" PM"),t=""+t,(n=""+n).length<2&&(n="0"+n);var a=[t,n].join(":");return a+=o,theRenderTime=a,a}function ParseCommentCommands(e){thePageHeader="",thePageFooter="";var t=/^%pageheader.*$/m,n=e.match(t);n&&n.length>0&&(thePageHeader=(thePageHeader=n[0].replace("%pageheader","")).trim()),t=/^%pagefooter.*$/m;var o=e.match(t);o&&o.length>0&&(thePageFooter=(thePageFooter=o[0].replace("%pagefooter","")).trim()),gQRCodeRequested=!1,gDoForceQRCodeURLOverride=!1,gQRCodeURLOverride="",t=/^%qrcode.*$/m;var a=e.match(t);a&&a.length>0&&(gQRCodeRequested=!0,""!=(gQRCodeURLOverride=(gQRCodeURLOverride=a[0].replace("%qrcode","")).trim())&&(gDoForceQRCodeURLOverride=!0)),gDoForceQRCodeCaptionOverride=!1,gQRCodeCaptionOverride="",t=/^%caption_for_qrcode.*$/m;var r=e.match(t);r&&r.length>0&&""!=(gQRCodeCaptionOverride=(gQRCodeCaptionOverride=r[0].replace("%caption_for_qrcode","")).trim())&&(gDoForceQRCodeCaptionOverride=!0),theTunebookIndexTitle="",TunebookIndexRequested=!1,t=/^%addindex.*$/m;var l=e.match(t);l&&l.length>0&&(TunebookIndexRequested=!0,theTunebookIndexTitle=(theTunebookIndexTitle=l[0].replace("%addindex","")).trim()),theTunebookSortedIndexTitle="",TunebookSortedIndexRequested=!1,t=/^%addsortedindex.*$/m;var s=e.match(t);s&&s.length>0&&(TunebookSortedIndexRequested=!0,theTunebookSortedIndexTitle=(theTunebookSortedIndexTitle=s[0].replace("%addsortedindex","")).trim()),theTunebookTOCTitle="",TunebookTOCRequested=!1,t=/^%addtoc.*$/m;var g=e.match(t);g&&g.length>0&&(TunebookTOCRequested=!0,theTunebookTOCTitle=(theTunebookTOCTitle=g[0].replace("%addtoc","")).trim()),theTunebookSortedTOCTitle="",TunebookSortedTOCRequested=!1,t=/^%addsortedtoc.*$/m;var c=e.match(t);c&&c.length>0&&(TunebookSortedTOCRequested=!0,theTunebookSortedTOCTitle=(theTunebookSortedTOCTitle=c[0].replace("%addsortedtoc","")).trim()),theTunebookTP="",TunebookTPRequested=!1,t=/^%addtitle.*$/m;var d=e.match(t);d&&d.length>0&&(TunebookTPRequested=!0,theTunebookTP=(theTunebookTP=d[0].replace("%addtitle","")).trim()),theTunebookTPST="",TunebookTPSTRequested=!1,t=/^%addsubtitle.*$/m;var u=e.match(t);u&&u.length>0&&(TunebookTPSTRequested=!0,theTunebookTPST=(theTunebookTPST=u[0].replace("%addsubtitle","")).trim()),INDEXFONTSIZE=13,t=/^%indexfontsize.*$/m;var p=e.match(t);if(p&&p.length>0){var m=p[0].replace("%indexfontsize",""),h=parseInt(m=m.trim());!isNaN(h)&&h>0&&(INDEXFONTSIZE=h)}INDEXLINESPACING=12,t=/^%indexlinespacing.*$/m;var f=e.match(t);if(f&&f.length>0){var T=f[0].replace("%indexlinespacing",""),A=parseInt(T=T.trim());!isNaN(A)&&A>=0&&(INDEXLINESPACING=A)}INDEXTITLESIZE=18,t=/^%indextitlefontsize.*$/m;var y=e.match(t);if(y&&y.length>0){var m=y[0].replace("%indextitlefontsize",""),h=parseInt(m=m.trim());!isNaN(h)&&h>0&&(INDEXTITLESIZE=h)}INDEXTITLEOFFSET=35,t=/^%indextitleoffset.*$/m;var b=e.match(t);if(b&&b.length>0){var I=b[0].replace("%indextitleoffset",""),v=parseInt(I=I.trim());!isNaN(v)&&v>=0&&(INDEXTITLEOFFSET=v)}t=/^%indextopoffset.*$/m;var C=e.match(t);if(C&&C.length>0){var S=C[0].replace("%indextopoffset",""),B=parseInt(S=S.trim());!isNaN(B)&&B>=0&&(gINDEXTOPOFFSET=B+300)}TOCFONTSIZE=13,t=/^%tocfontsize.*$/m;var E=e.match(t);if(E&&E.length>0){var m=E[0].replace("%tocfontsize",""),h=parseInt(m=m.trim());!isNaN(h)&&h>0&&(TOCFONTSIZE=h)}TOCLINESPACING=12,t=/^%toclinespacing.*$/m;var _=e.match(t);if(_&&_.length>0){var T=_[0].replace("%toclinespacing",""),A=parseInt(T=T.trim());!isNaN(A)&&A>=0&&(TOCLINESPACING=A)}TOCTITLESIZE=18,t=/^%toctitlefontsize.*$/m;var P=e.match(t);if(P&&P.length>0){var m=P[0].replace("%toctitlefontsize",""),h=parseInt(m=m.trim());!isNaN(h)&&h>0&&(TOCTITLESIZE=h)}TOCTITLEOFFSET=35,t=/^%toctitleoffset.*$/m;var M=e.match(t);if(M&&M.length>0){var I=M[0].replace("%toctitleoffset",""),v=parseInt(I=I.trim());!isNaN(v)&&v>=0&&(TOCTITLEOFFSET=v)}t=/^%toctopoffset.*$/m;var F=e.match(t);if(F&&F.length>0){var S=F[0].replace("%toctopoffset",""),B=parseInt(S=S.trim());!isNaN(B)&&B>=0&&(gTOCTOPOFFSET=B+300)}gPDFQuality=.75,t=/^%pdfquality.*$/m;var w=e.match(t);if(w&&w.length>0){var D=w[0].replace("%pdfquality",""),L=parseFloat(D=D.trim());!isNaN(L)&&L>=0&&(gPDFQuality=L)}gIncludePageLinks=!0,t=/^%no_toc_or_index_links.*$/m;var R=e.match(t);R&&R.length>0&&(gIncludePageLinks=!1),gForcePDFFilename="",gDoForcePDFFilename=!1,t=/^%pdfname.*$/m;var k=e.match(t);k&&k.length>0&&(gDoForcePDFFilename=!0,""==(gForcePDFFilename=(gForcePDFFilename=k[0].replace("%pdfname","")).trim())&&(gDoForcePDFFilename=!1)),thePageHeaderURL="",thePageFooterURL="",t=/^%urlpageheader.*$/m;var N=e.match(t);if(N&&N.length>0){var H=N[0].replace("%urlpageheader ",""),O=(H=H.trim()).split(" ");O.length>1&&(thePageHeaderURL=O[0],thePageHeader=(thePageHeader=H.replace(thePageHeaderURL,"")).trim())}t=/^%urlpagefooter.*$/m;var z=e.match(t);if(z&&z.length>0){var G=z[0].replace("%urlpagefooter ",""),O=(G=G.trim()).split(" ");O.length>1&&(thePageFooterURL=O[0],thePageFooter=(thePageFooter=G.replace(thePageFooterURL,"")).trim())}theTunebookTPURL="",theTunebookTPSTURL="",t=/^%urladdtitle.*$/m;var U=e.match(t);if(U&&U.length>0){var W=U[0].replace("%urladdtitle ","");theTunebookTP=W.trim();var O=W.split(" ");O.length>1&&(theTunebookTPURL=O[0],theTunebookTP=(theTunebookTP=W.replace(theTunebookTPURL,"")).trim(),TunebookTPRequested=!0)}t=/^%urladdsubtitle.*$/m;var V=e.match(t);if(V&&V.length>0){var Q=V[0].replace("%urladdsubtitle ","");theTunebookTPST=Q.trim();var O=Q.split(" ");O.length>1&&(theTunebookTPSTURL=O[0],theTunebookTPST=(theTunebookTPST=Q.replace(theTunebookTPSTURL,"")).trim(),TunebookTPSTRequested=!0)}gAddTOCLinkback=!1,t=/^%addlinkbacktotoc.*$/m;var Y=e.match(t);Y&&Y.length>0&&(gAddTOCLinkback=!0),gAddIndexLinkback=!1,t=/^%addlinkbacktoindex.*$/m;var X=e.match(t);X&&X.length>0&&(gAddIndexLinkback=!0),gAddTheSessionHyperlinks=!1,t=/^%add_all_links_to_thesession.*$/m;var J=e.match(t);J&&J.length>0&&(gAddTheSessionHyperlinks=!0),t=/^%addlinkstothesession.*$/m,(J=e.match(t))&&J.length>0&&(gAddTheSessionHyperlinks=!0),gInjectEditDisabled=!1,t=/^%no_edit_allowed.*$/m;var q=e.match(t);q&&q.length>0&&(gInjectEditDisabled=!0),gAllSwingHornpipesRequested=!1,gAllSwingHornpipesSwingFactor=gAutoSwingFactor,t=/^%swing_all_hornpipes.*$/m;var K=e.match(t);if(K&&K.length>0){gAllSwingHornpipesRequested=!0;var Z=K[0].replace("%swing_all_hornpipes","");if(""!=(Z=Z.trim())){var ee=parseFloat(Z);!isNaN(ee)&&ee>=-.9&&ee<=.9&&(gAllSwingHornpipesSwingFactor=ee)}}gAllNoSwingHornpipesRequested=!1,t=/^%noswing_all_hornpipes.*$/m;var et=e.match(t);et&&et.length>0&&(gAllNoSwingHornpipesRequested=!0),gAddPlaybackHyperlinks=!1,gAddPlaybackHyperlinksIncludePrograms=!1,t=/^%add_all_playback_links.*$/m;var en=e.match(t);if(en&&en.length>0){gAddPlaybackHyperlinks=!0;var eo=en[0].replace("%add_all_playback_links",""),ea=(eo=eo.trim()).match(/\b(\w+)\b/g);gPlaybackHyperlinkMelodyProgram=gTheMelodyProgram,gPlaybackHyperlinkBassProgram=gTheBassProgram,gPlaybackHyperlinkChordProgram=gTheChordProgram,gPlaybackHyperlinkSoundFont="fluid",-1!=gDefaultSoundFont.indexOf("Fluid")?gPlaybackHyperlinkSoundFont="fluid":-1!=gDefaultSoundFont.indexOf("Musyng")?gPlaybackHyperlinkSoundFont="musyng":-1!=gDefaultSoundFont.indexOf("FatBoy")?gPlaybackHyperlinkSoundFont="fatboy":-1!=gDefaultSoundFont.indexOf("canvas")?gPlaybackHyperlinkSoundFont="canvas":-1!=gDefaultSoundFont.indexOf("mscore")&&(gPlaybackHyperlinkSoundFont="mscore"),ea&&ea.length>0?(gAddPlaybackHyperlinksIncludePrograms=!0,ea.length>=1&&(gPlaybackHyperlinkMelodyProgram=(gPlaybackHyperlinkMelodyProgram=ea[0]).trim()),ea.length>=2&&(gPlaybackHyperlinkBassProgram=(gPlaybackHyperlinkBassProgram=ea[1]).trim()),ea.length>=3&&(gPlaybackHyperlinkChordProgram=(gPlaybackHyperlinkChordProgram=ea[2]).trim()),ea.length>=4&&(gPlaybackHyperlinkSoundFont=(gPlaybackHyperlinkSoundFont=ea[3]).trim())):gAddPlaybackHyperlinksIncludePrograms=!1}gAddTunebookPlaybackHyperlinks=!1,t=/^%playback_links_are_complete_tunebook.*$/m;var er=e.match(t);er&&er.length>0&&(gAddTunebookPlaybackHyperlinks=!0),theTunebookTOCHeader="",TunebookTOCHeaderRequested=!1,t=/^%tocheader.*$/m;var el=e.match(t);el&&el.length>0&&(TunebookTOCHeaderRequested=!0,theTunebookTOCHeader=(theTunebookTOCHeader=el[0].replace("%tocheader","")).trim()),theTunebookIndexHeader="",TunebookTOCIndexHeaderRequested=!1,t=/^%indexheader.*$/m;var ei=e.match(t);ei&&ei.length>0&&(TunebookIndexHeaderRequested=!0,theTunebookIndexHeader=(theTunebookIndexHeader=ei[0].replace("%indexheader","")).trim()),t=/^%pdf_between_tune_space.*$/m,gBetweenTuneSpace=20,gGotBetweenTuneSpace=!1;var es=e.match(t);if(es&&es.length>0){var es=es[0].replace("%pdf_between_tune_space",""),eg=parseInt(es=es.trim());!isNaN(eg)&&eg>=0&&(gBetweenTuneSpace=eg,gGotBetweenTuneSpace=!0)}t=/^%pdffont.*$/m;var ec=e.match(t);if(ec&&ec.length>0){var ed=(ec=(ec=ec[0].replace("%pdffont","")).trim()).split(" ");ed&&ed.length>1?(gPDFFont=ed[0],gPDFFontStyle=ed[1]):(gPDFFont=ec,gPDFFontStyle=""),"normal"==gPDFFontStyle.toLowerCase()&&(gPDFFontStyle="");var eu=gPDFFont.toLowerCase();switch(eu){case"times":"oblique"==gPDFFontStyle.toLowerCase()?gPDFFontStyle="Italic":"boldoblique"==gPDFFontStyle.toLowerCase()&&(gPDFFontStyle="BoldItalic");break;case"helvetica":case"courier":break;default:gPDFFont="Times",gPDFFontStyle=""}var ep=gPDFFontStyle.toLowerCase();if(""!=ep)switch(ep){case"normal":case"bold":case"oblique":case"boldoblique":case"italic":case"bolditalic":break;default:gPDFFontStyle=""}}TunebookTOCWithNoPageNumbers=!1,t=/^%toc_no_page_numbers.*$/m;var em=e.match(t);em&&em.length>0&&(TunebookTOCWithNoPageNumbers=!0),TunebookIndexWithNoPageNumbers=!1,t=/^%index_no_page_numbers.*$/m;var eh=e.match(t);eh&&eh.length>0&&(TunebookIndexWithNoPageNumbers=!0)}function ProcessHeaderFooter(e,t,n){var o=getDescriptiveFileName(n,!0);if(gDoForcePDFFilename){var a=o;""==(o=(o=(o=gForcePDFFilename).trim()).replace(".pdf",""))&&(o=a)}var r=e.replace("$PDFNAME",o+".pdf");r=(r=(r=r.replace("$PAGENUMBER",t)).replace("$TUNECOUNT",totalTunes)).replace("$TUNENAMES",theHeaderFooterTuneNames);var l=formatDate(0),s=formatDate(1);r=(r=r.replace("$DATEMDY",l)).replace("$DATEYMD",s);var g=formatTime();return r.replace("$TIME",g)}function calcPageNumberVerticalOffset(e){thePageNumberVerticalOffset=e.internal.pageSize.getHeight()-9}function AddPageHeaderFooter(e,t,n,o,a,r){var l=gPAGENUMBERTOP;e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var s=!1;if(thePageHeader&&""!=thePageHeader){var g=ProcessHeaderFooter(thePageHeader,n,totalTunes);if(thePageHeaderURL&&""!=thePageHeaderURL){var c=e.getTextWidth(g);e.textWithLink(g,e.internal.pageSize.getWidth()/3.1-c/2,l,{align:"left",url:thePageHeaderURL})}else e.text(g,e.internal.pageSize.getWidth()/3.1,l,{align:"center"});s=!0}var d=!1;if(thePageFooter&&""!=thePageFooter){var u=ProcessHeaderFooter(thePageFooter,n,totalTunes);if(thePageFooterURL&&""!=thePageFooterURL){var c=e.getTextWidth(u);e.textWithLink(u,e.internal.pageSize.getWidth()/3.1-c/2,thePageNumberVerticalOffset,{align:"center",url:thePageFooterURL})}else e.text(u,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});d=!0}if(t&&(!a||1!=n)){e.setFont(gPDFFont,gPDFFontStyle,"normal"),e.setFontSize(HEADERFOOTERFONTSIZE);var p=""+n;switch(o){case"tl":e.text(p,13,l,{align:"center"});break;case"tc":s||e.text(p,e.internal.pageSize.getWidth()/3.1,l,{align:"center"});break;case"tr":e.text(p,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"});break;case"bl":e.text(p,13,thePageNumberVerticalOffset,{align:"center"});break;case"bc":d||e.text(p,e.internal.pageSize.getWidth()/3.1,thePageNumberVerticalOffset,{align:"center"});break;case"br":e.text(p,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"tlr":n%2==1?e.text(p,13,l,{align:"center"}):e.text(p,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"});break;case"trl":n%2==1?e.text(p,e.internal.pageSize.getWidth()/1.55-12,l,{align:"center"}):e.text(p,13,l,{align:"center"});break;case"blr":n%2==1?e.text(p,13,thePageNumberVerticalOffset,{align:"center"}):e.text(p,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"});break;case"brl":n%2==1?e.text(p,e.internal.pageSize.getWidth()/1.55-12,thePageNumberVerticalOffset,{align:"center"}):e.text(p,13,thePageNumberVerticalOffset,{align:"center"})}}}function PrimeWhistleRender(e,t){if(e.length<2){t();return}var n=e[0].querySelector("svg");theOffscreen.innerHTML="<div>"+n.outerHTML+"</div>",(n=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(n,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(n){var o=e[1].querySelector("svg");theOffscreen.innerHTML="<div>"+o.outerHTML+"</div>",(o=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(o,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(n){var o,a=(o=e.length<3?e[1]:e[2]).querySelector("svg");theOffscreen.innerHTML="<div>"+a.outerHTML+"</div>",(a=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(a,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(e){t()})})})}function RenderPDFBlock(e,t,n,o,a,r,l,s,g,c){if(null!=e&&void 0!=e){var d=1;if(g){var u=e.id+".block";if(-1==u.indexOf("_0.block")&&-1==u.indexOf("_1.block")){c();return}2==gIncipitsColumns&&(d=2)}var p=e.querySelector("svg");theOffscreen.innerHTML="<div>"+p.outerHTML+"</div>",(p=theOffscreen.querySelector("svg")).setAttribute("width",gQualitaet),htmlToImage.toCanvas(p,{backgroundColor:"white",style:{background:"white"},pixelRatio:gPDFQuality*gRenderPixelRatio}).then(function(t){var a,r=PAGELEFTOFFSET;"a4"==s&&(r=PAGELEFTOFFSETA4);var l=r,u=r+gPageWidth/2;switch(1==column_number&&(r=u),gPDFOrientation){case"portrait":a=PAGEHEIGHTLETTER,"a4"==s&&(a=PAGEHEIGHTA4);break;case"landscape":a=PAGEHEIGHTLETTER_LANDSCAPE,"a4"==s&&(a=PAGEHEIGHTA4_LANDSCAPE)}pdf.internal.scaleFactor=PDFSCALEFACTOR;var p=t.toDataURL("image/jpeg",PDFJPGQUALITY),m=e.id+".block",h=!1;-1!=m.indexOf("_0.block")&&(h=!0,isFirstPage?(isFirstPage=!1,calcPageNumberVerticalOffset(pdf)):n?(gMixedNotationAndQRCode&&(theCurrentPageNumber++,pdf.addPage(s,gPDFOrientation)),running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):o[tunesProcessed-1]?g?2==gIncipitsColumns&&0==column_number?(running_height=PAGETOPOFFSET,column_number=1,r=u):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages",column_number=0,r=l):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,pdf.addPage(s,gPDFOrientation),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):running_height+=BETWEENTUNESPACE/d,theTunePageMap[tunesProcessed]=theCurrentPageNumber,++tunesProcessed<totalTunes&&(document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">'+(tunesProcessed+1)+'</font> of  <font color="red">'+totalTunes+"</font>")),height=parseInt(t.height*gPageWidth/t.width),running_height+(height/=d)<=a-PAGEBOTTOMOFFSET?(h&&gTuneHyperlinks.push({page:theCurrentPageNumber,x:r,y:running_height,width:gPageWidth/d,height:height,url:""}),pdf.addImage(p,"JPG",r,running_height,gPageWidth/d,height)):(running_height=PAGETOPOFFSET,theCurrentPageNumber++,h&&(gTuneHyperlinks.push({page:theCurrentPageNumber,x:r,y:running_height,width:gPageWidth/d,height:height,url:""}),theTunePageMap[tunesProcessed-1]=theCurrentPageNumber),pdf.addPage(s,gPDFOrientation),pdf.addImage(p,"JPG",r,running_height,gPageWidth/d,height),document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),running_height=running_height+height+1/d,c(!0)})}}function promptForPDFFilename(e,t){if(ParseCommentCommands(gTheABC.value),gDoForcePDFFilename){var n=e;""==(e=(e=(e=gForcePDFFilename).trim()).replace(".pdf",""))&&(e=n)}e=(e=(e=cleanTitleNumber(e)).trim()).replace(/^[_]+/,""),DayPilot.Modal.prompt("Please enter a filename for your PDF file:",e+".pdf",{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var n=e.result;null==n||(0!=(n=n.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length?isDesktopBrowser()&&n.endsWith(".pdf")||(n=n.replace(/\..+$/,""),n+=".pdf"):n=null),t(n)})}function ShowAcrobatHyperlinkLengthWarning(){sendGoogleAnalytics("dialog","ShowAcrobatHyperlinkLengthWarning");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Adobe Acrobat Hyperlink Length Warning</p>';e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">Adobe Acrobat limits the length of clicked hyperlinks to 2076 characters.</p>',e+='<p style="font-size:12pt;line-height:18pt;">Some very complex tune Share URLs used in tunebooks generated with this tool may exceed this limit.</p>',e+='<p style="font-size:12pt;line-height:18pt;">If you are using Adobe Acrobat as your PDF reader, and you are seeing this message after clicking a complex tune link, try instead simply dragging the PDF of the tunebook to your browser to read it.</p>',e+='<p style="font-size:12pt;line-height:18pt;">The PDF readers built into most modern browsers do not have this hyperlink length limitation and will properly open the tune hyperlink when clicked.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()})}function ShowHyperlinkBadDecodeAlert(){sendGoogleAnalytics("dialog","ShowHyperlinkBadDecodeAlert");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Problem Decoding Tune Share URL</p>';e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">An unrecoverable error occured when decoding this tune ShareURL.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()})}function ShowAcrobatURLSizeWarningDialog(){sendGoogleAnalytics("dialog","ShowAcrobatURLSizeWarningDialog");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Adobe Acrobat Maximum URL Length Warning</p>';if(gAddTunebookPlaybackHyperlinks)e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During PDF export play hyperlink embedding, the entire tunebook play hyperlink length of '+gAcrobatURLLimitExceeded[0].urllength+" characters exceeded the Adobe Acrobat maximum URL length of 2076 characters.</p>",e+='<p style="font-size:12pt;line-height:18pt;">These play links will work with the built-in PDF reader on most web browsers and online PDF readers, many non-Adobe desktop and mobile PDF readers, but will not open correctly if the tune title is clicked when the PDF is viewed using Adobe Acrobat:</p>',e+='<p style="font-size:12pt;line-height:18pt;margin-top:24px">If Adobe Acrobat is your target PDF reader, your best option is to use the per-tune %hyperlink directive in these tunes with a shortened play Share URL to the entire tunebook manually generated using the Sharing dialog.</p>';else{e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During PDF export play hyperlink embedding, some very long and complex tunes had play hyperlinks that exceeded the Adobe Acrobat maximum URL length of 2076 characters.</p>',e+='<p style="font-size:12pt;line-height:18pt;">These play links will work with the built-in PDF reader on most web browsers and online PDF readers, many non-Adobe desktop and mobile PDF readers, but will not open correctly if the tune title is clicked when the PDF is viewed using Adobe Acrobat:</p>';for(var t=gAcrobatURLLimitExceeded.length,n=0;n<t;++n)e+='<p style="font-size:12pt;line-height:10pt;">"'+gAcrobatURLLimitExceeded[n].name+'"&nbsp;-&nbsp;URL length: '+gAcrobatURLLimitExceeded[n].urllength+"</p>";e+='<p style="font-size:12pt;line-height:18pt;margin-top:24px">If Adobe Acrobat is your target PDF reader, your best option is to use the per-tune %hyperlink directive in these tunes with a shortened play Share URL manually generated using the Sharing dialog.</p>'}DayPilot.Modal.alert(e,{theme:"modal_flat",top:75,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){gAcrobatURLLimitExceeded=[]})}function ExportPDF(){if(!gRenderingPDF&&gAllowPDF){var e=document.getElementById("pdfformat"),t=e.options[e.selectedIndex].value,n="incipits_abc"==t||"incipits_a4_abc"==t||"incipits_abc_sort"==t||"incipits_a4_abc_sort"==t||"incipits_abc_full"==t||"incipits_a4_abc_full"==t||"incipits_abc_full_cce"==t||"incipits_a4_abc_full_cce"==t,o="all_qr_codes"==t||"all_qr_codes_a4"==t,a="incipits_abc_full"==t||"incipits_a4_abc_full"==t||"incipits_abc_full_cce"==t||"incipits_a4_abc_full_cce"==t,r="incipits_abc_full_cce"==t||"incipits_a4_abc_full_cce"==t;(gMixedNotationAndQRCode="mixed_notation_qr"==t||"mixed_notation_qr_a4"==t)&&(t="mixed_notation_qr"==t?"one":"one_a4",document.getElementById("pdfformat").value=t),totalTunes=CountTunes();var l=getDescriptiveFileName(totalTunes,!0);if(o)promptForPDFFilename(l+="_QR_Codes",function(e){e&&ExportTextIncipitsPDF(e,a,r,!0)});else if(n)a?r?l+="_Comhaltas":l+="_ABC":l+="_Incipits",promptForPDFFilename(l,function(e){e&&ExportTextIncipitsPDF(e,a,r,!1)});else{if(gDisableNotationRendering){var s="Notation PDF export not possible with rendering disabled.";s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var e=document.getElementById("pdfformat"),t=e.options[e.selectedIndex].value;("incipits"==t||"incipits_a4"==t)&&(l+="_Incipits"),gMixedNotationAndQRCode&&(l+="_Notation_QR"),promptForPDFFilename(l,function(e){e&&(gOriginalWidthBeforePDFExport=gTheNotation.style.width,gTheNotation.style.width="850px",ExportNotationPDF(e))})}}}function ExportTextIncipitsPDF(e,t,n,o){gPDFCancelRequested=!1;var a=document.getElementById("pdfformat"),r=a.options[a.selectedIndex].value;document.getElementById("pdf-controls").style.display="block";var l=(a=document.getElementById("pagenumbers")).options[a.selectedIndex].value,s="none"!=l,g="letter";("incipits_a4_abc"==r||"incipits_a4_abc_sort"==r||"incipits_a4_abc_full"==r||"incipits_a4_abc_full_cce"==r||"all_qr_codes_a4"==r)&&(g="a4");var c=!1;("incipits_abc_sort"==r||"incipits_a4_abc_sort"==r)&&(c=!0);var d=!1;"no"==(a=document.getElementById("firstpage")).options[a.selectedIndex].value&&(d=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,totalTunes=CountTunes(),isFirstPage=!0,document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="",document.getElementById("pagestatustext").innerHTML="&nbsp;",gRenderingPDF=!0,(pdf=new jsPDF(gPDFOrientation,"pt",g)).setDisplayMode("fullpage","single","UseNone"),pdf.internal.scaleFactor=PDFSCALEFACTOR,calcPageNumberVerticalOffset(pdf),gTuneHyperlinks=[],setTimeout(function(){var a=[];function r(){if(gPDFCancelRequested){gRenderingPDF=!1,document.getElementById("pdf-controls").style.display="none";return}var t=theCurrentPageNumber;TunebookTPRequested&&(pdf.addPage(g,gPDFOrientation),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var n=theCurrentPageNumber,o=1,r=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,l,d,g,a,theTunebookSortedTOCTitle,!1,c),r=theCurrentPageNumber-n,r++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,l,d,g,a,theTunebookSortedTOCTitle,!0,c),theTOCDelta=theCurrentPageNumber-n,theCurrentPageNumber=n,TunebookTPRequested&&(o++,r++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,l,d,g,a,theTunebookTOCTitle,c,c,gIncludePageLinks,theTOCDelta,o),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,l,d,g,a,theTunebookSortedTOCTitle,!0,c,gIncludePageLinks,theTOCDelta,r),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,g,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),n=theCurrentPageNumber-n,TunebookTPRequested&&n++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(n=theTOCDelta),PostProcessHeadersAndFooters(pdf,s,n+1,t,l,d,g),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,l,d,g,a,theTunebookIndexTitle,c,c,gIncludePageLinks,n),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,l,d,g,a,theTunebookSortedIndexTitle,!0,c,gIncludePageLinks,n),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var u=!1,p=1,m=!1,h=1,f=theTOCDelta+1,T=theTOCDelta+t;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(u=!0,TunebookTPRequested&&(p=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(m=!0,h=t+theTOCDelta+1),(u||m)&&PostProcessTOCAndIndexLinks(pdf,f,T,u,p,m,h),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,g,f),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding Tunebook QR Code",AppendQRCode(pdf,g,function e(t){t?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="Tunebook QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var n=1e3;t||(n=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",A()},n)});else{A();return}function A(){document.getElementById("statuspdfname").innerHTML='<font color="darkgreen">Rendering Complete!</font>',setTimeout(function(){document.getElementById("statuspdfname").innerHTML='Saving <font color="blue">'+e+"</font>",setTimeout(function(){if(isMobileBrowser()){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gRenderingPDF=!1},1500)},2e3)}}o?(sendGoogleAnalytics("export","PDFQRCodes"),a=GenerateFullTuneQRCodes(pdf,s,l,d,g,a,function e(t){a=t,document.getElementById("statustunecount").innerHTML="All QR Codes Added!",r()})):t?(sendGoogleAnalytics("export","PDFFullText"),a=GenerateFullTextIncipits(pdf,s,l,d,g,a,!1,n),document.getElementById("statustunecount").innerHTML="Full ABC Text Added!",r()):(sendGoogleAnalytics("export","PDFTextIncipits"),a=GenerateTextIncipits(pdf,s,l,d,g,a,c),document.getElementById("statustunecount").innerHTML="ABC Incipits Added!",r())},250)}function ExportNotationPDF(e){gPDFCancelRequested=!1,gPDFTabselected=GetRadioValue("notenodertab"),document.getElementById("pdf-controls").style.display="block";var t=document.getElementById("pdfformat"),n=t.options[t.selectedIndex].value,o=(t=document.getElementById("pagenumbers")).options[t.selectedIndex].value,a="one"==n||"one_a4"==n,r="none"!=o,l="letter";("one_a4"==n||"multi_a4"==n||"incipits_a4"==n)&&(l="a4");var s="incipits"==n||"incipits_a4"==n,g=!1;"no"==(t=document.getElementById("firstpage")).options[t.selectedIndex].value&&(g=!0),ParseCommentCommands(gTheABC.value),theRenderTime="",theHeaderFooterTuneNames=GetAllTuneTitles(),theCurrentPageNumber=1,tunesProcessed=0,column_number=0,theTunePageMap=[],totalTunes=CountTunes(),isFirstPage=!0;var c=0,d=[],u=null,p=0,m=null,h=!1;function f(){sendGoogleAnalytics("export","PDFFull"),running_height=PAGETOPOFFSET,document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing notation for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",theOffscreen=document.getElementById("offscreenrender"),PrepareSVGDivsForRasterization(),document.getElementById("statustunecount").innerHTML='Rendering tune <font color="red">1</font> of  <font color="red">'+totalTunes+"</font>",theTunePageMap[0]=theCurrentPageNumber,gRenderingPDF=!0,(pdf=new jsPDF(gPDFOrientation,"pt",l)).setDisplayMode("fullpage","single","UseNone"),d=[],a||(d=scanTunesForPageBreaks(pdf,l,s)),p=(u=document.querySelectorAll('div[class="block"]')).length,m=u[0],"whistle"==gPDFTabselected?PrimeWhistleRender(u,T):T()}function T(){setTimeout(function(){RenderPDFBlock(m,0,a,d,r,o,g,l,s,t);function t(){if(gPDFCancelRequested){(gRenderingPDF=!1,gTheNotation.style.width=gOriginalWidthBeforePDFExport,pdf=null,u=null,h)?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after PDF generation</font>',RenderAsync(!0,null,function(){document.getElementById("pdf-controls").style.display="none",document.getElementById("offscreenrender").innerHTML=""})):(document.getElementById("pdf-controls").style.display="none",RestoreSVGDivsAfterRasterization()),gMixedNotationAndQRCode&&("a4"==l?document.getElementById("pdfformat").value="mixed_notation_qr_a4":document.getElementById("pdfformat").value="mixed_notation_qr",SavePDFSettings());return}if(++c==p){gMixedNotationAndQRCode&&(theCurrentPageNumber++,pdf.addPage(l,gPDFOrientation));var n=theCurrentPageNumber;function f(){TunebookTPRequested&&(pdf.addPage(l,gPDFOrientation),theCurrentPageNumber++,pdf.movePage(theCurrentPageNumber,1));var t=theCurrentPageNumber,a=1,s=1;TunebookTOCRequested&&DryRunAddTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookTOCTitle,!1,!1),s=theCurrentPageNumber-t,s++,TunebookSortedTOCRequested&&DryRunAddTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1),theTOCDelta=theCurrentPageNumber-t,theCurrentPageNumber=t,TunebookTPRequested&&(a++,s++,theTOCDelta++),TunebookTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Table of Contents",AppendTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookTOCTitle,!1,!1,gIncludePageLinks,theTOCDelta,a),document.getElementById("statustunecount").innerHTML="Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedTOCRequested&&(document.getElementById("statustunecount").innerHTML="Adding Sorted Table of Contents",AppendTuneTOC(pdf,o,g,l,theTunePageMap,theTunebookSortedTOCTitle,!0,!1,gIncludePageLinks,theTOCDelta,s),document.getElementById("statustunecount").innerHTML="Sorted Table of Contents Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookTPRequested&&(document.getElementById("statustunecount").innerHTML="Adding Title Page",AppendTuneTitlePage(pdf,l,theTunebookTP,theTunebookTPST),document.getElementById("statustunecount").innerHTML="Title Page Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),t=theCurrentPageNumber-t,TunebookTPRequested&&t++,(TunebookTOCRequested||TunebookSortedTOCRequested)&&(t=theTOCDelta),PostProcessHeadersAndFooters(pdf,r,t+1,n,o,g,l),TunebookIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Index",AppendTunebookIndex(pdf,o,g,l,theTunePageMap,theTunebookIndexTitle,!1,!1,gIncludePageLinks,t),document.getElementById("statustunecount").innerHTML="Tunebook Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"),TunebookSortedIndexRequested&&(document.getElementById("statustunecount").innerHTML="Adding Tunebook Sorted Index",AppendTunebookIndex(pdf,o,g,l,theTunePageMap,theTunebookSortedIndexTitle,!0,!1,gIncludePageLinks,t),document.getElementById("statustunecount").innerHTML="Tunebook Sorted Index Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages");var c=!1,d=1,u=!1,p=1,m=theTOCDelta+1,f=theTOCDelta+n;if(gAddTOCLinkback&&(TunebookTOCRequested||TunebookSortedTOCRequested)&&(c=!0,TunebookTPRequested&&(d=2)),gAddIndexLinkback&&(TunebookIndexRequested||TunebookSortedIndexRequested)&&(u=!0,p=n+theTOCDelta+1),(c||u)&&PostProcessTOCAndIndexLinks(pdf,m,f,c,d,u,p),gTuneHyperlinks.length>0&&PostProcessTuneHyperlinks(pdf,gTuneHyperlinks,l,m),gQRCodeRequested)document.getElementById("statustunecount").innerHTML="Adding Tunebook QR Code",AppendQRCode(pdf,l,function e(t){t?(theCurrentPageNumber++,document.getElementById("statustunecount").innerHTML="Tunebook QR Code Added!",document.getElementById("pagestatustext").innerHTML='Rendered <font color="red">'+theCurrentPageNumber+"</font> pages"):document.getElementById("statustunecount").innerHTML="Share URL too long for QR Code, try sharing fewer tunes";var n=1e3;t||(n=4e3),setTimeout(function(){document.getElementById("statustunecount").innerHTML="&nbsp;",T()},n)});else{T();return}function T(){document.getElementById("statuspdfname").innerHTML='<font color="darkgreen">Rendering Complete!</font>',setTimeout(function(){e&&(document.getElementById("statuspdfname").innerHTML='Saving <font color="blue">'+e+"</font>"),setTimeout(function(){if(isMobileBrowser()){var t=pdf.output("blob",{filename:e}),n=new Blob([t],{type:"application/octet-stream"}),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",url=window.URL.createObjectURL(n),o.href=url,o.download=e,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(url)},1e3)}else pdf.save(e);function a(){document.getElementById("statuspdfname").innerHTML="&nbsp;",document.getElementById("statustunecount").innerHTML="&nbsp;",document.getElementById("pagestatustext").innerHTML="&nbsp;",document.getElementById("pdf-controls").style.display="none",gAcrobatURLLimitExceeded.length>0&&ShowAcrobatURLSizeWarningDialog(),gMixedNotationAndQRCode&&("a4"==l?document.getElementById("pdfformat").value="mixed_notation_qr_a4":document.getElementById("pdfformat").value="mixed_notation_qr",SavePDFSettings())}h?(document.getElementById("statuspdfname").innerHTML='<font color="red">Cleaning up after PDF generation</font>',setTimeout(function(){gRenderingPDF=!1,gTheNotation.style.width=gOriginalWidthBeforePDFExport,Render(!0,null),document.getElementById("offscreenrender").innerHTML="",a()},100)):(RestoreSVGDivsAfterRasterization(),a(),gRenderingPDF=!1,gTheNotation.style.width=gOriginalWidthBeforePDFExport)},1500)},2e3)}}gMixedNotationAndQRCode?PostProcessMixedNotationAndQRCode(pdf,o,g,l,theTunePageMap,n,f):f()}else{if(c>u.length)return;c>0&&(u[c-1]=null),(m=u[c])&&RenderPDFBlock(m,c,a,d,r,o,g,l,s,t)}}},250)}gTuneHyperlinks=[],BETWEENTUNESPACE=gBetweenTuneSpace,s?(sendGoogleAnalytics("export","PDFIncipits"),1!=gIncipitsColumns||gGotBetweenTuneSpace||(BETWEENTUNESPACE=0),IdleAdvancedControls(!1),IdleAllowShowTabNames(),gRawMode||gAllowFilterAnnotations&&!gStripAnnotations||gAllowFilterText&&!gStripTextAnnotations||gAllowShowTabNames&&gShowTabNames?(document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing Incipits for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){var e=gStripAnnotations;gStripAnnotations=!0;var t=gStripTextAnnotations;gStripTextAnnotations=!0;var n=gShowTabNames;gAllowShowTabNames&&(gShowTabNames=!1);var o=gRawMode;gRawMode=!1,Render(!0,null),gRawMode=o,gStripAnnotations=e,gStripTextAnnotations=t,gAllowShowTabNames&&(gShowTabNames=n),h=!0,f()},100)):f()):gRawMode?(document.getElementById("statuspdfname").innerHTML='Generating <font color="blue">'+e+"</font>",document.getElementById("statustunecount").innerHTML="Processing ABC for PDF generation",document.getElementById("pagestatustext").innerHTML="&nbsp;",setTimeout(function(){gRawMode=!1,Render(!0,null),gRawMode=!0,h=!0,f()},100)):f()}function CancelPDF(){gPDFCancelRequested=!0}function getNextSiblings(e,t){for(var n=[];e=e.nextSibling;)(!t||t(e))&&n.push(e);return n}function getStyleProp(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle?e.currentStyle[t]:void 0}function GetABCJSParams(e){var t,n="",o="";if(e&&gShowTabNames)switch(gCapo>0&&(n=" (Capo "+gCapo+")"),e){case"noten":break;case"notenames":case"whistle":o=" ";break;case"mandolin":o="Mandolin"+n;break;case"gdad":o="GDAD"+n;break;case"cgdae":o="CGDAE"+n;break;case"guitare":o="Guitar"+n;break;case"guitard":o="DADGAD"+n;break;case"uke":o="Ukulele"+n}var a=gRenderingFonts;gDrawTabSymbol=!0;var r=!0;if(e?"noten"==e?(r=!1,t={responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}):"mandolin"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}:"gdad"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","D","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}:"cgdae"==e?t={tablature:[{instrument:"fivestring",label:o,tuning:["C,","G,","D","A","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}:"guitare"==e?t={tablature:[{instrument:"guitar",label:o,tuning:["E,","A,","D","G","B","e"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}:"guitard"==e?t={tablature:[{instrument:"guitar",label:o,tuning:["D,","A,","D","G","A","d"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}:"uke"==e?t={tablature:[{instrument:"violin",label:o,tuning:["G,","C","E","A"],highestNote:"f'",capo:gCapo}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}:"notenames"==e?(gDrawTabSymbol=!1,t={tablature:[{instrument:"violin",label:o,tuning:["G,,,","G,,","G,"],highestNote:"b'",hideTabSymbol:!0,linePitch:2}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}):"whistle"==e?(gDrawTabSymbol=!1,t={tablature:[{instrument:"violin",label:o,tuning:["G,"],highestNote:"^a'",hideTabSymbol:!0}],responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a}):(r=!1,t={responsive:"resize",oneSvgPerLine:"true",selectTypes:!1,format:a}):(r=!1,t={responsive:"resize",oneSvgPerLine:"true",expandToWidest:"true",selectTypes:!1,format:a},e=""),r&&t.tablature&&t.tablature.length>0)for(var l=t.tablature[0],s=0;s<7;++s)t.tablature.push(l);return t}function UpdateLocalStorage(){if(gLocalStorageAvailable){if(!gIsFromShare||gForceTabSave){var e=GetRadioValue("notenodertab");localStorage.abcTab=e,gForceTabSave=!1}var t=gCapo;if(localStorage.abcCapo=t,!gIsFromShare){var n=gStaffSpacing-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=n}var o=document.getElementById("pdfformat").value;localStorage.abcTunesPerPage=o;var a=document.getElementById("pagenumbers").value;localStorage.abcPageNumberLocation=a;var r=document.getElementById("firstpage").value;localStorage.abcPageNumberOnPageOne=r,gTopBarShowing?localStorage.abcHideTopBar="false":localStorage.abcHideTopBar="true",gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false",localStorage.PDFFont=gPDFFont,localStorage.PDFFontStyle=gPDFFontStyle,localStorage.PDFOrientation=gPDFOrientation}}function SavePDFSettings(){UpdateLocalStorage()}function PrepareSVGDivsForRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,r=document.querySelectorAll('div[id="'+a+'"] > div'),l=r.length;for(n=0;n<l;++n)(o=r.item(n)).classList.add("block"),o.id="block_"+t+"_"+n}}function RestoreSVGDivsAfterRasterization(){document.getElementById("offscreenrender").innerHTML="";for(var e=CountTunes(),t=0;t<e;++t){var n,o,a="notation"+t,r=document.querySelectorAll('div[id="'+a+'"] > div'),l=r.length;for(n=0;n<l;++n)(o=r.item(n)).removeAttribute("class"),o.removeAttribute("id")}}function NoteClickListener(e,t,n,o,a,r){var l=window.scrollY;setTimeout(function(){var t;window.scrollTo(0,l),gTheABC.focus(),ScrollABCTextIntoView(gTheABC,e.startChar,e.endChar,2)},10)}function fireSelectionChanged(){if(gRawMode&&CountTunes()>0&&gRawVisual){if(gCurrentTune!=gRawLastIndex){for(var e=gRawVisual.length,t=0;t<e;++t){var n=gRawVisual[t].engraver;n.rangeHighlight(0,0)}gRawLastIndex=gCurrentTune}var n=gRawVisual[gRawLastIndex].engraver;n&&n.rangeHighlight(gTheABC.selectionStart,gTheABC.selectionEnd)}}function RenderTheNotes(e,t,n,o){if(!gDisableNotationRendering){var a=GetABCJSParams(t),r=[],l=0,s=0,g=0;if(n){g=l=CountTunes();for(var c=0;c<l;++c)r.push("notation"+c)}else l=1,s=o,g=o+1,r.push("notation"+o);if(0!=l){gRawMode&&isDesktopBrowser()&&(a.clickListener=NoteClickListener,a.selectTypes=!0,a.selectionColor=gRawHighlightColor);var d=ABCJS.renderAbc(r,e,a);gRawVisual=d;for(var u=s;u<g;++u)postProcessTab(d,"notation"+u,t,!1)}}}function SetRadioValue(e,t){let n=document.querySelectorAll('input[name="'+e+'"]');for(let o of n)o.value==t?o.checked=!0:o.checked=!1}function GetRadioValue(e){let t=document.querySelectorAll('input[name="'+e+'"]'),n;for(let o of t)if(o.checked){n=o.value;break}return n}function StripAnnotations(){var e=gTheABC.value;e=StripAnnotationsOne(e),gTheABC.value=e,gIsDirty=!0}function StripAnnotationsOne(e){var t=/^Q:.*[\r\n]*/gm;return e=e.replace(t,""),t=/^Z:.*[\r\n]*/gm,e=e.replace(t,""),t=/^R:.*[\r\n]*/gm,e=e.replace(t,""),t=/^S:.*[\r\n]*/gm,e=e.replace(t,""),t=/^N:.*[\r\n]*/gm,e=e.replace(t,""),t=/^D:.*[\r\n]*/gm,e=e.replace(t,""),t=/^H:.*[\r\n]*/gm,e=e.replace(t,""),t=/^B:.*[\r\n]*/gm,e=e.replace(t,""),t=/^C:.*[\r\n]*/gm,e=e.replace(t,""),t=/^O:.*[\r\n]*/gm,e=e.replace(t,"")}function StripTextAnnotations(){var e=gTheABC.value;e=StripTextAnnotationsOne(e),gTheABC.value=e,gIsDirty=!0}function StripTextAnnotationsOne(e){var t=/%%text.*[\r\n]*/gm;return e=e.replace(t,""),t=/%%center.*[\r\n]*/gm,e=e.replace(t,"")}function StripChords(){var e=gTheABC.value;e=StripChordsOne(e),gTheABC.value=e,gIsDirty=!0}function StripChordsOne(e){return e=e.replace(/"[^"]*"/gm,function e(t){return -1!=t.indexOf('"_')||-1!=t.indexOf('"^')?t:t.length>9?t:-1!=t.indexOf(" ")?t:""})}function AreChordsInMatch(e,t){if(!t)return!1;for(var n=t.length,o=0;o<n;++o){var a=t[o];if(-1==a.indexOf('"_')&&-1==a.indexOf('"^')){if(a.length>9)continue;if(-1!=a.indexOf(" "))continue;return!0}}return!1}function IsTabInMatch(e,t){if(!t)return!1;for(var n=t.length,o=0;o<n;++o)if(0==t[o].indexOf('"_')||0==t[o].indexOf('"^'))return!0;return!1}function StripTab(){var e=gTheABC.value;e=StripTabOne(e),gTheABC.value=e,gIsDirty=!0}function StripTabOne(e){return e=e.replace(/"[^"]*"/gm,function e(t){return 0==t.indexOf('"_')||0==t.indexOf('"^')?"":t})}function StripOrnamentsOne(e){return e=e.replace(/{[^}]*}/gm,"")}function RenderAsync(e,t,n){!gRenderingPDF&&(document.getElementById("loading-bar-spinner").style.display="none",e?(document.getElementById("loading-bar-spinner").style.display="block",setTimeout(function(){Render(e,t),document.getElementById("loading-bar-spinner").style.display="none",MakeTuneVisible(!0),n&&void 0!=n&&n()},100)):(Render(e,t),n&&void 0!=n&&n()))}function Render(e,t){if(!gRenderingPDF){var n=CountTunes();if(""!=gTheABC.value&&n>0){var o,a=document.getElementById("abc-selected");1==n?a.innerText=gDisplayedName+"  ("+n+" Tune)":a.innerText=gDisplayedName+"  ("+n+" Tunes)";var r=window.pageYOffset;UpdateLocalStorage(),document.getElementById("notation-placeholder").style.display="none",isDesktopBrowser()?gIsMaximized?gTheNotation.style.display="flex":gTheNotation.style.display="inline":gIsMaximized?gTheNotation.style.display="flex":gTheNotation.style.display="block",gDisableEditFromPlayLink?HideMaximizeButton():ShowMaximizeButton(),(isDesktopBrowser()||gIsMaximized)&&(ShowPlayButton(),ShowPDFButton()),gShowAllControls?(document.getElementById("notenrechts").style.display="inline-block",gIsFirstRender&&(UpdateNotationTopPosition(),gIsFirstRender=!1)):document.getElementById("notenrechts").style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfiledisabled"),document.getElementById("saveabcfile").classList.add("saveabcfile"),gAllowSave=!0,gAllowControlToggle=!0,document.getElementById("saveaspdf").classList.remove("saveaspdfdisabled"),document.getElementById("saveaspdf").classList.add("saveaspdf"),gAllowPDF=!0,document.getElementById("copybutton").classList.remove("copybuttondisabled"),document.getElementById("copybutton").classList.add("copybutton"),document.getElementById("playbutton").classList.remove("playbuttondisabled"),document.getElementById("playbutton").classList.add("playbutton"),isDesktopBrowser()&&(document.getElementById("rawmodebutton").classList.remove("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("rawmodebutton")),gAllowCopy=!0;var l=GetRadioValue("notenodertab");if(e?(GenerateRenderingDivs(n),o=gTheABC.value):o=getTuneByIndex(t),!gRawMode){var s="";gStripAnnotations&&(s=/^Q:.*$/gm,o=o.replace(s,"% comment"),s=/^Z:.*$/gm,o=o.replace(s,"% comment"),s=/^R:.*$/gm,o=o.replace(s,"% comment"),s=/^S:.*$/gm,o=o.replace(s,"% comment"),s=/^N:.*$/gm,o=o.replace(s,"% comment"),s=/^D:.*$/gm,o=o.replace(s,"% comment"),s=/^H:.*$/gm,o=o.replace(s,"% comment"),s=/^B:.*$/gm,o=o.replace(s,"% comment"),s=/^C:.*$/gm,o=o.replace(s,"% comment"),s=/^O:.*$/gm,o=o.replace(s,"% comment")),gStripTextAnnotations&&(s=/%%text.*$/gm,o=o.replace(s,"% comment"),s=/%%center.*$/gm,o=o.replace(s,"% comment")),gStripChords&&(o=StripChordsOne(o)),gStripTab&&(o=StripTabOne(o)),s=/^X:.*$/gm,o=o.replace(s,"X:1\n%%staffsep "+gStaffSpacing)}RenderTheNotes(o,l,e,t),window.scrollTo(0,r)}else{document.getElementById("notenrechts").style.display="none",gTheNotation.style.display="none",document.getElementById("saveabcfile").classList.remove("saveabcfile"),document.getElementById("saveabcfile").classList.add("saveabcfiledisabled"),gAllowSave=!1,document.getElementById("saveaspdf").classList.remove("saveaspdf"),document.getElementById("saveaspdf").classList.add("saveaspdfdisabled"),gAllowPDF=!1,gAllowControlToggle=!1,document.getElementById("copybutton").classList.remove("copybutton"),document.getElementById("copybutton").classList.add("copybuttondisabled"),document.getElementById("playbutton").classList.remove("playbutton"),document.getElementById("playbutton").classList.add("playbuttondisabled"),document.getElementById("rawmodebutton").classList.remove("rawmodebutton"),document.getElementById("rawmodebutton").classList.add("rawmodebuttondisabled"),document.getElementById("rawmodebutton").classList.add("btn-rawmode-off"),document.getElementById("rawmodebutton").classList.remove("btn-rawmode-on"),document.getElementById("rawmodebutton").value="Highlighting Off",gTheABC.style.backgroundColor="white",gRawMode=!1,gRawLastIndex=-1,gLastClickedTune=-1,gAllowCopy=!1,document.getElementById("notation-placeholder").style.display="block",document.getElementById("zoombutton").style.display="none",HidePlayButton(),HidePDFButton(),document.getElementById("loading-bar-spinner").style.display="none";var a=document.getElementById("abc-selected");a.innerText="No ABC file selected",gDisplayedName="No ABC file selected",gABCFromFile=!1,gIsFirstRender=!0,UpdateNotationTopPosition()}}}function ensureABCFile(e){var t="";if(e.lastIndexOf(".")>0&&(t=e.substring(e.lastIndexOf(".")+1,e.length)),"abc"==t.toLowerCase()||"txt"==t.toLowerCase()||"xml"==t.toLowerCase()||"musicxml"==t.toLowerCase()||"mxl"==t.toLowerCase())return!0;var n="Sorry, only .abc, .txt, .xml, .musicxml, or .mxl files are supported.";return n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),!1}function IdleAdvancedControls(e){var t=gTheABC.value,n="",o=!1,a=!1,r=!1,l=!1;n=/^Q:.*$/gm,(l=-1!=t.search(n))||(n=/^Z:.*$/gm,l=-1!=t.search(n)),l||(n=/^R:.*$/gm,l=-1!=t.search(n)),l||(n=/^S:.*$/gm,l=-1!=t.search(n)),l||(n=/^N:.*$/gm,l=-1!=t.search(n)),l||(n=/^D:.*$/gm,l=-1!=t.search(n)),l||(n=/^H:.*$/gm,l=-1!=t.search(n)),l||(n=/^B:.*$/gm,l=-1!=t.search(n)),l||(n=/^C:.*$/gm,l=-1!=t.search(n)),l||(n=/^O:.*$/gm,l=-1!=t.search(n)),o=l,l=!1,n=/%%text.*$/gm,(l=-1!=t.search(n))||(n=/%%center.*$/gm,l=-1!=t.search(n)),a=l,l=!1,n=/"[^"]*"/gm;var s=t.match(n);r=l=AreChordsInMatch(t,s),n=/"[^"]*"/gm;var s=t.match(n);EnableTab=l=IsTabInMatch(t,s),o?(gAllowFilterAnnotations=!0,e&&(document.getElementById("toggleannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggleannotations").classList.add("advancedcontrols"),document.getElementById("stripannotations").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.add("advancedcontrols"))):(gAllowFilterAnnotations=!1,e&&(document.getElementById("toggleannotations").classList.remove("advancedcontrols"),document.getElementById("toggleannotations").classList.add("advancedcontrolsdisabled"),document.getElementById("stripannotations").classList.remove("advancedcontrols"),document.getElementById("stripannotations").classList.add("advancedcontrolsdisabled"))),a?(gAllowFilterText=!0,e&&(document.getElementById("toggletext").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletext").classList.add("advancedcontrols"),document.getElementById("striptext").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptext").classList.add("advancedcontrols"))):(gAllowFilterText=!1,e&&(document.getElementById("toggletext").classList.remove("advancedcontrols"),document.getElementById("toggletext").classList.add("advancedcontrolsdisabled"),document.getElementById("striptext").classList.remove("advancedcontrols"),document.getElementById("striptext").classList.add("advancedcontrolsdisabled"))),r?(gAllowFilterChords=!0,e&&(document.getElementById("togglechords").classList.remove("advancedcontrolsdisabled"),document.getElementById("togglechords").classList.add("advancedcontrols"),document.getElementById("stripchords").classList.remove("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.add("advancedcontrols"))):(gAllowFilterChords=!1,e&&(document.getElementById("togglechords").classList.remove("advancedcontrols"),document.getElementById("togglechords").classList.add("advancedcontrolsdisabled"),document.getElementById("stripchords").classList.remove("advancedcontrols"),document.getElementById("stripchords").classList.add("advancedcontrolsdisabled"))),EnableTab?(gAllowFilterTab=!0,e&&(document.getElementById("toggletab").classList.remove("advancedcontrolsdisabled"),document.getElementById("toggletab").classList.add("advancedcontrols"),document.getElementById("striptab").classList.remove("advancedcontrolsdisabled"),document.getElementById("striptab").classList.add("advancedcontrols"))):(gAllowFilterTab=!1,e&&(document.getElementById("toggletab").classList.remove("advancedcontrols"),document.getElementById("toggletab").classList.add("advancedcontrolsdisabled"),document.getElementById("striptab").classList.remove("advancedcontrols"),document.getElementById("striptab").classList.add("advancedcontrolsdisabled"))),e&&(gStripAnnotations?document.getElementById("toggleannotations").value="Show Annotations":document.getElementById("toggleannotations").value="Hide Annotations",gStripTextAnnotations?document.getElementById("toggletext").value="Show Text":document.getElementById("toggletext").value="Hide Text",gStripChords?document.getElementById("togglechords").value="Show Chords":document.getElementById("togglechords").value="Hide Chords",gStripTab?document.getElementById("toggletab").value="Show Injected Tab":document.getElementById("toggletab").value="Hide Injected Tab")}function UpdateNotationTopPosition(){var e=document.getElementById("noscroller").offsetHeight;document.getElementById("notation-spacer").style.height=e+"px"}function RestoreDefaults(){gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gTotalTunes=0,gCurrentTune=0,gRawLastIndex=-1,gForceFullRender=!1,gIsFirstRender=!0,gLastAutoScrolledTune=-1,gLastClickedTune=-1;document.getElementById("selectabcfile").value="",clearQRCode(),UpdateNotationTopPosition()}function ToggleAnnotations(e){if(gAllowFilterAnnotations){if(e){StripAnnotations(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripAnnotations=!gStripAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleTextAnnotations(e){if(gAllowFilterText){if(e){StripTextAnnotations(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripTextAnnotations=!gStripTextAnnotations,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleChords(e){if(gAllowFilterChords){if(e){StripChords(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripChords=!gStripChords,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function ToggleTab(e){if(gAllowFilterTab){if(e){StripTab(),RenderAsync(!0,null),IdleAdvancedControls(!0);return}gStripTab=!gStripTab,RenderAsync(!0,null),IdleAdvancedControls(!0)}}function idleAddABC(){gIsIOS&&document.getElementById("addabcfilebutton").removeAttribute("accept"),document.getElementById("addabcfilebutton").onchange=()=>{let e=document.getElementById("addabcfilebutton");if(0===e.files.length){var t="Please select an ABC or MusicXML file";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}DoFileRead(e.files[0],!0),e.value=""};var e=document.getElementById("dialogrestorebutton");e.style.display="none";var t=document.getElementById("dialogrestoreautobutton");if(t.style.display="none",gLocalStorageAvailable){var n=localStorage.SavedSnapshot,o=localStorage.LastAutoSnapShot;n&&""!=n&&(e.style.display="inline"),o&&""!=o&&(t.style.display="inline")}for(var a=document.getElementsByClassName("modal_flat_ok"),r=null,l=0;l<a.length;++l)if("OK"==(r=a[l]).innerText){gAddABCOKButton=r;break}}var gPDFTunebookConfig={pdfquality:.75,pdf_between_tune_space:20,addtitle:"Tunebook Title",addsubtitle:"Tunebook Subtitle",addtoc:"Table of Contents",addindex:"Index",pageheader:"This is the Page Header",pagefooter:"This is the Page Footer",bAdd_add_all_playback_links:!0,bAdd_add_full_tunebook:!1,bInjectInstruments:!0,sound_font:"fluid",melody_instrument:1,bass_instrument:1,chord_instrument:1,bAdd_QRCode:!0,qrcode_link:"https://michaeleskin.com/abc",caption_for_qrcode:"Created using Michael Eskin's ABC Transcription Tools"};function resetPDFTunebookConfig(){gPDFTunebookConfig={pdfquality:.75,pdf_between_tune_space:20,addtitle:"Tunebook Title",addsubtitle:"Tunebook Subtitle",addtoc:"Table of Contents",addindex:"Index",pageheader:"This is the Page Header",pagefooter:"This is the Page Footer",bAdd_add_all_playback_links:!0,bAdd_add_full_tunebook:!1,bInjectInstruments:!0,sound_font:"fluid",melody_instrument:1,bass_instrument:1,chord_instrument:1,bAdd_QRCode:!0,qrcode_link:"https://michaeleskin.com/abc",caption_for_qrcode:"Created using Michael Eskin's ABC Transcription Tools"}}function idlePDFTunebookBuilder(){$('[name="addtitle"]').attr("placeholder","No Title Page will be included"),$('[name="addsubtitle"]').attr("placeholder","No Title Page subtitle will be included"),$('[name="addtoc"]').attr("placeholder","No Table of Contents will be included"),$('[name="addindex"]').attr("placeholder","No Index will be included"),$('[name="pageheader"]').attr("placeholder","No Page Header will be included"),$('[name="pagefooter"]').attr("placeholder","No Page Footer will be included"),$('[name="qrcode_link"]').attr("placeholder","QR Code will use default Share URL"),$('[name="caption_for_qrcode"]').attr("placeholder","No QR Code caption will be included")}function PDFTunebookBuilder(){if(!gRenderingPDF){sendGoogleAnalytics("dialog","PDFTunebookBuilder"),gPDFTunebookConfig.sound_font&&""!=gPDFTunebookConfig.sound_font||(gPDFTunebookConfig.sound_font="fluid"),gPDFTunebookConfig.bass_instrument&&""!=gPDFTunebookConfig.bass_instrument||(gPDFTunebookConfig.bass_instrument=1);for(var e=[],t=0;t<138;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});for(var t=0;t<138;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});setTimeout(function(){idlePDFTunebookBuilder()},150),DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Configure PDF Tunebook Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#configure_pdf_tunebook_features" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:14pt;font-family:helvetica">Clicking "OK" will add PDF tunebook feature annotations to the top of your ABC.</p>'},{html:'<p style="margin-top:12px;margin-bottom:12px;font-size:12pt;line-height:14pt;font-family:helvetica">Leave any text fields blank for features you don\'t want in your PDF tunebook.</p>'},{name:"PDF quality:",id:"pdfquality",type:"select",options:[{name:"  Draft",id:.4},{name:"  Good",id:.5},{name:"  High",id:.75},],cssClass:"configure_pdfquality_select"},{name:'Space between tunes (in 1/72"):',id:"pdf_between_tune_space",type:"number",cssClass:"configure_setuppdftunebook_form_text"},{name:"Title Page title:",id:"addtitle",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide2"},{name:"Title Page subtitle:",id:"addsubtitle",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Table of Contents title:",id:"addtoc",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Index title:",id:"addindex",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Page Header:",id:"pageheader",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"Page Footer:",id:"pagefooter",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"          Add playback links to each tune to allow playing the tune by clicking the tune title",id:"bAdd_add_all_playback_links",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text2"},{name:"          Playback links contain entire tunebook",id:"bAdd_add_full_tunebook",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{name:"Soundfont for playback links:",id:"sound_font",type:"select",options:[{name:"  Fluid",id:"fluid"},{name:"  Musyng Kite",id:"musyng"},{name:"  FatBoy",id:"fatboy"},{name:"  Canvas",id:"canvas"},{name:"  MScore",id:"mscore"},],cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Melody instrument for playback links:",id:"melody_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Bass instrument for playback links:",id:"bass_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"Chord instrument for playback links:",id:"chord_instrument",type:"select",options:e,cssClass:"configure_setuppdftunebook_midi_program_select"},{name:"          Add a QR Code to the end of the PDF",id:"bAdd_QRCode",type:"checkbox",cssClass:"configure_setuppdftunebook_form_text"},{html:'<p style="margin-top:18px;margin-bottom:16px;font-size:12pt;line-height:10pt;font-family:helvetica">To override the default Share URL QR Code, enter your own URL below:</p>'},{name:"Custom URL:",id:"qrcode_link",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},{name:"QR Code caption:",id:"caption_for_qrcode",type:"text",cssClass:"configure_setuppdftunebook_form_text_wide"},],gPDFTunebookConfig,{theme:"modal_flat",top:10,width:690,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled){var t="% Start of PDF Tunebook Features\n";if(t+="%\n",gPDFTunebookConfig.pdfquality=e.result.pdfquality,t+="%pdfquality "+gPDFTunebookConfig.pdfquality+"\n",gPDFTunebookConfig.pdf_between_tune_space=e.result.pdf_between_tune_space,""!=gPDFTunebookConfig.pdf_between_tune_space&&(t+="%pdf_between_tune_space "+gPDFTunebookConfig.pdf_between_tune_space+"\n"),gPDFTunebookConfig.addtitle=e.result.addtitle,gPDFTunebookConfig.addsubtitle=e.result.addsubtitle,""!=gPDFTunebookConfig.addtitle&&(t+="%addtitle "+gPDFTunebookConfig.addtitle+"\n",""!=gPDFTunebookConfig.addsubtitle&&(t+="%addsubtitle "+gPDFTunebookConfig.addsubtitle+"\n")),gPDFTunebookConfig.addtoc=e.result.addtoc,""!=gPDFTunebookConfig.addtoc&&(t+="%addtoc "+gPDFTunebookConfig.addtoc+"\n",t+="%addlinkbacktotoc\n"),gPDFTunebookConfig.addindex=e.result.addindex,""!=gPDFTunebookConfig.addindex&&(t+="%addsortedindex "+gPDFTunebookConfig.addindex+"\n",t+="%addlinkbacktoindex\n"),gPDFTunebookConfig.pageheader=e.result.pageheader,""!=gPDFTunebookConfig.pageheader&&(t+="%pageheader "+gPDFTunebookConfig.pageheader+"\n"),gPDFTunebookConfig.pagefooter=e.result.pagefooter,""!=gPDFTunebookConfig.pagefooter&&(t+="%pagefooter "+gPDFTunebookConfig.pagefooter+"\n"),gPDFTunebookConfig.bAdd_add_all_playback_links=e.result.bAdd_add_all_playback_links,gPDFTunebookConfig.bAdd_add_full_tunebook=e.result.bAdd_add_full_tunebook,gPDFTunebookConfig.bInjectInstruments=e.result.bInjectInstruments,gPDFTunebookConfig.sound_font=e.result.sound_font,gPDFTunebookConfig.melody_instrument=e.result.melody_instrument,gPDFTunebookConfig.bass_instrument=e.result.bass_instrument,gPDFTunebookConfig.chord_instrument=e.result.chord_instrument,gPDFTunebookConfig.bAdd_add_all_playback_links){var n=gPDFTunebookConfig.sound_font,o=gPDFTunebookConfig.melody_instrument,a=gPDFTunebookConfig.bass_instrument,r=gPDFTunebookConfig.chord_instrument;0==o?o="mute":((o-=1)<0||o>137)&&(o=0),0==a?a="mute":((a-=1)<0||a>137)&&(a=0),0==r?r="mute":((r-=1)<0||r>137)&&(r=0),t+="%add_all_playback_links "+o+" "+a+" "+r+" "+n+"\n",gPDFTunebookConfig.bAdd_add_full_tunebook&&(t+="%playback_links_are_complete_tunebook\n")}gPDFTunebookConfig.bAdd_QRCode=e.result.bAdd_QRCode,gPDFTunebookConfig.qrcode_link=e.result.qrcode_link,gPDFTunebookConfig.caption_for_qrcode=e.result.caption_for_qrcode,gPDFTunebookConfig.bAdd_QRCode&&(""!=gPDFTunebookConfig.qrcode_link?t+="%qrcode "+gPDFTunebookConfig.qrcode_link+"\n":t+="%qrcode\n",""!=gPDFTunebookConfig.caption_for_qrcode&&(t+="%caption_for_qrcode "+gPDFTunebookConfig.caption_for_qrcode+"\n")),t+="%\n",t+="% End of PDF Tunebook Features\n",t+="\n",SaveConfigurationSettings();var l=gTheABC.value,s="% End of PDF Tunebook Features\n\n",g=l.indexOf(s);-1!=g&&(g+=s.length,l=l.substring(g)),s="% End of PDF Tunebook Features\n",-1!=(g=l.indexOf(s))&&(g+=s.length,l=l.substring(g)),t+=l,gTheABC.value=t,gIsDirty=!0,gRawMode&&RenderAsync(!0,null)}})}}function capitalizeSongName(e){let t=["the","of","and","for","a","an"],n=e.split(" "),o=n.map((e,n)=>t.includes(e.toLowerCase())&&0!==n?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1)),a=o.join(" ");return a}function capitalizeAfterO(e){return e.replace(/(O')([a-z])/g,function(e,t,n){return t+n.toUpperCase()})}function searchForTunes(){var e=gTheCurrentTuneDatabase;if(0==e){if(!gTheParsedTuneDatabase){var t=makeCenteredPromptString("Gavin Heneghan tune database still loading...");DayPilot.Modal.alert(t,{theme:"modal_flat",top:200});return}}else if(!gTheFolkFriendDatabase){var t=makeCenteredPromptString("FolkFriend tune database still loading...");DayPilot.Modal.alert(t,{theme:"modal_flat",top:200});return}var n=document.getElementById("tuneNameToSearch").value;if(""==n){var t=makeCenteredPromptString("No Text Entered in the Search Field");DayPilot.Modal.alert(t,{theme:"modal_flat",top:200});return}if(n=(n=(n=n.toLowerCase()).replace("'","")).replace('"',""),document.getElementById("search_results").value="",0==e)for(var o=document.getElementById("chords_only").checked,a=document.getElementById("match_title_start").checked,r=document.getElementById("only_first_variation").checked,l=gTheParsedTuneDatabase.length,s="",g=0,c=!1,d=0;d<l&&!c;++d){var u=gTheParsedTuneDatabase[d].info,p=u.T;if(p=(p=(p=p.toLowerCase()).replace("'","")).replace('"',""),!a&&-1!=p.indexOf(n)||a&&0==p.indexOf(n)){var m=gTheParsedTuneDatabase[d].variations,h=1,f=Object.entries(m).length;for(let[T,A]of Object.entries(m))if(o){var y=/"[^"]*"/gm,b=A.match(y);if(b&&b.length>0){for(let[I,v]of Object.entries(u))"X"==I?s+=I+": "+(g+1)+"\n":s+=I+": "+v+"\n";if(!r&&f>1&&(s+="% Variation "+h+"\n"),s+=A+"\n\n",h++,++g==gTheMaxDatabaseResults){c=!0;break}if(r)break}}else{for(let[C,S]of Object.entries(u))"X"==C?s+=C+": "+(g+1)+"\n":s+=C+": "+S+"\n";if(!r&&f>1&&(s+="% Variation "+h+" of "+f+"\n"),s+=A+"\n\n",h++,++g==gTheMaxDatabaseResults){c=!0;break}if(r)break}}}else{var o=document.getElementById("chords_only").checked,a=document.getElementById("match_title_start").checked,r=document.getElementById("only_first_variation").checked,B=gTheFolkFriendDatabase.settings,E=[];for(let _ in B)B.hasOwnProperty(_)&&E.push(_);var P=E.length,M=gTheFolkFriendDatabase.aliases,F=[];for(let w in M)M.hasOwnProperty(w)&&F.push(w);for(var D=F.length,s="",g=0,c=!1,L=[],d=0;d<D&&!c;++d){var R=gTheFolkFriendDatabase.aliases[F[d]],k=[];for(let N in R)R.hasOwnProperty(N)&&k.push(N);for(var H=k.length,O=0;O<H&&!c;++O){var p=R[k[O]],z=p;if(p=(p=(p=p.toLowerCase()).replace("'","")).replace('"',""),!a&&-1!=p.indexOf(n)||a&&0==p.indexOf(n)){p=z;for(var G=0;G<P&&!c;++G){var U=gTheFolkFriendDatabase.settings[E[G]];if(U.tune_id==F[d]){var W=!0;if(r){for(var V=L.length,Q=0;Q<V;++Q)L[Q]==U.tune_id&&(W=!1);L.push(U.tune_id)}if(W){if(o){var y=/"[^"]*"/gm,b=U.abc.match(y);if(b&&b.length>0){g++;var Y=capitalizeSongName(p);Y=capitalizeAfterO(Y),s+="X: "+g+"\n",s+="T: "+Y+"\n",s+="S: https://thesession.org/tunes/"+U.tune_id+"\n";var X=!1;U.dance&&(s+="R: "+U.dance+"\n","polka"==U.dance&&(X=!0)),U.meter&&(s+="M: "+U.meter+"\n",X&&"2/4"==U.meter&&(s+="L: 1/8\n")),U.mode&&(s+="K: "+U.mode+"\n"),s+=U.abc+"\n\n",g==gTheMaxDatabaseResults&&(c=!0)}}else{g++;var Y=capitalizeSongName(p);Y=capitalizeAfterO(Y),s+="X: "+g+"\n",s+="T: "+Y+"\n",s+="S: https://thesession.org/tunes/"+U.tune_id+"\n";var X=!1;U.dance&&(s+="R: "+U.dance+"\n","polka"==U.dance&&(X=!0)),U.meter&&(s+="M: "+U.meter+"\n",X&&"2/4"==U.meter&&(s+="L: 1/8\n")),U.mode&&(s+="K: "+U.mode+"\n"),s+=U.abc+"\n\n",g==gTheMaxDatabaseResults&&(c=!0)}}}}}}}}var J=document.getElementById("search_result");J.innerHTML="Search Results:&nbsp;&nbsp;"+g+" found",document.getElementById("search_results").value=s,(J=document.getElementById("search_results")).selectionStart=0,J.selectionEnd=0,isDesktopBrowser()?J.focus():J.blur(),J=document.getElementById("add-search-results"),g>0?(J.classList.remove("add-search-results-disabled"),J.classList.add("add-search-results"),J.disabled=!1):(J.classList.remove("add-search-results"),J.classList.add("add-search-results-disabled"),J.disabled=!0)}function addSearchResults(){var e=document.getElementById("search_results").value;if(e&&0!=e.length){ProcessAddTune(e);var t='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Search Results Added to Tunebook!</p>';DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}else{var t='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Nothing to Add!</p>';DayPilot.Modal.alert(t,{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}}function idleSearchResults(){var e=document.getElementById("search_results").value,t=document.getElementById("add-search-results");e&&e.length>0?(t.classList.remove("add-search-results-disabled"),t.classList.add("add-search-results"),t.disabled=!1):(t.classList.remove("add-search-results"),t.classList.add("add-search-results-disabled"),t.disabled=!0)}function SetTuneSearchMaxResults(){gTheMaxDatabaseResults=parseInt(document.getElementById("maxtunesearchresults").value),isNaN(gTheMaxDatabaseResults)&&(gTheMaxDatabaseResults=25)}function wait_for_retry(e){return new Promise(t=>setTimeout(t,e))}function fetchWithRetry(e,t,n,o={}){return fetch(e,o).catch(function a(r){if(!(triesLeft=n-1))throw r;return wait_for_retry(t).then(()=>fetchWithRetry(e,t,triesLeft,o))})}function SwitchTuneDatabase(){var e=document.getElementById("databaseselect").value;switch(e){case"0":gTheCurrentTuneDatabase=0,gUseLocalJSTuneDatabase?(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search",gTheParsedTuneDatabase=theLocalTuneDatabase):gTheParsedTuneDatabase?document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search":(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...",fetchWithRetry("https://michaeleskin.com/abctools/abctunes_gavin_heneghan_10nov2023.json",gTuneDatabaseRetryTimeMS,gTuneDatabaseRetryCount).then(e=>e.json()).then(e=>{document.getElementById("status")&&0==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheParsedTuneDatabase=e}).catch(function(e){document.getElementById("status")&&0==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Unable to load tune collection, please retry later...")})),document.getElementById("search_results").value="",document.getElementById("search_result").innerHTML="Search Results:",idleSearchResults();break;case"1":gTheCurrentTuneDatabase=1,gUseLocalJSTuneDatabase?(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search",gTheFolkFriendDatabase=theLocalFolkFriendDatabase):gTheFolkFriendDatabase?document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search":(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...",fetchWithRetry("https://michaeleskin.com/abctools/folkfriend-non-user-data_22dec2023.json",gTuneDatabaseRetryTimeMS,gTuneDatabaseRetryCount).then(e=>e.json()).then(e=>{document.getElementById("status")&&1==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Ready to search"),gTheFolkFriendDatabase=e}).catch(function(e){document.getElementById("status")&&1==gTheCurrentTuneDatabase&&(document.getElementById("status").innerHTML="&nbsp;&nbsp;&nbsp;Unable to load tune collection, please retry later...")})),document.getElementById("search_results").value="",document.getElementById("search_result").innerHTML="Search Results:",idleSearchResults()}gDefaultTuneDatabase=gTheCurrentTuneDatabase,SaveConfigurationSettings()}var gUseLocalJSTuneDatabase=!1,gTheParsedTuneDatabase=null,gTheFolkFriendDatabase=null,gTheCurrentTuneDatabase=0,gTheMaxDatabaseResults=25,gDefaultSearchCollection=0,gTuneDatabaseRetryTimeMS=3e3,gTuneDatabaseRetryCount=10;function AddFromSearch(e){sendGoogleAnalytics("dialog","AddFromSearch"),e&&e.preventDefault(),gTheCurrentTuneDatabase=gDefaultTuneDatabase;var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Search and Add Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#search_and_add_tunes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>';t+='<p style="font-size:12pt;line-height:24pt;margin-top:20px;margin-bottom:12px;" class="switchtunedatabase">Tune Collection to Search: <select id="databaseselect" onchange="SwitchTuneDatabase();" title="Select your tune search database"><option value="0">Gavin Heneghan\'s Collection (20,000+ Tune Settings)</option><option value="1">FolkFriend.app Collection (45,000+ Tune Settings)</option></select></p>',t+='<p style="font-size:12pt;line-height:24pt;margin-top:0px;margin-bottom:18px;">Search for text in the tune name:&nbsp;&nbsp;<input style="width:100%;font-size:12pt;line-height:18px;padding:6px;" id="tuneNameToSearch" title="Enter your search text here" autocomplete="off" autocorrect="off" placeholder="Enter your search text here"/> </p>',t+='<p class="tunesearchoptions">Only return first variation found?&nbsp;<input id="only_first_variation" type="checkbox" style="margin-top:-5px;margin-bottom:0px;" checked/>&nbsp;&nbsp;&nbsp;Match start of title?&nbsp;<input id="match_title_start" type="checkbox" style="margin-top:-5px;margin-bottom:0px;"/>&nbsp;&nbsp;&nbsp;Only return tunes with chords?&nbsp;<input id="chords_only" type="checkbox" style="margin-top:-5px;margin-bottom:0px;"/></p>',t+='<p class="tunesearchoptionsmax">Maximum number of results:<select id="maxtunesearchresults" onchange="SetTuneSearchMaxResults();" title="Maximum number of results" style="margin-top:-7px;"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></p>',t+='<p style="margin-top:10px;font-size:12pt;">	<input class="btn btn-start-search start-search" id="start-search" onclick="searchForTunes();" type="button" value="Search" title="Start search"><span id="status">&nbsp;&nbsp;&nbsp;Waiting for tune collection to load...</span></p>',t+='<div style="margin-bottom: 18px;">',t+='<h4 id="search_result">Search Results:</h4>',t+='<textarea id="search_results" style="font-family:Courier;font-size:13pt;line-height:16pt;width:724px;height:350px;padding:6px" placeholder="Search results will appear here" spellcheck="false" autocorrect="off" autocapitalize="none" oninput="idleSearchResults()"></textarea>',t+='<p style="margin-top:20px;text-align: center;">',t+='<input class="btn btn-add-search-results add-search-results-disabled" id="add-search-results" onclick="addSearchResults();" type="button" value="Add Results to Tunebook" title="Add Results to Tunebook">',t+="</p>",DayPilot.Modal.alert(t,{theme:"modal_flat",top:25,width:800,scrollWithPage:AllowDialogsToScroll()}),document.getElementById("maxtunesearchresults").value="25",gTheMaxDatabaseResults=25,document.getElementById("add-search-results").disabled=!0,0==gTheCurrentTuneDatabase?document.getElementById("databaseselect").value="0":document.getElementById("databaseselect").value="1",SwitchTuneDatabase()}function ChangeTuneOrderMobileSelect(e){ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_mobile_selected"),ChangeTuneOrderCurrent=e,e.classList.add("draggable_tune_mobile_selected")}function ChangeTuneOrderMobileUp(){if(null==ChangeTuneOrderCurrent)return;var e=ChangeTuneOrderCurrent.previousElementSibling;if(null==e)return;let t=document.getElementById("sortable-tune-list-mobile");t.insertBefore(ChangeTuneOrderCurrent,e);let n=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(n).map(e=>e.getAttribute("data_tune_index"))}function ChangeTuneOrderMobileDown(){if(null==ChangeTuneOrderCurrent)return;var e=ChangeTuneOrderCurrent.nextElementSibling;if(null==e)return;var t=e;e=e.nextElementSibling;let n=document.getElementById("sortable-tune-list-mobile");null==e?n.insertBefore(t,ChangeTuneOrderCurrent):n.insertBefore(ChangeTuneOrderCurrent,e);let o=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");ChangeTuneOrderNewOrder=Array.from(o).map(e=>e.getAttribute("data_tune_index"))}var ChangeTuneOrderCurrent=null,ChangeTuneOrderOriginalOrder=[],ChangeTuneOrderNewOrder=[];function ChangeTuneOrderMobile(){var e,t=[];ChangeTuneOrderNewOrder=[],ChangeTuneOrderCurrent=null,totalTunes=CountTunes();var n=GetTunebookIndexTitles(),o=n.length;if(0==o){var a="No tunes to re-order.";a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var r='<div id="sortable-tune-list-mobile" style="overflow:auto;height:580px;margin-top:18px">';for(e=0;e<o;++e)r+='<div class="draggable_tune_mobile" data_tune_index="'+e+'" onclick="ChangeTuneOrderMobileSelect(this)">'+n[e]+"</div>";var l=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Change the Order of the Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#change_tune_order" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:r+="</div>"},{html:'<p style="text-align:center;margin-top:36px;"><input id="mobile_tune_order_up" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobileUp(this);" type="button" value="Move Up" title="Moves the currently selected tune up one position"><input id="mobile_tune_order_down" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobileDown(this);" type="button" value="Move Down" title="Moves the currently selected tune down one position"></p>'}];setTimeout(function(){let e=document.querySelectorAll("#sortable-tune-list-mobile .draggable_tune_mobile");t=(ChangeTuneOrderNewOrder=Array.from(e).map(e=>e.getAttribute("data_tune_index"))).slice()},100),DayPilot.Modal.form(l,{},{theme:"modal_flat",top:50,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(!n.canceled){var o=!1;for(e=0;e<totalTunes;++e)if(ChangeTuneOrderNewOrder[e]!=t[e]){o=!0;break}if(o){var a=FindPreTuneHeader(gTheABC.value);for(e=0;e<totalTunes;++e){var r=getTuneByIndex(parseInt(ChangeTuneOrderNewOrder[e]));r=r.trim(),r+="\n\n",a+=r}gTheABC.value=a,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus(),MakeTuneVisible(!0)}),gIsDirty=!0}}})}function ChangeTuneOrder(){var e,t=[],n=[];ChangeTuneOrderCurrent=null,totalTunes=CountTunes();var o=GetTunebookIndexTitles(),a=o.length;if(0==a){var r="No tunes to re-order.";r=makeCenteredPromptString(r),DayPilot.Modal.alert(r,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var l='<div id="sortable-tune-list" style="overflow:auto;height:635px;margin-top:18px">';for(e=0;e<a;++e)l+='<div class="draggable_tune" draggable="true" data_tune_index="'+e+'">'+o[e]+"</div>";var s=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Change the Order of the Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#change_tune_order" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:18px;font-size:12pt;">Drag and drop the tune names to change the order of the tunes in the tunebook:</p>'},{html:l+="</div>"}];setTimeout(function(){let e=document.querySelectorAll("#sortable-tune-list .draggable_tune");t=(n=Array.from(e).map(e=>e.getAttribute("data_tune_index"))).slice()},100),DayPilot.Modal.form(s,{},{theme:"modal_flat",top:50,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(o){if(!o.canceled){var a=!1;for(e=0;e<totalTunes;++e)if(n[e]!=t[e]){a=!0;break}if(a){var r=FindPreTuneHeader(gTheABC.value);for(e=0;e<totalTunes;++e){var l=getTuneByIndex(parseInt(n[e]));l=l.trim(),l+="\n\n",r+=l}gTheABC.value=r,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus(),MakeTuneVisible(!0)}),gIsDirty=!0}}});let g=document.getElementById("sortable-tune-list"),c=null;g.addEventListener("click",function(e){var t=e.target;t.classList&&t.classList.contains("draggable_tune")&&(c=t,ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_selected"),ChangeTuneOrderCurrent=c,c.classList.add("draggable_tune_selected"))}),g.addEventListener("dragstart",function(e){c=e.target,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",c.innerHTML),ChangeTuneOrderCurrent&&ChangeTuneOrderCurrent.classList.remove("draggable_tune_selected"),ChangeTuneOrderCurrent=c,c.classList.add("draggable_tune_selected")}),g.addEventListener("dragover",function(e){e.preventDefault();let t=e.target;if(t&&t!==c&&t.classList.contains("draggable_tune")){let o=t.getBoundingClientRect(),a=(e.clientY-o.top)/(o.bottom-o.top)>.5;g.insertBefore(c,a?t.nextElementSibling:t);let r=document.querySelectorAll("#sortable-tune-list .draggable_tune");n=Array.from(r).map(e=>e.getAttribute("data_tune_index"))}}),g.addEventListener("dragend",function(){c=null})}function CullTunesUpdateKeepList(){CullTunesKeepList=[];let e=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(e).map(e=>{e.classList.contains("cull_selected")?CullTunesKeepList.push(0):CullTunesKeepList.push(1)})}function CullToggleSelection(e){e.classList.toggle("cull_selected"),CullTunesUpdateKeepList()}function CullSelectAll(){let e=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(e).map(e=>e.classList.add("cull_selected")),CullTunesUpdateKeepList()}function CullClearSelection(){let e=document.querySelectorAll("#cullable-tune-list .cullable_tune");Array.from(e).map(e=>e.classList.remove("cull_selected")),CullTunesUpdateKeepList()}var CullTunesKeepList=[];function CullTunes(){CullTunesKeepList=[],totalTunes=CountTunes();var e,t=GetTunebookIndexTitles(),n=t.length;if(0==n){var o="No tunes to delete.";o=makeCenteredPromptString(o),DayPilot.Modal.alert(o,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}var a='<div id="cullable-tune-list" style="overflow:auto;height:580px;margin-top:18px">';for(e=0;e<n;++e)a+='<div class="cullable_tune" onclick="CullToggleSelection(this)">'+t[e]+"</div>";var r=[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Delete Selected Tunes&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#delete_selected_tunes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:a+="</div>"},{html:'<p style="text-align:center;margin-top:36px;"><input id="cull_select_all" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullSelectAll();" type="button" value="Select All" title="Selects all the tunes for deletion"><input id="cull_clear_selection" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullClearSelection();" type="button" value="Clear Selection" title="Unselects all the tunes for deletion"></p>'}];DayPilot.Modal.form(r,{},{theme:"modal_flat",top:50,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1,okText:"Delete"}).then(function(t){if(!t.canceled){var n=CullTunesKeepList.length,o=0;for(e=0;e<n;++e)0==CullTunesKeepList[e]&&(bGotChange=!0,o++);if(o){var a="Are you sure you want to delete "+o;1==o?a+=" tune from your tunebook?":a+=" tunes from your tunebook?",a=makeCenteredPromptString(a),DayPilot.Modal.confirm(a,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(t){if(!t.canceled){var n=FindPreTuneHeader(gTheABC.value);for(e=0;e<totalTunes;++e)if(1==CullTunesKeepList[e]){var o=getTuneByIndex(e);o=o.trim(),o+="\n\n",n+=o}gTheABC.value=n,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.focus(),MakeTuneVisible(!0)}),gIsDirty=!0}})}}})}var gAddABCOKButton=null;function Configure_AddABC_UI(){var e=gFeaturesShowSearch,t=gFeaturesShowExamples,n=gFeaturesShowTemplates;let o={showsearch:gFeaturesShowSearch,showexampletunes:gFeaturesShowExamples,showexampletemplates:gFeaturesShowTemplates};DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-left:15px;">Select Add ABC Feature Options</p>'},{name:"          Show Search and Add Tunes",id:"showsearch",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show Example Tunes",id:"showexampletunes",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show Example Templates",id:"showexampletemplates",type:"checkbox",cssClass:"configure_ui_options_form_text"},],o,{theme:"modal_flat",top:100,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(o){!o.canceled&&(gFeaturesShowSearch=o.result.showsearch,gFeaturesShowExamples=o.result.showexampletunes,gFeaturesShowTemplates=o.result.showexampletemplates,(gFeaturesShowSearch!=e||gFeaturesShowExamples!=t||gFeaturesShowTemplates!=n)&&(SaveConfigurationSettings(),gAddABCOKButton.click(),setTimeout(function(){AddABC()},250)))})}function AddABC(){sendGoogleAnalytics("dialog","AddABC");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Add ABC Tunes, Templates, and PDF Features&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#add_templates_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span><img id="moreaddabcsettings" class="moreaddabcsettings" src="img/settings.png" title="Add ABC  Settings" onclick="Configure_AddABC_UI()"</img></p>';e+='<div id="add-new-tune-dialog">',e+='<p style="text-align:center;margin-top:28px;font-size:18px;">Add Your Own Tunes from an ABC or MusicXML File</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<label class="abcuploaddialog btn btn-top" for="addabcfilebutton" title="Adds tunes from an existing ABC or MusicXML file to the end of the ABC">Choose File to Add <input type="file" id="addabcfilebutton" accept=".abc,.txt,.ABC,.TXT,.xml,.XML,.musicxml,.mxl,.MXL" hidden/></label>',e+='<input class="dialogrestorebutton btn btn-restorebutton" id="dialogrestorebutton" onclick="RestoreSnapshot(false,true);" type="button" value="Restore from Snapshot" title="Replaces the contents of the ABC editor with a Snapshot saved in browser storage" style="display:none;">',e+='<input class="dialogrestoreautobutton btn btn-restorebutton" id="dialogrestoreautobutton" onclick="RestoreSnapshot(true,true);" type="button" value="Restore from Auto-Snapshot" title="Replaces the contents of the ABC editor with an Auto-Snapshot saved in browser storage" style="display:none;">',e+="</p>",gFeaturesShowSearch&&(e+='<p style="text-align:center;font-size:18px;margin-top:24px;">Search and Add Tunes</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="searchandaddtunes" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddFromSearch();" type="button" value="Search and Add Tunes" title="Search for tunes to add to your tunebook">'),e+='<p style="text-align:center;font-size:18px;margin-top:24px;">Change the Order or Delete Tunes</p>',e+='<p style="text-align:center;margin-top:16px;">',isDesktopBrowser()?e+='<input id="changetuneorder" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrder();" type="button" value="Change the Order of the Tunes" title="Change the order of the tunes">':e+='<input id="changetuneorder" class="advancedcontrols btn btn-injectcontrols-headers" onclick="ChangeTuneOrderMobile();" type="button" value="Change the Order of the Tunes" title="Change the order of the tunes">',e+='<input id="culltunes" class="advancedcontrols btn btn-injectcontrols-headers" onclick="CullTunes();" type="button" value="Delete Tunes from the Tunebook" title="Delete selected tunes from the tunebook">',e+="</p>",gFeaturesShowExamples&&(e+='<p style="text-align:center;font-size:18px;margin-top:24px;">Add an Example ABC Tune</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addnewreel" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleReel();" type="button" value="Add an Example Reel" title="Adds an example reel (Cooley\'s) to the end of the ABC">',e+='<input id="addnewjig" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleJig();" type="button" value="Add an Example Jig" title="Adds an example jig (The Kesh) to the end of the ABC">',e+='<input id="addnewhornpipe" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleHornpipe();" type="button" value="Add an Example Hornpipe" title="Adds an example Hornpipe (Alexander\'s) to the end of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addjsbach" class="advancedcontrols btn btn-injectcontrols-headers" style="margin-right:24px;" onclick="AppendJSBach();" type="button" value="Add J.S. Bach Two-Part Invention #1" title="Adds the J.S. Bach 2-Part Invention #1 to the end of the ABC">',e+='<input id="addjsbach" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendJSBach2();" type="button" value="Add J.S. Bach BWV570 Fantasia" title="Adds the J.S. Bach BWV570 Fantasia for Pipe Organ to the end of the ABC">',e+="</p>"),gFeaturesShowTemplates&&(e+='<p style="text-align:center;margin-top:24px;font-size:18px;">Add an ABC Template</p>',e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addnewtunetemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendTuneTempate();" type="button" value="Add a Tune Template" title="Adds a tune template to the end of the ABC">',e+='<input id="addsongtemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSongTemplate();" type="button" value="Add a Song Template" title="Adds a minimal song template to the end of the ABC">',e+='<input id="addnewsong" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AppendSampleSong();" type="button" value="Add an Example Song" title="Adds an example song to the end of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:16px;">',e+='<input id="addboxfingeringtemplate" class="advancedcontrols btn btn-injectcontrols-headers" style="margin-right:24px;" onclick="AppendBoxFingeringTemplate();" type="button" value="Add Box Fingering Symbols Template" title="Adds a template with symbols for annotating box fingerings and tablature to the top of the ABC">',e+='<input id="addboxfingeringtemplate" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddClickTrackTemplate();" type="button" value="Add Two-Bar Click Intro Templates" title="Adds two-bar click intro templates for common styles of tunes to the end of the ABC">',e+="</p>"),e+='<p style="text-align:center;margin-top:24px;font-size:18px;">Configure PDF Tunebook Features</p>',e+='<p style="text-align:center;margin-top:16px;"><input id="tunebookbuilder_add" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Configure PDF Tunebook Features" title="Easily add features to your PDF tunebook including: Title Page, Table of Contents, Index, Page Headers, Page Footers, playback links, and custom QR Code"></p>',e+='<p style="text-align:center;margin-top:24px;">',e+="</p>",e+="</div>",setTimeout(function(){idleAddABC()},100),DayPilot.Modal.alert(e,{theme:"modal_flat",top:25,width:720,scrollWithPage:AllowDialogsToScroll()}).then(function(){})}function AppendSampleReel(){sendGoogleAnalytics("action","AppendSampleReel");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Cooley's\n",e+="C: Traditional\n",e+="R: Reel\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="Q: 1/2=90\n",e+="K: Edor\n",e+="%abcjs_soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Set a specific amount of swing:\n",e+="%swing 0.15\n",e+="%\n",e+='|:"Em"EBBA B2 EB|"Em"B2 AB dBAG|"D"F/E/D AD BDAD|"D"F/E/D AD BAGF|\n',e+='"Em"EBBA B2 EB|"Em"B2 AB defg|"D"afge dBAF|1 "D"DEFD "Em"E3D:|2 "D"DEFD "Em"E2gf||\n',e+='|:"Em"eB (3BBB eBgf|"Em"eBB2 gedB|"D"A/A/A FA DAFA|"D"A/A/A FA defg|\n',ProcessAddTune(e+='"Em"eB (3BBB eBgf|"Em"eBBB defg|"D"afge dBAF|1 "D"DEFD "Em"E2gf:|2 "D"DEFD "Em"E4|]\n')}function AppendSampleJig(){sendGoogleAnalytics("action","AppendSampleJig");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: The Kesh\n",e+="C: Traditional\n",e+="R: Jig\n",e+="M: 6/8\n",e+="L: 1/8\n",e+="Q: 3/8=120\n",e+="K: Gmaj\n",e+="%abcjs_soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Set a specific amount of swing:\n",e+="%swing 0.25\n",e+="%\n",e+='|:"G"GAG GAB|"D"ABA ABd|"G"edd gdd|"C"edB "D"dBA|\n',e+='"G"GAG GAB|"D"ABA ABd|"G"edd gdB|"D"AGF "G"G3:|\n',e+='|:"G"BAB dBd|"C"ege "D"dBA|"G"BAB dBG|"D"ABA AGA|\n',ProcessAddTune(e+='"G"BAB dBd|"C"ege "G"dBd|"C"gfg "D"aga|"G"bgf g3:|\n')}function AppendSampleHornpipe(){sendGoogleAnalytics("action","AppendSampleHornpipe");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Alexander's\n",e+="C: Traditional\n",e+="R: Hornpipe\n",e+="M: 4/4\n",e+="L: 1/8\n",e+="Q: 1/2=80\n",e+="K: Dmaj\n",e+="%abcjs_soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Set a specific amount of swing:\n",e+="%swing 0.25\n",e+="%\n",e+='|:(3gfe|"D"dAFA DFAd|fdcd Adef|"G"g2 ge "D"fdcd|"A"(3efe (3dcB A2 (3gfe|\n',e+='"D"dAFA DFAd|fdcd Adef|"G"g2 ge "D"fdcd|"A"(3efe dc"D"d2:|\n',e+='|:AG|"D"FAdA FAdA|"G"GBdB GBdB|"A"Acec Acec|"D"dfaf "A"(3gfe (3dAG|\n',ProcessAddTune(e+='"D"FAdA FAdA|"G"GBdB GBdB|"A"Acef gecd|(3efe dc"D"d2:|\n')}function AppendTuneTempate(){sendGoogleAnalytics("action","AppendTuneTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Tune Title\n",e+="C: Composer\n",e+="R: Tune style (Reel, Jig, Hornpipe, etc.)\n",e+="%\n",e+="% Meter:\n",e+="M: 4/4\n",e+="%\n",e+="% Beat unit:\n",e+="L: 1/8\n",e+="%\n",e+="% Tempo:\n",e+="Q: 120\n",e+="%\n",e+="% Key:\n",e+="K: C\n",e+="%\n",e+="% Soundfont (fluid, musyng, fatboy, canvas, or mscore):\n",e+="%abcjs_soundfont fluid\n",e+="%\n",e+="% Use an Acoustic Grand Piano sound for the melody:\n",e+="%%MIDI program 0\n",e+="%\n",e+="% Use an Acoustic Grand Piano for the chords:\n",e+="%%MIDI chordprog 0\n",e+="%\n",e+="% Use an Synth Bass sound for the bass:\n",e+="%%MIDI bassprog 38\n",e+="%\n",e+="% Add your tune's ABC below:\n",ProcessAddTune(e+='"C"C2 D2 E2 F2| G2 A2 B2 c2|]\n')}function AppendSongTemplate(){sendGoogleAnalytics("action","AppendSongTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="% Stripped-down self-documenting song in ABC, by Linda Eskin\n",e+="% Replace the WORDS IN UPPER-CASE with your own information.\n",e+="% You can remove all these comments with single % signs.\n",e+="%\n",e+="X: 1\n",e+="%\n",e+="% *** THIS HEADER CONVEYS INFORMATION ABOUT THE SONG ***\n",e+="%\n",e+="% These text elements appear above the music:\n",e+="T: TITLE OF THE SONG\n",e+="T: ALTERNATE TITLE\n",e+="C: COMPOSER/SONGWRITER\n",e+="O: ORIGIN/GEOGRAPHIC\n",e+="%%text GENERAL PURPOSE TEXT\n",e+="%\n",e+="% These appear below the music and lyrics:\n",e+="S: SOURCE OF THE SONG\n",e+="D: DISCOGRAPHY - CD, LP, ETC.\n",e+="N: NOTES (TEXT)\n",e+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS\n",e+="H: HISTORY OF THE SONG\n",e+="H: This self-documenting ABC song template was created by Linda Eskin.\n",e+="%\n",e+="% This appears in your ABC file only, for reference.\n",e+="F: FILE URL - WHERE TO FIND THIS ONLINE\n",e+="%\n",e+="% These appear above the music AND control how it is played:\n",e+="R: RHYTHM, E.G. JIG, WALTZ\n",e+="M: 4/4\n",e+="L: 1/4\n",e+="Q: 1/4=120\n",e+="K: C\n",e+="% The K (key) tag should be the last thing in the header.\n",e+="%\n",e+="% *** THE SONG ITSELF STARTS HERE - REPLACE THIS WITH YOUR SONG ***\n",e+="%\n",e+="P: PART - VERSE, CHORUS, ETC.\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',e+="w: The words to the act-u-al tune go here\n",e+="w: You can put more ver-ses here is you like\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',e+="w: This tune is a scale. See how the notes work!\n",e+="w: This line is for the se-cond verse. Ta-da!\n",e+="%\n",e+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",e+="%\n",e+="W: Write your extra verses here, verses here, verses here.\n",e+="W: Write your extra verses here, or the whole song if you like.\n",e+="W:\n",e+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",e+="W: --- Indent it with dashes if you like, but spaces will not work.\n",e+="W:\n",e+="W: Here we have another verse, another verse, another verse.\n",e+="W: Now we have reached the end - this is the last verse of this song.\n",e+="%\n",ProcessAddTune(e+="% That should get you started. Go play!\n")}function AppendSampleSong(){sendGoogleAnalytics("action","AppendSampleSong");var e="";CountTunes()>0&&(e+="\n"),e+="% A simple, self-documenting song in ABC, by Linda Eskin\n",e+="%\n",e+="% ABC is a plain-text format for conveying musical information.\n",e+="% Use this as an example to learn how ABC is written.\n",e+="% You can use it as a template to create your own ABC song.\n",e+="% Examples are in UPPER-CASE so you can see and replace them easily.\n",e+="%\n",e+="% Comments (like this one) start with a single percent symbol.\n",e+="%\n",e+="X: 1 \n",e+="% Each tune must start with an X: tag, and a number.\n",e+="%\n",e+="% *** THIS IS THE HEADER - INFO ABOUT THE TUNE/SONG ***\n",e+="%\n",e+="% These text elements appear above the music:\n",e+="%\n",e+="T: TITLE OF THE SONG\n",e+="T: ALTERNATE TITLE\n",e+="%\n",e+="C: COMPOSER\n",e+='% Songwriter, source, "Traditional", "Child Ballad," etc.\n',e+="%\n",e+="O: ORIGIN\n",e+="% Where is the tune from? Country, culture, ...\n",e+="%\n",e+="%%text GENERAL PURPOSE TEXT\n",e+="% There are many more options that use the double percentage symbols.\n",e+="% Note that lines starting with %% are *not* comments.\n",e+="%\n",e+="% These text elements appear below the music and lyrics:\n",e+="%\n",e+="% For S:, D:, H:, N:, and Z: the first line with the tag adds a label.\n",e+="% Additional lines with the same tag do not.\n",e+="%\n",e+="% S:, D:, H:, N:, and Z: lines do not word wrap.\n",e+="% Add more lines if you have more than will fit across the page.\n",e+="%\n",e+="S: SOURCE\n",e+='% "Learned from Morgan at Folk Festival," "Child Ballad," etc.\n',e+="%\n",e+="D: DISCOGRAPHY\n",e+="% On which CD/LP? Appears at the bottom of the page.\n",e+="%\n",e+="N: THESE NOTES APPEAR NEAR THE BOTTOM OF THE PAGE.\n",e+="%\n",e+="Z: TRANSCRIBER, COPYRIGHT, PERMISSIONS.\n",e+="% Transcriber info appears at the bottom, right below the Notes.\n",e+="%\n",e+="H: HISTORY OF THE SONG\n",e+="H: This self-documenting ABC example song was created by Linda Eskin.\n",e+="% Real-life event? Written for a movie? Appears at the bottom of the page.\n",e+="%\n",e+="F: FILE URL\n",e+="% If you want people to find your file online, put the URL here.\n",e+="%\n",e+="% These appear above the music AND control how it is played:\n",e+="%\n",e+="R: RHYTHM\n",e+="% Reel, Waltz, Jig, Hornpipe, etc.\n",e+="%\n",e+="M: 4/4\n",e+="% Meter, such as 3/4, 4/4, 9/8. Appears in the key signature.\n",e+="%\n",e+="L: 1/4\n",e+="% Length of base note unit. Here a 1/4 note = 1.\n",e+="% Use multiplier numbers to get longer notes: C2, a3, F4\n",e+="%\n",e+="Q: 1/4=120\n",e+="% Tempo. e.g. 120 beats per minute (BPM). (Mnemonic: Q=Quickness.)\n",e+="%\n",e+="%%staffsep 80\n",e+="% Sets the spacing between the staffs. Bigger numbers = more space.\n",e+="%\n",e+="K: C\n",e+="% Key signature - G, D, Edor, Amix, etc.\n",e+="% The K (key) tag should be the last thing in the header.\n",e+="%\n",e+="% *** THE TUNE ITSELF STARTS HERE ***\n",e+="%\n",e+="P: PART GOES HERE\n",e+="% Intro, Verse, Chorus, Refrain, etc.\n",e+="%\n",e+="% This is the actual music and words.\n",e+="% ABC apps *play* the music you write. Don't just make stuff up!\n",e+="% Follow the ABC standard so your tune and chords play correctly:\n",e+="% http://abcnotation.com/wiki/abc:standard:v2.1\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|\n',e+="w: The words to the act-u-al tune go here\n",e+="w: You can put more ver-ses here is you like\n",e+="%\n",e+='"C"C D2 E|"F"F G3|"Am"A B2 c|"E7"d e3|]\n',e+="w: This tune is a scale. See how the notes work!\n",e+="w: This line is for the se-cond verse. Ta-da!\n",e+="%\n",e+="% Chord names, in quotes, appear above the black-dots notation.\n",e+="%\n",e+="% The other letters are the notes. Lower-case for higher octave.\n",e+='% The base unit note length ("L", above) is assumed to equal 1.\n',e+="% For longer notes use a multiplier: G3, e2, C4 etc.\n",e+="%\n",e+='% w (lower-case "w") = words, or inline lyrics - the lyrics that appear right in the sheet music, below the black-dots notation.\n',e+="%\n",e+="% *** YOU CAN PUT MORE LYRICS AFTER THE TUNE, TOO. ***\n",e+="%\n",e+="% W = Words. More lyrics, if you want them.\n",e+='% Note upper-case "W:" used below:\n',e+="%\n",e+="W: Write your extra verses here, verses here, verses here.\n",e+="W: Write your extra verses here, or the whole song if you like.\n",e+="W:\n",e+='% You can leave a "W" line blank, to leave some space.\n',e+="W: --- This is where the chorus goes, chorus goes, chorus goes.\n",e+="W: --- Indent it with dashes if you like, but spaces won't work.\n",e+="W:\n",e+="W: Here we have another verse, another verse, another verse.\n",e+="W: Now we have reached the end - this is the last verse of this song.\n",e+="%\n",ProcessAddTune(e+="% That should get you started. Go play!\n")}function AppendBoxFingeringTemplate(){sendGoogleAnalytics("action","AppendBoxFingeringTemplate");var e=gTheABC.value,t="";t+="%\n",t+="% Danny Flynn's symbols for box fingering transcriptions\n",t+="%\n",t+="% Copy and paste these as chord annotations before the notes:\n",t+="%\n",t+='% Finger 1: "1" "①"\n',t+='% Finger 2: "2" "②"\n',t+='% Finger 3: "3" "③"\n',t+='% Finger 4: "4" "④"\n',t+='% Slide down: "➘"\n',t+='% Slide up: "➚"\n',t+='% Slide straight down: "↓"\n',t+='% Cross over/under: "x"\n',t+='% Push: "⮐"\n',t+='% Draw: "⮑"\n',t+="%\n",t+="% Additional symbols for button numbering tablature:\n",t+="%\n",t+='% "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "↑" "↓"\n',t+='% "①" "②" "③" "④" "⑤" "⑥" "⑦" "⑧" "⑨" "⑩" "⑪"\n',t+="%\n",t+="\n",t+=e,gTheABC.value=t,gIsDirty=!0,gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation())}function AddClickTrackTemplate(){sendGoogleAnalytics("action","AddClickTrackTemplate");var e="";CountTunes()>0&&(e+="\n"),e+="X: 1\n",e+="T: Two-Bar Click Intro Templates\n",e+="Q: 1/8\n",e+="%\n",e+="%%text Copy and paste these templates at the start of the notes for any tune.\n",e+="%%text Make sure that any tune first-part repeats, including first-endings, have a starting |:\n",e+="%%text For a higher pitched click, change the ^C values in the patterns to =C\n",e+="%%text\n",e+="%\n",e+="%%text Reel two-bar click intro:\n",e+="%%text\n",e+="M: 4/4\n",e+="%\n",e+="V:1\n",e+="V:2\n",e+="%%MIDI program 128\n",e+="^Cz3 ^Cz3|^Cz3 ^Cz3|\n",e+="V:1\n",e+="z8|z8|\n",e+="%\n",e+="%%text\n",e+="%%text Jig two-bar click intro:\n",e+="M: 6/8\n",e+="%\n",e+="V:1\n",e+="V:2\n",e+="%%MIDI program 128\n",e+="^Cz2 ^Cz2|^Cz2 ^Cz2|\n",e+="V:1\n",e+="z6|z6|\n",e+="%\n",e+="%%text\n",e+="%%text Slide two-bar click intro:\n",e+="M: 12/8\n",e+="%\n",e+="V:1\n",e+="V:2\n",e+="%%MIDI program 128\n",e+="^Cz2 ^Cz2 ^Cz2 ^Cz2|\n",e+="V:1\n",e+="z12|\n",e+="%\n",e+="%%text\n",e+="%%text Slip Jig two-bar click intro:\n",e+="M: 9/8\n",e+="%\n",e+="V:1\n",e+="V:2\n",e+="%%MIDI program 128\n",e+="^Cz2 ^Cz2 ^Cz2|^Cz2 ^Cz2 ^Cz2|\n",e+="V:1\n",e+="z9|z9|\n",e+="%\n",e+="%%text\n",e+="%%text Polka two-bar click intro:\n",e+="M: 2/4\n",e+="%\n",e+="V:1\n",e+="V:2\n",e+="%%MIDI program 128\n",e+="^Cz ^Cz|^Cz ^Cz|\n",e+="V:1\n",e+="z4|z4|\n",e+="%\n",e+="%%text\n",e+="%%text Waltz two-bar click intro:\n",e+="M: 3/4\n",e+="%\n",e+="V:1\n",e+="V:2\n",e+="%%MIDI program 128\n",e+="^Cz ^Cz ^Cz|^Cz ^Cz ^Cz|\n",e+="V:1\n",e+="z6|z6|\n",ProcessAddTune(e+="\n")}function AppendJSBach(){sendGoogleAnalytics("action","AppendJSBach");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="%\n",e+="% Example J.S. Bach transcription originally imported from MusicXML\n",e+="%\n",e+='% Click "Play" to play\n',e+="%\n",e+="T:Two-Part Invention #1\n",e+="C:J.S. Bach\n",e+="L:1/16\n",e+="Q:1/4=84\n",e+="M:4/4\n",e+="K:C\n",e+="%\n",e+="% Try changing the abcjs_soundfont value to\n",e+="% fluid, musyng, fatboy, canvas, or mscore for different harpsichord sounds:\n",e+="%\n",e+="%abcjs_soundfont fluid\n",e+="%\n",e+="%%staffsep 40\n",e+="%\n",e+="% Try changing these to %%MIDI program mute\n",e+="% to isolate individual voices:\n",e+="%\n",e+="V:1 treble\n",e+="%%MIDI program 6\n",e+="V:2 bass\n",e+="%%MIDI program 6\n",e+="V:1\n",e+="[Q:84]\n",e+="z CDE FDEC G2c2 B/A/Bc2 | dGAB cABG d2g2 f/e/fg2 |\n",e+="eagf egfa gfed cedf | edcB AcBd cBAG ^FAGB |\n",e+="A2D2 c/B/c2d BAG^F EGFA | GBAc Bdce dB/c/dg B/c/BAG |\n",e+=".G4 z4 z GAB cABG | .^F4 z4 z ABc dBcA |\n",e+=".B4 z4 z dcB AcBd | .c4 z4 z edc Bd^ce |\n",e+="d2^c2d2e2 f2A2B2c2 | d2^F2^G2A2 B2c2 d4 |\n",e+="z E^F^G AFGE edce dcBd | ca^gb aefd ^Gfed c/d/cBA |\n",e+="Aagf egfa g8- | gefg afge f8 |\n",e+="z gfe dfeg f8- | fdef gefd e8- |\n",e+="ecde fdec defg afge | fgab c'abg [Q:78]c'2g2 [Q:70]e/f/edc|\n",e+="c_BAG [Q:62]FAGB [Q:54]A=BcE [Q:46]Dc[Q:28]FB | [EGc]16|]\n",e+="V:2\n",e+="[Q:84]\n",e+="z8 z C,D,E, F,D,E,C, | G,2G,,2 z4 z G,A,B, CA,B,G, |\n",e+="C2B,2C2D2 E2G,2A,2B,2 | C2E,2^F,2G,2 A,2B,2 C4- |\n",e+="CD,E,^F, G,E,F,D, G,2B,,2C,2D,2 | E,2^F,2G,2E,2 B,,2>C,2 D,2D,,2 |\n",e+="z G,,A,,B,, C,A,,B,,G,, D,2G,2^F,2G,2 | A,D,E,^F, G,E,F,D, A,2D2C2D2 |\n",e+="G,GFE DFEG F2E2F2D2 | EAGF EGFA G2F2G2E2 |\n",e+="F_BAG FAGB AGFE DFEG | FEDC B,DCE DCB,A, ^G,B,A,C |\n",e+="B,2E,2D/C/.D3 CB,A,G, ^F,A,^G,B, | A,CB,D CEDF E2A,2E2E,2 |\n",e+="A,2A,,2 z4 z EDC B,D^CE | D8- DA,B,C DB,CA, |\n",e+="B,8- B,DCB, A,CB,D | C8- CG,A,_B, CA,B,G, |\n",e+="A,2_B,2A,2G,2 F,2D2C2B,2 | A,2F2E2D2 ED,E,F, G,E,F,D, |\n",ProcessAddTune(e+="E,2C,2D,2E,2 F,D,E,F, [Q:46]G,2[Q:28]G,,2 | [C,,C,]16 |]\n")}function AppendJSBach2(){sendGoogleAnalytics("action","AppendJSBach2");var e="";CountTunes()>0&&(e+="\n"),e+="X:1\n",e+="%\n",e+="% Example J.S. Bach transcription originally imported from MusicXML\n",e+="%\n",e+='% Click "Play" to play\n',e+="%\n",e+="T:Fantasia\n",e+="T:BWV570\n",e+="T:Johann Sebastian Bach (1685-1750)\n",e+="%%score { 1 | 2 | 3 | 4 }\n",e+="L:1/16\n",e+="M:4/4\n",e+="K:C\n",e+="%\n",e+="% Try changing the abcjs_soundfont value to\n",e+="% fluid, musyng, fatboy, canvas, or mscore for different organ sounds:\n",e+="%\n",e+="%abcjs_soundfont fluid\n",e+="%\n",e+="%%stretchlast true\n",e+="%%staffsep 40\n",e+="Q:100\n",e+="%\n",e+="% Try changing these to %%MIDI program mute\n",e+="% to isolate individual voices:\n",e+="%\n",e+="V:1 treble\n",e+="%%MIDI program 19\n",e+="V:2 treble\n",e+="%%MIDI program 19\n",e+="V:3 bass\n",e+="%%MIDI program 19\n",e+="V:4 bass\n",e+="%%MIDI program 19\n",e+="V:1\n",e+="G4 c6 d2 B4 | e6 f2 d6 e2 | c8- c2e2d2c2 | B2A2 B4 z2 e2g2e2 |\n",e+="c2e2G2c2 A2c2d2e2 | f2e2d2c2 B2G2 c4- | c2dcB2cB A8- | A2Bc d6 efB2cd |\n",e+="^G6 AB A2Bcd2cd | B6 cB A6 B^G | c8- c2dc_B2cA | _B8- B2>G2A2GA |\n",e+="F6 EF G2A_B A4- | A2Bc d6 Bcd2ef | e8- e2dc d4- | d2ef e6 fg f4- |\n",e+="f2ga g6 ag f4- | f2gf e6 fe d4 | d8d8- | d2cB c6 dc B4 |\n",e+="c4 z12 | z4 d8 c4- | c8 B4 _B4 | A4 B4 G8 |\n",e+="A4 c4 B8 | c8c8 | f8 e8- | e6e6 d4- |\n",e+="d4 d2ef g2agf2gf | e4 g6 ag f4- | f2gfe2fe d8 | g2agf2gf e6 fe |\n",e+="d6 ed c6 dc | B4 c4 d4 e4- | e2fe d6 ef e4- | e2fe d6 efg2ab |\n",e+="c2Bcd2ef B4 c4- | cdBd cdBd cedf egfa | gGAB c4- cede fdef | B2cd2<c2B c8- |\n",e+="c8c8 | c16 |]\n",e+="V:2\n",e+="G8G8- | G2G2 c6 c2 B4- | B2B2 A6A6- | A4 G4 z8 |\n",e+="z16 | z16 | z4 G4 E8 | F8F8- |\n",e+="F2ED C4 E8- | E8E8- | E8 D8- | D2E^F G6 E2- E4- |\n",e+="E2D^C D4 E6 ^FG | ^F6 EF G8- | G2AB c4 A6 Bc | B6 cd c6 de |\n",e+="d6 ef e6 dc | d6 cB c6 BA | B8B8 | G6 FE F6 ED |\n",e+="E6 FG A6 Bc | B8- B6 A^G | A8 G8 | F8 E6 FE |\n",e+="D6 ED D4 G4 | G4 A6A6 | d8- d2cB c4- | c2dc c6 dc c4- |\n",e+="c2BA B6 c4 B2 | c4 d4 c6 dc | B4 c6 BA B4 | c4 B6 cB A4- |\n",e+="A2BA G6 AG ^F4 | G8 B4 c4- | c6 BA B6 cd | c6 BA B8 |\n",e+="A8 G8- | G8G8- | G8G8- | G6G6 F4 |\n",e+="G4 F6 GF EFDF | E16 |]\n",e+="V:3\n",e+="E8 D8- | D4 C4 D4 G4 | E8 D8- | D8 C8- |\n",e+="C8 C8 | D6D6 E2FE | D8 ^C8 | D4 A,2B,C B,8- |\n",e+="B,4 A,8 ^G,4- | G,2A,B, C6 B,A, B,4- | B,2A,^G,A,2E,=G, ^F,8 | G,6 A,_B,- B,4 A,4- |\n",e+="A,8 _B,4 E,4 | A,8 G,8- | G,6 E,C, ^F,6 D,2 | G,8G,8- |\n",e+="G,8G,8- | G,8G,8- | G,2G,A,B,2CD G,2A,B,D,2E,F, | E,4 A,4 D,4 G,4- |\n",e+="G,2A,B, C6 DE F4- | F8 E8- | E4 D8 C4- | C4 D6 CB, C4- |\n",e+="C2B,C A,4 B,4 E4- | E8 F8- | F4 G6G6 | A8A8 |\n",e+="G4 G2F2 E4 D4 | C2DCB,2CB, A,4 D4- | D4 E2C2 G6 FG | E2FED2ED C6 DC |\n",e+="B,6 CB, A,2B,2 C4 | D4 E4 G8 | A4 D4 G8- | G8G8 |\n",e+="E4 D8 E4- | E2D2E2D2 E2B,2C2D2 | E4- EEDC D8- | D4 F4 E4 C4|\n",e+="z2 C_B,A,2G,F, G,6 F,2 | G,16 |]\n",e+="V:4\n",e+="C,2D,2E,2C,2 G,8- | G,8G,8 | A,6 G,2 ^F,8 | G,6 F,2 E,8- |\n",e+="E,8 F,8- | F,4 ^F,4 G,8- | G,8- G,2A,_B,A,2G,A, | F,8 D,8 |\n",e+="E,8E,8- | E,8E,8 | A,,8 D,8- | D,8 ^C,8 |\n",e+="D,6D,6 ^C,4 | C,8 B,,8 | C,8 ^F,,8 | G,,8G,,8- |\n",e+="G,,8G,,8- | G,,8G,,8- | G,,4 z12 | z16 |\n",e+="C,6 D,E, F,6 G,A, | D,2E,F,B,,2C,D, ^G,,2E,,2 A,,4- | A,,2A,G,^F,2E,D, G,2D,=F,E,2D,C, | F,2C,E,D,2C,B,, E,8 |\n",e+="F,4 ^F,4 G,2G,=F,E,2E,D, | C,2C,B,,A,,2A,,G,, F,,2A,,G,,F,,2F,,E,, | D,,2D,C,B,,2A,,G,, C,6 D,E, | A,,6 B,,C, F,,4 ^F,,2E,,F,, |\n",e+="G,,4 z8 x4 | z16 | G,8G,8- | G,8G,8- |\n",e+="G,8G,8- | G,2G,F,E,2D,C, B,,2A,,G,,F,,2E,,D,, | F,,4 F,4 G,8- | G,8G,8- |\n",e+="G,4 F,6 G,F,E,2D,C, | G,8G,8- | G,8G,8- | G,8 C,2C_B,A,2G,F, |\n",ProcessAddTune(e+="E,4 F,4 C,8 | C,16 |]\n")}function ProcessAddTune(e){gTheABC.value.length,gTheABC.value=gTheABC.value+e,gIsDirty=!0,"No ABC file selected"!=gDisplayedName&&-1==gDisplayedName.indexOf("+ added tunes")&&(gDisplayedName+=" + added tunes"),RenderAsync(!0,null,function(){UpdateNotationTopPosition();var e=CountTunes();isMobileBrowser()&&(gCurrentTune=e-1);var t=getTuneByIndex(e-1),n=gTheABC.value.length-t.length;if(!gIsMaximized){if(ScrollABCTextIntoView(gTheABC,n,n,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}MakeTuneVisible(!0)})}function ScrollABCTextIntoView(e,t,n,o){let a=e.value;e.value=a.substring(0,n);let r=e.scrollHeight;e.value=a;let l=r,s=e.clientHeight;l>s?l-=s/o:l=0,e.scrollTop=l,e.setSelectionRange(t,n)}function RenderDivClickHandler(e){if(!gRenderingPDF&&!gDisableNotationRendering){var t=this.id;if(t&&""!=t&&0==t.indexOf("notation")){var n=this.id.replace("notation","");if(""!=n){var o=parseInt(n);if(o==gLastClickedTune)return;gLastClickedTune=o;var a=findTuneOffsetByIndex(o);if(gIsMaximized)gGotRenderDivClick=!0,gRenderDivClickOffset=a;else{if(ScrollABCTextIntoView(gTheABC,a,a,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}}}}}function GenerateRenderingDivs(e){if(!gDisableNotationRendering){var t=gTheNotation;t.innerHTML="";for(var n=0;n<e;++n){var o=document.createElement("div");o.id="notation"+n,o.classList.add("tunespacer"),o.classList.add("pagebreak"),isDesktopBrowser()&&(o.onclick=RenderDivClickHandler),t.appendChild(o)}}}function getUrlWithoutParams(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function FillUrlBoxWithAbcInLZW(e,t){var n="";n=e||gTheABC.value;var o=LZString.compressToEncodedURIComponent(n),a=GetRadioValue("notenodertab"),r=gCapo,l=gStaffSpacing-STAFFSPACEOFFSET,s=document.getElementById("pdfformat").value,g=document.getElementById("pagenumbers").value,c=document.getElementById("firstpage").value,d=getUrlWithoutParams()+"?lzw="+o+"&format="+a+"&ssp="+l+"&pdf="+s+"&pn="+g+"&fp="+c,u="";switch(a){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"cgdae":case"guitare":case"guitard":case"uke":u="&capo="+r,gShowTabNames?u+="&stn=true":u+="&stn=false"}if(d+=u,e)return d;var p=CountTunes(),m=getDescriptiveFileName(p,!1);if(d+="&name="+m,document.getElementById("qrcode").style.display="none",gAllowURLSave=!1,gAllowQRCodeSave=!1,d.length<8100&&(gAllowURLSave=!0,d.length<MAXQRCODEURLLENGTH&&(gAllowQRCodeSave=!0)),t){var h=document.getElementById("urltextbox");gAllowURLSave?(document.getElementById("testurl").classList.remove("urlcontrolsdisabled"),document.getElementById("testurl").classList.add("urlcontrols"),document.getElementById("saveurl").classList.remove("urlcontrolsdisabled"),document.getElementById("saveurl").classList.add("urlcontrols"),document.getElementById("copyurl").classList.remove("urlcontrolsdisabled"),document.getElementById("copyurl").classList.add("urlcontrols"),document.getElementById("shortenurl").classList.remove("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.add("urlcontrols"),gAllowQRCodeSave?(document.getElementById("generateqrcode").classList.remove("urlcontrolsdisabled"),document.getElementById("generateqrcode").classList.add("urlcontrols")):(document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"))):(d=" *** The URL link would be too long to share. Please try sharing fewer tunes. ***",document.getElementById("generateqrcode").classList.remove("urlcontrols"),document.getElementById("generateqrcode").classList.add("urlcontrolsdisabled"),document.getElementById("shortenurl").classList.remove("urlcontrols"),document.getElementById("shortenurl").classList.add("urlcontrolsdisabled"),document.getElementById("testurl").classList.remove("urlcontrols"),document.getElementById("testurl").classList.add("urlcontrolsdisabled"),document.getElementById("copyurl").classList.remove("urlcontrols"),document.getElementById("copyurl").classList.add("urlcontrolsdisabled"),document.getElementById("saveurl").classList.remove("urlcontrols"),document.getElementById("saveurl").classList.add("urlcontrolsdisabled")),h.value=d}return d}function CreateURLfromHTML(){FillUrlBoxWithAbcInLZW(null,!0),(urltextbox=document.getElementById("urltextbox")).focus(),urltextbox.setSelectionRange(0,0),clearQRCode()}function clearQRCode(){gTheQRCode&&gTheQRCode.clear()}function GenerateQRCode(e){sendGoogleAnalytics("sharing","generate_qr_code");var t=!1,n=document.getElementById("urltextbox").value;if(e.shiftKey){if(n.length>MAXQRCODEURLLENGTH){DayPilot.Modal.alert('<p style="text-align:center;font-family:helvetica;font-size:14pt;">Share URL is too long to generate a QR Code</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}t=!0}else if(!gAllowQRCodeSave)return;null==gTheQRCode?gTheQRCode=new QRCode(document.getElementById("qrcode"),{text:n,width:548,height:548,colorDark:"#000000",colorLight:"#ffffff",border:16,correctLevel:QRCode.CorrectLevel.M}):(gTheQRCode.clear(),gTheQRCode.makeCode(n)),document.getElementById("qrcode").style.display="inline-block";var o="Custom QR Code",a="custom_qr_code";if((theQRCodeImage=document.querySelectorAll('div[id="qrcode"] > img'))&&theQRCodeImage.length>0){if(!t){o=GetAllTuneTitles();var r=GetRadioValue("notenodertab"),l="";switch(r){case"noten":l="<br/><br/>(Standard Notation)";break;case"notenames":l="<br/><br/>(Note Names Tab)";break;case"mandolin":l="<br/><br/>(Mandolin Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"gdad":l="<br/><br/>(Bouzouki GDAD Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"cgdae":l="<br/><br/>(CGDAE Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"guitare":l="<br/><br/>(Standard Guitar Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"guitard":l="<br/><br/>(DADGAD Guitar Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"uke":l="<br/><br/>(Ukulele Tab",0!=gCapo&&(l+=" - Capo on "+gCapo),l+=")";break;case"whistle":l="<br/><br/>(Whistle Tab)"}o+=l;var s=CountTunes();a=getDescriptiveFileName(s,!0)}theQRCodeImage=theQRCodeImage[0];var g=window.open("");setTimeout(function(){var e=theQRCodeImage.src,t=theQRCodeImage.outerHTML.replace("display: block;",""),n='<div style="text-align:center;padding:24px;margin-top:0px;margin-bottom:0px;">';n+=t,n+='<p style="font-family:times;font-size:15pt;margin-top:18px;margin-bottom:0px;">'+o+"</p>",n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Get Your QR Code</strong></p>',n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><a href="'+e+'" download="'+a+'.png" style="text-decoration:none;color:darkblue">Click here to download&nbsp;'+a+".png&nbsp;to your system.</a></p>",n+='<p style="font-family:times;font-size:16pt;margin-top:32px;margin-bottom:0px;"><strong>Use Your QR Code</strong></p>',n+='<p style="font-family:times;font-size:15pt;margin-top:30px;margin-bottom:0px;">Share QR Codes on social media or email them to friends like any other photo.</p>',n+='<p style="font-family:times;font-size:15pt;margin-top:24px;margin-bottom:0px;">Scanning the code with the Camera app on any iOS or Android phone will load the</p>',n+='<p style="font-family:times;font-size:15pt;margin-top:6px;margin-bottom:0px;">ABC Transcription Tool with your tune set into the browser on the device.</p>',n+="</div>",g.document.write(n),setTimeout(function(){g.document.title="ABC Tools Tune Sharing QR Code"},100)},1e3)}}function saveABCFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;isDesktopBrowser()?t.endsWith(".abc")||t.endsWith(".txt")||t.endsWith(".ABC")||t.endsWith(".TXT")||(t=t.replace(/\..+$/,""),t+=".abc"):(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3),gDisplayedName=t,gABCFromFile=!0,document.getElementById("abc-selected").innerText=t,gIsDirty=!1})}function saveTextFile(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;isDesktopBrowser()&&(t.endsWith(".txt")||t.endsWith(".TXT"))||(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)})}function saveTextFileDeveloper(e,t,n){DayPilot.Modal.prompt(e,t,{theme:"modal_flat",top:200,autoFocus:!1,scrollWithPage:AllowDialogsToScroll()}).then(function(e){var t=e.result;if(null==t||0==(t=t.replace(/[^a-zA-Z0-9_\-. ]+/ig,"")).length)return null;isDesktopBrowser()||(t=t.replace(/\..+$/,""),t+=".txt");var o=document.createElement("a");document.body.appendChild(o),o.style="display: none";var a=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(a);o.href=r,o.download=t,o.click(),document.body.removeChild(o),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)})}function CopyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);{let t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((e,n)=>{document.execCommand("copy")?e():n(),t.remove()})}}catch(n){console.log("CopyToClipboard error: "+n)}}function OverrideOneTuneMIDIParams(e,t,n,o,a,r){var l=e,s=/%%MIDI program \d+\s*/gm,g=e.match(s);if(g&&g.length>0)for(var c=0;c<g.length;++c)l=l.replace(g[c].trim(),"%%MIDI program "+t);s=/%%MIDI bassprog \d+\s*/gm;var d=e.match(s);if(d&&d.length>0)for(var c=0;c<d.length;++c)l=l.replace(d[c].trim(),"%%MIDI bassprog "+n);s=/%%MIDI chordprog \d+\s*/gm;var u=e.match(s);if(u&&u.length>0)for(var c=0;c<u.length;++c)l=l.replace(u[c].trim(),"%%MIDI chordprog "+o);s=/%%MIDI bassvol \d+\s*/gm;var p=e.match(s);if(p&&p.length>0)for(var c=0;c<p.length;++c)l=l.replace(p[c].trim(),"%%MIDI bassvol "+a);s=/%%MIDI chordvol \d+\s*/gm;var m=e.match(s);if(m&&m.length>0)for(var c=0;c<m.length;++c)l=l.replace(m[c].trim(),"%%MIDI chordvol "+r);return l}function FindPreTuneHeader(e){var t,n=e.search(/^X:.*[\r\n]*/m);return -1==n||0==n?"":t=e.substring(0,n)}function InjectRepeatsAndClickTrackAll(){sendGoogleAnalytics("dialog","InjectRepeatsAndClickTrackAll");var e=CountTunes();0!=e&&DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Repeats and Two-Bar Click Intros&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#injectrepeatsandtwobarclickintros" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject repeats into each tune in the ABC area by  appending the entire ABC for each tune to itself multiple times.</p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">You may also optionally inject a two-bar click intro before each tune.</p>'},{name:"How many times through each tune:",id:"configure_repeats",type:"number",cssClass:"configure_repeats_form_text"},{name:"            Inject a two-bar style-appropriate click intro before each tune",id:"configure_inject_click",type:"checkbox",cssClass:"configure_repeats_form_text"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>To only append a two-bar click intro before each tune:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">1) Set <strong>How many times through each tune:</strong> to 1</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">2) Check <strong>Inject a two-bar style-appropriate click intro before each tune</strong>.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">3) Click <strong>OK</strong>.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>For best results when repeating tunes:<strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">For clean repeats, your tunes must not have extraneous pickup or trailing notes and must have proper and complete timing.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">If there is a repeat at the end of the first part of a tune, either standalone or in a first ending, there must be a matching |: bar at the start of the tune for the tune repeats to work properly.</p>'},],{configure_repeats:1,configure_inject_click:!1},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){var n=t.result.configure_repeats;if(null!=n){if(repeatCount=parseInt(n),!(isNaN(repeatCount)||void 0==repeatCount||repeatCount<1)){for(var o=t.result.configure_inject_click,a=FindPreTuneHeader(gTheABC.value),r=0;r<e;++r){var l=getTuneByIndex(r),s=getTuneRhythmType(l);l=AddDuplicatesForMp3(l,s,repeatCount,o),a+=l,a+="\n\n"}gTheABC.value=a,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}}}})}function InjectStringAboveTuneHeaderConditional(e,t){return -1==e.indexOf(t)?InjectStringAboveTuneHeader(e,t):e}function InjectStringAboveTuneHeader(e,t){var n=escape(e).split("%0A"),o="",a="";for(i=0;i<n.length;++i){var r=(a=unescape(n[i])).split("");"|"!=r[0]&&"["!=r[0]&&":"==r[1]?(o+=a+"\n","X"==r[0]&&(o+=t+"\n")):(o+=a,i!=n.length-1&&(o+="\n"))}return o}function InjectStringBelowTuneHeaderConditional(e,t){return -1==e.indexOf(t)?InjectStringBelowTuneHeader(e,t):e}function InjectStringBelowTuneHeader(e,t){if(isSectionHeader(e))return e;for(var n,o=e,a=removeABCTuneHeaders(e=e.trim()),r=(a=a.trim()).split("\n"),l=r.length,s=!1,g=0;g<l;++g)if(0!=(n=r[g]).indexOf("%")){s=!0;var c=a.indexOf(n);a=a.substring(c);break}if(!s)return o;var d=e.indexOf(n);return e=e.substring(0,d),e+=t,e+="\n"+a+"\n\n"}function InjectOneTuneStaffWidth(e,t){return InjectStringBelowTuneHeader(e,"%%staffwidth "+t)}function InjectOneTuneLargePrint(e,t){return InjectStringBelowTuneHeader(e,"%\n% Adjust these values to produce the desired results:\n%\n%%noexpandtowidest\n%%leftmargin 0\n%%rightmargin 0\n%%staffwidth "+t+"\n%")}function InjectOneTuneSoundfont(e,t){return InjectStringBelowTuneHeader(e,"% Soundfont: "+t+"\n%abcjs_soundfont "+t)}function InjectSectionHeader(){!gRenderingPDF&&(sendGoogleAnalytics("dialog","InjectSectionHeader"),DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject PDF Tunebook Section Header&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#pdf_section_headers" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a PDF section header placeholder tune into the ABC.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica">The section header will be displayed on its own line in the PDF Table of Contents and Index.</p>'},{html:'<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Clicking on the section header in the PDF Table of Contents or Index will jump to the section.</p>'},{html:'<p style="margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">The * at the start of the injected tune title marks the tune as a PDF section header.</p>'},{name:"Section name to inject",id:"configure_sectionheader",type:"text",cssClass:"configure_sectionheader_form_text"},],{configure_sectionheader:"Section Name"},{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!0}).then(function(e){if(!e.canceled){var t=e.result.configure_sectionheader;if(null!=t){var n=gTheABC.selectionStart,o=gTheABC.value.substring(0,n),a=gTheABC.value.substring(n);gTheABC.value=o+"\nX:1\nT:*"+t+"\n"+a,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=n,gTheABC.selectionEnd=n,FocusAfterOperation()})}}}))}function InjectHeaderString(){if(!gRenderingPDF){var e=findSelectedTuneIndex();DayPilot.Modal.form([{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Inject ABC Header String&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_controls" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">Clicking "OK" will inject the string into the header of your ABC tune(s).</p>'},{name:"Header inject location:",id:"injectlocation",type:"select",options:[{name:"  Top",id:0},{name:"  Bottom",id:1}],cssClass:"configure_injectheaderstring_select"},{name:"String to inject:",id:"injectstring",type:"text",cssClass:"configure_injectheaderstring_form_text"},{name:"          Inject all tunes",id:"injectalltunes",type:"checkbox",cssClass:"configure_injectheaderstring_form_text"},],{injectlocation:1,injectstring:"",injectalltunes:!0},{theme:"modal_flat",top:100,width:650,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(sendGoogleAnalytics("action","InjectHeaderString"),!t.canceled){var n=t.result.injectlocation,o=t.result.injectalltunes,a=t.result.injectstring;if(""!=a){if(o){for(var r=CountTunes(),l=gTheABC.value,s=l.split(/^X:/gm),g=FindPreTuneHeader(l),c=1;c<=r;++c){var d="X:"+s[c];0==n?g+=InjectStringAboveTuneHeader(d,a):g+=InjectStringBelowTuneHeader(d,a)}gTheABC.value=g,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var u=findSelectedTune();if(""==u)return;var p=u;p=(p=0==n?InjectStringAboveTuneHeader(p,a):InjectStringBelowTuneHeader(p,a)).replace("\n\n","");var m=gTheABC.selectionStart,h=gTheABC.value;h=h.replace(u,p),gTheABC.value=h,gIsDirty=!0,RenderAsync(!1,e,function(){gTheABC.selectionStart=m,gTheABC.selectionEnd=m,FocusAfterOperation()})}}}})}}var gLastInjectedStaffWidth=556;function InjectStaffWidth(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectStaffWidth");let e={configure_staffwidth:gLastInjectedStaffWidth,configure_inject_all:!0};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Staff Width Directive&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#pdf_tunebook_spacing_overrides" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %%staffwidth directive into the ABC. </p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">Larger numbers make the notation less tall. </p>'},{name:"%%staffwidth value to inject?",id:"configure_staffwidth",type:"number",cssClass:"configure_staffwidth_form_text"},{name:"            Inject all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_staffwidth_form_text"},],e,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.configure_staffwidth;if(null!=t){var n=parseInt(t);if(!isNaN(n)&&void 0!=n){if(gLastInjectedStaffWidth=n,e.result.configure_inject_all){for(var o=CountTunes(),a=gTheABC.value,r=a.split(/^X:/gm),l=FindPreTuneHeader(a),s=1;s<=o;++s)r[s]="X:"+r[s],l+=InjectOneTuneStaffWidth(r[s],n);gTheABC.value=l,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var g=gTheABC.selectionStart,c=gTheABC.value.substring(0,g),d=gTheABC.value.substring(g);gTheABC.value=c+"%%staffwidth "+n+"\n"+d,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=g,gTheABC.selectionEnd=g,FocusAfterOperation()})}}}}})}var gNotationSpacingLeftMargin=15,gNotationSpacingRightMargin=15,gNotationSpacingStaffWidth=556,gNotationSpacingStaffSep=0,gNotationSpacingNoExpand=!1,gNotationCallback=null;function testSpacingChange(){var e;isNaN(e=document.getElementById("layout_left_margin").value)||(gNotationSpacingLeftMargin=e),isNaN(e=document.getElementById("layout_right_margin").value)||(gNotationSpacingRightMargin=e),isNaN(e=document.getElementById("layout_staff_width").value)||(gNotationSpacingStaffWidth=e),isNaN(e=document.getElementById("layout_staff_sep").value)||(gNotationSpacingStaffSep=e),gNotationSpacingNoExpand=document.getElementById("layout_inject_noexpand").checked,gNotationCallback&&gNotationCallback()}function NotationSpacingInject(){if(document.getElementById("layout_inject_all").checked){for(var e=CountTunes(),t=gTheABC.value,n=t.split(/^X:/gm),o=FindPreTuneHeader(t),a=1;a<=e;++a)o+=InjectOneTuneSpacingHeader("X:"+n[a],gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand);gTheABC.value=o,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()});var r='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Spacing Injection Complete!</p>';DayPilot.Modal.alert(r,{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}else{var l=findSelectedTune();if(""==l)return;var s=findSelectedTuneIndex(),g=l;g=(g=InjectOneTuneSpacingHeader(g,gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand)).replace("\n\n","");var c=gTheABC.selectionStart,d=gTheABC.value;d=d.replace(l,g),gTheABC.value=d,gIsDirty=!0,RenderAsync(!1,s,function(){gTheABC.selectionStart=c,gTheABC.selectionEnd=c,FocusAfterOperation()});var r='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Spacing Injection Complete!</p>';DayPilot.Modal.alert(r,{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}}function InjectOneTuneSpacingHeader(e,t,n,o,a,r){var l="%%staffsep "+t+"\n%%leftmargin "+n+"\n%%rightmargin "+o+"\n%%staffwidth "+a+"\n%";return r&&(l="%%noexpandtowidest\n"+l),InjectStringBelowTuneHeader(e,l="%\n% Spacing values injected by the Notation Spacing Explorer:\n%\n"+l)}function NotationSpacingExplorer(){if(gAllowCopy&&!gRenderingPDF){sendGoogleAnalytics("dialog","NotationSpacingExplorer");var e,t=findSelectedTune();if(""!=t){var n=GetRadioValue("notenodertab"),o=GetABCJSParams(n);o.oneSvgPerLine=!1,modal_msg='<div id="notationspacingexplorerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;padding:4px;">',modal_msg+='<div id="notationspacingexplorer-paper"></div>',modal_msg+="</div>",modal_msg+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span>Staff Separation:</span> <input style="width:70px;margin-right:14px;" id="layout_staff_sep" type="number" min="-100" step="1" max="1000" title="Staff separation" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+='<span>Left Margin:</span> <input style="width:70px;margin-right:14px;" id="layout_left_margin" type="number" min="0" step="1" max="1000" title="Left margin" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+='<span>Right Margin:</span> <input style="width:70px;margin-right:14px;" id="layout_right_margin" type="number" min="0" step="1" max="1000" title="Right margin" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+='<span>Staff Width:</span> <input style="width:80px;margin-right:0px;" id="layout_staff_width" type="number" min="0" step="1" max="2000" title="Staff width" autocomplete="off" onchange="testSpacingChange();"/>',modal_msg+="</p>",modal_msg+='<p class="configure_layout_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Add %%noexpandtowidest:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="layout_inject_noexpand" type="checkbox" onchange="testSpacingChange();"/>',modal_msg+='<input id="notationspacingexplorertest" style="margin-right:36px;" class="notationspacingexplorerinject button btn btn-notationspacingexplorertest" onclick="testSpacingChange();" type="button" value="Test Values" title="Tests the spacing changes ABC">',modal_msg+='<span style="font-size:12pt;font-family:helvetica;">Inject all tunes:</span><input style="width:16px;margin-left:8px;margin-right:24px;" id="layout_inject_all" type="checkbox"/>',modal_msg+='<input id="notationspacingexplorerinject" class="notationspacingexplorerinject button btn btn-notationspacingexplorerinject" onclick="NotationSpacingInject();" type="button" style="margin-right:0px;" value="Inject Spacing into the ABC" title="Injects the spacing values into the ABC">',modal_msg+="</p>",modal_msg+='<a id="notationspacingexplorer_help" href="https://michaeleskin.com/abctools/userguide.html#advanced_notationspacingexplorer" target="_blank" style="text-decoration:none;" title="Learn more about the Notation Spacing Explorer">?</a>';var a=window.innerWidth;isDesktopBrowser()?(e=.45*a)<850&&(e=850):e=800;var r=/^X:.*$/gm,l=t=t.replace(r,"X:1\n%%staffsep "+gStaffSpacing);DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:e,okText:"Close",scrollWithPage:isMobileBrowser()}),gNotationSpacingLeftMargin=15;var r=/^%%leftmargin.*$/m,s=t.match(r);if(s&&s.length>0){var g=s[0].replace("%%leftmargin",""),c=parseInt(g=g.trim());isNaN(c)||(gNotationSpacingLeftMargin=c)}if(gNotationSpacingRightMargin=15,r=/^%%rightmargin.*$/gm,(s=t.match(r))&&s.length>0){var g=s[s.length-1].replace("%%rightmargin",""),c=parseInt(g=g.trim());isNaN(c)||(gNotationSpacingRightMargin=c)}if(gNotationSpacingStaffWidth=556,r=/^%%staffwidth.*$/gm,(s=t.match(r))&&s.length>0){var g=s[s.length-1].replace("%%staffwidth",""),c=parseInt(g=g.trim());isNaN(c)||(gNotationSpacingStaffWidth=c)}if(gNotationSpacingStaffSep=gStaffSpacing,r=/^%%staffsep.*$/gm,(s=t.match(r))&&s.length>0){var g=s[s.length-1].replace("%%staffsep",""),c=parseInt(g=g.trim());isNaN(c)||(gNotationSpacingStaffSep=c)}gNotationSpacingNoExpand=!1,r=/^%%noexpandtowidest.*$/m,(s=t.match(r))&&s.length>0&&(gNotationSpacingNoExpand=!0),document.getElementById("layout_left_margin").value=gNotationSpacingLeftMargin,document.getElementById("layout_right_margin").value=gNotationSpacingRightMargin,document.getElementById("layout_staff_width").value=gNotationSpacingStaffWidth,document.getElementById("layout_staff_sep").value=gNotationSpacingStaffSep,document.getElementById("layout_inject_noexpand").checked=gNotationSpacingNoExpand,gNotationCallback=function(){t=InjectOneTuneSpacingHeader(l,gNotationSpacingStaffSep,gNotationSpacingLeftMargin,gNotationSpacingRightMargin,gNotationSpacingStaffWidth,gNotationSpacingNoExpand);var e=ABCJS.renderAbc("notationspacingexplorer-paper",t,o)[0];postProcessTab([e],"notationspacingexplorer-paper",n,!0),document.querySelectorAll('div[id="notationspacingexplorer-paper"] > svg')[0].style.boxShadow="inset 0px 0px 0px 1px #b8b8b8"};var d=ABCJS.renderAbc("notationspacingexplorer-paper",t,o)[0];postProcessTab([d],"notationspacingexplorer-paper",n,!0),document.querySelectorAll('div[id="notationspacingexplorer-paper"] > svg')[0].style.boxShadow="inset 0px 0px 0px 1px #b8b8b8"}}}function InjectOneTuneMIDIProgram(e,t){var n,o,a="";return InjectStringBelowTuneHeader(e,a="% Melody program: "+(n="mute"==t?"Mute":generalMIDISoundNames[t+1])+"\n%%MIDI program "+t)}function InjectOneTuneMIDIBassProgramAndVolumes(e,t,n){var o,a="";return a="% Bass program: "+(o="mute"==t?"Mute":generalMIDISoundNames[t+1])+"\n%%MIDI bassprog "+t,InjectStringBelowTuneHeader(e,a+="\n%%MIDI bassvol "+n)}function InjectOneTuneMIDIChordProgramAndVolumes(e,t,n){var o,a="";return a="% Chords program: "+(o="mute"==t?"Mute":generalMIDISoundNames[t+1])+"\n%%MIDI chordprog "+t,InjectStringBelowTuneHeader(e,a+="\n%%MIDI chordvol "+n)}function InjectOneTuneMIDIProgramAboveTune(e,t,n,o){var a;return n?InjectStringAboveTuneHeader(e,"%%MIDI bassprog "+t):o?InjectStringAboveTuneHeader(e,"%%MIDI chordprog "+t):InjectStringAboveTuneHeader(e,"%%MIDI program "+t)}function InjectOneTuneMIDIVolume(e,t,n){var o;return n?InjectStringBelowTuneHeader(e,"%%MIDI chordvol "+t):InjectStringBelowTuneHeader(e,"%%MIDI bassvol "+t)}function InjectOneTuneMIDIVolumeAboveTune(e,t,n){var o;return n?InjectStringAboveTuneHeader(e,"%%MIDI chordvol "+t):InjectStringAboveTuneHeader(e,"%%MIDI bassvol "+t)}const soundfontNames=["Fluid","Musyng Kite","FatBoy","Canvas","MScore"],generalMIDISoundNames=["Mute","Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavi","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)","Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar Harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","SynthStrings 1","SynthStrings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet","French Horn","Brass Section","SynthBrass 1","SynthBrass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)","Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bag pipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Melodic Tom","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot","abcjs Percussion","Uilleann Pipes","Smallpipes (D)","Smallpipes (A)","S\xe4ckpipa","Concertina","Melodica","Cajun Accordion","Solf\xe8ge","Silence"];var gLastInjectedSoundfont=null,gLastInjectedProgram=1,gLastInjectedBassProgram=1,gLastInjectedChordsProgram=1,gLastInjectedChordVolume=64,gLastInjectedBassVolume=64;function InjectAllMIDIParams(){if(gRenderingPDF)return;sendGoogleAnalytics("dialog","InjectAllMIDIParams");for(var e=[],t=0;t<138;++t)e.push({name:"  "+generalMIDISoundNames[t],id:t});null==gLastInjectedSoundfont&&(-1!=gDefaultSoundFont.indexOf("Fluid")?gLastInjectedSoundfont="0":-1!=gDefaultSoundFont.indexOf("Musyng")?gLastInjectedSoundfont="1":-1!=gDefaultSoundFont.indexOf("FatBoy")?gLastInjectedSoundfont="2":-1!=gDefaultSoundFont.indexOf("canvas")?gLastInjectedSoundfont="3":-1!=gDefaultSoundFont.indexOf("mscore")&&(gLastInjectedSoundfont="4"));let n={configure_soundfont:gLastInjectedSoundfont,configure_inject_soundfont:!1,configure_program:gLastInjectedProgram,configure_inject_melody_program:!1,configure_bassprogram:gLastInjectedBassProgram,configure_chordprogram:gLastInjectedChordsProgram,configure_bassvolume:gLastInjectedBassVolume,configure_chordvolume:gLastInjectedChordVolume,configure_inject_chord_program:!1,configure_inject_bass_program:!1,configure_inject_all:!0};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject MIDI Soundfont, Melody, Bass, and Chords&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#selecting_the_instruments_for_playback" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %abcjs_soundfont directive into the ABC:</p>'},{name:"            Inject abcjs Soundfont",id:"configure_inject_soundfont",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"%abcjs_soundfont value to inject:",id:"configure_soundfont",type:"select",options:[{name:"  Fluid",id:"0"},{name:"  Musyng Kite",id:"1"},{name:"  FatBoy",id:"2"},{name:"  Canvas",id:"3"},{name:"  MScore",id:"4"},],cssClass:"configure_soundfont_select"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject a %%MIDI program directive into the ABC:</p>'},{name:"            Inject MIDI Melody program",id:"configure_inject_melody_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Melody program to inject:",id:"configure_program",type:"select",options:e,cssClass:"configure_midi_program_select"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject %%MIDI bassprog and %%MIDI bassvol directives into the ABC:</p>'},{name:"            Inject MIDI Bass program and volumes",id:"configure_inject_bass_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Bass program to inject:",id:"configure_bassprogram",type:"select",options:e,cssClass:"configure_midi_program_select"},{name:"MIDI Bass volume (0-127):",id:"configure_bassvolume",type:"text",cssClass:"configure_midi_program_form_number_input"},{html:'<p style="margin-top:24px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject %%MIDI chordprog and %%MIDI chordvol directives into the ABC:</p>'},{name:"            Inject MIDI Chord program and volumes",id:"configure_inject_chord_program",type:"checkbox",cssClass:"configure_midi_program_form_text"},{name:"MIDI Chord program to inject:",id:"configure_chordprogram",type:"select",options:e,cssClass:"configure_midi_program_select"},{name:"MIDI Chord volume (0-127):",id:"configure_chordvolume",type:"text",cssClass:"configure_midi_program_form_number_input"},{html:'<p style="font-size:14pt;line-height:19pt;font-family:helvetica;margin-bottom:30px;text-align:center;"><a href="https://michaeleskin.com/documents/general_midi_extended_v2.pdf" target="_blank">General MIDI Instrument Program Numbers</a></p>'},{name:"            Inject all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_midi_program_form_text"},],n,{theme:"modal_flat",top:20,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.configure_inject_soundfont,n=e.result.configure_inject_melody_program,o=e.result.configure_inject_bass_program,a=e.result.configure_inject_chord_program;if(t||n||o||a){var r=e.result.configure_soundfont;gLastInjectedSoundfont=r;var l="fluid";switch(r){case"0":l="fluid";break;case"1":l="musyng";break;case"2":l="fatboy";break;case"3":l="canvas";break;case"4":l="mscore"}var s=e.result.configure_program;gLastInjectedProgram=s,0==s?s="mute":((s-=1)<0||s>137)&&(s=0);var g=e.result.configure_bassprogram,c=e.result.configure_chordprogram;if(gLastInjectedBassProgram=g,gLastInjectedChordsProgram=c,gLastInjectedBassVolume=e.result.configure_bassvolume,gLastInjectedChordVolume=e.result.configure_chordvolume,isNaN(parseInt(gLastInjectedBassVolume))&&(gLastInjectedBassVolume=0),gLastInjectedBassVolume<0&&(gLastInjectedBassVolume=0),gLastInjectedBassVolume>127&&(gLastInjectedBassVolume=127),isNaN(parseInt(gLastInjectedChordVolume))&&(gLastInjectedChordVolume=0),gLastInjectedChordVolume<0&&(gLastInjectedChordVolume=0),gLastInjectedChordVolume>127&&(gLastInjectedChordVolume=127),0==g?g="mute":((g-=1)<0||g>137)&&(g=0),0==c?c="mute":((c-=1)<0||c>137)&&(c=0),e.result.configure_inject_all){if(t){for(var d=CountTunes(),u=gTheABC.value,p=u.split(/^X:/gm),m=FindPreTuneHeader(u),h=1;h<=d;++h)p[h]="X:"+p[h],m+=InjectOneTuneSoundfont(p[h],l);gTheABC.value=m,gIsDirty=!0}if(n){for(var d=CountTunes(),u=gTheABC.value,p=u.split(/^X:/gm),m=FindPreTuneHeader(u),h=1;h<=d;++h)p[h]="X:"+p[h],m+=InjectOneTuneMIDIProgram(p[h],s);gTheABC.value=m,gIsDirty=!0}if(o){for(var d=CountTunes(),u=gTheABC.value,p=u.split(/^X:/gm),m=FindPreTuneHeader(u),h=1;h<=d;++h)p[h]="X:"+p[h],m+=InjectOneTuneMIDIBassProgramAndVolumes(p[h],g,gLastInjectedBassVolume);gTheABC.value=m,gIsDirty=!0}if(a){for(var d=CountTunes(),u=gTheABC.value,p=u.split(/^X:/gm),m=FindPreTuneHeader(u),h=1;h<=d;++h)p[h]="X:"+p[h],m+=InjectOneTuneMIDIChordProgramAndVolumes(p[h],c,gLastInjectedChordVolume);gTheABC.value=m,gIsDirty=!0}gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation())}else{var f=gTheABC.selectionStart;if(o){T="mute"==g?"Mute":generalMIDISoundNames[g+1];var T,A=gTheABC.value.substring(0,f),y=gTheABC.value.substring(f),b="% Bass instrument: "+T+"\n%%MIDI bassprog "+g;b+="\n%%MIDI bassvol "+gLastInjectedBassVolume,b+="\n",gTheABC.value=A+b+y,gIsDirty=!0}if(a){T="mute"==c?"Mute":generalMIDISoundNames[c+1];var T,A=gTheABC.value.substring(0,f),y=gTheABC.value.substring(f),b="% Chord instrument: "+T+"\n%%MIDI chordprog "+c;b+="\n%%MIDI chordvol "+gLastInjectedChordVolume,b+="\n",gTheABC.value=A+b+y,gIsDirty=!0}if(n){T="mute"==s?"Mute":generalMIDISoundNames[s+1];var T,A=gTheABC.value.substring(0,f),y=gTheABC.value.substring(f);gTheABC.value=A+"% Melody instrument: "+T+"\n%%MIDI program "+s+"\n"+y,gIsDirty=!0}if(t){var A=gTheABC.value.substring(0,f),y=gTheABC.value.substring(f);gTheABC.value=A+"% Soundfont: "+l+"\n%abcjs_soundfont "+l+"\n"+y,gIsDirty=!0}gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=f,gTheABC.selectionEnd=f,FocusAfterOperation()}):(gTheABC.selectionStart=f,gTheABC.selectionEnd=f,FocusAfterOperation())}}}})}const metronome_list=[{name:"C|",pattern:"dd 76 77 32 32"},{name:"C",pattern:"dddd 76 77 77 77 32 32 32 32"},{name:"2/2",pattern:"dd 76 77 32 32"},{name:"3/2",pattern:"ddd 76 77 77 32 32 32"},{name:"2/4",pattern:"dd 76 77 32 32"},{name:"3/4",pattern:"ddd 76 77 77 32 32 32"},{name:"4/4",pattern:"dddd 76 77 77 77 32 32 32 32"},{name:"5/4",pattern:"ddddd 76 77 77 77 77 32 32 32 32 32"},{name:"6/4",pattern:"dddddd 76 77 77 77 77 77 32 32 32 32 32"},{name:"7/4",pattern:"ddddddd 76 77 77 77 77 77 77 32 32 32 32 32 32"},{name:"2/8",pattern:"dz 76 32"},{name:"3/8",pattern:"dzz 76 32"},{name:"5/8",pattern:"dzzdz 76 76 32 32"},{name:"6/8",pattern:"dzzdzz 76 76 32 32"},{name:"7/8",pattern:"dzdzdzz 76 76 76 32 32 32"},{name:"9/8",pattern:"dzzdzzdzz 76 76 76 32 32 32"},{name:"10/8",pattern:"dzzdzzdzdz 76 76 76 76 32 32 32 32"},{name:"12/8",pattern:"dzzdzzdzzdzz 76 76 76 76 32 32 32 32"}];var gMetronomeVolume=48;function inject_one_metronome(e,t){var n,o=e.split("\n"),a="",r="";for(n=0;n<o.length;++n){a=o[n],searchRegExp=/^M:.*[\r\n]*/m;var l=a.match(searchRegExp);l&&l.length>0&&""==r&&(r=(r=l[0].replace("M:","")).trim())}if(""==r){if(t){var s="No meter found in the ABC.";s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}return null}var g="";for(n=0;n<metronome_list.length;++n)if(r==metronome_list[n].name){g="%\n% Metronome sounds and volumes\n%\n%%MIDI drum "+metronome_list[n].pattern.replaceAll("32",gMetronomeVolume)+"\n%%MIDI drumon\n%";break}if(""==g){if(t){var s="No metronome pattern available for meter: "+r;s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}return null}return e=(e=InjectStringBelowTuneHeader(e,g)).trim()}function InjectMetronome(){if(!gRenderingPDF){sendGoogleAnalytics("dialog","InjectMetronome");var e=findSelectedTuneIndex();DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Metronome&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#adding_a_metronome" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This injects a metronome into the ABC using %%MIDI drum and %%MIDI drumon directives.</p>'},{name:"            Inject metronome into all tunes",id:"configure_inject_all",type:"checkbox",cssClass:"configure_metronome_form_text"},],{configure_inject_all:!1},{theme:"modal_flat",top:200,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){if(!t.canceled){if(t.result.configure_inject_all){for(var n=CountTunes(),o=1==n,a="",r=0;r<n;++r){var l=getTuneByIndex(r),s=inject_one_metronome(l,o);s?(a+=s,a+="\n\n"):a+=l}gTheABC.value=a,gIsDirty=!0,RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()})}else{var g=findSelectedTune();if(""==g)return;var c=inject_one_metronome(g,!0);if(!c)return;var d=gTheABC.selectionStart,u=gTheABC.value;u=u.replace(g,c),gTheABC.value=u,gIsDirty=!0,RenderAsync(!1,e,function(){gTheABC.selectionStart=d,gTheABC.selectionEnd=d,FocusAfterOperation()})}}})}}function CopyABC(){gAllowCopy&&(CopyToClipboard(gTheABC.value),document.getElementById("copybutton").value="Copied!",setTimeout(function(){document.getElementById("copybutton").value="Copy All"},750))}function ShortenURLFallback(){gAllowURLSave&&(CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("shortenurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("shortenurl").value="Launching TinyURL",setTimeout(function(){window.open("https://tinyurl.com"),document.getElementById("shortenurl").value="Shorten URL"},1e3)},2e3))}function ShortenURL(){if(gAllowURLSave){var e;sendGoogleAnalytics("sharing","shorten_share_url"),fetch("https://api.tinyurl.com/create",{method:"POST",headers:{accept:"application/json",authorization:gTinyURLAPIKey,"content-type":"application/json"},body:JSON.stringify({url:document.getElementById("urltextbox").value})}).then(e=>{if(200!=e.status){ShortenURLFallback();return}return e.json()}).then(e=>{CopyToClipboard(e.data.tiny_url);var t='<p style="text-align:center;font-size:16pt;font-family:helvetica">Shortened URL Copied to the Clipboard</p>';t+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica">Short URL:</p>',t+='<p style="text-align:center;font-size:14pt;line-height:19pt;font-family:helvetica"><a href="'+e.data.tiny_url+'" target="_blank">'+e.data.tiny_url+"</a></p>",DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}).catch(e=>{ShortenURLFallback()})}}function CopyShareURL(){gAllowURLSave&&(sendGoogleAnalytics("sharing","copy_share_url"),CopyToClipboard(document.getElementById("urltextbox").value),document.getElementById("copyurl").value="Share URL Copied!",setTimeout(function(){document.getElementById("copyurl").value="Copy Share URL"},750))}function SaveABC(){if(gAllowSave){sendGoogleAnalytics("export","SaveABC");var e=gTheABC.value;if(0!=e.length){var t=CountTunes(),n=getDescriptiveFileName(t,!1);isDesktopBrowser()?saveABCFile("Please enter a filename for your ABC file:",n+=".abc",e):saveABCFile("Please enter a filename for your ABC file:",n+=".txt",e)}}}function SaveShareURL(){if(gAllowURLSave){sendGoogleAnalytics("sharing","save_share_url");var e=urltextbox.value;if(0!=e.length){var t=CountTunes(),n=getDescriptiveFileName(t,!1);saveTextFile("Please enter a filename for your Share URL file:",n+"_Share_URL.txt",e)}}}function TestShareURL(){if(gAllowURLSave){sendGoogleAnalytics("sharing","test_share_url");var e=document.getElementById("urltextbox").value;window.open(e)}}function SetAbcText(e){gTheABC.value=e}function ShowAllControls(){document.getElementById("notenrechts").style.display="inline-block",gShowAllControls=!0,UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function HideAllControls(){document.getElementById("notenrechts").style.display="none",gShowAllControls=!1,UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function ShowMaximizeButton(){document.getElementById("zoombutton").style.display="block"}function HideMaximizeButton(){document.getElementById("zoombutton").style.display="none"}function HideHelpButton(){document.getElementById("helpbutton").style.display="none"}function ShowHelpButton(){document.getElementById("helpbutton").style.display="block"}function ShowPlayButton(){document.getElementById("playbuttonicon").style.display="block"}function HidePlayButton(){document.getElementById("playbuttonicon").style.display="none"}function ShowPDFButton(){document.getElementById("pdfbuttonicon").style.display="block"}function HidePDFButton(){document.getElementById("pdfbuttonicon").style.display="none"}function DoMaximize(){document.getElementById("noscroller").style.display="none",document.getElementById("notation-spacer").style.display="none",gTheNotation.style.display="flex",gTheNotation.style.float="none",document.getElementById("zoombutton").src="img/zoomin.png",gIsMaximized=!0,gPlayABCGotMaximizedPlay=!1,HandleWindowResize(),isDesktopBrowser()?(gGotRenderDivClick=!1,gRenderDivClickOffset=-1,gNotationLeftMarginBeforeMaximize=gTheNotation.style.marginLeft,gTheNotation.style.marginLeft="auto"):(ShowPDFButton(),ShowPlayButton())}function DoMinimize(){if(document.getElementById("noscroller").style.display="block",document.getElementById("notation-spacer").style.display="block",document.getElementById("zoombutton").src="img/zoomout.png",isDesktopBrowser()||(HidePlayButton(),HidePDFButton()),isDesktopBrowser()&&(gTheNotation.style.display="inline",gTheNotation.style.float="left",gTheNotation.style.marginLeft=gNotationLeftMarginBeforeMaximize),gIsMaximized=!1,gPlayABCGotMaximizedPlay=!1,HandleWindowResize(),isDesktopBrowser()){if(gForceInitialTextBoxRecalc){gInitialTextBoxWidth=gTheABC.offsetWidth;var e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,gInitialTextBoxContainerLeft=(e=document.getElementById("noscroller")).offsetLeft,ResizeTextBox(),gForceInitialTextBoxRecalc=!1}if(gGotWindowResizeWhileMaximized){gTheABC.style.width=gInitialTextBoxWidth+"px",gTheABC.style.marginLeft="0px";var e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,gInitialTextBoxContainerLeft=(e=document.getElementById("noscroller")).offsetLeft,gTheNotation.style.marginLeft="auto",gGotWindowResizeWhileMaximized=!1}if(gGotRenderDivClick){if(-1!=gRenderDivClickOffset){if(gTheABC.selectionEnd=gTheABC.selectionStart=gRenderDivClickOffset,isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}gGotRenderDivClick=!1,gRenderDivClickOffset=-1}}}function ToggleMaximize(){if(gIsMaximized)DoMinimize(),isDesktopBrowser()?gTheNotation.style.width="850px":gTheNotation.style.width="820px";else if(DoMaximize(),isDesktopBrowser()){var e=window.innerWidth;e*gFullScreenScaling/100>850&&(gTheNotation.style.width=gFullScreenScaling+"%")}else{var e=window.innerWidth;e*gFullScreenScaling/100>820&&(gTheNotation.style.width=gFullScreenScaling+"%")}}function IdleAllowShowTabNames(){var e=GetRadioValue("notenodertab"),t=!1;switch(e){case"noten":case"notenames":case"whistle":break;case"mandolin":case"gdad":case"cgdae":case"guitare":case"guitard":case"uke":t=!0}gAllowShowTabNames=!!t}function utf8tob64(e){var t;try{t=btoa(escape(e))}catch(n){t=""}return t}function b64toutf8(e){var t;try{t=unescape(atob(e))}catch(n){t=""}return t}function isLandscapeOrientation(){if(window.matchMedia("(orientation: portrait)").matches);else if(window.matchMedia("(orientation: landscape)").matches)return!0;return!1}function processShareLink(){var e=!1;gDisableEditFromPlayLink=!1;let t=new URLSearchParams(window.location.search);if(t.has("lzw")){var n=t.get("lzw");abcInLZW=LZString.decompressFromEncodedURIComponent(n);let o=abcInLZW;o.length>0?(SetAbcText(o),RestoreDefaults(),e=!0,gIsDirty=!0):n.length>2e3?ShowAcrobatHyperlinkLengthWarning():ShowHyperlinkBadDecodeAlert()}if(t.has("format")){var a=t.get("format");("bc"==a||"cd"==a||"bass"==a||"mandola"==a)&&(a="noten"),SetRadioValue("notenodertab",a),"whistle"==a&&PrepareWhistleFont(),gCurrentTab=a}if(t.has("capo")&&(gCapo=parseInt(t.get("capo"))),gStaffSpacing=t.has("ssp")?STAFFSPACEOFFSET+parseInt(t.get("ssp")):STAFFSPACEOFFSET+STAFFSPACEDEFAULT,t.has("stn")&&(gShowTabNames="true"==t.get("stn")),t.has("pdf")){var r=t.get("pdf");document.getElementById("pdfformat").value=r}else document.getElementById("pdfformat").value="one";if(t.has("pn")){var l=t.get("pn");document.getElementById("pagenumbers").value=l}else document.getElementById("pagenumbers").value="none";if(t.has("fp")){var s=t.get("fp");document.getElementById("firstpage").value=s}else document.getElementById("firstpage").value="yes";var g=!1;t.has("dx")&&"1"==t.get("dx")&&(g=!0),g&&(gDisableEditFromPlayLink=!0),gPlayABCTuneIndex=0;var c=!1;t.has("play")&&"1"==t.get("play")&&(c=!0);var d=!1;if(c&&t.has("index")&&(gPlayABCTuneIndex=tuneIndex=parseInt(t.get("index")),d=!0),e){var u="";if(t.has("name"))u=t.get("name");else{var p=CountTunes();u=getDescriptiveFileName(p,!1)}if(gABCFromFile=!0,gDisplayedName=u,document.getElementById("notenrechts").style.display="none",UpdateNotationTopPosition(),gShowAllControls=!1,FocusABC(),RenderAsync(!0,null,function(){if(c){if(isMobileBrowser()&&isLandscapeOrientation()){var e="The ABC Transcription Tools tune Player is best used in Portrait mode.<br/>Please rotate your device and click the play button to play the tune.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("show_player","from_share"),gPlayABCTuneCount=CountTunes(),gPlayABCGotMaximizedPlay=!0;var t=gTheABC.value;d&&(t=getTuneByIndex(gPlayABCTuneIndex));var n=PreProcessPlayABC(t);PlayABCDialog(n,null,null,null,!1)}}),isDesktopBrowser()){var m=window.innerWidth;m*gFullScreenScaling/100>850&&(gTheNotation.style.width=gFullScreenScaling+"%")}else{var m=window.innerWidth;m*gFullScreenScaling/100>820&&(gTheNotation.style.width=gFullScreenScaling+"%")}return!0}return!1}function TextBoxResizeHandler(){UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0)}function findSelectedTuneIndex(){var e=gTheABC.value,t=e.split(/^X:/gm),n=CountTunes();if(n<2)return 0;var o=gTheABC.selectionStart;if(0==o&&(o=e.indexOf("X:")+2),0==o)return -1;var a=0;a=t[0].length;for(var r=1;r<=n;++r)if(o<(a+=t[r].length+2))return r-1;return -1}function MakeTuneVisible(e){if(gAllowCopy){var t=findSelectedTuneIndex();if(gCurrentTune=t,!(!e&&isMobileBrowser())&&!gDisableNotationRendering&&-1!=t){var n=document.getElementById("notation"+t),o=n.offsetTop,a=n.offsetHeight,r=document.getElementById("notation-spacer").offsetHeight;gIsOneColumn?o+=r:r=0;var l=window.innerHeight,s=window.scrollY,g=l-r,c=o-s-r,d=c+a;if(t!=gLastAutoScrolledTune||e){var u=o-r;window.scrollTo(0,u),gLastAutoScrolledTune=t}else if(!(c>=0&&c<g||d>0&&d<g||c<0&&c+a>g)){var u=o-r;window.scrollTo(0,u),gLastAutoScrolledTune=t}}}}function debounce(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout(function(){e.apply(this,o)},t)}}function OnABCTextChange(){var e=gTotalTunes,t=CountTunes();e!=t?RenderAsync(!0,null):gRawMode?(Render(!0,null),fireSelectionChanged()):Render(!1,gCurrentTune)}function PrepareWhistleFont(){if(!gWhistleFontPrepared){var e=document.querySelectorAll('div[id="fontholder"] > svg > style');e[0].innerHTML+="@font-face { font-family: 'TinWhistleFingering'; src: url(data:font/truetype;charset=utf-8;base64,AAEAAAAOAIAAAwBgRkZUTXBCeEYAACXQAAAAHEdERUYASAAGAAAlsAAAACBPUy8yYmFjVAAAAWgAAABWY21hcGbEMvAAAAIAAAABkmN2dCAARAURAAADlAAAAARnYXNw//8AAwAAJagAAAAIZ2x5ZjcPuw8AAAPQAAAfFGhlYWQFzCAtAAAA7AAAADZoaGVhCdYA8gAAASQAAAAkaG10eAuFBggAAAHAAAAAPmxvY2FW+F8kAAADmAAAADhtYXhwAHIA1QAAAUgAAAAgbmFtZccVWP0AACLkAAACGXBvc3RkEEUZAAAlAAAAAKgAAQAAAAEAAC+9UnlfDzz1AAsIAAAAAADSAmq7AAAAANICarsARP8CAmQGuAAAAAgAAgAAAAAAAAABAAAGuP8CALgB6wAAAAACZAABAAAAAAAAAAAAAAAAAAAABAABAAAAGwCkABUAAAAAAAIAAAABAAEAAABAAC4AAAAAAAEB6wH0AAUACAUzBZkAAAEeBTMFmQAAA9cAZgISAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAQABBAG0Gzf7NALgGuAD+AAAAAQAAAAAAAAHrAEQAAAAAAesAAAHrAHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AHsAewB7AAAAAAADAAAAAwAAABwAAQAAAAAAjAADAAEAAAAcAAQAcAAAAAwACAACAAQAAABHAE0AZwBt//8AAAAAAEEASQBhAGn//wAAAAAAAAAAAAAAAQAAAAoAFgAeACoAAAAWABgAGQAPABEAEgAUABcAGgAQABMAFQAKAAwADQADAAUABgAIAAsADgAEAAcACQAAAQYAAAEAAAAAAAAAAQIAAAACAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhgZDxESFAAXGhATFQAAAAAAAAAAAAAAAAAAAAAAAAAKDA0DBQYIAAsOBAcJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEBREAAAAsACwALACSAQQBfAIAAooDJgPOBHwFNgX2BqQHdgf+CH4JBgmYCjIK3guUDFINGg3qDqgPigACAEQAAAJkBVUAAwAHAC6xAQAvPLIHBADtMrEGBdw8sgMCAO0yALEDAC88sgUEAO0ysgcGAfw8sgECAO0yMxEhESUhESFEAiD+JAGY/mgFVfqrRATNAAAABwB7/1QBcQa4AAAADAAYACQAMAA8AEgAABcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSwFXNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAACQB7/1QBcQa4AAAADAATABQAIAAsADgARABQAAAXETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEcdPCIlOdlLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiASc0R0swNEdLAVc0R0swNEdLAVc0RkowNEdLAVc0RkowNEdLAVY0R0swNEZKAAAACQB7/1QBcQa4AAAADAAYABkAJQAxAD0ASQBVAAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAACwB7/1QBcQa4AAAADAAYABkAJQAsAC0AOQBFAFEAXQAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1IxE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU52UswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiASc0R0swNEdLAVc0RkowNEdLAVc0RkowNEdLAVY0R0swNEZKAAAACwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAFYAYgAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme0swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAADQB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAG8AABcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAADwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBeAF8AawB3AAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7SzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOdlLMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iASc0RkowNEdLAVY0R0swNEZKAAAADwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB8AAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJhE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSwFWNEdLMDRGSgAAEQB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB3AHgAhAAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1IxE0NjMyFhUUBiMiJntLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU52UswNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iASY0R0swNEZKAAAAEQB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB8AH0AiQAAFxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyIme0swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEmNEdLMDRGSgAADwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAG8AewB8AAAXETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGB3tLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEcdPCIlOTwiJTkdrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSjAlOTwiJTo9IgAAEwB7/1QBcQa4AAAADAAYABkAJQAxADIAPgBKAEsAVwBjAGQAcAB8AH0AiQCVAJYAABcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgd7SzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdrAEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEmNEdLMDRGSjAlOTwiJTo9IgAACwB7/wIBcQa4AAAADAANABkAJQAxAD0ASQBVAGEAYgAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHe5k9UlI9UutLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEcdPCIlOTwiJTkdrFJSPVJSPQEnNEdLMDRHSwFXNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSjAlOTwiJTo9IgAAAAALAHv/AgFxBrgAAAAMAA0AGQAgACEALQA5AEUAUQBdAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjUjETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme5k9UlI9UutLMDRHSzA0Rx08IiU52UswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIBJzRHSzA0R0sBVzRHSzA0R0sBVzRGSjA0R0sBVzRGSjA0R0sBVjRHSzA0RkoACwB7/wIBcQa4AAAADAANABkAJQAmADIAPgBKAFYAYgAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme5k9UlI9UutLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrFJSPVJSPQEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAAAAANAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA5ADoARgBSAF4AagAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTnZSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIBJzRHSzA0R0sBVzRGSjA0R0sBVzRGSjA0R0sBVjRHSzA0RkoADQB7/wIBcQa4AAAADAANABkAJQAmADIAPgA/AEsAVwBjAG8AABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHrFJSPVJSPQEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSwFXNEZKMDRHSwFXNEZKMDRHSwFWNEdLMDRGSgAAAAAPAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA+AD8ASwBXAFgAZABwAHwAABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyIme5k9UlI9UutLMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0Rx08IiU5PCIlOR1LMDRHSzA0R0swNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU6PSIlOTwiASc0RkowNEdLAVc0RkowNEdLAVY0R0swNEZKAAAAABEAe/8CAXEGuAAAAAwADQAZACUAJgAyAD4APwBLAFcAWABkAGsAbAB4AIQAABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NSMRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTnZSzA0R0swNEdLMDRHSzA0R6xSUj1SUj0BJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTo9IiU5PCIBJzRGSjA0R0swJTo9IgEnNEZKMDRHSwFWNEdLMDRGSgARAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA+AD8ASwBXAFgAZABwAHEAfQCJAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiYRNDYzMhYVFAYjIiZ7mT1SUj1S60swNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHHTwiJTk8IiU5HUswNEdLMDRHSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU6PSIlOTwiASc0RkowNEdLMCU6PSIlOTwiASc0RkowNEdLAVY0R0swNEZKAAAAABMAe/8CAXEGuAAAAAwADQAZACUAJgAyAD4APwBLAFcAWABkAHAAcQB9AIQAhQCRAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1IxE0NjMyFhUUBiMiJnuZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOdlLMDRHSzA0R6xSUj1SUj0BJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTo9IiU5PCIBJzRGSjA0R0swJTo9IiU5PCIBJzRGSjA0R0swJTo9IgEmNEdLMDRGSgATAHv/AgFxBrgAAAAMAA0AGQAlACYAMgA+AD8ASwBXAFgAZABwAHEAfQCJAIoAlgAAFzMVIzUjNTM1MxUzFSMRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJnuZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEesUlI9UlI9ASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU5PCIlOTwiASc0R0swNEdLMCU6PSIlOTwiASc0RkowNEdLMCU6PSIlOTwiASc0RkowNEdLMCU6PSIlOTwiASY0R0swNEZKAAAAABEAe/8CAXEGuAAAAAwADQAZACUAJgAyAD4APwBLAFcAWABkAHAAfACIAIkAABczFSM1IzUzNTMVMxUjETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGB3uZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEdLMDRHSzA0R0swNEdLMDRHHTwiJTk8IiU5HaxSUj1SUj0BJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTk8IiU5PCIBJzRHSzA0R0swJTo9IiU5PCIBJzRGSjA0R0sBVzRGSjA0R0sBVjRHSzA0RkowJTk8IiU6PSIAAAAAFQB7/wIBcQa4AAAADAANABkAJQAmADIAPgA/AEsAVwBYAGQAcABxAH0AiQCKAJYAogCjAAAXMxUjNSM1MzUzFTMVIxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGBxE0NjMyFhUUBiMiJjcUFjMyNjU0JiMiBgcRNDYzMhYVFAYjIiY3FBYzMjY1NCYjIgYHETQ2MzIWFRQGIyImNxQWMzI2NTQmIyIGB3uZPVJSPVLrSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdSzA0R0swNEcdPCIlOTwiJTkdrFJSPVJSPQEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOTwiJTk8IgEnNEdLMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEnNEZKMDRHSzAlOj0iJTk8IgEmNEdLMDRGSjAlOTwiJTo9IgAAAAAAAAwAlgABAAAAAAABABUALAABAAAAAAACAAYAUAABAAAAAAADAC8AtwABAAAAAAAEABMBDwABAAAAAAAFAAsBOwABAAAAAAAGABMBbwADAAEECQABACoAAAADAAEECQACAAwAQgADAAEECQADAF4AVwADAAEECQAEACYA5wADAAEECQAFABYBIwADAAEECQAGACYBRwBUAGkAbgAgAFcAaABpAHMAdABsAGUAIABGAGkAbgBnAGUAcgBpAG4AZwAAVGluIFdoaXN0bGUgRmluZ2VyaW5nAABNAGUAZABpAHUAbQAATWVkaXVtAABGAG8AbgB0AEYAbwByAGcAZQAgADIALgAwACAAOgAgAFQAaQBuAFcAaABpAHMAdABsAGUARgBpAG4AZwBlAHIAaQBuAGcAIAA6ACAAMgA1AC0AOAAtADIAMAAxADUAAEZvbnRGb3JnZSAyLjAgOiBUaW5XaGlzdGxlRmluZ2VyaW5nIDogMjUtOC0yMDE1AABUAGkAbgBXAGgAaQBzAHQAbABlAEYAaQBuAGcAZQByAGkAbgBnAABUaW5XaGlzdGxlRmluZ2VyaW5nAABWAGUAcgBzAGkAbwBuACAAMQAuADAAAFZlcnNpb24gMS4wAABUAGkAbgBXAGgAaQBzAHQAbABlAEYAaQBuAGcAZQByAGkAbgBnAABUaW5XaGlzdGxlRmluZ2VyaW5nAAAAAAACAAAAAAAA/2cAZgAAAAEAAAAAAAAAAAAAAAAAAAAAABsAAAABAAIARwECAEgASQEDAEoBBABEAQUARQBGAQYAJwEHACgAKQEIACoBCQAkAQoAJQAmAQsHZC1zaGFycAdmLXNoYXJwB2ctc2hhcnAHYS1zaGFycAdjLXNoYXJwB0Qtc2hhcnAHRi1zaGFycAdHLXNoYXJwB0Etc2hhcnAHQy1zaGFycAAAAAH//wACAAEAAAAOAAAAGAAAAAAAAgABAAMAGgABAAQAAAACAAAAAAABAAAAAMw9os8AAAAA0gJquwAAAADSAmq7) format('truetype'); font-weight: normal; font-style: normal; }",gWhistleFontPrepared=!0}}function InjectPDFHeaders(){if(!gRenderingPDF){var e=gTheABC.value,t="";t+="%\n",t+="% Here are all the available PDF tunebook annotations:\n",t+="%\n",t+="%pdfquality .75\n",t+="%pdf_between_tune_space 20\n",t+="%pdfname your_pdf_filename\n",t+="%pdffont fontname style\n",t+="%addtitle Title Page Title\n",t+="%addsubtitle Title Page Subtitle\n",t+="%urladdtitle https://michaeleskin.com Title Page Title as Hyperlink\n",t+="%urladdsubtitle https://michaeleskin.com Title Page Subtitle as Hyperlink\n",t+="%addtoc Table of Contents\n",t+="%addsortedtoc Table of Contents Sorted by Tune Name\n",t+="%addlinkbacktotoc\n",t+="%tocheader Page Header Text for Table of Contents Pages\n",t+="%toctopoffset 30\n",t+="%toctitleoffset 35\n",t+="%toctitlefontsize 18\n",t+="%tocfontsize 13\n",t+="%toclinespacing 12\n",t+="%addindex Unsorted Index\n",t+="%addsortedindex Index Sorted by Tune Name\n",t+="%addlinkbacktoindex\n",t+="%indexheader Page Header Text for Index Pages\n",t+="%indextopoffset 30\n",t+="%indextitleoffset 35\n",t+="%indextitlefontsize 18\n",t+="%indexfontsize 13\n",t+="%indexlinespacing 12\n",t+="%no_toc_or_index_links\n",t+="%toc_no_page_numbers\n",t+="%index_no_page_numbers\n",t+="%pageheader Page Header\n",t+="%pagefooter Page Footer\n",t+="%urlpageheader https://michaeleskin.com Page Header as Hyperlink\n",t+="%urlpagefooter https://michaeleskin.com Page Footer as Hyperlink\n",t+="%add_all_links_to_thesession\n",t+="%add_all_playback_links 0 0 0 fluid\n",t+="%playback_links_are_complete_tunebook\n",t+="%swing_all_hornpipes 0.25\n",t+="%noswing_all_hornpipes\n",t+="%no_edit_allowed\n",t+="%qrcode\n",t+="%qrcode https://michaeleskin.com\n",t+="%caption_for_qrcode Caption for the QR code\n",t+="%\n",t+="% These directives can be added to each tune:\n",t+="%hyperlink https://michaeleskin.com\n",t+="%add_link_to_thesession\n",t+="%add_playback_link 0 0 0 fluid\n",t+="%swing 0.25 0\n",t+="%noswing\n",t+="%grace_duration_ms 30\n",t+="%roll_2_params 0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0\n",t+="%roll_3_params 1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0\n",t+="%use_original_abcjs_roll_solution\n",t+="%abcjs_release_decay_time 200\n",t+="\n",t+=e,gTheABC.value=t,gIsDirty=!0,gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation()}):(gTheABC.selectionStart=0,gTheABC.selectionEnd=0,FocusAfterOperation())}}function DoCeoltasTransform(e){e?sendGoogleAnalytics("tablature","DoCeoltasTransform_Inverse"):sendGoogleAnalytics("tablature","DoCeoltasTransform"),gTheABC.value=ceoltasABCTransformer(gTheABC.value,e,!1),gIsDirty=!0,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoCeoltasTransformDialog(){var e='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Ceoltas ABC Transform&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_comhaltas" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>';e+='<p style="text-align:center;"><input id="ceoltasdialog" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransform(false)" type="button" value="Standard ABC to Comhaltas ABC" title="Transforms the standard ABC format to Comhaltas format">',e+='<input id="ceoltasdialoginverse" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransform(true)" type="button" value="Comhaltas ABC to Standard ABC" title="Transforms the Comhaltas format to standard ABC format"></p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function TuneTitlesNumbersDialog(){var e='<p style="text-align:center;margin-bottom:36px;font-size:16pt;font-family:helvetica;margin-left:15px;">Add/Remove Tune Title Numbers&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_injecttunetitlenumbers" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>';e+='<p style="text-align:center;"><input id="addtunetitlenumbers" class="advancedcontrols btn btn-injectcontrols-headers" onclick="AddTuneTitleNumbers()" type="button" value="Add Numbers to Tune Titles" title="Adds incrementing numbers to the tune titles">',e+='<input id="removetunetitlenumbers" class="advancedcontrols btn btn-injectcontrols" onclick="RemoveTuneTitleNumbers(true)" type="button" value="Remove Tune Title Numbers" title="Removes any tune title numbers that were added"></p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,width:650,scrollWithPage:AllowDialogsToScroll()})}function cleanTitleNumber(e){return e.replace(/^[0-9.]+/,"")}function AddTuneTitleNumbers(){var e,t=CountTunes();if(0==t){var n="No tunes to add tune title numbers.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("action","AddTuneTitleNumbers");var o=RemoveTuneTitleNumbers(!1);gTheABC.value=o;var a=FindPreTuneHeader(o);""!=a&&(a+="\n");var r=0;for(e=0;e<t;++e){var l=getTuneByIndex(e);if(isSectionHeader(l)){a+="\n",a+=l,a+="\n";continue}r++;let s=l.split("\n");var g=!1,c="";for(let d=0;d<s.length;d++){let u=s[d];!g&&(u.startsWith("T: ")&&(u="T: "+r+". "+(u=(u=u.replace("T:","")).trim()),g=!0),!g&&u.startsWith("T:")&&(u="T:"+r+". "+(u=(u=u.replace("T:","")).trim()),g=!0)),c+=u,c+="\n"}a+=c}a=a.replaceAll("\n\n","\n"),gTheABC.value=a,gIsDirty=!0;var p=document.getElementById("addtunetitlenumbers");p&&(p.value="Adding Tune Title Numbers"),RenderAsync(!0,null,function(){var e=document.getElementById("addtunetitlenumbers");e&&(e.value="Tune Title Numbers Added",setTimeout(function(){var e=document.getElementById("addtunetitlenumbers");e&&(e.value="Add Numbers to Tune Titles")},750))})}function RemoveTuneTitleNumbers(e){var t,n=gTheABC.value,o=CountTunes();if(e){if(0==o){var a="No tunes with title numbers to remove.";a=makeCenteredPromptString(a),DayPilot.Modal.alert(a,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}sendGoogleAnalytics("action","RemoveTuneTitleNumbers")}var r=FindPreTuneHeader(n);""!=r&&(r+="\n");var l=!1;for(t=0;t<o;++t){var s=getTuneByIndex(t);if(isSectionHeader(s)){r+="\n",r+=s,r+="\n";continue}let g=s.split("\n");var c=!1,d="";for(let u=0;u<g.length;u++){let p=g[u];if(!c){if(p.startsWith("T: ")){var m=p;p="T: "+(p=(p=cleanTitleNumber(p=(p=p.replace("T:","")).trim())).trim()),c=!0,m!=p&&(l=!0)}if(!c&&p.startsWith("T:")){var m=p;p="T:"+(p=(p=cleanTitleNumber(p=(p=p.replace("T:","")).trim())).trim()),c=!0,m!=p&&(l=!0)}}d+=p,d+="\n"}r+=d}if(r=r.replaceAll("\n\n","\n"),!e)return r;if(l){gTheABC.value=r,gIsDirty=!0;var h=document.getElementById("removetunetitlenumbers");h&&(h.value="Removing Tune Title Numbers"),RenderAsync(!0,null,function(){var e=document.getElementById("removetunetitlenumbers");e&&(e.value="Tune Title Numbers Removed",setTimeout(function(){var e=document.getElementById("removetunetitlenumbers");e&&(e.value="Remove Added Tune Title Numbers")},750))})}}function DoInjectTablature_BC(){sendGoogleAnalytics("tablature","Inject_BC"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="0",gTheABC.value=boxTabGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_CsD(){sendGoogleAnalytics("tablature","Inject_CsD"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gInjectTab_BoxStyle="1",gTheABC.value=boxTabGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function DoInjectTablature_Anglo(){sendGoogleAnalytics("tablature","Inject_Anglo"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",angloFingeringsGenerator(gTheABC.value,function e(t,n,o){n?DayPilot.Modal.alert(o,{theme:"modal_flat",top:100,scrollWithPage:!0}).then(function(){gTheABC.value=t,gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}):(gTheABC.value=t,gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames())})}function DoInjectTablature_Bamboo_Flute(){sendGoogleAnalytics("tablature","Inject_Bamboo_Flute");let e={configure_bamboo_flute_key:gBambooFluteKey};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Bamboo Flute Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://en.m.wikipedia.org/wiki/Numbered_musical_notation" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject numeric notation tablature for a bamboo flute in the key selected below into all of the tunes in the ABC text area:</p>'},{name:"Bamboo flute key:",id:"configure_bamboo_flute_key",type:"select",options:[{name:"  C",id:"0"},{name:"  D",id:"1"},{name:"  G",id:"2"},{name:"  A",id:"3"},],cssClass:"configure_box_settings_select"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'},],e,{theme:"modal_flat",top:200,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gBambooFluteKey=e.result.configure_bamboo_flute_key,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=bambooFluteTabGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames())})}function DoInjectTablature_Fiddle_Fingerings(){sendGoogleAnalytics("tablature","Inject_Fiddle_Fingerings"),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=fiddleFingeringsGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null),IdleAdvancedControls(!0),IdleAllowShowTabNames()}function ShowMDTabWarningDialog(){sendGoogleAnalytics("dialog","ShowMDTabWarningDialog");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Some Tunes Did Not Have Complete Tab Solutions</p>';e+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;">During the tablature generation the following tunes did not have complete tablature solutions and as requested were excluded from the result:</p>';var t=gExcludedFromMDSolution.length;e+='<p style="font-size:12pt;line-height:18pt;">';for(var n=0;n<t-1;++n)e+=gExcludedFromMDSolution[n]+", ";e+=gExcludedFromMDSolution[t-1],e+="</p>",DayPilot.Modal.alert(e,{theme:"modal_flat",top:75,width:630,scrollWithPage:AllowDialogsToScroll()}).then(function(){gExcludedFromMDSolution=[]})}var gExcludedFromMDSolution=[];function DoInjectTablature_MD(){sendGoogleAnalytics("tablature","Inject_MD");let e={configure_dulcimer_style:gMDulcimerStyle,open_string_symbol:gMDulcimerUseDashForOpenString,strip_bad_tunes:gMDulcimerStripBadTunes};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Mountain Dulcimer Tablature&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#tab_dulcimer" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject tablature for a DAD, DGD, or DAA-tuned Mountain Dulcimer in the style selected below into all of the tunes in the ABC text area:</p>'},{name:"Style:",id:"configure_dulcimer_style",type:"select",options:[{name:"  DAD - Along High-D String",id:"0"},{name:"  DAD - Cross-String",id:"1"},{name:"  DGD - Along High-D String",id:"2"},{name:"  DGD - Cross-String",id:"3"},{name:"  DAA - Along A String",id:"4"},{name:"  Blank Tablature",id:"5"},],cssClass:"configure_md_settings_select"},{name:"          Use - for open strings (default is leave blank using a space)",id:"open_string_symbol",type:"checkbox",cssClass:"configure_md_settings_form_text"},{name:"          Strip tunes from the result that have no complete tablature solution",id:"strip_bad_tunes",type:"checkbox",cssClass:"configure_md_settings_form_text"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'},],e,{theme:"modal_flat",top:200,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gMDulcimerStyle=e.result.configure_dulcimer_style,gMDulcimerUseDashForOpenString=e.result.open_string_symbol,gMDulcimerStripBadTunes=e.result.strip_bad_tunes,SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gExcludedFromMDSolution=[],gTheABC.value=MDTablatureGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null,function(){gExcludedFromMDSolution.length>0&&ShowMDTabWarningDialog(),IdleAdvancedControls(!0),IdleAllowShowTabNames()}))})}var gShapeNoteStyle=0;function DoInjectTablature_ShapeNotes(){let e={shape_note_style:gShapeNoteStyle};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Inject Shape Note/Solf\xe8ge&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_shapenoteshapes" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:24px;font-size:12pt;line-height:18pt;font-family:helvetica">This will inject Shape Note shapes and/or Solf\xe8ge note names into all the tunes in the ABC text area.</p>'},{name:"Shape Note/Solf\xe8ge style:",id:"shape_note_style",type:"select",options:[{name:"  4-Shape",id:"0"},{name:"  4-Shape - Include fa/sol/la note names below",id:"1"},{name:"  4-Shape - No shapes, only fa/sol/la note names below",id:"2"},{name:"  7-Shape",id:"3"},{name:"  7-Shape - Include do/re/mi note names below",id:"4"},{name:"  7-Shape - No shapes, only do/re/mi note names below",id:"5"},{name:"  Pitch Names",id:"6"},{name:"  Fixed (Do=C) Solf\xe8ge - No chromatics",id:"7"},{name:"  Fixed (Do=C) Solf\xe8ge - Include chromatics",id:"8"},{name:"  Movable Solf\xe8ge Do-based Minor",id:"9"},{name:"  Movable Solf\xe8ge La-based Minor",id:"10"},],cssClass:"configure_sn_settings_select"},{html:'<p style="margin-top:24px;font-size:12pt;line-height:18pt;font-family:helvetica">&nbsp;</p>'},],e,{theme:"modal_flat",top:200,width:680,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gShapeNoteStyle=parseInt(e.result.shape_note_style),sendGoogleAnalytics("tablature","Inject_ShapeNotes_"+gShapeNoteStyle),SaveConfigurationSettings(),SetRadioValue("notenodertab","noten"),gCurrentTab="noten",gTheABC.value=shapeNoteGenerator(gTheABC.value),gIsDirty=!0,gStripTab=!1,RenderAsync(!0,null,function(){IdleAdvancedControls(!0),IdleAllowShowTabNames()}))})}function ChangeTab(){var e=GetRadioValue("notenodertab");"whistle"==e&&PrepareWhistleFont(),e!=gCurrentTab&&(gForceTabSave=!0,sendGoogleAnalytics("ChangeTab",e),RenderAsync(!0,null)),gCurrentTab=e}function FocusAfterOperation(){isDesktopBrowser()?gTheABC.focus():gTheABC.blur()}function FocusABC(){gTheABC.focus(),gTheABC.selectionStart=0,gTheABC.selectionEnd=0,gTheABC.scrollTo(0,0)}function fadeOutAndHide(e,t){var n=setInterval(function(){e.style.opacity||(e.style.opacity=1),e.style.opacity>0?e.style.opacity-=.1:(clearInterval(n),e.style.display="none",t())},100)}function PreProcessSVGImageForDownload(){for(var e=document.querySelectorAll("#playback-paper svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#playback-paper svg .abcjs-cursor");n&&(n.style.display="none")}function PostProcessSVGImageAfterDownload(){var e=document.querySelector("#playback-paper svg .abcjs-cursor");e&&(e.style.display="inline")}function dataURLtoBlob(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],o=atob(t[1]),a=o.length,r=new Uint8Array(a);a--;)r[a]=o.charCodeAt(a);return new Blob([r],{type:n})}var gInDownloadSVG=!1;function DownloadSVG(e,t){if(gInDownloadSVG)return!1;e||sendGoogleAnalytics("export","DownloadSVG");var n=document.getElementById("export_width").value;n=parseInt(n),isNaN(n)&&(n=2400),!e&&(gExportWidth=n,gLocalStorageAvailable&&(localStorage.ExportWidth=n)),gInDownloadSVG=!0,PreProcessSVGImageForDownload();var o=document.querySelector("#playback-paper svg");if(!o){if(gInDownloadSVG=!1,!e)return;e(t)}var a=o.getBoundingClientRect();o=o.cloneNode(!0);var r=a.width,l=a.height,s=n,g=n*l/r;o.setAttribute("width",s+"px"),o.setAttribute("height",g+"px"),o.setAttribute("xmlns","http://www.w3.org/2000/svg");var c=o.outerHTML,d=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',c],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(d),p=document.createElement("a");p.href=u,p.download=GetTuneAudioDownloadName(gPlayerABC,".svg"),document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(u),document.body.removeChild(p),PostProcessSVGImageAfterDownload(),gInDownloadSVG=!1,o=null,e?e(t):(document.getElementById("abcplayer_svgbutton").value="SVG File Saved!",setTimeout(function(){document.getElementById("abcplayer_svgbutton").value="Save as SVG File"},750))}var gInDownloadJPEG=!1;function DownloadJPEG(e,t){if(gInDownloadJPEG)return!1;e||sendGoogleAnalytics("export","DownloadJPEG");var n=document.getElementById("export_width").value;n=parseInt(n),isNaN(n)&&(n=2400),!e&&(gExportWidth=n,gLocalStorageAvailable&&(localStorage.ExportWidth=n)),gInDownloadJPEG=!0,PreProcessSVGImageForDownload();var o=document.querySelector("#playback-paper svg");if(!o){if(gInDownloadJPEG=!1,!e)return;e(t)}var a=document.createElement("canvas"),r=o.getBoundingClientRect();o=o.cloneNode(!0);var l=r.width,s=r.height,g=n,c=n*s/l;a.width=g,a.height=c,a.style.width=g,a.style.height=c,o.setAttribute("width",g+"px"),o.setAttribute("height",c+"px");var d=a.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,a.width,a.height);var u=document.createElement("img"),p=new XMLSerializer().serializeToString(o);u.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(p)))),u.onload=function(){d.drawImage(u,0,0);var n=a.toDataURL("image/jpeg",.75);if(isDesktopBrowser()){var r=document.createElement("a");r.download=GetTuneAudioDownloadName(gPlayerABC,".jpg"),r.href=n,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}else{var l=dataURLtoBlob(n),s=URL.createObjectURL(l),r=document.createElement("a");r.href=s,r.download=GetTuneAudioDownloadName(gPlayerABC,".jpg"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)}PostProcessSVGImageAfterDownload(),gInDownloadJPEG=!1,o=null,e?e(t):(document.getElementById("abcplayer_jpgbutton").value="JPG File Saved!",setTimeout(function(){document.getElementById("abcplayer_jpgbutton").value="Save as JPG File"},750))}}var gInDownloadPNG=!1;function DownloadPNG(e,t){if(gInDownloadPNG)return!1;e||sendGoogleAnalytics("export","DownloadPNG");var n=document.getElementById("export_width").value;n=parseInt(n),isNaN(n)&&(n=2400),!e&&(gExportWidth=n,gLocalStorageAvailable&&(localStorage.ExportWidth=n)),gInDownloadPNG=!0,PreProcessSVGImageForDownload();var o=document.querySelector("#playback-paper svg");if(!o){if(gInDownloadPNG=!1,!e)return;e(t)}var a=document.createElement("canvas"),r=o.getBoundingClientRect();o=o.cloneNode(!0);var l=r.width,s=r.height,g=n,c=n*s/l;a.width=g,a.height=c,a.style.width=g,a.style.height=c,o.setAttribute("width",g+"px"),o.setAttribute("height",c+"px");var d=a.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,a.width,a.height);var u=document.createElement("img"),p=new XMLSerializer().serializeToString(o);u.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(p)))),u.onload=function(){d.drawImage(u,0,0);var n=a.toDataURL("image/png",1);if(isDesktopBrowser()){var r=document.createElement("a");r.download=GetTuneAudioDownloadName(gPlayerABC,".png"),r.href=n,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}else{var l=dataURLtoBlob(n),s=URL.createObjectURL(l),r=document.createElement("a");r.href=s,r.download=GetTuneAudioDownloadName(gPlayerABC,".png"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)}PostProcessSVGImageAfterDownload(),gInDownloadPNG=!1,o=null,e?e(t):(document.getElementById("abcplayer_pngbutton").value="PNG File Saved!",setTimeout(function(){document.getElementById("abcplayer_pngbutton").value="Save as PNG File"},750))}}function ExportAll(){if(isMobileBrowser()){var e="Batch export is not supported on iOS or Android at this time.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:400,scrollWithPage:AllowDialogsToScroll(),okText:"Ok"});return}var t=GetRadioValue("notenodertab"),n="";n="whistle"!=t?'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export All Audio or Images</p>':'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export All Audio</p>',n+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export All Tunes Audio</p>',n+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',n+='<input id="exportall_mp3button" class="exportall_mp3button btn btn-allmp3download" onclick="BatchMP3Export();" type="button" value="Export all as MP3 Audio" title="Saves the audio for all the tunes as .MP3 files">',n+="</p>","whistle"!=t&&(n+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export All Tunes Images</p>',n+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',n+='<input id="exportall_jpegbutton" class="exportall_jpegbutton btn btn-alljpegdownload" onclick="BatchJPEGExport();" type="button" value="Export all as JPEG" title="Saves the images for all the tunes as bitmap JPEG files">',n+='<input id="exportall_pngbutton" class="exportall_pngbutton btn btn-allpngdownload" onclick="BatchPNGExport();" type="button" value="Export all as PNG" title="Saves the images for all the tunes as bitmap PNG files">',n+='<input id="exportall_svgbutton" class="exportall_svgbutton btn btn-allsvgdownload" onclick="BatchSVGExport();" type="button" value="Export all as SVG" title="Saves the images for all the tunes as vector format SVG files">',n+="</p>",n+='<p class="export_all_text">',n+='Image width to export: <input id="export_width" type="number" min="0" step="1" max="4096" title="Image width to export" autocomplete="off"/>',n+="</p>",n+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Developer Share URL Batch Export Tools</p>',n+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',n+='<input id="exportall_jsonbutton" class="exportall_jsonbutton btn btn-alljsondownload" onclick="BatchJSONExport();" type="button" value="Export all Share URLs as JSON" title="Saves the Share URLs for all the tunes as a JSON file">',n+='<input id="exportall_csvbutton" class="exportall_csvbutton btn btn-allcsvdownload" onclick="BatchCSVExport();" type="button" value="Export all Share URLs as CSV" title="Saves the Share URLs for all the tunes as a CSV file">',n+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">SmartDraw Set List Builder</p>',n+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',n+='<input id="export_smartdrawbutton" class="export_smartdrawbutton btn btn-smartdraw" onclick="SmartDrawExport();" type="button" value="SmartDraw Set List Builder" title="Build a SmartDraw set list using drag and drop">',n+="</p>"),n+='<a id="exportall_help" href="https://michaeleskin.com/abctools/userguide.html#export_all" target="_blank" style="text-decoration:none;" title="Learn more about the audio and image exporter">?</a>',DayPilot.Modal.alert(n,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()}),"whistle"!=t&&(document.getElementById("export_width").value=gExportWidthAll)}var gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null,gExportWidth=2400,gExportWidthAll=2400,gBatchExportDelayMS=200;function BatchJPEGExport(){sendGoogleAnalytics("dialog","BatchJPEGExport"),DoBatchImageExport("JPEG")}function BatchPNGExport(){sendGoogleAnalytics("dialog","BatchPNGExport"),DoBatchImageExport("PNG")}function BatchSVGExport(){sendGoogleAnalytics("dialog","BatchSVGExport"),DoBatchImageExport("SVG")}function DoBatchImageExport(e){function t(t){a--,t.click(),gBatchImageExportCancelRequested||(0!=a?setTimeout(function(){var t=getTuneByIndex(++r),a=getTuneTitle(t);gTheBatchImageExportStatusText.innerText="Exporting "+e+" for tune "+(r+1)+" of "+o+": "+a,ExportImageDialog(t,n,r,null,!1)},gBatchExportDelayMS):(gTheBatchImageExportOKButton.click(),gBatchImageExportCancelRequested=!1))}function n(n,o){switch(e){case"JPEG":DownloadJPEG(t,o);break;case"PNG":DownloadPNG(t,o);break;case"SVG":DownloadSVG(t,o)}}gExportWidthAll=parseInt(gExportWidthAll=document.getElementById("export_width").value),isNaN(gExportWidthAll)&&(gExportWidthAll=2400),gLocalStorageAvailable&&(localStorage.ExportWidthAll=gExportWidthAll);var o,a=CountTunes();if(0!=a){o=a;var r=0;gBatchImageExportCancelRequested=!1,gTheBatchImageExportOKButton=null,gTheBatchImageExportStatusText=null;var l="Exporting "+e+" for tune "+(r+1)+" of "+o;l=makeCenteredPromptString(l),DayPilot.Modal.alert(l,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchImageExportCancelRequested=!0});var s=document.getElementsByClassName("modal_flat_main");s[s.length-1].style.zIndex=100001;for(var g=document.getElementsByClassName("modal_flat_ok"),c=null,d=0;d<g.length;++d)if("Cancel"==(c=g[d]).innerText){gTheBatchImageExportOKButton=c;break}var u=document.getElementsByClassName("modal_flat_content");(gTheBatchImageExportStatusText=u[u.length-1]).style.textAlign="center";var p=getTuneByIndex(r),m=getTuneTitle(p);return gTheBatchImageExportStatusText.innerText="Exporting "+e+" for tune "+(r+1)+" of "+o+": "+m,ExportImageDialog(p,n,r,null,!1),!0}}function ExportImageDialog(e,t,n,o,a){gTheOKButton=null,gPlayerABC=e;var r=GetRadioValue("notenodertab"),l=GetABCJSParams(r);l.oneSvgPerLine=!1,!function o(){modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;">',modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",modal_msg+="</p>";var a,r=window.innerWidth,s=GetRadioValue("notenodertab");isDesktopBrowser()?(a=.45*r)<850&&(a=850):a=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:a,okText:"Close",scrollWithPage:isMobileBrowser()});for(var g=document.getElementsByClassName("modal_flat_ok"),c=null,d=0;d<g.length;++d)if("Close"==(c=g[d]).innerText){gTheOKButton=c;break}var u=ABCJS.renderAbc("playback-paper",e,l)[0];postProcessTab([u],"playback-paper",s,!0),t&&setTimeout(function(){t(n,gTheOKButton)},10)}()}function BatchJSONExport(){var e=CountTunes();if(0!=e){sendGoogleAnalytics("dialog","BatchJSONExport");for(var t=[],n=0;n<e;++n){var o=getTuneByIndex(n),a=GetTuneAudioDownloadName(o,""),r=FillUrlBoxWithAbcInLZW(o,!1);r+="&name="+a+"&play=1",t.push({Name:a,URL:r})}saveTextFileDeveloper("Please enter a filename for your batch Share URL JSON file:","All_Share_URLs_JSON.txt",JSON.stringify(t))}}function BatchCSVExport(){var e=CountTunes();if(0!=e){sendGoogleAnalytics("dialog","BatchCSVExport");for(var t="Name,URL\n",n=0;n<e;++n){var o=getTuneByIndex(n),a=GetTuneAudioDownloadName(o,""),r=FillUrlBoxWithAbcInLZW(o,!1);r+="&name="+a+"&play=1",t+=a,t+=",",t+=r,t+="\n"}saveTextFileDeveloper("Please enter a filename for your batch Share URL CSV file:","All_Share_URLs_CSV.txt",t)}}var gMIDIbuffer=null,gPlayerABC=null,gPlayerABCMetronome=null,gTheOKButton=null,gTheMuteHandle=null,gPlayMetronome=!1,gUseWidePlayer=!1;function GetTuneAudioDownloadName(e,t){var n=escape(e),o=n.split("%0D%0A");o=n.split("%0A");for(var a=0;a<o.length;++a){o[a]=unescape(o[a]);var r=o[a].split("");if("T"==r[0]&&":"==r[1]){var l=o[a].slice(2);return(l=(l=(l=l.trim()).replace(/[ ]+/ig,"_")).replace(/[^a-zA-Z0-9_\-.]+/ig,""))+t}}return"output"+t}function isJigWithNoTiming(e,t){var n=escape(e),o=n.split("%0D%0A");o=n.split("%0A");for(var a=!1,r=!1,l=!1,s=!1,g=t,c=0;c<o.length;++c){o[c]=unescape(o[c]);var d=o[c].split("");if("Q"==d[0]&&":"==d[1]&&(a=!0),"M"==d[0]&&":"==d[1]){var u=o[c].replace("M:","");-1!=(u=u.trim()).indexOf("12/8")&&(s=!0,g=2e3),-1!=u.indexOf("6/8")&&(r=!0,g=1e3),-1!=u.indexOf("9/8")&&(l=!0,g=1500)}}return(r||l||s)&&!a?g:t}function DownloadWave(){sendGoogleAnalytics("export","DownloadWave"),gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure);var e=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=e,gMIDIbuffer.prime().then(function(e){var t=gMIDIbuffer.download(),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("style","display: none;"),n.href=t,n.download=GetTuneAudioDownloadName(gPlayerABC,".wav"),n.click(),window.URL.revokeObjectURL(t),document.body.removeChild(n)}).catch(function(e){var t="A problem occured when exporting the .wav file.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})}var gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;function AddDuplicatesForMp3(e,t,n,o){if(1==n&&!o)return e;var a=removeABCTuneHeaders(e=e.trim()),r=(a=a.trim()).split("\n"),l=r.length;if(0==l)return e;var s=0;if(-1!=r[0].indexOf("%")){a=a.replace(r[s]+"\n",""),s=1;for(var g=1;g<l&&-1!=r[g].indexOf("%");++g)a=a.replace(r[s]+"\n",""),s++}var c=r[s],d=e.indexOf(c);if(e=e.substring(0,d),o)switch(t){case"reel":default:e+="V:1\nV:2\n%%MIDI program 128\n^Cz3 ^Cz3|^Cz3 ^Cz3|\nV:1\nz8|z8|\n";break;case"jig":e+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2|^Cz2 ^Cz2|\nV:1\nz6|z6|\n";break;case"slide":e+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2 ^Cz2 ^Cz2|\nV:1\nz12|\n";break;case"slipjig":e+="V:1\nV:2\n%%MIDI program 128\n^Cz2 ^Cz2 ^Cz2|^Cz2 ^Cz2 ^Cz2|\nV:1\nz9|z9|\n";break;case"polka":e+="V:1\nV:2\n%%MIDI program 128\n^Cz ^Cz|^Cz ^Cz|\nV:1\nz4|z4|\n";break;case"waltz":e+="V:1\nV:2\n%%MIDI program 128\n^Cz ^Cz ^Cz|^Cz ^Cz ^Cz|\nV:1\nz6|z6|\n"}e+=a;for(var g=0;g<n-1;++g)e+="\n",e+=a;return e}function getTuneRhythmType(e){var t=escape(e),n=t.split("%0D%0A");n=t.split("%0A");for(var o=!1,a=!1,r=!1,l=!1,s=!1,g=!1,c=!1,d=0;d<n.length;++d){n[d]=unescape(n[d]);var u=n[d].split("");if("M"==u[0]&&":"==u[1]){var p=n[d].replace("M:","");-1!=(p=p.trim()).indexOf("3/8")&&(c=!0),-1!=p.indexOf("6/8")&&(o=!0),-1!=p.indexOf("9/8")&&(a=!0),-1!=p.indexOf("12/8")&&(r=!0),-1!=p.indexOf("2/4")&&(l=!0),-1!=p.indexOf("4/4")&&(s=!0),-1!=p.indexOf("3/4")&&(g=!0),-1!=p.indexOf("C")&&(s=!0)}}return o||r?"jig":a?"slipjig":c?"oddjig":l?"polka":s?"reel":g?"waltz":"reel"}var gBatchMP3ExportDelayMS=250;function BatchMP3Export(){sendGoogleAnalytics("dialog","BatchMP3Export"),DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Export All Tunes as MP3&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_all_tunes_as_mp3" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:36px;margin-bottom:36px;font-size:12pt;line-height:18pt;font-family:helvetica">This will export all the tunes in the ABC area as .MP3 files with one or more repeats.</p>'},{name:"How many times to repeat each tune in the MP3:",id:"configure_repeats",type:"number",cssClass:"configure_repeats_form_text"},{name:"            Inject a two-bar style-appropriate click intro before each tune",id:"configure_inject_click",type:"checkbox",cssClass:"configure_repeats_form_text"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica"><strong>For best results with repeated tunes:</strong></p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">For clean repeats, your tunes must not have extraneous pickup or trailing notes and must have proper and complete timing.</p>'},{html:'<p style="margin-top:16px;font-size:12pt;line-height:18pt;font-family:helvetica">If there is a repeat at the end of the first part of a tune, either standalone or in a first ending, there must be a matching |: bar at the start of the tune for the tune repeats to work properly.</p>'},],{configure_repeats:1,configure_inject_click:!1},{theme:"modal_flat",top:200,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled){var t=e.result.configure_repeats;if(null!=t)repeatCount=parseInt(t),!(isNaN(repeatCount)||void 0==repeatCount||repeatCount<1)&&DoBatchMP3Export(repeatCount,e.result.configure_inject_click)}})}function DoBatchMP3Export(e,t){function n(n){r--,n.click(),gBatchMP3ExportCancelRequested||(0!=r?setTimeout(function(){var n=getTuneByIndex(++l),r=getTuneRhythmType(n);n=AddDuplicatesForMp3(n,r,e,t),n=PreProcessPlayABC(n);var s=getTuneTitle(n);gTheBatchMP3ExportStatusText.innerText="Exporting .MP3 for tune "+(l+1)+" of "+a+": "+s,PlayABCDialog(n,o,l,null,!1)},gBatchMP3ExportDelayMS):(gTheBatchMP3ExportOKButton.click(),gBatchMP3ExportCancelRequested=!1))}function o(e,t){DownloadMP3(n,t)}var a,r=CountTunes();if(0!=r){a=r;var l=0;gBatchMP3ExportCancelRequested=!1,gTheBatchMP3ExportOKButton=null,gTheBatchMP3ExportStatusText=null;var s="Exporting .MP3 for tune "+(l+1)+" of "+a;s=makeCenteredPromptString(s),DayPilot.Modal.alert(s,{theme:"modal_flat",top:290,scrollWithPage:AllowDialogsToScroll(),okText:"Cancel"}).then(function(e){gBatchMP3ExportCancelRequested=!0});var g=document.getElementsByClassName("modal_flat_main");g[g.length-1].style.zIndex=100001;for(var c=document.getElementsByClassName("modal_flat_ok"),d=null,u=0;u<c.length;++u)if("Cancel"==(d=c[u]).innerText){gTheBatchMP3ExportOKButton=d;break}var p=document.getElementsByClassName("modal_flat_content");(gTheBatchMP3ExportStatusText=p[p.length-1]).style.textAlign="center";var m=getTuneByIndex(l),h=getTuneRhythmType(m);m=AddDuplicatesForMp3(m,h,e,t),m=PreProcessPlayABC(m);var f=getTuneTitle(m);return gTheBatchMP3ExportStatusText.innerText="Exporting .MP3 for tune "+(l+1)+" of "+a+": "+f,PlayABCDialog(m,o,l,null,!1),!0}}var gInDownloadMP3=!1;function DownloadMP3(e,t){if(gInDownloadMP3)return!1;sendGoogleAnalytics("export","DownloadMP3"),gInDownloadMP3=!0,gMIDIbuffer.millisecondsPerMeasure=isJigWithNoTiming(gPlayerABC,gMIDIbuffer.millisecondsPerMeasure);var n=computeFade(gPlayerABC);gMIDIbuffer.fadeLength=n,gMIDIbuffer.prime().then(function(n){e||(document.getElementById("abcplayer_mp3button").value="Encoding .MP3"),document.getElementById("loading-bar-spinner").style.display="block",setTimeout(async function(){var n=await fetch(gMIDIbuffer.download()).then(e=>e.blob()),o=new FileReader;o.onload=function(n){var o=function e(t){var n,o=function e(t){function n(e,n){for(var o=0,a=0;n;)o+=t[e]<<a,a+=8,e++,n--;return o}return{sampleRate:n(24,4),bitsPerSample:n(34,2),samples:t.subarray(44)}}(new Uint8Array(t)),a=o.samples.length,r=a/4,l=o.sampleRate,s=new lamejs.Mp3Encoder(2,l,gMP3Bitrate),g=[],c=new Int16Array(o.samples.buffer);for(let d=0;d<882;d++)c[d]=0;let u=Math.ceil(a/2);var p=new Int16Array(u),m=new Int16Array(a-u);for(let h=0;h<2*r;h++)h%2==0?p[h/2]=c[h]:m[(h-1)/2]=c[h];for(var f=0;f<r;f+=1152){var T=p.subarray(f,f+1152),A=m.subarray(f,f+1152),y=s.encodeBuffer(T,A);y.length>0&&g.push(y)}var y=s.flush();return y.length>0&&g.push(y),g}(n.target.result),a=new Blob(o,{type:"audio/mp3"}),r=window.URL.createObjectURL(a),l=document.createElement("a");document.body.appendChild(l),l.setAttribute("style","display: none;"),l.href=r,l.download=GetTuneAudioDownloadName(gPlayerABC,".mp3"),l.click(),window.URL.revokeObjectURL(r),document.body.removeChild(l),e||(document.getElementById("abcplayer_mp3button").value="Save as .MP3"),document.getElementById("loading-bar-spinner").style.display="none",gInDownloadMP3=!1,e&&e(t)},o.readAsArrayBuffer(n)},100)}).catch(function(t){var n="A problem occured when exporting the .mp3 file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),e||(document.getElementById("abcplayer_mp3button").value="Save as .MP3"),document.getElementById("loading-bar-spinner").style.display="none",gInDownloadMP3=!1})}function DownloadMIDI(){sendGoogleAnalytics("export","DownloadMIDI");var e=ABCJS.synth.getMidiFile(gPlayerABC,{midiOutputType:"link"})[0];e=e.replace("<a download",'<a id="downloadmidilink" download');var t=document.createElement("div");t.innerHTML=e,t.setAttribute("style","display: none;"),document.body.appendChild(t),document.getElementById("downloadmidilink").click(),document.body.removeChild(t)}function ExportAudioOrImage(){var e="",t=GetRadioValue("notenodertab");e="whistle"!=t?'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export Audio or Image</p>':'<p style="text-align:center;font-size:20pt;font-family:helvetica">Export Audio</p>',e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:32px;">Export Tune Audio</p>',e+='<p style="text-align:center;font-size:20pt;font-family:helvetica;">',e+='<input id="abcplayer_wavbutton" class="abcplayer_wavbutton btn btn-wavedownload" onclick="DownloadWave();" type="button" value="Save as WAV File" title="Saves the audio for the current tune as a .WAV file">',e+='<input id="abcplayer_mp3button" class="abcplayer_mp3button btn btn-mp3download" onclick="DownloadMP3();" type="button" value="Save as MP3 File" title="Saves the audio for the current tune as a .MP3 file">',e+='<input id="abcplayer_midibutton" class="abcplayer_midibutton btn btn-mididownload" onclick="DownloadMIDI();" type="button" value="Save as MIDI File" title="Saves the current tune note events as a MIDI file">',e+="</p>","whistle"!=t&&(e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:42px;">Export Tune Image</p>',e+='<p style="text-align:center;font-size:20pt;font-family:helvetica"><input id="abcplayer_jpgbutton" class="abcplayer_jpgbutton btn btn-jpgdownload" onclick="DownloadJPEG();" type="button" value="Save as JPEG File" title="Saves the current tune image as a JPEG file">',e+='<input id="abcplayer_pngbutton" class="abcplayer_pngbutton btn btn-pngdownload" onclick="DownloadPNG();" type="button" value="Save as PNG File" title="Saves the current tune image as a PNG file">',e+='<input id="abcplayer_svgbutton" class="abcplayer_svgbutton btn btn-svgdownload" onclick="DownloadSVG();" type="button" value="Save as SVG File" title="Saves the current tune image as a SVG file">',e+="</p>",e+='<p class="export_single_text">',e+='Image width to export: <input id="export_width" type="number" min="0" step="1" max="4096" title="Image width to export" autocomplete="off"/>',e+="</p>"),e+='<a id="exportaudioimage_help" href="https://michaeleskin.com/abctools/userguide.html#export_audio_image" target="_blank" style="text-decoration:none;" title="Learn more about the audio and image exporter">?</a>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),"whistle"!=t&&(document.getElementById("export_width").value=gExportWidth)}function computeFade(e){var t=200,n=/^%%MIDI program.*[\r\n]*/gm,o=e.match(n);if(o&&o.length>0){var a=o[o.length-1].replace("%%MIDI program",""),r=(a=a.trim()).split(" ");if(r&&r.length>0){var l=r[0];if(gUseCustomGMSounds)switch(l){case"15":t=4e3;break;case"21":case"73":case"78":case"129":case"130":case"131":case"132":case"133":case"134":case"135":case"136":case"137":case"mute":t=100}else switch(l){case"129":case"130":case"131":case"132":case"133":case"134":case"135":case"136":case"137":case"mute":t=100}}}n=/^%%MIDI chordprog.*[\r\n]*/gm;var s=e.match(n);if(s&&s.length>0){var a=s[s.length-1].replace("%%MIDI chordprog",""),r=(a=a.trim()).split(" ");if(r&&r.length>0){var l=r[0];gUseCustomGMSounds&&"15"===l&&(t=4e3)}}n=/^%abcjs_release_decay_time.*[\r\n]*/gm;var g=e.match(n);if(g&&g.length>0){var t=g[g.length-1].replace("%abcjs_release_decay_time",""),c=parseInt(t=t.trim());isNaN(c)||(t=c)}return t}function postProcessTab(e,t,n,o){function a(){n=o?document.querySelectorAll('div[id="'+t+'"] > svg > g > g > [class="abcjs-top-line"]'):document.querySelectorAll('div[id="'+t+'"] > div > svg > g > g > [class="abcjs-top-line"]');var n,a=e.length;if(0!=a){var r=0;if(a>1){var r=t.replace("notation","");if(r=parseInt(r),isNaN(r))return}var l=e[r],s=l.lines.length;if(0!=s){for(var g=[],c=0;c<s;++c)l.lines[c].staff&&g.push(l.lines[c]);var d=g.length;if(0!=d){for(var u=[],c=0;c<d;++c){var p=g[c].staff.length,m=p/2;for(j=0;j<p;++j)j<m?u.push(!1):u.push(!0)}for(var h=0;h<n.length;h++)if(u[h]){n[h].setAttribute("class","hiddentabline");for(var f=getNextSiblings(n[h]),T=0;T<f.length;T++)f[T].setAttribute("class","hiddentabline")}}}}}if(e){if("whistle"==n){var r;for(a(),r=o?document.querySelectorAll('div[id="'+t+'"] > svg > g > g[data-name="tabNumber"] > text > tspan'):document.querySelectorAll('div[id="'+t+'"] > div > svg > g > g[data-name="tabNumber"] > text > tspan'),x=0;x<r.length;x++)r[x].setAttribute("class","whistle"),r[x].setAttribute("dy","-7"),"0"==r[x].innerHTML?r[x].innerHTML="g":"1"==r[x].innerHTML?r[x].innerHTML="m":"2"==r[x].innerHTML?r[x].innerHTML="a":"3"==r[x].innerHTML?r[x].innerHTML="i":"4"==r[x].innerHTML?r[x].innerHTML="b":"5"==r[x].innerHTML?r[x].innerHTML="c":"6"==r[x].innerHTML?r[x].innerHTML="j":"7"==r[x].innerHTML?r[x].innerHTML="d":"8"==r[x].innerHTML?r[x].innerHTML="k":"9"==r[x].innerHTML?r[x].innerHTML="e":"10"==r[x].innerHTML?r[x].innerHTML="f":"11"==r[x].innerHTML?r[x].innerHTML="l":"12"==r[x].innerHTML?r[x].innerHTML="g":"13"==r[x].innerHTML?r[x].innerHTML="m":"14"==r[x].innerHTML?r[x].innerHTML="a":"15"==r[x].innerHTML?r[x].innerHTML="i":"16"==r[x].innerHTML?r[x].innerHTML="b":"17"==r[x].innerHTML?r[x].innerHTML="c":"18"==r[x].innerHTML?r[x].innerHTML="j":"19"==r[x].innerHTML?r[x].innerHTML="D":"20"==r[x].innerHTML?r[x].innerHTML="K":"21"==r[x].innerHTML?r[x].innerHTML="E":"22"==r[x].innerHTML?r[x].innerHTML="F":"23"==r[x].innerHTML?r[x].innerHTML="L":"24"==r[x].innerHTML?r[x].innerHTML="G":"25"==r[x].innerHTML?r[x].innerHTML="M":"26"==r[x].innerHTML?r[x].innerHTML="A":"27"==r[x].innerHTML?r[x].innerHTML="I":"28"==r[x].innerHTML?r[x].innerHTML="B":"29"==r[x].innerHTML?r[x].innerHTML="C":"30"==r[x].innerHTML?r[x].innerHTML="J":"31"==r[x].innerHTML?r[x].innerHTML="D":"32"==r[x].innerHTML?r[x].innerHTML="K":"33"==r[x].innerHTML?r[x].innerHTML="E":"34"==r[x].innerHTML?r[x].innerHTML="F":"35"==r[x].innerHTML?r[x].innerHTML="L":"36"==r[x].innerHTML?r[x].innerHTML="G":"37"==r[x].innerHTML?r[x].innerHTML="M":"38"==r[x].innerHTML?r[x].innerHTML="A":(r[x].setAttribute("class","whistle_small"),r[x].setAttribute("dy","-23"),r[x].innerHTML="x")}if("notenames"==n){var l=!0;a(),Svgs=o?document.querySelectorAll('div[id="'+t+'"] > svg'):document.querySelectorAll('div[id="'+t+'"] > div > svg');var s=1;if(o&&(s=0),Svgs&&Svgs.length>s)for(var g=s;g<Svgs.length;++g){l=!0;var c=Svgs[g],d=c.querySelectorAll('g[data-name="staff-extra key-signature"]');d&&d.length>=1&&-1!=d[0].innerHTML.indexOf("accidentals.flat")&&(l=!1);var r=c.querySelectorAll('g[data-name="tabNumber"] > text > tspan');if(gUseComhaltasABC){if(l)for(x=0;x<r.length;x++)"0"==r[x].innerHTML?r[x].innerHTML="G,":"1"==r[x].innerHTML?r[x].innerHTML="G♯,":"2"==r[x].innerHTML?r[x].innerHTML="A,":"3"==r[x].innerHTML?r[x].innerHTML="A♯,":"4"==r[x].innerHTML?r[x].innerHTML="B,":"5"==r[x].innerHTML?r[x].innerHTML="C,":"6"==r[x].innerHTML?r[x].innerHTML="C♯,":"7"==r[x].innerHTML?r[x].innerHTML="D":"8"==r[x].innerHTML?r[x].innerHTML="D♯":"9"==r[x].innerHTML?r[x].innerHTML="E":"10"==r[x].innerHTML?r[x].innerHTML="F":"11"==r[x].innerHTML?r[x].innerHTML="F♯":"12"==r[x].innerHTML?r[x].innerHTML="G":"13"==r[x].innerHTML?r[x].innerHTML="G♯":"14"==r[x].innerHTML?r[x].innerHTML="A":"15"==r[x].innerHTML?r[x].innerHTML="A♯":"16"==r[x].innerHTML?r[x].innerHTML="B":"17"==r[x].innerHTML?r[x].innerHTML="C":"18"==r[x].innerHTML?r[x].innerHTML="C♯":"19"==r[x].innerHTML?r[x].innerHTML="D'":"20"==r[x].innerHTML?r[x].innerHTML="D♯'":"21"==r[x].innerHTML?r[x].innerHTML="E'":"22"==r[x].innerHTML?r[x].innerHTML="F'":"23"==r[x].innerHTML?r[x].innerHTML="F♯'":"24"==r[x].innerHTML?r[x].innerHTML="G'":"25"==r[x].innerHTML?r[x].innerHTML="G♯'":"26"==r[x].innerHTML?r[x].innerHTML="A'":"27"==r[x].innerHTML?r[x].innerHTML="A♯'":"28"==r[x].innerHTML?r[x].innerHTML="B'":"29"==r[x].innerHTML?r[x].innerHTML="C'":"30"==r[x].innerHTML?r[x].innerHTML="C♯'":"31"==r[x].innerHTML?r[x].innerHTML="D''":"32"==r[x].innerHTML?r[x].innerHTML="D♯''":"33"==r[x].innerHTML?r[x].innerHTML="E''":"34"==r[x].innerHTML?r[x].innerHTML="F''":"35"==r[x].innerHTML?r[x].innerHTML="F♯''":"36"==r[x].innerHTML?r[x].innerHTML="G''":"37"==r[x].innerHTML?r[x].innerHTML="G♯''":"38"==r[x].innerHTML?r[x].innerHTML="A''":"39"==r[x].innerHTML?r[x].innerHTML="A♯''":"40"==r[x].innerHTML?r[x].innerHTML="B''":r[x].innerHTML="?";else for(x=0;x<r.length;x++)"0"==r[x].innerHTML?r[x].innerHTML="G,":"1"==r[x].innerHTML?r[x].innerHTML="A♭,":"2"==r[x].innerHTML?r[x].innerHTML="A,":"3"==r[x].innerHTML?r[x].innerHTML="B♭,":"4"==r[x].innerHTML?r[x].innerHTML="B,":"5"==r[x].innerHTML?r[x].innerHTML="C,":"6"==r[x].innerHTML?r[x].innerHTML="D♭":"7"==r[x].innerHTML?r[x].innerHTML="D":"8"==r[x].innerHTML?r[x].innerHTML="E♭":"9"==r[x].innerHTML?r[x].innerHTML="E":"10"==r[x].innerHTML?r[x].innerHTML="F":"11"==r[x].innerHTML?r[x].innerHTML="G♭":"12"==r[x].innerHTML?r[x].innerHTML="G":"13"==r[x].innerHTML?r[x].innerHTML="A♭":"14"==r[x].innerHTML?r[x].innerHTML="A":"15"==r[x].innerHTML?r[x].innerHTML="B♭":"16"==r[x].innerHTML?r[x].innerHTML="B":"17"==r[x].innerHTML?r[x].innerHTML="C":"18"==r[x].innerHTML?r[x].innerHTML="D♭'":"19"==r[x].innerHTML?r[x].innerHTML="D'":"20"==r[x].innerHTML?r[x].innerHTML="E♭'":"21"==r[x].innerHTML?r[x].innerHTML="E'":"22"==r[x].innerHTML?r[x].innerHTML="F'":"23"==r[x].innerHTML?r[x].innerHTML="G♭'":"24"==r[x].innerHTML?r[x].innerHTML="G'":"25"==r[x].innerHTML?r[x].innerHTML="A♭'":"26"==r[x].innerHTML?r[x].innerHTML="A'":"27"==r[x].innerHTML?r[x].innerHTML="B♭'":"28"==r[x].innerHTML?r[x].innerHTML="B'":"29"==r[x].innerHTML?r[x].innerHTML="C'":"30"==r[x].innerHTML?r[x].innerHTML="D♭''":"31"==r[x].innerHTML?r[x].innerHTML="D''":"32"==r[x].innerHTML?r[x].innerHTML="E♭''":"33"==r[x].innerHTML?r[x].innerHTML="E''":"34"==r[x].innerHTML?r[x].innerHTML="F''":"35"==r[x].innerHTML?r[x].innerHTML="G♭''":"36"==r[x].innerHTML?r[x].innerHTML="G''":"37"==r[x].innerHTML?r[x].innerHTML="A♭''":"38"==r[x].innerHTML?r[x].innerHTML="A''":"39"==r[x].innerHTML?r[x].innerHTML="B♭''":"40"==r[x].innerHTML?r[x].innerHTML="B''":r[x].innerHTML="?"}else if(l)for(x=0;x<r.length;x++)"0"==r[x].innerHTML?r[x].innerHTML="G,":"1"==r[x].innerHTML?r[x].innerHTML="G♯,":"2"==r[x].innerHTML?r[x].innerHTML="A,":"3"==r[x].innerHTML?r[x].innerHTML="A♯,":"4"==r[x].innerHTML?r[x].innerHTML="B,":"5"==r[x].innerHTML?r[x].innerHTML="C":"6"==r[x].innerHTML?r[x].innerHTML="C♯":"7"==r[x].innerHTML?r[x].innerHTML="D":"8"==r[x].innerHTML?r[x].innerHTML="D♯":"9"==r[x].innerHTML?r[x].innerHTML="E":"10"==r[x].innerHTML?r[x].innerHTML="F":"11"==r[x].innerHTML?r[x].innerHTML="F♯":"12"==r[x].innerHTML?r[x].innerHTML="G":"13"==r[x].innerHTML?r[x].innerHTML="G♯":"14"==r[x].innerHTML?r[x].innerHTML="A":"15"==r[x].innerHTML?r[x].innerHTML="A♯":"16"==r[x].innerHTML?r[x].innerHTML="B":"17"==r[x].innerHTML?r[x].innerHTML="c":"18"==r[x].innerHTML?r[x].innerHTML="c♯":"19"==r[x].innerHTML?r[x].innerHTML="d":"20"==r[x].innerHTML?r[x].innerHTML="d♯":"21"==r[x].innerHTML?r[x].innerHTML="e":"22"==r[x].innerHTML?r[x].innerHTML="f":"23"==r[x].innerHTML?r[x].innerHTML="f♯":"24"==r[x].innerHTML?r[x].innerHTML="g":"25"==r[x].innerHTML?r[x].innerHTML="g♯":"26"==r[x].innerHTML?r[x].innerHTML="a":"27"==r[x].innerHTML?r[x].innerHTML="a♯":"28"==r[x].innerHTML?r[x].innerHTML="b":"29"==r[x].innerHTML?r[x].innerHTML="c'":"30"==r[x].innerHTML?r[x].innerHTML="c♯'":"31"==r[x].innerHTML?r[x].innerHTML="d'":"32"==r[x].innerHTML?r[x].innerHTML="d♯'":"33"==r[x].innerHTML?r[x].innerHTML="e'":"34"==r[x].innerHTML?r[x].innerHTML="f'":"35"==r[x].innerHTML?r[x].innerHTML="f♯'":"36"==r[x].innerHTML?r[x].innerHTML="g'":"37"==r[x].innerHTML?r[x].innerHTML="g♯'":"38"==r[x].innerHTML?r[x].innerHTML="a'":"39"==r[x].innerHTML?r[x].innerHTML="a♯'":"40"==r[x].innerHTML?r[x].innerHTML="b'":r[x].innerHTML="?";else for(x=0;x<r.length;x++)"0"==r[x].innerHTML?r[x].innerHTML="G,":"1"==r[x].innerHTML?r[x].innerHTML="A♭,":"2"==r[x].innerHTML?r[x].innerHTML="A,":"3"==r[x].innerHTML?r[x].innerHTML="B♭,":"4"==r[x].innerHTML?r[x].innerHTML="B,":"5"==r[x].innerHTML?r[x].innerHTML="C":"6"==r[x].innerHTML?r[x].innerHTML="D♭":"7"==r[x].innerHTML?r[x].innerHTML="D":"8"==r[x].innerHTML?r[x].innerHTML="E♭":"9"==r[x].innerHTML?r[x].innerHTML="E":"10"==r[x].innerHTML?r[x].innerHTML="F":"11"==r[x].innerHTML?r[x].innerHTML="G♭":"12"==r[x].innerHTML?r[x].innerHTML="G":"13"==r[x].innerHTML?r[x].innerHTML="A♭":"14"==r[x].innerHTML?r[x].innerHTML="A":"15"==r[x].innerHTML?r[x].innerHTML="B♭":"16"==r[x].innerHTML?r[x].innerHTML="B":"17"==r[x].innerHTML?r[x].innerHTML="c":"18"==r[x].innerHTML?r[x].innerHTML="d♭":"19"==r[x].innerHTML?r[x].innerHTML="d":"20"==r[x].innerHTML?r[x].innerHTML="e♭":"21"==r[x].innerHTML?r[x].innerHTML="e":"22"==r[x].innerHTML?r[x].innerHTML="f":"23"==r[x].innerHTML?r[x].innerHTML="g♭":"24"==r[x].innerHTML?r[x].innerHTML="g":"25"==r[x].innerHTML?r[x].innerHTML="a♭":"26"==r[x].innerHTML?r[x].innerHTML="a":"27"==r[x].innerHTML?r[x].innerHTML="b♭":"28"==r[x].innerHTML?r[x].innerHTML="b":"29"==r[x].innerHTML?r[x].innerHTML="c'":"30"==r[x].innerHTML?r[x].innerHTML="d♭'":"31"==r[x].innerHTML?r[x].innerHTML="d'":"32"==r[x].innerHTML?r[x].innerHTML="e♭'":"33"==r[x].innerHTML?r[x].innerHTML="e'":"34"==r[x].innerHTML?r[x].innerHTML="f'":"35"==r[x].innerHTML?r[x].innerHTML="g♭'":"36"==r[x].innerHTML?r[x].innerHTML="g'":"37"==r[x].innerHTML?r[x].innerHTML="a♭'":"38"==r[x].innerHTML?r[x].innerHTML="a'":"39"==r[x].innerHTML?r[x].innerHTML="b♭'":"40"==r[x].innerHTML?r[x].innerHTML="b'":r[x].innerHTML="?"}}}}function ToggleMetronome(){gPlayMetronome=!gPlayMetronome,gTheOKButton.click(),setTimeout(function(){if(gPlayMetronome){if(!gPlayerABCMetronome&&!(gPlayerABCMetronome=inject_one_metronome(gPlayerABC,!1))){gPlayMetronome=!1;var e='<p style="text-align:center;font-size:20pt;font-family:helvetica">Metronome Not Available for this Meter</p>';e+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">No metronome pattern is available for the meter of this tune.</p>',e+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">Only the original version can be played.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){PlayABCDialog(gPlayerABC,null,null,gUseWidePlayer)});return}PlayABCDialog(gPlayerABCMetronome,null,null,!0,gUseWidePlayer)}else PlayABCDialog(gPlayerABC,null,null,!1,gUseWidePlayer)},250)}function ToggleWidePlayer(){gUseWidePlayer=!gUseWidePlayer,gTheOKButton.click(),setTimeout(function(){PlayABCDialog(gPlayerABC,null,null,!1,gUseWidePlayer)},250)}var gPlayerContainerRect=null,gPlayerHolder=null;function CursorControl(){var e=this;e.onReady=function(){},e.onStart=function(){var e=document.querySelector("#playback-paper svg"),t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("class","abcjs-cursor"),t.setAttributeNS(null,"x1",0),t.setAttributeNS(null,"y1",0),t.setAttributeNS(null,"x2",0),t.setAttributeNS(null,"y2",0),e.appendChild(t)},e.beatSubdivisions=2,e.onBeat=function(e,t,n){},e.onEvent=function(e){if(!e.measureStart||null!==e.left){for(var t=document.querySelectorAll("#playback-paper svg .highlight"),n=0;n<t.length;n++)t[n].classList.remove("highlight");for(var o=0;o<e.elements.length;o++)for(var a=e.elements[o],r=0;r<a.length;r++)a[r].classList.add("highlight");var l=document.querySelector("#playback-paper svg .abcjs-cursor");if(l&&(l.setAttribute("x1",e.left-2),l.setAttribute("x2",e.left-2),l.setAttribute("y1",e.top),l.setAttribute("y2",e.top+e.height),gAutoscrollPlayer)){let s=l.getBoundingClientRect();var g,c=gPlayerContainerRect.bottom-gPlayerContainerRect.top;(g=gUseWidePlayer?2*c/3:3*c/4,s.top<gPlayerContainerRect.top)?gPlayerHolder.scrollTop+=s.top-gPlayerContainerRect.top:s.bottom>g&&(s.bottom-s.top<=g?gPlayerHolder.scrollTop+=s.bottom-g:gPlayerHolder.scrollTop+=s.top-gPlayerContainerRect.top)}}},e.onFinished=function(){for(var e=document.querySelectorAll("svg .highlight"),t=0;t<e.length;t++)e[t].classList.remove("highlight");var n=document.querySelector("#playback-paper svg .abcjs-cursor");n&&(n.setAttribute("x1",0),n.setAttribute("x2",0),n.setAttribute("y1",0),n.setAttribute("y2",0))}}function findLargestRectangle(e,t,n){for(var o={width:0,height:0},a=1;a<=e;a++){var r=a/n;r<=t&&(o.width=a,o.height=r)}return o}function calc_wide_play_width(e){var t=getTuneRangeForTranspose().start,n=document.getElementById("notation"+t);if(n){var o,a=n.getElementsByTagName("div");if(a&&a.length>0){var r=(o=a.length>1?a[1]:a[0]).getElementsByTagName("svg");if(r&&r.length>0){var l=r[0].getBoundingClientRect(),s=l.width,g=3*l.height,c=.9*window.innerWidth;return findLargestRectangle(c,(window.innerHeight-e)*.9,s/g).width}}}var c=window.innerWidth;return .75*c}function PlayPrevious(e){if(gPlayABCTuneIndex>0){e.shiftKey?gPlayABCTuneIndex=0:gPlayABCTuneIndex--;var t=getTuneByIndex(gPlayABCTuneIndex);""!=t&&(gTheOKButton.click(),t=PreProcessPlayABC(t),PlayABCDialog(t,null,null,null,gUseWidePlayer=!1))}}function PlayNext(e){if(gPlayABCTuneIndex<gPlayABCTuneCount-1){e.shiftKey?gPlayABCTuneIndex=gPlayABCTuneCount-1:gPlayABCTuneIndex++;var t=getTuneByIndex(gPlayABCTuneIndex);""!=t&&(gTheOKButton.click(),t=PreProcessPlayABC(t),PlayABCDialog(t,null,null,null,gUseWidePlayer=!1))}}function PlaySelectedTune(){var e=document.getElementById("playertunelist").value;if(e=parseInt(e),!isNaN(e)){var t=getTuneByIndex(gPlayABCTuneIndex=e);""!=t&&(gTheOKButton.click(),t=PreProcessPlayABC(t),PlayABCDialog(t,null,null,null,gUseWidePlayer=!1))}}function JustTheNotes(e){if(isSectionHeader(e))return e;for(var t,n=removeABCTuneHeaders(e),o=n.split("\n"),a=o.length,r=!1,l=0;l<a;++l)if(0!=(t=o[l]).indexOf("%")){r=!0;var s=n.indexOf(t);n=n.substring(s);break}return r?n:e}function ProcessSelectRegionForPlay(e){if(gDisableSelectedPlay||gIsMaximized)return e;var t=gTheABC.selectionStart,n=gTheABC.selectionEnd;if(t==n||-1!=e.indexOf("V:"))return e;var o=findTuneOffsetByIndex(gPlayABCTuneIndex),a=e.length,r=JustTheNotes(e);t<o&&(t=o),n>o+a&&(n=o+a),t-=o,n-=o;var l=e.indexOf(r);if(-1==l||t<l&&n<l)return e;t<l&&(t=l),t-=l,n-=l;var s=r.substring(t,n);return 0==(s=s.trim()).indexOf("\n")&&(s=(s=s.substring(1,s.length)).trim()),e.substring(0,l)+s}function PlayABC(){if(gAllowCopy){var e;if(gIsMaximized){if(gPlayABCGotMaximizedPlay){if(""==(e=getTuneByIndex(gPlayABCTuneIndex)))return}else{var e=findSelectedTune();if(""==e)return;gPlayABCTuneIndex=findSelectedTuneIndex(),gPlayABCTuneCount=CountTunes(),gPlayABCGotMaximizedPlay=!0}}else{if(""==(e=findSelectedTune()))return;gPlayABCTuneIndex=findSelectedTuneIndex(),gPlayABCTuneCount=CountTunes(),-1==gPlayABCTuneIndex&&(e=getTuneByIndex(gPlayABCTuneIndex=0)),gPlayABCGotMaximizedPlay=!1}e=ProcessSelectRegionForPlay(e),e=PreProcessPlayABC(e),PlayABCDialog(e,null,null,null,gUseWidePlayer=!1)}}var gPlayABCTuneIndex=0,gPlayABCTuneCount=0,gPlayABCGotMaximizedPlay=!1;function PlayABCDialog(e,t,n,o,a){sendGoogleAnalytics("dialog","PlayABCDialog"),gMIDIbuffer=null,gTheOKButton=null,gPlayMetronome=!1,o?gPlayMetronome=o:(gPlayerABC=e,gPlayMetronome=!1,gPlayerABCMetronome=null);var r,l=ScanTuneForSoundFont(e);if(l){var s=gTheActiveSoundFont;switch(l){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FatBoy/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore/"}gTheActiveSoundFont!=s&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});var g=ScanTuneForBoomChick(e);if(""!=g){DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;"><strong>There is an issue with your custom rhythm directive:</strong></p><p style="font-family:helvetica;font-size:14pt;"><strong>'+g+'</strong></p><p style="font-family:helvetica;font-size:14pt;">Format should be:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick meter rhythm_pattern_string partial_measure</p><p style="font-family:helvetica;font-size:14pt;">Valid rhythm_pattern_string characters are:</p><p style="font-family:helvetica;font-size:14pt;">B - Boom, b - Alternate Boom, c - Chick, and x - Silence.</p><p style="font-family:helvetica;font-size:14pt;">Examples:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 7/8 Bccbxbx 3</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 10/8 Bccbccbxbx 5</p><p style="font-family:helvetica;font-size:14pt;">The number of characters in the pattern_string must match the meter numerator.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure sets how many beats must be present in a partial measure in the ABC to use the custom pattern.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure is optional and defaults to half of the meter numerator rounded down to the next lowest integer (min is 1).</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()});return}ScanTuneForCustomTimingInjection(e);var c=GetRadioValue("notenodertab"),d=GetABCJSParams(c);function u(){gSynthControl=null,r&&(r.destroy(),r=null)}d.oneSvgPerLine=!1,"noten"!=c&&d.tablature&&d.tablature.length>0&&(d.tablature[0].label="");var p=new CursorControl;if(gIsIOS){var m=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,m&&(gTheMuteHandle=unmute(m,!1,!1))}!function l(){if(gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-340)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p style="text-align:center;margin:0px;margin-top:10px">',modal_msg+='<input id="abcplayer_exportbutton" class="abcplayer_exportbutton btn btn-exportaudiomidi" onclick="ExportAudioOrImage();" type="button" value="Export Audio or Image" title="Brings up a dialog where you can save the tune in various audio and image formats">',modal_msg+='<input id="abcplayer_trainer" class="btn btn-looper abcplayer_trainer" onclick="TuneTrainerLaunchFromPlayer()" type="button" value="Start Tune Trainer" title="Opens the Tune Trainer for practicing tunes with increasing tempos">',modal_msg+='<input id="abcplayer_metronomebutton" class="abcplayer_metronome button btn btn-metronome" onclick="ToggleMetronome();" type="button" value="Enable Metronome" title="Enables/disables the metronome">',isDesktopBrowser()&&(modal_msg+='<input id="abcplayer_wideplayerbutton" class="abcplayer_wideplayerbutton button btn btn-wide-player" onclick="ToggleWidePlayer();" type="button" value="Wide View" title="Toggles the player between normal and wide views">'),modal_msg+="</p>",modal_msg+='<p style="text-align:center;font-size:0pt;font-family:helvetica">&nbsp;</p>',modal_msg+='<a id="abcplayer_help" href="https://michaeleskin.com/abctools/userguide.html#playing_your_tunes" target="_blank" style="text-decoration:none;" title="Learn more about the Player">?</a>',gPlayABCTuneCount>1){gPlayerStatusOnLeft?modal_msg+='<p id="playerstatus_left" class="playerstatus_left">':modal_msg+='<p id="playerstatus" class="playerstatus">',modal_msg+='<input id="abcplayer_previousbutton" class="abcplayer_previousbutton btn btn-playerprevious" onclick="PlayPrevious(event);" type="button" value="&nbsp;←&nbsp;" title="Play the previous tune.&nbsp;&nbsp;Shift-click to jump to the first tune.">Tune '+(gPlayABCTuneIndex+1)+" of "+gPlayABCTuneCount+'<input id="abcplayer_nextbutton" class="abcplayer_nextbutton btn btn-playernext" onclick="PlayNext(event);" type="button" value="&nbsp;→&nbsp;" title="Play the next tune.&nbsp;&nbsp;Shift-click to jump to the last tune.">',modal_msg+='<br/><select id="playertunelist" onchange="PlaySelectedTune();" title="Select a tune to play from the list">',totalTunes=CountTunes();for(var s,g,m,h,f,T=GetTunebookIndexTitles(),A=T.length,y=0;y<A;++y)modal_msg+='<option value="'+y+'">'+T[y]+"</option>";modal_msg+="</select></p>"}var b=window.innerWidth;if(GetRadioValue("notenodertab"),isDesktopBrowser()?(g=calc_wide_play_width(200),(s=a?g:.45*b)<850&&(s=850)):s=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:40,width:s,okText:"Close",scrollWithPage:isMobileBrowser()}),gPlayABCTuneCount>1){var I=document.getElementById("abcplayer_previousbutton");gPlayABCTuneIndex>0?(I.disabled=!1,I.style.opacity=1):(I.disabled=!0,I.style.opacity=.25),I=document.getElementById("abcplayer_nextbutton"),gPlayABCTuneIndex<gPlayABCTuneCount-1?(I.disabled=!1,I.style.opacity=1):(I.disabled=!0,I.style.opacity=.25),document.getElementById("playertunelist").value=gPlayABCTuneIndex}if("whistle"==GetRadioValue("notenodertab")&&(document.getElementById("abcplayer_exportbutton").value="Export Audio",document.getElementById("abcplayer_exportbutton").title="Brings up a dialog where you can save the tune in various audio formats"),o&&!0==o){var I=document.getElementById("abcplayer_metronomebutton");I.value="Disable Metronome"}if(isDesktopBrowser()){if(!a&&g<=s)document.getElementById("abcplayer_wideplayerbutton").style.display="none";else if(a&&!0==a){var I=document.getElementById("abcplayer_wideplayerbutton");I.value="Normal View"}}for(var v=document.getElementsByClassName("modal_flat_ok"),C=null,y=0;y<v.length;++y)if("Close"==(C=v[y]).innerText){gTheOKButton=C;var S=C.onclick;C.onclick=function(){S(),u(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(r=new ABCJS.synth.SynthController(e)).load("#playback-audio",p,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",m=!1,r.disable(!0),h=ABCJS.renderAbc("playback-paper",e,d)[0],postProcessTab([h],"playback-paper",c,!0),gMIDIbuffer=f=new ABCJS.synth.CreateSynth(e),f.init({visualObj:h}).then(function(o){if(console.log(o),r){var a=computeFade(e);r.setTune(h,m,{fadeLength:a}).then(function(e){if(console.log("Audio successfully loaded."),t&&t(n,gTheOKButton),gTrainerTouchControls){var o=document.getElementsByClassName("abcjs-midi-clock"),a=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(o&&a&&o.length>0&&a.length>0){gSynthControl=r;var l=o[0];l.onclick=DecrementTempo,(l=a[0]).onclick=IncrementTempo}}}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function PreProcessPlayABC(e){var t=!1;if(gOverridePlayMIDIParams&&(e=OverrideOneTuneMIDIParams(e,gTheMelodyProgram,gTheBassProgram,gTheChordProgram,gTheBassVolume,gTheChordVolume),t=!0),gAlwaysInjectPrograms){var n=/^%%MIDI chordprog.*$/m,o=e.match(n),a=!1;o&&o.length>0||(a=!0,e=InjectOneTuneMIDIProgramAboveTune(e,gTheChordProgram,!1,!0));var n=/^%%MIDI bassprog.*$/m,r=e.match(n);if(!(r&&r.length>0)){if(t)e=InjectOneTuneMIDIProgramAboveTune(e,gTheBassProgram,!0,!1);else if(a)e=InjectOneTuneMIDIProgramAboveTune(e,gTheBassProgram,!0,!1);else{var l=o[0].replace("%%MIDI chordprog","");theBassProgam=l.trim(),e=InjectOneTuneMIDIProgramAboveTune(e,l,!0,!1)}}n=/^%%MIDI program.*$/m;var s=e.match(n);s&&s.length>0||(e=InjectOneTuneMIDIProgramAboveTune(e,gTheMelodyProgram,!1,!1))}if(gAlwaysInjectVolumes){var n=/^%%MIDI bassvol.*$/m,g=e.match(n);g&&g.length>0||(e=InjectOneTuneMIDIVolumeAboveTune(e,gTheBassVolume,!1));var n=/^%%MIDI chordvol.*$/m,c=e.match(n);c&&c.length>0||(e=InjectOneTuneMIDIVolumeAboveTune(e,gTheChordVolume,!0))}return e}function tuneIsHornpipe(e){var t=/^R:Hornpipe.*$/gm,n=e.match(t);return!!n&&n.length>0||(t=/^R: Hornpipe.*$/gm,!!(n=e.match(t))&&n.length>0||(t=/^R:hornpipe.*$/gm,!!(n=e.match(t))&&n.length>0||(t=/^R: hornpipe.*$/gm,!!(n=e.match(t))&&!!(n.length>0))))}function validate_roll_2_params(e,t){var n=e.split(" ");if(n&&8!=n.length)return!1;var o=n[0],a=n[1],r=n[2],l=n[3],s=n[4],g=n[5],c=n[6],d=n[7];return o=parseFloat(o),a=parseFloat(a),r=parseFloat(r),l=parseFloat(l),s=parseFloat(s),g=parseFloat(g),c=parseFloat(c),d=parseFloat(d),!isNaN(o)&&!isNaN(a)&&!isNaN(r)&&!isNaN(l)&&!isNaN(s)&&!isNaN(g)&&!isNaN(c)&&!isNaN(d)&&o>=0&&a>=0&&r>=0&&r<=1&&l>=0&&l<=1&&s>=0&&s<=1&&g>=0&&g<=2&&c>=0&&c<=2&&d>=0&&d<=2&&o+a<3&&(t&&(gRoll2Duration1=o,gRoll2Duration2=a,gRoll2Fraction1=r,gRoll2Fraction2=l,gRoll2Fraction3=s,gRoll2Volume1=g,gRoll2Volume2=c,gRoll2Volume3=d),!0)}function validate_roll_3_params(e,t){var n=e.split(" ");if(n&&8!=n.length)return!1;var o=n[0],a=n[1],r=n[2],l=n[3],s=n[4],g=n[5],c=n[6],d=n[7];return(o=parseFloat(o),a=parseFloat(a),r=parseFloat(r),l=parseFloat(l),s=parseFloat(s),g=parseFloat(g),c=parseFloat(c),d=parseFloat(d),isNaN(o)||isNaN(a)||isNaN(r)||isNaN(l)||isNaN(s)||isNaN(g)||isNaN(c)||isNaN(d))?(console.log("roll3 validation fail2"),!1):o>=0&&a>=0&&r>=0&&r<=1&&l>=0&&l<=1&&s>=0&&s<=1&&g>=0&&g<=2&&c>=0&&c<=2&&d>=0&&d<=2&&o+a<3&&(t&&(gRoll3Duration1=o,gRoll3Duration2=a,gRoll3Fraction1=r,gRoll3Fraction2=l,gRoll3Fraction3=s,gRoll3Volume1=g,gRoll3Volume2=c,gRoll3Volume3=d),!0)}function ScanTuneForCustomTimingInjection(e){if(gAddSwing=!1,gSwingFactor=gAutoSwingFactor,gSwingOffset=0,gAutoSwingHornpipes&&(gAddSwing=tuneIsHornpipe(e)),t=/^%swing.*$/gm,(n=e.match(t))&&n.length>0){gAddSwing=!0;var t,n,o=n[0].replace("%swing",""),a=(o=o.trim()).split(" ");if(a.length>=1){var r=parseFloat(a[0]);isNaN(r)||(gSwingFactor=r)}if(a.length>1){var l=parseInt(a[1]);isNaN(l)||(gSwingOffset=l)}}t=/^%noswing.*$/gm,(n=e.match(t))&&n.length>0&&(gAddSwing=!1),t=/^%grace_duration_ms.*$/gm;var s=e.match(t);if(gGraceDuration=.045,s&&s.length>0){var o=s[0].replace("%grace_duration_ms",""),a=(o=o.trim()).split(" ");if(a.length>=1){var g=parseInt(a[0]);!isNaN(g)&&g>=0&&g<=150&&(gGraceDuration=g/1e3)}}gGraceMissingTempo=!0,t=/^Q:.*$/gm;var c=e.match(t);c&&c.length>0&&(gGraceMissingTempo=!1),gGraceTuneType=getTuneRhythmType(e),validate_roll_2_params(gRoll2DefaultParams,!0)||(gRoll2Duration1=.95,gRoll2Duration2=.8,gRoll2Fraction1=1,gRoll2Fraction2=.75,gRoll2Fraction3=.9,gRoll2Volume1=1,gRoll2Volume2=.75,gRoll2Volume3=1),t=/^%roll_2_params.*$/gm;var d=e.match(t);if(d&&d.length>0){var o=d[0].replace("%roll_2_params","");validate_roll_2_params(o=o.trim(),!0)}validate_roll_3_params(gRoll3DefaultParams,!0)||(gRoll3Duration1=1.45,gRoll3Duration2=.6,gRoll3Fraction1=1,gRoll3Fraction2=.75,gRoll3Fraction3=.9,gRoll3Volume1=1,gRoll3Volume2=.75,gRoll3Volume3=1),t=/^%roll_3_params.*$/gm;var u=e.match(t);if(u&&u.length>0){var o=u[0].replace("%roll_3_params","");validate_roll_3_params(o=o.trim(),!0)}gRollUseOriginalRollSolution=!1,t=/^%use_original_abcjs_roll_solution.*$/gm;var p=e.match(t);p&&p.length>0&&(gRollUseOriginalRollSolution=!0)}function ScanTuneForBoomChick(e){gRhythmPatternOverrides={};var t=e.match(/^%abcjs_boomchick.*$/gm);if(t&&t.length>0)for(var n=0;n<t.length;++n){var o=t[n],a=o,r=a.replace("%abcjs_boomchick",""),l=(r=r.trim()).split(" ");if(2!=l.length&&3!=l.length)return o;var s,g=l[0],a=l[1],c=g.split("/");if(2!=c.length)return o;var d=c[0];if(isNaN(parseInt(d)))return o;d=parseInt(d);var u=c[1];if(isNaN(parseInt(u)))return o;if(u=parseInt(u),3==l.length){if(isNaN(parseInt(s=l[2]))||(s=parseInt(s))<1||s>d)return o}else 0==(s=Math.floor(s=d/2))&&(s=1);var p=a.split(""),m=p.length;if(m!=d)return o;for(var h=[],f=0;f<m;++f){var T=p[f];switch(T){case"B":h.push("boom");break;case"b":h.push("boom2");break;case"c":h.push("chick");break;case"x":h.push("");break;default:return o}}gRhythmPatternOverrides[g]||(gRhythmPatternOverrides[g]={pattern:h,threshold:s})}return""}function ScanTuneForSoundFont(e){var t=null,n=e.match(/^%abcjs_soundfont.*$/gm);return n&&n.length>0&&(t=(t=(t=n[n.length-1].replace("%abcjs_soundfont","")).trim()).toLowerCase()),t}function SwingExplorer(){if(gAllowCopy){var e=findSelectedTune();if(""!=e){var t=PreProcessPlayABC(e);SwingExplorerDialog(e,t,!1)}}}function SwingExplorerRegenerate(){var e=!1,t=document.getElementById("swing_explorer_factor").value;t=parseFloat(t),!isNaN(t)&&t>=-.9&&t<=.9&&(gSwingFactor=t,e=!0);var n=document.getElementById("swing_explorer_offset").value;n=parseInt(n),!isNaN(n)&&n>=0&&(gSwingOffset=n,e=!0),e&&(gTheOKButton.click(),setTimeout(function(){SwingExplorerDialog(gPlayerABCSwingExplorerOriginal,gPlayerABCSwingExplorerProcessed,!0)},250))}function ScanTuneForSwingExplorer(e){if(gAddSwing=!0,gSwingFactor=0,gSwingOffset=0,gAutoSwingHornpipes&&tuneIsHornpipe(e)&&(gSwingFactor=gAutoSwingFactor),t=/^%swing.*$/gm,(n=e.match(t))&&n.length>0){var t,n,o=n[0].replace("%swing",""),a=(o=o.trim()).split(" ");if(a.length>=1){var r=parseFloat(a[0]);isNaN(r)||(gSwingFactor=r)}if(a.length>1){var l=parseInt(a[1]);isNaN(l)||(gSwingOffset=l)}}}function SwingExplorerInject(){var e=!1,t=document.getElementById("swing_explorer_factor").value;t=parseFloat(t),!isNaN(t)&&t>=-.9&&t<=.9&&(e=!0);var n=!1;if(e){var o=document.getElementById("swing_explorer_offset").value;o=parseInt(o),!isNaN(o)&&o>=0&&(n=!0);var a="%swing "+t;n&&(a+=" "+o);var r=/^%swing.*[\r\n]*/gm,l=gPlayerABCSwingExplorerOriginal.replaceAll(r,""),s=InjectStringBelowTuneHeader(l,a);s=s.replace("\n\n","");var g=gTheABC.selectionStart,c=gTheABC.value;c=c.replace(gPlayerABCSwingExplorerOriginal,s),gTheABC.value=c,gIsDirty=!0,gPlayerABCSwingExplorerOriginal=s,gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=g,gTheABC.selectionEnd=g,FocusAfterOperation()}):(gTheABC.selectionStart=g,gTheABC.selectionEnd=g,FocusAfterOperation()),DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Swing Injection Complete!</p>',{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}}var gSwingExplorerFactor=0,gSwingExplorerOffset=0,gPlayerABCSwingExplorerOriginal=null,gPlayerABCSwingExplorerProcessed=null;function SwingExplorerDialog(e,t,n){sendGoogleAnalytics("dialog","SwingExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,n||(gPlayerABCSwingExplorerOriginal=e,gPlayerABCSwingExplorerProcessed=t);var o,a=ScanTuneForSoundFont(t);if(a){var r=gTheActiveSoundFont;switch(a){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FatBoy/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore/"}gTheActiveSoundFont!=r&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});var l=ScanTuneForBoomChick(t);if(""!=l){DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;"><strong>There is an issue with your custom rhythm directive:</strong></p><p style="font-family:helvetica;font-size:14pt;"><strong>'+l+'</strong></p><p style="font-family:helvetica;font-size:14pt;">Format should be:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick meter rhythm_pattern_string partial_measure</p><p style="font-family:helvetica;font-size:14pt;">Valid rhythm_pattern_string characters are:</p><p style="font-family:helvetica;font-size:14pt;">B - Boom, b - Alternate Boom, c - Chick, and x - Silence.</p><p style="font-family:helvetica;font-size:14pt;">Examples:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 7/8 Bccbxbx 3</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 10/8 Bccbccbxbx 5</p><p style="font-family:helvetica;font-size:14pt;">The number of characters in the pattern_string must match the meter numerator.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure sets how many beats must be present in a partial measure in the ABC to use the custom pattern.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure is optional and defaults to half of the meter numerator rounded down to the next lowest integer (min is 1).</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()});return}n||(ScanTuneForCustomTimingInjection(t),ScanTuneForSwingExplorer(t));var s=GetRadioValue("notenodertab"),g=GetABCJSParams(s);function c(){gSynthControl=null,o&&(o.destroy(),o=null)}g.oneSvgPerLine=!1,"noten"!=s&&g.tablature&&g.tablature.length>0&&(g.tablature[0].label="");var d=new CursorControl;if(gIsIOS){var u=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,u&&(gTheMuteHandle=unmute(u,!1,!1))}!function e(){gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-400)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',isMobileBrowser()?(modal_msg+='<p class="configure_swingexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Swing factor: <input style="width:80px;" id="swing_explorer_factor" type="number" min="-0.9" step="0.05" max=".9" title="Swing factor, range is -0.9 to 0.9" autocomplete="off"/>',modal_msg+='Swing offset (1/8 notes): <input style="width:50px;margin-right:0px;" id="swing_explorer_offset" type="number" min="0" step="1" max="12" title="Swing offset in 1/8 notes" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_swingexplorer_text_mobile" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="swingexplorertest" class="swingexplorertest button btn btn-swingexplorertest" onclick="SwingExplorerRegenerate();" type="button" value="Reload Tune with Changed Swing Settings" title="Reloads the tune into the player with the entered swing factor and offset">',modal_msg+='<input id="swingexplorerinject" class="swingexplorerinject button btn btn-swingexplorerinject" onclick="SwingExplorerInject();" type="button" style="margin-right:0px;" value="Inject Swing into the ABC" title="Injects the current swing factor and offset into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="swingexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#swing_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer">?</a>'):(modal_msg+='<p class="configure_swingexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Swing factor (range is -0.9 to 0.9): <input style="width:90px;" id="swing_explorer_factor" type="number" min="-0.9" step="0.05" max=".9" title="Swing factor, range is -0.9 to 0.9" autocomplete="off"/>',modal_msg+='Swing offset (1/8 notes): <input style="width:60px;margin-right:0px;" id="swing_explorer_offset" type="number" min="0" step="1" max="12" title="Swing offset in 1/8 notes" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_swingexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="swingexplorertest" class="swingexplorertest button btn btn-swingexplorertest" onclick="SwingExplorerRegenerate();" type="button" value="Reload Tune with Changed Swing Settings" title="Reloads the tune into the player with the entered swing factor and offset">',modal_msg+='<input id="swingexplorerinject" class="swingexplorerinject button btn btn-swingexplorerinject" onclick="SwingExplorerInject();" type="button" style="margin-right:0px;" value="Inject Swing into the ABC" title="Injects the current swing factor and offset into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="swingexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#swing_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Swing Explorer">?</a>');var n,a,r,l=window.innerWidth;GetRadioValue("notenodertab");var u=.45*l;isDesktopBrowser()?u<850&&(u=850):u=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:u,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("swing_explorer_factor").value=gSwingFactor,document.getElementById("swing_explorer_offset").value=gSwingOffset;for(var p=document.getElementsByClassName("modal_flat_ok"),m=null,h=0;h<p.length;++h)if("Close"==(m=p[h]).innerText){gTheOKButton=m;var f=m.onclick;m.onclick=function(){f(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(o=new ABCJS.synth.SynthController(t)).load("#playback-audio",d,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",n=!1,o.disable(!0),a=ABCJS.renderAbc("playback-paper",t,g)[0],postProcessTab([a],"playback-paper",s,!0),gMIDIbuffer=r=new ABCJS.synth.CreateSynth(t),r.init({visualObj:a}).then(function(e){if(console.log(e),o){var r=computeFade(t);o.setTune(a,n,{fadeLength:r}).then(function(e){if(console.log("Audio successfully loaded."),gTrainerTouchControls){var t=document.getElementsByClassName("abcjs-midi-clock"),n=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(t&&n&&t.length>0&&n.length>0){gSynthControl=o;var a=t[0];a.onclick=DecrementTempo,(a=n[0]).onclick=IncrementTempo}}}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}var gInstrumentExplorerMelodyInstruments=null,gInstrumentExplorerBassInstruments=null,gInstrumentExplorerChordInstruments=null,gInstrumentExplorerSoundfonts=null;function InstrumentExplorer(){if(gAllowCopy){var e=findSelectedTune();if(""!=e){gPlayerABCInstrumentExplorerOriginal=null,gPlayerABCInstrumentExplorerProcessed=null,gPlayerABCInstrumentExplorerInjected=null,gInstrumentExplorerSoundfonts||(gInstrumentExplorerSoundfonts=(gInstrumentExplorerSoundfonts=InstrumentExplorerBuildDropdown("instrument_explorer_soundfont",soundfontNames)).replace("<select ",'<select style="width:130px;" ')),gInstrumentExplorerMelodyInstruments||(gInstrumentExplorerMelodyInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_melody_program",generalMIDISoundNames)),gInstrumentExplorerBassInstruments||(gInstrumentExplorerBassInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_bass_program",generalMIDISoundNames)),gInstrumentExplorerChordInstruments||(gInstrumentExplorerChordInstruments=InstrumentExplorerBuildDropdown("instrument_explorer_chord_program",generalMIDISoundNames)),ScanTuneForCustomTimingInjection(e),ScanTuneForInstrumentExplorer(e);var t=PreProcessTuneInstrumentExplorer(e);InstrumentExplorerDialog(e,t,!1)}}}function InstrumentExplorerBuildDropdown(e,t){for(var n='<select id="'+e+'" name="'+e+'">\n',o=t.length,a=0;a<o;++a)n+='<option value="'+a+'"> '+t[a]+"</option>";return n+"</select>"}function PreProcessTuneInstrumentExplorer(e){var t=/^%abcjs_soundfont.*[\r\n]*/gm;return e=e.replaceAll(t,""),t=/^%%MIDI program.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI bassprog.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI chordprog.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI bassvol.*[\r\n]*/gm,e=e.replaceAll(t,""),t=/^%%MIDI chordvol.*[\r\n]*/gm,e=e.replaceAll(t,"")}function InstrumentExplorerRegenerate(){gInstrumentExplorerSoundfont=document.getElementById("instrument_explorer_soundfont").value,gInstrumentExplorerMelodyInstrument=document.getElementById("instrument_explorer_melody_program").value,gInstrumentExplorerBassInstrument=document.getElementById("instrument_explorer_bass_program").value,gInstrumentExplorerChordInstrument=document.getElementById("instrument_explorer_chord_program").value;var e=document.getElementById("instrument_explorer_bass_volume").value;e=parseInt(e),isNaN(e)||(gInstrumentExplorerBassVolume=e);var t=document.getElementById("instrument_explorer_chord_volume").value;t=parseInt(t),isNaN(t)||(gInstrumentExplorerChordVolume=t),gTheOKButton.click(),setTimeout(function(){InstrumentExplorerDialog(gPlayerABCInstrumentExplorerOriginal,gPlayerABCInstrumentExplorerProcessed,!0)},250)}function ScanTuneForInstrumentExplorer(e){switch(gDefaultSoundFont){case"https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/":default:gInstrumentExplorerSoundfont="0";break;case"https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/":gInstrumentExplorerSoundfont="1";break;case"https://paulrosen.github.io/midi-js-soundfonts/FatBoy/":gInstrumentExplorerSoundfont="2";break;case"https://michaeleskin.com/abctools/soundfonts/canvas/":gInstrumentExplorerSoundfont="3";break;case"https://michaeleskin.com/abctools/soundfonts/mscore/":gInstrumentExplorerSoundfont="4"}if(gInstrumentExplorerMelodyInstrument=""+(gInstrumentExplorerMelodyInstrument="137"==gTheMelodyProgram?0:parseInt(gTheMelodyProgram)+1),gInstrumentExplorerChordInstrument=""+(gInstrumentExplorerChordInstrument="137"==gTheChordProgram?0:parseInt(gTheChordProgram)+1),gInstrumentExplorerBassInstrument=""+(gInstrumentExplorerBassInstrument="137"==gTheBassProgram?0:parseInt(gTheBassProgram)+1),gInstrumentExplorerBassVolume=gTheBassVolume,gInstrumentExplorerChordVolume=gTheChordVolume,t=/^%abcjs_soundfont.*$/gm,(n=e.match(t))&&n.length>0){var t,n,o=n[n.length-1].replace("%abcjs_soundfont","");if(""!=(o=o.trim()))switch(o){case"fluid":gInstrumentExplorerSoundfont="0";break;case"musyng":gInstrumentExplorerSoundfont="1";break;case"fatboy":gInstrumentExplorerSoundfont="2";break;case"canvas":gInstrumentExplorerSoundfont="3";break;case"mscore":gInstrumentExplorerSoundfont="4"}}if(t=/^%%MIDI program.*$/gm,(n=e.match(t))&&n.length>0){var o=n[0].replace("%%MIDI program","");if(""!=(o=o.trim())){if("mute"==o.toLowerCase())gInstrumentExplorerMelodyInstrument="0";else{var a=parseInt(o);isNaN(a)||(gInstrumentExplorerMelodyInstrument=""+(a+1))}}}if(t=/^%%MIDI bassprog.*$/gm,(n=e.match(t))&&n.length>0){var o=n[0].replace("%%MIDI bassprog","");if(""!=(o=o.trim())){if("mute"==o.toLowerCase())gInstrumentExplorerBassInstrument="0";else{var a=parseInt(o);isNaN(a)||(gInstrumentExplorerBassInstrument=""+(a+1))}}}if(t=/^%%MIDI chordprog.*$/gm,(n=e.match(t))&&n.length>0){var o=n[0].replace("%%MIDI chordprog","");if(""!=(o=o.trim())){if("mute"==o.toLowerCase())gInstrumentExplorerChordInstrument="0";else{var a=parseInt(o);isNaN(a)||(gInstrumentExplorerChordInstrument=""+(a+1))}}}if(t=/^%%MIDI bassvol.*$/gm,(n=e.match(t))&&n.length>0){var o=n[0].replace("%%MIDI bassvol","");if(""!=(o=o.trim())){var a=parseInt(o);isNaN(a)||(gInstrumentExplorerBassVolume=a)}}if(t=/^%%MIDI chordvol.*$/gm,(n=e.match(t))&&n.length>0){var o=n[0].replace("%%MIDI chordvol","");if(""!=(o=o.trim())){var a=parseInt(o);isNaN(a)||(gInstrumentExplorerChordVolume=a)}}}function InstrumentExplorerInject(){gInstrumentExplorerSoundfont=document.getElementById("instrument_explorer_soundfont").value,gInstrumentExplorerMelodyInstrument=document.getElementById("instrument_explorer_melody_program").value,gInstrumentExplorerBassInstrument=document.getElementById("instrument_explorer_bass_program").value,gInstrumentExplorerChordInstrument=document.getElementById("instrument_explorer_chord_program").value;var e=document.getElementById("instrument_explorer_bass_volume").value;e=parseInt(e),isNaN(e)||(gInstrumentExplorerBassVolume=e);var t=document.getElementById("instrument_explorer_chord_volume").value;t=parseInt(t),isNaN(t)||(gInstrumentExplorerChordVolume=t),gPlayerABCInstrumentExplorerInjected=InstrumentExplorerDialogInjectThisTune(gPlayerABCInstrumentExplorerProcessed);var n=gTheABC.selectionStart,o=gTheABC.value;o=o.replace(gPlayerABCInstrumentExplorerOriginal,gPlayerABCInstrumentExplorerInjected),gTheABC.value=o,gIsDirty=!0,gPlayerABCInstrumentExplorerOriginal=gPlayerABCInstrumentExplorerInjected,gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=n,gTheABC.selectionEnd=n,FocusAfterOperation()}):(gTheABC.selectionStart=n,gTheABC.selectionEnd=n,FocusAfterOperation()),DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Instrument Injection Complete!</p>',{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}function InstrumentExplorerDialogInjectThisTune(e){switch(gInstrumentExplorerSoundfont){case"0":default:e=InjectStringBelowTuneHeader(e,"%abcjs_soundfont fluid");break;case"1":e=InjectStringBelowTuneHeader(e,"%abcjs_soundfont musyng");break;case"2":e=InjectStringBelowTuneHeader(e,"%abcjs_soundfont fatboy");break;case"3":e=InjectStringBelowTuneHeader(e,"%abcjs_soundfont canvas");break;case"4":e=InjectStringBelowTuneHeader(e,"%abcjs_soundfont mscore")}if("0"==gInstrumentExplorerMelodyInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI program mute");else{var t=parseInt(gInstrumentExplorerMelodyInstrument)-1;e=InjectStringBelowTuneHeader(e,"%%MIDI program "+t)}if("0"==gInstrumentExplorerBassInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog mute");else{var t=parseInt(gInstrumentExplorerBassInstrument)-1;e=InjectStringBelowTuneHeader(e,"%%MIDI bassprog "+t)}if("0"==gInstrumentExplorerChordInstrument)e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog mute");else{var t=parseInt(gInstrumentExplorerChordInstrument)-1;e=InjectStringBelowTuneHeader(e,"%%MIDI chordprog "+t)}return e=InjectStringBelowTuneHeader(e,"%%MIDI bassvol "+gInstrumentExplorerBassVolume),e=(e=InjectStringBelowTuneHeader(e,"%%MIDI chordvol "+gInstrumentExplorerChordVolume)).replace("\n\n","")}var gInstrumentExplorerSoundfont="0",gInstrumentExplorerMelodyInstrument="0",gInstrumentExplorerBassInstrument="0",gInstrumentExplorerChordInstrument="0",gInstrumentExplorerBassVolume=0,gInstrumentExplorerChordVolume=0,gPlayerABCInstrumentExplorerOriginal=null,gPlayerABCInstrumentExplorerProcessed=null,gPlayerABCInstrumentExplorerInjected=null;function InstrumentExplorerDialog(e,t,n){sendGoogleAnalytics("dialog","InstrumentExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,n||(gPlayerABCInstrumentExplorerOriginal=e,gPlayerABCInstrumentExplorerProcessed=t),gPlayerABCInstrumentExplorerInjected=t=InstrumentExplorerDialogInjectThisTune(gPlayerABCInstrumentExplorerProcessed);var o,a=ScanTuneForSoundFont(t);if(a){var r=gTheActiveSoundFont;switch(a){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FatBoy/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore/"}gTheActiveSoundFont!=r&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});var l=ScanTuneForBoomChick(t);if(""!=l){DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;"><strong>There is an issue with your custom rhythm directive:</strong></p><p style="font-family:helvetica;font-size:14pt;"><strong>'+l+'</strong></p><p style="font-family:helvetica;font-size:14pt;">Format should be:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick meter rhythm_pattern_string partial_measure</p><p style="font-family:helvetica;font-size:14pt;">Valid rhythm_pattern_string characters are:</p><p style="font-family:helvetica;font-size:14pt;">B - Boom, b - Alternate Boom, c - Chick, and x - Silence.</p><p style="font-family:helvetica;font-size:14pt;">Examples:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 7/8 Bccbxbx 3</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 10/8 Bccbccbxbx 5</p><p style="font-family:helvetica;font-size:14pt;">The number of characters in the pattern_string must match the meter numerator.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure sets how many beats must be present in a partial measure in the ABC to use the custom pattern.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure is optional and defaults to half of the meter numerator rounded down to the next lowest integer (min is 1).</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()});return}var s=GetRadioValue("notenodertab"),g=GetABCJSParams(s);function c(){gSynthControl=null,o&&(o.destroy(),o=null)}g.oneSvgPerLine=!1,"noten"!=s&&g.tablature&&g.tablature.length>0&&(g.tablature[0].label="");var d=new CursorControl;if(gIsIOS){var u=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,u&&(gTheMuteHandle=unmute(u,!1,!1))}!function e(){gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-515)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<div class="configure_instrumentexplorer_text" style="text-align:center;margin:0px;margin-top:36px">',modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+="Sound font:"+gInstrumentExplorerSoundfonts+"&nbsp;&nbsp;&nbsp;Melody:"+gInstrumentExplorerMelodyInstruments,modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+="Bass:"+gInstrumentExplorerBassInstruments+"&nbsp;&nbsp;&nbsp;Chords:"+gInstrumentExplorerChordInstruments,modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+='Bass Volume (0-127):&nbsp;&nbsp;<input style="width:90px;" id="instrument_explorer_bass_volume" type="number" min="0" step="1" max="127" title="Bass volume, range is 0-127"  autocomplete="off"/>',modal_msg+='Chord Volume (0-127):&nbsp;&nbsp;<input style="width:90px;" id="instrument_explorer_chord_volume" type="number" min="0" step="1" max="127" title="Chord volume, range is 0-127" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_instrumentexplorer_text">',modal_msg+='<input id="instrumentexplorertest" class="instrumentexplorertest button btn btn-instrumentexplorertest" onclick="InstrumentExplorerRegenerate();" type="button" value="Reload Tune with Changed Instruments and Volumes" title="Reloads the tune into the player with the selected MIDI soundfont, melody instrument, bass instrument, bass volumes, chord instrument, and chord volumes">',modal_msg+='<input id="instrumentexplorerinject" class="instrumentexplorerinject button btn btn-instrumentexplorerinject" onclick="InstrumentExplorerInject();" style="margin-right:0px;" type="button" value="Inject Instruments and Volumes into the ABC" title="Injects the current soundfont, melody instrument, bass instrument, bass volume, chord instrument, and chord volumes into the tune ABC">',modal_msg+="</p>",modal_msg+="</div>",modal_msg+='<a id="instrumentexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#midi_instrument_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the MIDI Instrument Explorer">?</a>';var n,a,r,l=window.innerWidth;GetRadioValue("notenodertab");var u=.45*l;isDesktopBrowser()?u<850&&(u=850):u=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:u,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("instrument_explorer_soundfont").value=gInstrumentExplorerSoundfont,document.getElementById("instrument_explorer_melody_program").value=gInstrumentExplorerMelodyInstrument,document.getElementById("instrument_explorer_bass_program").value=gInstrumentExplorerBassInstrument,document.getElementById("instrument_explorer_chord_program").value=gInstrumentExplorerChordInstrument,document.getElementById("instrument_explorer_bass_volume").value=gInstrumentExplorerBassVolume,document.getElementById("instrument_explorer_chord_volume").value=gInstrumentExplorerChordVolume;for(var p=document.getElementsByClassName("modal_flat_ok"),m=null,h=0;h<p.length;++h)if("Close"==(m=p[h]).innerText){gTheOKButton=m;var f=m.onclick;m.onclick=function(){f(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(o=new ABCJS.synth.SynthController(t)).load("#playback-audio",d,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",n=!1,o.disable(!0),a=ABCJS.renderAbc("playback-paper",t,g)[0],postProcessTab([a],"playback-paper",s,!0),gMIDIbuffer=r=new ABCJS.synth.CreateSynth(t),r.init({visualObj:a}).then(function(e){if(console.log(e),o){var r=computeFade(t);o.setTune(a,n,{fadeLength:r}).then(function(e){if(console.log("Audio successfully loaded."),gTrainerTouchControls){var t=document.getElementsByClassName("abcjs-midi-clock"),n=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(t&&n&&t.length>0&&n.length>0){gSynthControl=o;var a=t[0];a.onclick=DecrementTempo,(a=n[0]).onclick=IncrementTempo}}}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function GraceExplorer(){if(gAllowCopy){var e=findSelectedTune();if(""!=e){ScanTuneForCustomTimingInjection(e);var t=PreProcessPlayABC(e);GraceExplorerDialog(e,t,!1)}}}function GraceExplorerRegenerate(){var e=!1,t=document.getElementById("grace_explorer_duration").value;t=parseFloat(t),!isNaN(t)&&t>=0&&t<=150&&(gGraceDuration=t/1e3,e=!0),e&&(gTheOKButton.click(),setTimeout(function(){GraceExplorerDialog(gPlayerABCGraceExplorerOriginal,gPlayerABCGraceExplorerProcessed,!0)},250))}function ScanTuneForGraceExplorer(e){if(gGraceDuration=.045,t=/^%grace_duration_ms.*$/gm,(n=e.match(t))&&n.length>0){var t,n,o=n[0].replace("%grace_duration_ms",""),a=(o=o.trim()).split(" ");if(a.length>=1){var r=parseFloat(a[0]);!isNaN(r)&&r>=0&&r<=150&&(gGraceDuration=r/1e3)}}}function GraceExplorerInject(){var e=!1,t=document.getElementById("grace_explorer_duration").value;if(t=parseFloat(t),!isNaN(t)&&t>=0&&t<=150&&(e=!0),e){var n="%grace_duration_ms "+t,o=/^%grace_duration_ms.*[\r\n]*/gm,a=gPlayerABCGraceExplorerOriginal.replaceAll(o,""),r=InjectStringBelowTuneHeader(a,n);r=r.replace("\n\n","");var l=gTheABC.selectionStart,s=gTheABC.value;s=s.replace(gPlayerABCGraceExplorerOriginal,r),gTheABC.value=s,gIsDirty=!0,gPlayerABCGraceExplorerOriginal=r,gRawMode?RenderAsync(!0,null,function(){gTheABC.selectionStart=l,gTheABC.selectionEnd=l,FocusAfterOperation()}):(gTheABC.selectionStart=l,gTheABC.selectionEnd=l,FocusAfterOperation()),DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Grace Duration Injection Complete!</p>',{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}}var gPlayerABCGraceExplorerOriginal=null,gPlayerABCGraceExplorerProcessed=null;function GraceExplorerDialog(e,t,n){sendGoogleAnalytics("dialog","GraceExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,n||(gPlayerABCGraceExplorerOriginal=e,gPlayerABCGraceExplorerProcessed=t);var o,a=ScanTuneForSoundFont(t);if(a){var r=gTheActiveSoundFont;switch(a){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FatBoy/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore/"}gTheActiveSoundFont!=r&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});var l=ScanTuneForBoomChick(t);if(""!=l){DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;"><strong>There is an issue with your custom rhythm directive:</strong></p><p style="font-family:helvetica;font-size:14pt;"><strong>'+l+'</strong></p><p style="font-family:helvetica;font-size:14pt;">Format should be:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick meter rhythm_pattern_string partial_measure</p><p style="font-family:helvetica;font-size:14pt;">Valid rhythm_pattern_string characters are:</p><p style="font-family:helvetica;font-size:14pt;">B - Boom, b - Alternate Boom, c - Chick, and x - Silence.</p><p style="font-family:helvetica;font-size:14pt;">Examples:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 7/8 Bccbxbx 3</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 10/8 Bccbccbxbx 5</p><p style="font-family:helvetica;font-size:14pt;">The number of characters in the pattern_string must match the meter numerator.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure sets how many beats must be present in a partial measure in the ABC to use the custom pattern.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure is optional and defaults to half of the meter numerator rounded down to the next lowest integer (min is 1).</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()});return}n||ScanTuneForGraceExplorer(t);var s=GetRadioValue("notenodertab"),g=GetABCJSParams(s);function c(){gSynthControl=null,o&&(o.destroy(),o=null)}g.oneSvgPerLine=!1,"noten"!=s&&g.tablature&&g.tablature.length>0&&(g.tablature[0].label="");var d=new CursorControl;if(gIsIOS){var u=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,u&&(gTheMuteHandle=unmute(u,!1,!1))}!function e(){gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-400)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p class="configure_graceexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='Grace duration in milliseconds (range is 1-150): <input style="width:90px;" id="grace_explorer_duration" type="number" min="0" step="1" max="150" title="Grace duration in milliseconds, range is 1 to 150, 0 disables the custom grace duration feature and uses original abcjs default behavior" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_graceexplorer_text" style="text-align:center;margin:0px;margin-top:22px">',modal_msg+='<input id="graceexplorertest" class="graceexplorertest button btn btn-graceexplorertest" onclick="GraceExplorerRegenerate();" type="button" value="Reload Tune with Changed Grace Duration" title="Reloads the tune into the player with the entered grace duration">',modal_msg+='<input id="graceexplorerinject" class="graceexplorerinject button btn btn-graceexplorerinject" onclick="GraceExplorerInject();" type="button" style="margin-right:0px;" value="Inject Grace Duration into the ABC" title="Injects the current grace duration into the tune ABC">',modal_msg+="</p>",modal_msg+='<a id="graceexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#grace_duration_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Grace Duration Explorer">?</a>';var n,a,r,l=window.innerWidth;GetRadioValue("notenodertab");var u=.45*l;isDesktopBrowser()?u<850&&(u=850):u=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:50,width:u,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("grace_explorer_duration").value=gGraceDuration/.001;for(var p=document.getElementsByClassName("modal_flat_ok"),m=null,h=0;h<p.length;++h)if("Close"==(m=p[h]).innerText){gTheOKButton=m;var f=m.onclick;m.onclick=function(){f(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(o=new ABCJS.synth.SynthController(t)).load("#playback-audio",d,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",n=!1,o.disable(!0),a=ABCJS.renderAbc("playback-paper",t,g)[0],postProcessTab([a],"playback-paper",s,!0),gMIDIbuffer=r=new ABCJS.synth.CreateSynth(t),r.init({visualObj:a}).then(function(e){if(console.log(e),o){var r=computeFade(t);o.setTune(a,n,{fadeLength:r}).then(function(e){if(console.log("Audio successfully loaded."),gTrainerTouchControls){var t=document.getElementsByClassName("abcjs-midi-clock"),n=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(t&&n&&t.length>0&&n.length>0){gSynthControl=o;var a=t[0];a.onclick=DecrementTempo,(a=n[0]).onclick=IncrementTempo}}}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function RollExplorer(){if(gAllowCopy){var e=findSelectedTune();if(""!=e){ScanTuneForCustomTimingInjection(e);var t=PreProcessPlayABC(e);gRollExplorerTransformed=!1,RollExplorerDialog(e,t,!1)}}}function RollParameterIssueAlert(e){var t='<p style="text-align:center;font-size:18pt;font-family:helvetica;">Please Check the Roll Parameters</p>';t+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">There is an issue with the roll parameters</p>',t+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">All values must be positive</p>',t+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The total of the slot sizes for each of the roll styles must be less than 3</p>',t+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The fractions must be between 0 and 1</p>',t+='<p style="font-size:12pt;line-height:18pt;margin-top:20px;text-align:center;">The volumes must be between 0 and 2</p>',DayPilot.Modal.alert(t,{theme:"modal_flat",top:100,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){e&&e()})}function makeRollString(e){var t,n="",o=e.length;for(t=0;t<o;++t)t!=o-1?n+=e[t]+" ":n+=e[t];return n}function RollExplorerValidate(){var e=document.getElementById("roll_2_slot_1").value,t=document.getElementById("roll_2_slot_2").value,n=document.getElementById("roll_2_fraction_1").value,o=document.getElementById("roll_2_fraction_2").value,a=document.getElementById("roll_2_fraction_3").value,r=document.getElementById("roll_2_volume_1").value,l=document.getElementById("roll_2_volume_2").value,s=document.getElementById("roll_2_volume_3").value,g=document.getElementById("roll_3_slot_1").value,c=document.getElementById("roll_3_slot_2").value,d=document.getElementById("roll_3_fraction_1").value,u=document.getElementById("roll_3_fraction_2").value,p=document.getElementById("roll_3_fraction_3").value,m=document.getElementById("roll_3_volume_1").value,h=document.getElementById("roll_3_volume_2").value,f=document.getElementById("roll_3_volume_3").value,T=makeRollString([e,t,n,o,a,r,l,s]),A=makeRollString([g,c,d,u,p,m,h,f]),y=validate_roll_2_params(T,!1),b=validate_roll_3_params(A,!1);return!!y&&!!b&&(y=validate_roll_2_params(T,!0),b=validate_roll_3_params(A,!0),!0)}function RollExplorerTransformReel(e){function t(e){return e.replace(/(~[a-zA-Z])3/g,function(e,t){return t.charAt(1)+t+"2"})}function n(e){return e.replace(/(~[a-zA-Z])3/g,function(e,t){return t+"2"+t.charAt(1)})}gRollExplorerTransformed=!0,e?(gPlayerABCRollExplorerTransformed=n(gPlayerABCRollExplorerOriginal),gPlayerABCRollExplorerProcessed=n(gPlayerABCRollExplorerProcessed)):(gPlayerABCRollExplorerTransformed=t(gPlayerABCRollExplorerOriginal),gPlayerABCRollExplorerProcessed=t(gPlayerABCRollExplorerProcessed)),gTheOKButton.click(),setTimeout(function(){RollExplorerDialog(gPlayerABCRollExplorerTransformed,gPlayerABCRollExplorerProcessed,!0)},250)}function RollExplorerRegenerate(){var e=!1;(e=RollExplorerValidate())?(gTheOKButton.click(),setTimeout(function(){gPlayerABCRollExplorerTransformed?RollExplorerDialog(gPlayerABCRollExplorerTransformed,gPlayerABCRollExplorerProcessed,!0):RollExplorerDialog(gPlayerABCRollExplorerOriginal,gPlayerABCRollExplorerProcessed,!0)},250)):RollParameterIssueAlert(null)}function RollExplorerInject(){if(RollExplorerValidate()){var e,t="%roll_2_params "+gRoll2Duration1+" "+gRoll2Duration2+" "+gRoll2Fraction1+" "+gRoll2Fraction2+" "+gRoll2Fraction3+" "+gRoll2Volume1+" "+gRoll2Volume2+" "+gRoll2Volume3+"\n%roll_3_params "+gRoll3Duration1+" "+gRoll3Duration2+" "+gRoll3Fraction1+" "+gRoll3Fraction2+" "+gRoll3Fraction3+" "+gRoll3Volume1+" "+gRoll3Volume2+" "+gRoll3Volume3,n=/^%roll_2_params.*[\r\n]*/gm;e=gPlayerABCRollExplorerTransformed?gPlayerABCRollExplorerTransformed.replaceAll(n,""):gPlayerABCRollExplorerOriginal.replaceAll(n,""),n=/^%roll_3_params.*[\r\n]*/gm;var o=InjectStringBelowTuneHeader(e=e.replaceAll(n,""),t);o=o.replace("\n\n","");var a=gTheABC.selectionStart,r=gTheABC.value;r=r.replace(gPlayerABCRollExplorerOriginal,o),gTheABC.value=r,gIsDirty=!0,gPlayerABCRollExplorerOriginal=o,gRawMode||gRollExplorerTransformed?RenderAsync(!0,null,function(){gTheABC.selectionStart=a,gTheABC.selectionEnd=a,FocusAfterOperation()}):(gTheABC.selectionStart=a,gTheABC.selectionEnd=a,FocusAfterOperation()),DayPilot.Modal.alert('<p style="text-align:center;font-size:14pt;font-family:helvetica;">Roll Parameter Injection Complete!</p>',{theme:"modal_flat",top:300,width:700,scrollWithPage:AllowDialogsToScroll()})}else RollParameterIssueAlert(null)}function idleRollExplorer(){document.getElementById("roll_2_slot_1").value=gRoll2Duration1,document.getElementById("roll_2_slot_2").value=gRoll2Duration2,document.getElementById("roll_2_fraction_1").value=gRoll2Fraction1,document.getElementById("roll_2_fraction_2").value=gRoll2Fraction2,document.getElementById("roll_2_fraction_3").value=gRoll2Fraction3,document.getElementById("roll_2_volume_1").value=gRoll2Volume1,document.getElementById("roll_2_volume_2").value=gRoll2Volume2,document.getElementById("roll_2_volume_3").value=gRoll2Volume3,document.getElementById("roll_3_slot_1").value=gRoll3Duration1,document.getElementById("roll_3_slot_2").value=gRoll3Duration2,document.getElementById("roll_3_fraction_1").value=gRoll3Fraction1,document.getElementById("roll_3_fraction_2").value=gRoll3Fraction2,document.getElementById("roll_3_fraction_3").value=gRoll3Fraction3,document.getElementById("roll_3_volume_1").value=gRoll3Volume1,document.getElementById("roll_3_volume_2").value=gRoll3Volume2,document.getElementById("roll_3_volume_3").value=gRoll3Volume3}function RollExplorerResetRoll2(){var e;validate_roll_2_params(gRoll2DefaultParams,!0),idleRollExplorer(),RollExplorerRegenerate()}function RollExplorerResetRoll3(){var e;validate_roll_3_params(gRoll3DefaultParams,!0),idleRollExplorer(),RollExplorerRegenerate()}function RollExplorerDefaultRoll2(){var e,t=document.getElementById("roll_2_slot_1").value,n=document.getElementById("roll_2_slot_2").value,o=document.getElementById("roll_2_fraction_1").value,a=document.getElementById("roll_2_fraction_2").value,r=document.getElementById("roll_2_fraction_3").value,l=document.getElementById("roll_2_volume_1").value,s=makeRollString([t,n,o,a,r,l,document.getElementById("roll_2_volume_2").value,document.getElementById("roll_2_volume_3").value]),g=validate_roll_2_params(s,!1);if(g){g=validate_roll_2_params(s,!0),gRoll2DefaultParams=s,SaveConfigurationSettings();var c='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Quarter Note Roll Parameters Set as Tool Default</p>';c+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">You can edit the values in the Advanced Settings dialog.</p>',DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){RollExplorerRegenerate()})}else RollParameterIssueAlert(null)}function RollExplorerDefaultRoll3(){var e,t=document.getElementById("roll_3_slot_1").value,n=document.getElementById("roll_3_slot_2").value,o=document.getElementById("roll_3_fraction_1").value,a=document.getElementById("roll_3_fraction_2").value,r=document.getElementById("roll_3_fraction_3").value,l=document.getElementById("roll_3_volume_1").value,s=makeRollString([t,n,o,a,r,l,document.getElementById("roll_3_volume_2").value,document.getElementById("roll_3_volume_3").value]),g=validate_roll_3_params(s,!1);if(g){g=validate_roll_3_params(s,!0),gRoll3DefaultParams=s,SaveConfigurationSettings();var c='<p style="text-align:center;font-size:14pt;font-family:helvetica;">Dotted Quarter Note Roll Parameters Set as Tool Default</p>';c+='<p style="font-size:12pt;line-height:18pt;margin-top:36px;text-align:center;">You can edit the values in the Advanced Settings dialog.</p>',DayPilot.Modal.alert(c,{theme:"modal_flat",top:200,width:700,scrollWithPage:AllowDialogsToScroll()}).then(function(){RollExplorerRegenerate()})}else RollParameterIssueAlert(null)}var gPlayerABCRollExplorerOriginal=null,gPlayerABCRollExplorerProcessed=null,gPlayerABCRollExplorerTransformed=null,gRollExplorerTransformed=!1;function RollExplorerDialog(e,t,n){sendGoogleAnalytics("dialog","RollExplorerDialog"),gMIDIbuffer=null,gTheOKButton=null,gUseWidePlayer=!1,n||(gPlayerABCRollExplorerOriginal=e,gPlayerABCRollExplorerProcessed=t,gPlayerABCRollExplorerTransformed=null);var o,a=ScanTuneForSoundFont(t);if(a){var r=gTheActiveSoundFont;switch(a){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FatBoy/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore/"}gTheActiveSoundFont!=r&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});var l=ScanTuneForBoomChick(t);if(""!=l){DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;"><strong>There is an issue with your custom rhythm directive:</strong></p><p style="font-family:helvetica;font-size:14pt;"><strong>'+l+'</strong></p><p style="font-family:helvetica;font-size:14pt;">Format should be:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick meter rhythm_pattern_string partial_measure</p><p style="font-family:helvetica;font-size:14pt;">Valid rhythm_pattern_string characters are:</p><p style="font-family:helvetica;font-size:14pt;">B - Boom, b - Alternate Boom, c - Chick, and x - Silence.</p><p style="font-family:helvetica;font-size:14pt;">Examples:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 7/8 Bccbxbx 3</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 10/8 Bccbccbxbx 5</p><p style="font-family:helvetica;font-size:14pt;">The number of characters in the pattern_string must match the meter numerator.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure sets how many beats must be present in a partial measure in the ABC to use the custom pattern.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure is optional and defaults to half of the meter numerator rounded down to the next lowest integer (min is 1).</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()});return}n||ScanTuneForCustomTimingInjection(t);var s=GetRadioValue("notenodertab"),g=GetABCJSParams(s);function c(){gSynthControl=null,o&&(o.destroy(),o=null)}g.oneSvgPerLine=!1,"noten"!=s&&g.tablature&&g.tablature.length>0&&(g.tablature[0].label="");var d=new CursorControl;if(gIsIOS){var u=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,u&&(gTheMuteHandle=unmute(u,!1,!1))}!function e(){gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-650)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p class="configure_rollexplorer_text" style="font-size:14pt;text-align:center;margin:0px;margin-top:15px;margin-left:224px">Quarter Note Roll Parameters<input id="reset_roll_explorer_2" class="button btn btn-reset_roll_explorer_2" onclick="RollExplorerResetRoll2();" type="button" value="Reset" title="Reset quarter note roll parameters to the current tool defaults"><input id="default_roll_explorer_2" class="button btn btn-default_roll_explorer_2" onclick="RollExplorerDefaultRoll2();" type="button" value="Set as Tool Default" title="Makes the current quarter note roll parameters the default for the tool"></p>',modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Slot 1: <input style="width:85px;" id="roll_2_slot_1" title="Quarter note slot 1 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+='Slot 2: <input style="width:85px;" id="roll_2_slot_2" title="Quarter note slot 2 time" autocomplete="off"  type="number" min="0" step="0.05" max="2.95"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Fraction 1: <input style="width:85px;" id="roll_2_fraction_1" title="Quarter note fraction 1" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 2: <input style="width:85px;" id="roll_2_fraction_2" title="Quarter note fraction 2" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 3: <input style="width:85px;" id="roll_2_fraction_3" title="Quarter note fraction 3" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Volume 1: <input style="width:85px;" id="roll_2_volume_1" title="Quarter note volume 1" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 2: <input style="width:85px;" id="roll_2_volume_2" title="Quarter note volume 2" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 3: <input style="width:85px;" id="roll_2_volume_3" title="Quarter note volume 3" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="font-size:14pt;text-align:center;margin:0px;margin-top:10px;margin-left:162px">Dotted Quarter Note Roll Parameters<input id="reset_roll_explorer_3" class="reset_roll_explorer_3 button btn btn-reset_roll_explorer_3" onclick="RollExplorerResetRoll3();" type="button" value="Reset" title="Reset dotted quarter note roll parameters to the current tool defaults"><input id="default_roll_explorer_3" class="button btn btn-default_roll_explorer_3" onclick="RollExplorerDefaultRoll3();" type="button" value="Set as Tool Default" title="Makes the current dotted quarter note roll parameters the default for the tool"></p>',modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Slot 1: <input style="width:85px;" id="roll_3_slot_1" title="Dotted quarter note slot 1 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+='Slot 2: <input style="width:85px;" id="roll_3_slot_2" title="Dotted quarter note slot 2 time" autocomplete="off" type="number" min="0" step="0.05" max="2.95"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Fraction 1: <input style="width:85px;" id="roll_3_fraction_1" title="Dotted quarter note fraction 1" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 2: <input style="width:85px;" id="roll_3_fraction_2" title="Dotted quarter note fraction 2" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+='Fraction 3: <input style="width:85px;" id="roll_3_fraction_3" title="Dotted quarter note fraction 3" autocomplete="off" type="number" min="0" step="0.05" max="1"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:8px">',modal_msg+='Volume 1: <input style="width:85px;" id="roll_3_volume_1" title="Dotted quarter note volume 1" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 2: <input style="width:85px;" id="roll_3_volume_2" title="Dotted quarter note volume 2" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+='Volume 3: <input style="width:85px;" id="roll_3_volume_3" title="Dotted quarter note volume 3" autocomplete="off" type="number" min="0" step="0.05" max="2"/>',modal_msg+="</p>",modal_msg+='<p class="configure_rollexplorer_text" style="text-align:center;margin:0px;margin-top:24px">',modal_msg+='<input id="rollexplorertest" class="rollexplorertest button btn btn-rollexplorertest" onclick="RollExplorerRegenerate();" type="button" value="Reload Tune with Parameters" title="Reloads the tune into the player with the entered roll parameters">',modal_msg+='<input id="rollexplorerinject" class="rollexplorerinject button btn btn-rollexplorerinject" onclick="RollExplorerInject();" type="button" value="Inject Parameters into ABC" title="Injects the current roll parameters and roll transformations into the tune ABC">',modal_msg+='<input id="rollexplorertransform" class="rollexplorertransform button btn btn-rollexplorertransform" onclick="RollExplorerTransformReel(false);" type="button" value="~G3 → G~G2" title="Transforms ~G3 style rolls to G~G2 style, may be useful for creating a better sounding roll for reels">',modal_msg+='<input id="rollexplorertransform2" style="margin-right:0px" class="rollexplorertransform2 button btn btn-rollexplorertransform" onclick="RollExplorerTransformReel(true);" type="button" value="~G3 → ~G2G" title="Transforms ~G3 style rolls to ~G2G style, may be useful for creating a better sounding roll for reels">',modal_msg+="</p>",modal_msg+='<a id="rollexplorerhelp" href="https://michaeleskin.com/abctools/userguide.html#roll_explorer" target="_blank" style="text-decoration:none;" title="Learn more about the Roll Explorer">?</a>';var n,a,r,l=window.innerWidth;GetRadioValue("notenodertab");var u=.45*l;isDesktopBrowser()?u<850&&(u=850):u=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:20,width:u,okText:"Close",scrollWithPage:isMobileBrowser()}),idleRollExplorer();for(var p=document.getElementsByClassName("modal_flat_ok"),m=null,h=0;h<p.length;++h)if("Close"==(m=p[h]).innerText){gTheOKButton=m;var f=m.onclick;m.onclick=function(){f(),c(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(o=new ABCJS.synth.SynthController(t)).load("#playback-audio",d,{displayLoop:!0,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",n=!1,o.disable(!0),a=ABCJS.renderAbc("playback-paper",t,g)[0],postProcessTab([a],"playback-paper",s,!0),gMIDIbuffer=r=new ABCJS.synth.CreateSynth(t),r.init({visualObj:a}).then(function(e){if(console.log(e),o){var r=computeFade(t);o.setTune(a,n,{fadeLength:r}).then(function(e){if(console.log("Audio successfully loaded."),gTrainerTouchControls){var t=document.getElementsByClassName("abcjs-midi-clock"),n=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(t&&n&&t.length>0&&n.length>0){gSynthControl=o;var a=t[0];a.onclick=DecrementTempo,(a=n[0]).onclick=IncrementTempo}}}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}function TuneTrainerLaunchFromPlayer(){gTheOKButton.click(),setTimeout(function(){TuneTrainer(!0)},250)}function TuneTrainer(e){if(gAllowCopy&&""!=(t=e?getTuneByIndex(gPlayABCTuneIndex):findSelectedTune())){gPlayerABCMetronome=null,gUseWidePlayer=!1,ScanTuneForCustomTimingInjection(t),t=ProcessSelectRegionForPlay(t);var t,n=PreProcessPlayABC(t);TuneTrainerDialog(t,n,!1,gUseWidePlayer)}}function TuneTrainerReset(){var e=!1,t=document.getElementById("looper_start_percent").value,n=document.getElementById("looper_end_percent").value,o=document.getElementById("looper_increment").value,a=document.getElementById("looper_count").value;t=parseFloat(t),n=parseFloat(n),o=parseFloat(o),a=parseFloat(a),!isNaN(t)&&!isNaN(n)&&!isNaN(o)&&!isNaN(a)&&t<=n&&t>=0&&n<=400&&o>=0&&a>0&&(gLooperSpeedStart=t,gLooperSpeedEnd=n,gLooperSpeedIncrement=o,gLooperCount=a,gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,e=!0),e?(gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,gPlayMetronome=!1,gLooperMetronomeState=!1,gPlayerABCMetronome=null,gTheOKButton.click(),setTimeout(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)},250)):DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;text-align:center"><strong>Invalid Tune Trainer Values Entered</strong></p><p style="font-family:helvetica;font-size:14pt;margin-top:36px;">All values must be numbers.</p><p style="font-family:helvetica;font-size:14pt;">Starting tempo must be less than the ending tempo.</p><p style="font-family:helvetica;font-size:14pt;">Tempo increment must be greater than zero.</p><p style="font-family:helvetica;font-size:14pt;">Loop count must be greater than zero.</p><p style="font-family:helvetica;font-size:14pt;">Please fix and try again.</p>',{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})}function ToggleTuneTrainerMetronome(){gPlayMetronome=!gPlayMetronome,gTheOKButton.click(),setTimeout(function(){if(gPlayMetronome){if(!gPlayerABCMetronome&&!(gPlayerABCMetronome=inject_one_metronome(gPlayerLooperProcessed,!1))){gLooperMetronomeState=!1,gPlayMetronome=!1;var e='<p style="text-align:center;font-size:20pt;font-family:helvetica">Metronome Not Available for this Meter</p>';e+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">No metronome pattern is available for the meter of this tune.</p>',e+='<p style="font-size:14pt;line-height:20pt;font-family:helvetica;">Only the original version can be played.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}).then(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)});return}gLooperMetronomeState=!0,TuneTrainerDialog(gPlayerLooperOriginal,gPlayerABCMetronome,!0,gUseWidePlayer)}else gLooperMetronomeState=!1,gPlayerABCMetronome=null,TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)},250)}function ToggleTuneTrainerWidePlayer(){gUseWidePlayer=!gUseWidePlayer,gTheOKButton.click(),setTimeout(function(){TuneTrainerDialog(gPlayerLooperOriginal,gPlayerLooperProcessed,!0,gUseWidePlayer)},250)}var gLooperSpeedStart=50,gLooperSpeedEnd=100,gLooperSpeedIncrement=10,gLooperCount=1,gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,gPlayerLooperOriginal=null,gPlayerLooperProcessed=null,gLooperMetronomeState=!1,gTouchIncrementFive=!1;function TuneTrainerDialog(e,t,n,o){sendGoogleAnalytics("dialog","TuneTrainer");var a,r=0,l=0;gMIDIbuffer=null,gTheOKButton=null,n||(gPlayerLooperOriginal=e,gPlayerLooperProcessed=t,gPlayMetronome=!1,gLooperMetronomeState=!1,gPlayerABCMetronome=null),gLooperCurrent=gLooperSpeedStart,gLooperLoopCount=gLooperCount,gLocalStorageAvailable&&(localStorage.LooperSpeedStart=gLooperSpeedStart,localStorage.LooperSpeedEnd=gLooperSpeedEnd,localStorage.LooperSpeedIncrement=gLooperSpeedIncrement,localStorage.LooperCount=gLooperCount);var s=ScanTuneForSoundFont(t);if(s){var g=gTheActiveSoundFont;switch(s){case"fluid":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/";break;case"musyng":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/";break;case"fatboy":gTheActiveSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FatBoy/";break;case"canvas":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/canvas/";break;case"mscore":gTheActiveSoundFont="https://michaeleskin.com/abctools/soundfonts/mscore/"}gTheActiveSoundFont!=g&&(gSoundsCacheABCJS={})}else gTheActiveSoundFont!=gDefaultSoundFont&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={});var c=ScanTuneForBoomChick(t);if(""!=c){DayPilot.Modal.alert('<p style="font-family:helvetica;font-size:14pt;"><strong>There is an issue with your custom rhythm directive:</strong></p><p style="font-family:helvetica;font-size:14pt;"><strong>'+c+'</strong></p><p style="font-family:helvetica;font-size:14pt;">Format should be:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick meter rhythm_pattern_string partial_measure</p><p style="font-family:helvetica;font-size:14pt;">Valid rhythm_pattern_string characters are:</p><p style="font-family:helvetica;font-size:14pt;">B - Boom, b - Alternate Boom, c - Chick, and x - Silence.</p><p style="font-family:helvetica;font-size:14pt;">Examples:</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 7/8 Bccbxbx 3</p><p style="font-family:helvetica;font-size:14pt;">%abcjs_boomchick 10/8 Bccbccbxbx 5</p><p style="font-family:helvetica;font-size:14pt;">The number of characters in the pattern_string must match the meter numerator.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure sets how many beats must be present in a partial measure in the ABC to use the custom pattern.</p><p style="font-family:helvetica;font-size:14pt;">partial_measure is optional and defaults to half of the meter numerator rounded down to the next lowest integer (min is 1).</p>',{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()});return}var d=GetRadioValue("notenodertab"),u=GetABCJSParams(d);function p(){gSynthControl=null,a&&(a.destroy(),a=null)}function m(){if(!(l>r)){if(gLooperSpeedStart==gLooperSpeedEnd||0==gLooperSpeedIncrement){var e=document.getElementById("looperstatusbaroverlay");e.style.display="block",(e=document.getElementById("looperstatusbar")).style.display="block",e.style.width="212px";return}setTimeout(function(){var e=212,t=document.getElementById("looperstatusbaroverlay");t.style.display="block",(t=document.getElementById("looperstatusbar")).style.display="block",e=212*(l/r),t.style.width=e+"px"},10)}}function h(){if(gPlayerInPause)gPlayerInPause=!1;else if(isNaN(gLooperSpeedEnd)||isNaN(gLooperSpeedIncrement)||isNaN(gLooperCount))gPlayerInPause=!1;else{l++;var e=!1;if(gLooperCurrent==gLooperSpeedEnd&&(e=!0),0!=gLooperSpeedIncrement){0==--gLooperLoopCount&&(gLooperLoopCount=gLooperCount,gLooperCurrent!=gLooperSpeedEnd?((gLooperCurrent+=gLooperSpeedIncrement)>=gLooperSpeedEnd&&(gLooperCurrent=gLooperSpeedEnd,e=!0),a.pause(),a.forceWarp(gLooperCurrent)):e=!0);var t=document.getElementById("looperstatus");e?t.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%":gLooperSpeedStart!=gLooperSpeedEnd&&0!=gLooperSpeedIncrement?t.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%&nbsp;&nbsp;-&nbsp;&nbsp;Loop "+(gLooperCount-gLooperLoopCount+1)+" of "+gLooperCount:t.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%",m()}}}function f(){var e=document.getElementById("looperstatus");if(gLooperSpeedStart!=gLooperSpeedEnd&&0!=gLooperSpeedIncrement)e.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%&nbsp;&nbsp;-&nbsp;&nbsp;Loop 1 of "+gLooperCount;else{var e=document.getElementById("looperstatus");e.innerHTML="Tempo:&nbsp;"+gLooperCurrent+"%"}m()}function T(e){var t=this.innerHTML,n=null,o=0;0==t.indexOf("Starting")?(n=document.getElementById("looper_start_percent"),o=0):0==t.indexOf("Ending")?(n=document.getElementById("looper_end_percent"),o=1):0==t.indexOf("Tempo")?(n=document.getElementById("looper_increment"),o=2):0==t.indexOf("Increment")&&(n=document.getElementById("looper_count"),o=3);let a=this.getBoundingClientRect();var r=e.clientX,l=!0,s=1;r-a.left>a.width/2&&(l=!1),3!=o&&gTouchIncrementFive&&(s=5);var g=n.value;switch(o){case 0:case 1:g=parseFloat(g),l?(g-=s)<1&&(g=1):(g+=s)>400&&(g=400);break;case 2:g=parseFloat(g),l?(g-=s)<0&&(g=0):(g+=s)>400&&(g=400);break;case 3:g=parseInt(g),l?(g-=s)<1&&(g=1):(g+=s)>100&&(g=100)}n.value=g}function A(){gTouchIncrementFive=!gTouchIncrementFive}u.oneSvgPerLine=!1,"noten"!=d&&u.tablature&&u.tablature.length>0&&(u.tablature[0].label="");var y=new CursorControl;if(gIsIOS){var b=ABCJS.synth.activeAudioContext();gTheMuteHandle=null,b&&(gTheMuteHandle=unmute(b,!1,!1))}!function e(){gLoopCallback=null,gStartPlayCallback=null,gPlayerInPause=!1,modal_msg='<div id="playerholder" style="height:'+(window.innerHeight-450)+'px;overflow-y:auto;margin-bottom:15px;">',gLargePlayerControls?modal_msg+='<div id="abcplayer" class="abcjs-large">':modal_msg+='<div id="abcplayer">',modal_msg+='<div id="playback-paper"></div>',modal_msg+="</div>",modal_msg+="</div>",gLargePlayerControls?modal_msg+='<div id="playback-audio" class="abcjs-large"></div>':modal_msg+='<div id="playback-audio"></div>',modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span id="looper_text_1">Starting tempo:</span> <input style="width:75px;margin-right:4px;" id="looper_start_percent" type="number" min="1" step="1" max="400" title="Tune tempo start percentage" autocomplete="off"/><span id="looper_percent_span_1">%&nbsp;&nbsp;&nbsp;&nbsp;</span>',modal_msg+='<span id="looper_text_2">Ending tempo:</span> <input style="width:75px;margin-right:4px;" id="looper_end_percent" type="number" min="1" step="1" max="400" title="Tune tempo end percentage" autocomplete="off"/><span id="looper_percent_span_2">%&nbsp;&nbsp;&nbsp;&nbsp;</span>',modal_msg+='<span id="looper_text_3">Tempo increment:</span> <input style="width:75px;margin-right:4px;" id="looper_increment" type="number" min="0" step="1" max="400" title="Tempo increment percentage" autocomplete="off"/><span id="looper_percent_span_3">%</span>',modal_msg+="</p>",modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<span id="looper_text_4">Increment tempo after how many loops:</span> <input style="width:75px;" id="looper_count" type="number" min="1" step="1" max="100" title="Increment tempo after this many times through the tune" autocomplete="off"/>',modal_msg+="</p>",modal_msg+='<p class="configure_looper_text" style="text-align:center;margin:0px;margin-top:20px">',modal_msg+='<input id="looperreset" class="looperreset button btn btn-looperreset" onclick="TuneTrainerReset();" type="button" value="Apply Tune Trainer Settings and Reload the Player" title="Applies the entered tune trainer settings and reloads the player">',modal_msg+='<input id="looper_metronomebutton" class="looper_metronome button btn btn-metronome" onclick="ToggleTuneTrainerMetronome();" type="button" value="Enable Metronome" title="Enables/disables the metronome">',isDesktopBrowser()&&(modal_msg+='<input id="abcplayer_widetrainerbutton" class="abcplayer_widetrainerbutton button btn btn-wide-trainer" onclick="ToggleTuneTrainerWidePlayer();" type="button" value="Wide View" title="Toggles the trainer between normal and wide views">'),modal_msg+="</p>",modal_msg+='<a id="looperhelp" href="https://michaeleskin.com/abctools/userguide.html#tune_trainer" target="_blank" style="text-decoration:none;" title="Learn more about the Tune Trainer">?</a>',modal_msg+='<p id="looperstatus"></p>',modal_msg+='<div id="looperstatusbar"></div>',modal_msg+='<div id="looperstatusbaroverlay"></div>';var n,l,s,g,c,m=window.innerWidth;if(GetRadioValue("notenodertab"),isDesktopBrowser()?(l=calc_wide_play_width(250),(n=o?l:.45*m)<850&&(n=850)):n=800,DayPilot.Modal.alert(modal_msg,{theme:"modal_flat",top:45,width:n,okText:"Close",scrollWithPage:isMobileBrowser()}),document.getElementById("looper_start_percent").value=gLooperSpeedStart,document.getElementById("looper_end_percent").value=gLooperSpeedEnd,document.getElementById("looper_increment").value=gLooperSpeedIncrement,document.getElementById("looper_count").value=gLooperCount,gTrainerTouchControls&&(document.getElementById("looper_text_1").onclick=T,document.getElementById("looper_text_2").onclick=T,document.getElementById("looper_text_3").onclick=T,document.getElementById("looper_text_4").onclick=T,document.getElementById("looper_percent_span_1").onclick=A,document.getElementById("looper_percent_span_2").onclick=A,document.getElementById("looper_percent_span_3").onclick=A),r=function e(){if(gLooperSpeedStart==gLooperSpeedEnd||0==gLooperSpeedIncrement)return 1;for(var t=0,n=gLooperSpeedEnd,o=gLooperSpeedIncrement,a=gLooperCount,r=gLooperSpeedStart;r<n;)t+=a,r+=o;return t}(),gLooperMetronomeState){var b=document.getElementById("looper_metronomebutton");b.value="Disable Metronome"}else{var b=document.getElementById("looper_metronomebutton");b.value="Enable Metronome"}if(isDesktopBrowser()){if(!o&&l<=n)document.getElementById("abcplayer_widetrainerbutton").style.display="none";else if(o&&!0==o){var b=document.getElementById("abcplayer_widetrainerbutton");b.value="Normal View"}}for(var I=document.getElementsByClassName("modal_flat_ok"),v=null,C=0;C<I.length;++C)if("Close"==(v=I[C]).innerText){gTheOKButton=v;var S=v.onclick;v.onclick=function(){S(),p(),FocusAfterOperation(),gIsIOS&&gTheMuteHandle&&(gTheMuteHandle.dispose(),gTheMuteHandle=null)};break}ABCJS.synth.supportsAudio()?(a=new ABCJS.synth.SynthController(t)).load("#playback-audio",y,{displayLoop:!1,displayRestart:!0,displayPlay:!0,displayProgress:!0,displayWarp:!0}):document.querySelector("#playback-audio").innerHTML="<div class='audio-error'>Audio is not supported in this browser.</div>",s=!1,a.disable(!0),g=ABCJS.renderAbc("playback-paper",t,u)[0],postProcessTab([g],"playback-paper",d,!0),gMIDIbuffer=c=new ABCJS.synth.CreateSynth(t),c.init({visualObj:g}).then(function(e){if(console.log(e),a){var n=computeFade(t);a.setTune(g,s,{fadeLength:n}).then(function(e){if(console.log("Audio successfully loaded."),a.forceWarp(gLooperCurrent),a.isLooping=!0,gLoopCallback=h,gStartPlayCallback=f,gTrainerTouchControls){var t=document.getElementsByClassName("abcjs-midi-clock"),n=document.getElementsByClassName("abcjs-midi-current-tempo-wrapper");if(t&&n&&t.length>0&&n.length>0){gSynthControl=a;var o=t[0];o.onclick=DecrementTempo,(o=n[0]).onclick=IncrementTempo}}}).catch(function(e){console.log("Problem loading audio for this tune")})}}).catch(function(e){console.log("Problem loading audio for this tune")}),gPlayerContainerRect=(gPlayerHolder=document.getElementById("playerholder")).getBoundingClientRect()}()}var gSynthControl=null;function DecrementTempo(){var e=document.getElementsByClassName("abcjs-midi-tempo");if(e&&e.length>0){var t=e[0],n=t.value;n=parseInt(n),!isNaN(n)&&n>5&&(n-=5,t.value=n,gSynthControl.pause(),gSynthControl.forceWarp(n))}}function IncrementTempo(){var e=document.getElementsByClassName("abcjs-midi-tempo");if(e&&e.length>0){var t=e[0],n=t.value;n=parseInt(n),isNaN(n)||(n+=5,t.value=n,gSynthControl.pause(),gSynthControl.forceWarp(n))}}var gAlwaysInjectPrograms=!0,gTheMelodyProgram=0,gTheBassProgram=0,gTheChordProgram=0,gAlwaysInjectVolumes=!0,gTheBassVolume=64,gTheChordVolume=64,gOverridePlayMIDIParams=!1,gInjectTab_StripChords=!0,gInjectTab_FontFamily="Palatino",gInjectTab_TabFontSize=11,gInjectTab_StaffSep=80,gInjectTab_MusicSpace=10,gInjectTab_TabLocation=1,gInjectTab_ConcertinaStyle=0,gInjectTab_ConcertinaFingering=0,gInjectTab_GaryCoover=!1,gInjectTab_PushGlyph="↓",gInjectTab_DrawGlyph="↑",gInjectTab_UseBarForDraw=!1,gLargePlayerControls=!1,gTrainerTouchControls=!1,gBambooFluteKey=1,gMDulcimerStyle=0,gMDulcimerStripBadTunes=!1,gMDulcimerUseDashForOpenString=!1;function GetInitialConfigurationSettings(){var e=localStorage.AlwaysInjectPrograms;gAlwaysInjectPrograms=!e||"true"==e,gTheMelodyProgram=(e=localStorage.TheMelodyProgram)?e:0,gTheBassProgram=(e=localStorage.TheBassProgram)?e:0,gTheChordProgram=(e=localStorage.TheChordProgram)?e:0,gAlwaysInjectVolumes=!(e=localStorage.AlwaysInjectVolumes)||"true"==e,gTheBassVolume=(e=localStorage.TheBassVolume)?e:64,gTheChordVolume=(e=localStorage.TheChordVolume)?e:64,gOverridePlayMIDIParams=!!(e=localStorage.OverridePlayMIDIParams)&&"true"==e,gInjectTab_FontFamily=(e=localStorage.InjectTab_FontFamily)?e:"Palatino",gInjectTab_TabFontSize=(e=localStorage.InjectTab_TabFontSize)?e:10,gInjectTab_StaffSep=(e=localStorage.InjectTab_StaffSep)?e:80,gInjectTab_MusicSpace=(e=localStorage.InjectTab_MusicSpace)?e:10,gInjectTab_TabLocation=(e=localStorage.InjectTab_TabLocation)?e:1,gInjectTab_ConcertinaStyle=(e=localStorage.InjectTab_ConcertinaStyle)?e:0,gInjectTab_ConcertinaFingering=(e=localStorage.InjectTab_ConcertinaFingering)?e:1,gInjectTab_GaryCoover=!!(e=localStorage.InjectTab_GaryCoover)&&"true"==e,gInjectTab_StripChords=!(e=localStorage.InjectTab_StripChords)||"true"==e,gInjectTab_PushGlyph=(e=localStorage.InjectTab_PushGlyph)?e:"↓",gInjectTab_DrawGlyph=(e=localStorage.InjectTab_DrawGlyph)?e:"↑",gInjectTab_UseBarForDraw=!!(e=localStorage.InjectTab_UseBarForDraw)&&"true"==e,gFullScreenScaling=(e=localStorage.FullScreenScaling)?e:50;var t=localStorage.angloButtonNames;t?gAngloButtonNames=JSON.parse(t):resetAngloButtonNames();var n=localStorage.musicXMLImportOptionsV4;n?gMusicXMLImportOptions=JSON.parse(n):resetMusicXMLImportOptions(),gLargePlayerControls=(e=localStorage.LargePlayerControls)?"true"==e:!!gIsIPhone||!!gIsAndroid,gTrainerTouchControls=(e=localStorage.TrainerTouchControls)?"true"==e:!!gIsIPhone||!!gIsAndroid||!!gIsIPad,gBambooFluteKey=(e=localStorage.BambooFluteKey)?e:1,gMDulcimerStyle=(e=localStorage.MDulcimerStyle)?e:0,gMDulcimerStripBadTunes=!!(e=localStorage.MDulcimerStripBadTunes)&&"true"==e,gMDulcimerUseDashForOpenString=!!(e=localStorage.MDulcimerUseDashForOpenString)&&"true"==e;var o=localStorage.RenderingFonts;if(o)try{(gRenderingFonts=JSON.parse(o)).tablabelfont||(gRenderingFonts.tablabelfont="Trebuchet MS 14"),gRenderingFonts.tabgracefont||(gRenderingFonts.tabgracefont="Arial 8")}catch(a){resetABCRenderingFonts()}else resetABCRenderingFonts();var r=localStorage.abcShowTabNames;if(gShowTabNames=!r||"true"==r,gCapo=(e=localStorage.abcCapo)?e:0,gMP3Bitrate=(e=localStorage.MP3Bitrate)?e:224,(e=localStorage.theSoundFont)?(gDefaultSoundFont=e,gTheActiveSoundFont=e):gTheActiveSoundFont=gDefaultSoundFont="https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/",gAutoscrollPlayer=!(e=localStorage.AutoscrollPlayer)||"true"==e,gAutoSwingHornpipes=!(e=localStorage.AutoSwingHornpipes)||"true"==e,e=localStorage.AutoSwingFactor){var l=parseFloat(e);isNaN(l)||(gAutoSwingFactor=l)}else gAutoSwingFactor=.25;gUseCustomGMSounds=!(e=localStorage.UseCustomGMSounds)||"true"==e,gTipJarCount=(e=localStorage.TipJarCount)?e:0,(e=localStorage.SavedSnapshot)||(localStorage.SavedSnapshot=""),gSaveLastAutoSnapShot=!!(e=localStorage.SaveLastAutoSnapShot)&&"true"==e,(e=localStorage.LastAutoSnapShot)||(localStorage.LastAutoSnapShot=""),(e=localStorage.PDFFont)&&(gPDFFont=e),(e=localStorage.PDFFontStyle)&&(gPDFFontStyle=e),(e=localStorage.PDFOrientation)&&(gPDFOrientation=e),(e=localStorage.UseComhaltasABC)&&(gUseComhaltasABC="true"==e),(e=localStorage.AllowMIDIInput)&&(gAllowMIDIInput="true"==e);var s=localStorage.PDFTunebookConfig;if(s?(void 0==(gPDFTunebookConfig=JSON.parse(s)).bAdd_add_full_tunebook||null==gPDFTunebookConfig.bAdd_add_full_tunebook)&&(gPDFTunebookConfig.bAdd_add_full_tunebook=!1):resetPDFTunebookConfig(),(e=localStorage.LooperSpeedStart)?(gLooperSpeedStart=parseFloat(e),isNaN(gLooperSpeedStart)&&(gLooperSpeedStart=50)):gLooperSpeedStart=50,(e=localStorage.LooperSpeedEnd)?(gLooperSpeedEnd=parseFloat(e),isNaN(gLooperSpeedEnd)&&(gLooperSpeedEnd=100)):gLooperSpeedEnd=100,(e=localStorage.LooperSpeedIncrement)?(gLooperSpeedIncrement=parseFloat(e),isNaN(gLooperSpeedIncrement)&&(gLooperSpeedIncrement=10)):gLooperSpeedIncrement=10,(e=localStorage.LooperCount)?(gLooperCount=parseInt(e),isNaN(gLooperCount)&&(gLooperCount=1)):gLooperCount=1,e=localStorage.abcStaffSpacing)gStaffSpacing=STAFFSPACEOFFSET+parseInt(e);else{var g=(gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT)-STAFFSPACEOFFSET;localStorage.abcStaffSpacing=g}if((e=localStorage.BatchExportDelayMS)?(gBatchExportDelayMS=parseInt(e),(isNaN(gBatchExportDelayMS)||gBatchExportDelayMS<0)&&(gBatchExportDelayMS=200)):gBatchExportDelayMS=200,(e=localStorage.BatchMP3ExportDelayMS)?(gBatchMP3ExportDelayMS=parseInt(e),(isNaN(gBatchMP3ExportDelayMS)||gBatchMP3ExportDelayMS<0)&&(gBatchMP3ExportDelayMS=250)):gBatchMP3ExportDelayMS=250,(e=localStorage.ExportWidth)?(gExportWidth=parseInt(e),(isNaN(gExportWidth)||gExportWidth<0)&&(gExportWidth=2400)):gExportWidth=2400,(e=localStorage.ExportWidthAll)?(gExportWidthAll=parseInt(e),(isNaN(gExportWidthAll)||gExportWidthAll<0)&&(gExportWidthAll=2400)):gExportWidthAll=2400,(e=localStorage.MetronomeVolume)?(gMetronomeVolume=parseInt(e),(isNaN(gMetronomeVolume)||gMetronomeVolume<0||gMetronomeVolume>127)&&(gMetronomeVolume=48)):gMetronomeVolume=48,gRawFirstTime=!0,(e=localStorage.RawFirstTime)&&(gRawFirstTime="true"==e),gRawHighlightColor="#F00000",(e=localStorage.RawHighlightColor)&&(gRawHighlightColor=e),gForceLeftJustifyTitles=!1,(e=localStorage.ForceLeftJustifyTitles)&&(gForceLeftJustifyTitles="true"==e),gPlayerStatusOnLeft=!1,(e=localStorage.PlayerStatusOnLeft)&&(gPlayerStatusOnLeft="true"==e),gDisableSelectedPlay=!1,(e=localStorage.DisableSelectedPlay)&&(gDisableSelectedPlay="true"==e),gRollUseRollForIrishRoll=!1,(e=localStorage.RollUseRollForIrishRoll)&&(gRollUseRollForIrishRoll="true"==e),gRoll2DefaultParams="0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0",e=localStorage.Roll2DefaultParams){var c=validate_roll_2_params(e,!1);c&&(gRoll2DefaultParams=e,c=validate_roll_2_params(e,!0))}if(gRoll3DefaultParams="1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0",e=localStorage.Roll3DefaultParams){var c=validate_roll_3_params(e,!1);c&&(gRoll3DefaultParams=e,c=validate_roll_3_params(e,!0))}gDefaultTuneDatabase=0,(e=localStorage.DefaultTuneDatabase)&&(gDefaultTuneDatabase=parseInt(e)),gTuneDatabaseRetryTimeMS=3e3,(e=localStorage.TuneDatabaseRetryTimeMS)&&(gTuneDatabaseRetryTimeMS=parseInt(e)),gTuneDatabaseRetryCount=10,(e=localStorage.TuneDatabaseRetryCount)&&(gTuneDatabaseRetryCount=parseInt(e)),gShapeNoteStyle=0,(e=localStorage.ShapeNoteStyle)&&(gShapeNoteStyle=e),gFeaturesShowSearch=!0,(e=localStorage.FeaturesShowSearch)&&(gFeaturesShowSearch="true"==e),gFeaturesShowExamples=!0,(e=localStorage.FeaturesShowExamples)&&(gFeaturesShowExamples="true"==e),gFeaturesShowTemplates=!0,(e=localStorage.FeaturesShowTemplates)&&(gFeaturesShowTemplates="true"==e),gFeaturesShowTablatures=!0,(e=localStorage.FeaturesShowTablatures)&&(gFeaturesShowTablatures="true"==e),gFeaturesShowExplorers=!0,(e=localStorage.FeaturesShowExplorers)&&(gFeaturesShowExplorers="true"==e),gFeaturesShowExport=!0,(e=localStorage.FeaturesShowExport)&&(gFeaturesShowExport="true"==e),gFeaturesShowTabButtons=!0,(e=localStorage.FeaturesShowTabButtons)&&(gFeaturesShowTabButtons="true"==e),SaveConfigurationSettings()}function SaveConfigurationSettings(){gLocalStorageAvailable&&(localStorage.AlwaysInjectPrograms=gAlwaysInjectPrograms,localStorage.TheMelodyProgram=gTheMelodyProgram,localStorage.TheBassProgram=gTheBassProgram,localStorage.TheChordProgram=gTheChordProgram,localStorage.AlwaysInjectVolumes=gAlwaysInjectVolumes,localStorage.TheBassVolume=gTheBassVolume,localStorage.TheChordVolume=gTheChordVolume,localStorage.OverridePlayMIDIParams=gOverridePlayMIDIParams,localStorage.InjectTab_StripChords=gInjectTab_StripChords,localStorage.InjectTab_FontFamily=gInjectTab_FontFamily,localStorage.InjectTab_TabFontSize=gInjectTab_TabFontSize,localStorage.InjectTab_StaffSep=gInjectTab_StaffSep,localStorage.InjectTab_MusicSpace=gInjectTab_MusicSpace,localStorage.InjectTab_TabLocation=gInjectTab_TabLocation,localStorage.InjectTab_ConcertinaStyle=gInjectTab_ConcertinaStyle,localStorage.InjectTab_ConcertinaFingering=gInjectTab_ConcertinaFingering,localStorage.InjectTab_GaryCoover=gInjectTab_GaryCoover,localStorage.InjectTab_PushGlyph=gInjectTab_PushGlyph,localStorage.InjectTab_DrawGlyph=gInjectTab_DrawGlyph,localStorage.InjectTab_UseBarForDraw=gInjectTab_UseBarForDraw,localStorage.FullScreenScaling=gFullScreenScaling,localStorage.angloButtonNames=JSON.stringify(gAngloButtonNames),localStorage.musicXMLImportOptionsV4=JSON.stringify(gMusicXMLImportOptions),localStorage.LargePlayerControls=gLargePlayerControls,localStorage.TrainerTouchControls=gTrainerTouchControls,localStorage.BambooFluteKey=gBambooFluteKey,localStorage.MDulcimerStyle=gMDulcimerStyle,localStorage.MDulcimerStripBadTunes=gMDulcimerStripBadTunes,localStorage.MDulcimerUseDashForOpenString=gMDulcimerUseDashForOpenString,localStorage.RenderingFonts=JSON.stringify(gRenderingFonts),gShowTabNames?localStorage.abcShowTabNames="true":localStorage.abcShowTabNames="false",localStorage.abcCapo=gCapo,localStorage.MP3Bitrate=gMP3Bitrate,localStorage.theSoundFont=gDefaultSoundFont,localStorage.AutoscrollPlayer=gAutoscrollPlayer,localStorage.AutoSwingHornpipes=gAutoSwingHornpipes,localStorage.AutoSwingFactor=gAutoSwingFactor,localStorage.UseCustomGMSounds=gUseCustomGMSounds,localStorage.TipJarCount=gTipJarCount,localStorage.SaveLastAutoSnapShot=gSaveLastAutoSnapShot,localStorage.PDFFont=gPDFFont,localStorage.PDFFontStyle=gPDFFontStyle,localStorage.UseComhaltasABC=gUseComhaltasABC,localStorage.AllowMIDIInput=gAllowMIDIInput,localStorage.PDFTunebookConfig=JSON.stringify(gPDFTunebookConfig),localStorage.LooperSpeedStart=gLooperSpeedStart,localStorage.LooperSpeedEnd=gLooperSpeedEnd,localStorage.LooperSpeedIncrement=gLooperSpeedIncrement,localStorage.LooperCount=gLooperCount,localStorage.BatchExportDelayMS=gBatchExportDelayMS,localStorage.BatchMP3ExportDelayMS=gBatchMP3ExportDelayMS,localStorage.ExportWidth=gExportWidth,localStorage.ExportWidthAll=gExportWidthAll,localStorage.MetronomeVolume=gMetronomeVolume,localStorage.RawFirstTime=gRawFirstTime,localStorage.RawHighlightColor=gRawHighlightColor,localStorage.ForceLeftJustifyTitles=gForceLeftJustifyTitles,localStorage.PlayerStatusOnLeft=gPlayerStatusOnLeft,localStorage.RollUseRollForIrishRoll=gRollUseRollForIrishRoll,localStorage.Roll2DefaultParams=gRoll2DefaultParams,localStorage.Roll3DefaultParams=gRoll3DefaultParams,localStorage.DefaultTuneDatabase=gDefaultTuneDatabase,localStorage.TuneDatabaseRetryTimeMS=gTuneDatabaseRetryTimeMS,localStorage.TuneDatabaseRetryCount=gTuneDatabaseRetryCount,localStorage.ShapeNoteStyle=gShapeNoteStyle,localStorage.DisableSelectedPlay=gDisableSelectedPlay,localStorage.FeaturesShowSearch=gFeaturesShowSearch,localStorage.FeaturesShowExamples=gFeaturesShowExamples,localStorage.FeaturesShowTemplates=gFeaturesShowTemplates,localStorage.FeaturesShowTablatures=gFeaturesShowTablatures,localStorage.FeaturesShowExplorers=gFeaturesShowExplorers,localStorage.FeaturesShowExport=gFeaturesShowExport,localStorage.FeaturesShowTabButtons=gFeaturesShowTabButtons)}var gMusicXMLImportOptions={};function resetMusicXMLImportOptions(){gMusicXMLImportOptions={b:4,n:0,c:0,v:0,d:4,x:1,noped:0,p:"",v1:0,stm:0,s:0,t:0,u:0,v:0,v1:0,mnum:-1,m:1,addq:1,q:100,addstavenum:1}}function setMusicXMLOptions(){gMusicXMLImportOptions.u=$("#musicxml_unfld").prop("checked")?1:0,gMusicXMLImportOptions.b=parseInt($("#musicxml_bpl").val()||4),gMusicXMLImportOptions.n=parseInt($("#musicxml_cpl").val()||0),gMusicXMLImportOptions.c=parseInt($("#musicxml_crf").val()||0),gMusicXMLImportOptions.d=parseInt($("#musicxml_den").val()||4),gMusicXMLImportOptions.m=parseInt($("#musicxml_midi").val()||0),gMusicXMLImportOptions.x=$("#musicxml_nlb").prop("checked")?1:0,gMusicXMLImportOptions.noped=$("#musicxml_noped").prop("checked")?1:0,gMusicXMLImportOptions.v1=$("#musicxml_v1").prop("checked")?1:0,gMusicXMLImportOptions.stm=$("#musicxml_stems").prop("checked")?1:0,gMusicXMLImportOptions.mnum=parseInt($("#musicxml_mnum").val()||-1),gMusicXMLImportOptions.addq=$("#musicxml_addq").prop("checked")?1:0,gMusicXMLImportOptions.q=parseInt($("#musicxml_q").val()||100),gMusicXMLImportOptions.addstavenum=$("#musicxml_addstavenum").prop("checked")?1:0}function idleXMLImport(){$("#musicxml_unfld").prop("checked",1==gMusicXMLImportOptions.u),$("#musicxml_bpl").val(gMusicXMLImportOptions.b),$("#musicxml_cpl").val(gMusicXMLImportOptions.n),$("#musicxml_crf").val(gMusicXMLImportOptions.c),$("#musicxml_den").val(gMusicXMLImportOptions.d),$("#musicxml_midi").val(gMusicXMLImportOptions.m),$("#musicxml_nlb").prop("checked",1==gMusicXMLImportOptions.x),$("#musicxml_noped").prop("checked",1==gMusicXMLImportOptions.noped),$("#musicxml_v1").prop("checked",1==gMusicXMLImportOptions.v1),$("#musicxml_stems").prop("checked",1==gMusicXMLImportOptions.stm),$("#musicxml_mnum").val(gMusicXMLImportOptions.mnum),$("#musicxml_addq").prop("checked",1==gMusicXMLImportOptions.addq),$("#musicxml_q").val(gMusicXMLImportOptions.q),$("#musicxml_addstavenum").prop("checked",1==gMusicXMLImportOptions.addstavenum)}function defaultMusicXMLSettings(){sendGoogleAnalytics("action","defaultMusicXMLSettings");var e="Are you sure you want to reset the MusicXML import options to their default values?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||(resetMusicXMLImportOptions(),idleXMLImport())})}function ConfigureMusicXMLImport(){sendGoogleAnalytics("dialog","ConfigureMusicXMLImport");var e=JSON.parse(JSON.stringify(gMusicXMLImportOptions)),t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Configure MusicXML Import&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#musicxml" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></p>';t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Bars-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_bpl" type="text" pattern="d+" title="Default: 3"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Characters-per-line:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_cpl" type="text" pattern="d+" title="Default: 0 - ignore"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Measure numbers:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_mnum" type="text" pattern="d+" title="-1: No measure numbers, 1..n: Number every n-th measure, 0: Number every system"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Include measure numbers at end of staves:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_addstavenum" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Unfold repeats:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_unfld" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Credit text filter (level 0-6):&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_crf" type="text" pattern="[0123456]" title="0 (Default), 1, 2, 3, 4, 5, 6"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Denominator unit length for L: tags:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_den" type="text" pattern="dd?" title="0 (Automatic), 1, 2, 4, 8, 16, or 32"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">%%MIDI options:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_midi" type="text" pattern="[012]" title="0: No MIDI, 1: Only program, 2: All MIDI"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No score line breaks:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_nlb" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">No pedal directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_noped" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">All directions to first voice:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_v1" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Translate stem directions:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_stems" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Inject Q: tag if not present:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" id="musicxml_addq" type="checkbox"/></div>\n',t+='<div style="margin-bottom:12px;"><label style="font-size:12pt;font-family:helvetica;">Q: tag value to inject:&nbsp;&nbsp;</label><input onchange="setMusicXMLOptions()" style="width:60px;" id="musicxml_q" type="text" pattern="d+" title="Default: 100"/></div>\n',t+='<p style="text-align:center;margin-top:22px;"><input id="default_musicxml_settings" class="btn btn-clearbutton default_musicxml_settings" onclick="defaultMusicXMLSettings()" type="button" value="Reset to Default" title="Reset the MusicXML import settings to their default values"></p>\n';let n=[{html:t}];setTimeout(function(){idleXMLImport()},150),DayPilot.Modal.form(n,{},{theme:"modal_flat",top:50,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled?gMusicXMLImportOptions=e:gLocalStorageAvailable&&(localStorage.musicXMLImportOptionsV4=JSON.stringify(gMusicXMLImportOptions))})}function resetAngloButtonNames(){gAngloButtonNames=["L1a","L2a","L3a","L4a","L5a","R1a","R2a","R3a","R4a","R5a","L1","L2","L3","L4","L5","R1","R2","R3","R4","R5","L6","L7","L8","L9","L10","R6","R7","R8","R9","R10"]}function defaultAngloButtonNames(){sendGoogleAnalytics("action","defaultAngloButtonNames");var e="Are you sure you want to reset the Anglo Concertina button names to their default values?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){if(!e.canceled){var t;for(resetAngloButtonNames(),t=0;t<10;++t){var n="r1c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t]}for(t=0;t<10;++t){var n="r2c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t+10]}for(t=0;t<10;++t){var n="r3c"+(t+1);document.getElementById(n).value=gAngloButtonNames[t+20]}}})}function initAngloButtonNames(){var e;for(e=0;e<10;++e){var t="r1c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e]}for(e=0;e<10;++e){var t="r2c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e+10]}for(e=0;e<10;++e){var t="r3c"+(e+1);document.getElementById(t).value=gAngloButtonNames[e+20]}}function angloFingeringsChangeHandler(){var e;for(e=0;e<10;++e){var t="r1c"+(e+1);gAngloButtonNames[e]=document.getElementById(t).value}for(e=0;e<10;++e){var t="r2c"+(e+1);gAngloButtonNames[e+10]=document.getElementById(t).value}for(e=0;e<10;++e){var t="r3c"+(e+1);gAngloButtonNames[e+20]=document.getElementById(t).value}for(e=0;e<30;++e)""==gAngloButtonNames[e]&&(gAngloButtonNames[e]=" ")}function ConfigureAngloFingerings(){sendGoogleAnalytics("dialog","ConfigureAngloFingerings");var e=gAngloButtonNames.slice(),t='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Configure Anglo Concertina Tablature Button Names&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#injecting_box_or_anglo_concertina_tablature" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>';t+='<div id="anglo-button-names-dialog">',t+='<table style="margin-bottom:24px;text-align:center;">\n',t+="<tr>\n",t+='<td><input class="anglobuttonnames" type="text" id="r1c1" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c2" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c3" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c4" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c5" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c7" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c8" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c9" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r1c10" onchange="angloFingeringsChangeHandler()"></td>\n',t+="</tr>\n",t+="<tr>\n",t+='<td><input class="anglobuttonnames" type="text" id="r2c1" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c2" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c3" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c4" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c5" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c7" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c8" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c9" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r2c10" onchange="angloFingeringsChangeHandler()"></td>\n',t+="</tr>\n",t+="<tr>\n",t+='<td><input class="anglobuttonnames" type="text" id="r3c1" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c2" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c3" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c4" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c5" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c6" style="margin-left:36px" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c7" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c8" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c9" onchange="angloFingeringsChangeHandler()"></td>\n',t+='<td><input class="anglobuttonnames" type="text" id="r3c10" onchange="angloFingeringsChangeHandler()"></td>\n',t+="</tr>\n",t+="</table>\n",t+="</div>\n",t+='<p style="text-align:center;margin-top:22px;"><input id="default_anglo_fingerings" class="btn btn-clearbutton default_anglo_fingerings" onclick="defaultAngloButtonNames()" type="button" value="Reset to Default" title="Reset the Anglo Concertina button names to their default values"></p>\n';let n=[{html:t}];setTimeout(function(){initAngloButtonNames()},150),DayPilot.Modal.form(n,{},{theme:"modal_flat",top:160,width:800,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(t){t.canceled?gAngloButtonNames=e:gLocalStorageAvailable&&(localStorage.angloButtonNames=JSON.stringify(gAngloButtonNames))})}function ConfigureTablatureSettings(){sendGoogleAnalytics("dialog","ConfigureTablatureSettings");let e={configure_font_family:gInjectTab_FontFamily,configure_tab_font_size:gInjectTab_TabFontSize,configure_staffsep:gInjectTab_StaffSep,configure_musicspace:gInjectTab_MusicSpace,configure_tab_location:parseInt(gInjectTab_TabLocation),configure_concertina_style:parseInt(gInjectTab_ConcertinaStyle),configure_concertina_fingering:parseInt(gInjectTab_ConcertinaFingering),configure_strip_chords:gInjectTab_StripChords,configure_pushglyph:gInjectTab_PushGlyph,configure_drawglyph:gInjectTab_DrawGlyph,configure_use_bar_for_draw:gInjectTab_UseBarForDraw,configure_gary_coover:gInjectTab_GaryCoover};DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Tablature/Solf\xe8ge Injection Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#injecting_tablature" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="margin-top:18px;font-size:12pt;line-height:14pt;font-family:helvetica"><strong>Tablature/Solf\xe8ge Font Settings:</strong></p>'},{name:"Font family (Recommended: Palatino):",id:"configure_font_family",type:"text",cssClass:"configure_tab_settings_form_text_wide"},{name:"Tablature/Solf\xe8ge font size (Recommended: 10):",id:"configure_tab_font_size",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"%%staffsep value (Recommended: 80):",id:"configure_staffsep",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"%%musicspace value (Recommended: 10):",id:"configure_musicspace",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"Character(s) for Push indication (Clearing this field will reset to ↓ ):",id:"configure_pushglyph",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"Character(s) for Draw indication (Clearing this field will reset to ↑ ):",id:"configure_drawglyph",type:"text",cssClass:"configure_tab_settings_form_text"},{name:"    Use a bar over button name to indicate Draw (overrides Push and Draw characters)",id:"configure_use_bar_for_draw",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{name:"Tab location relative to notation:",id:"configure_tab_location",type:"select",options:[{name:"  Above",id:"0"},{name:"  Below",id:"1"},],cssClass:"configure_tab_settings_select"},{name:"    Strip all chords and tab before injecting tab (Tab below only. Tab above always strips.)",id:"configure_strip_chords",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{html:'<p style="margin-top:20px;font-size:12pt;line-height:12pt;font-family:helvetica"><strong>Anglo Concertina Tablature Settings:</strong></p>'},{name:"Concertina style:",id:"configure_concertina_style",type:"select",options:[{name:"  Jeffries",id:"0"},{name:"  Wheatstone",id:"1"},],cssClass:"configure_tab_settings_select"},{name:"Preferred fingerings:",id:"configure_concertina_fingering",type:"select",options:[{name:"  On-Row",id:"0"},{name:"  Cross-Row",id:"1"},],cssClass:"configure_tab_settings_select"},{html:'<p style="margin-top:16px;font-size:12pt;line-height:12pt;font-family:helvetica">On-Row: Favors D5 and E5 on right-side C-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Cross-Row: Favors D5 and E5 on the left-side G-row.</p>'},{html:'<p style="margin-top:12px;font-size:12pt;line-height:12pt;font-family:helvetica">Favors C5 on the left-side G-row draw, B4 on the right-side C-row draw.</p>'},{name:"    Gary Coover style tab (single notes only, overrides button name and direction settings)",id:"configure_gary_coover",type:"checkbox",cssClass:"configure_tab_settings_form_text"},{html:'<p style="text-align:center;margin-top:22px;"><input id="configure_anglo_fingerings" class="btn btn-subdialog configure_anglo_fingerings" onclick="ConfigureAngloFingerings()" type="button" value="Configure Anglo Concertina Tablature Button Names" title="Configure the Anglo Concertina tablature button names"></p>'},],e,{theme:"modal_flat",top:10,width:720,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gInjectTab_FontFamily=e.result.configure_font_family,gInjectTab_TabFontSize=e.result.configure_tab_font_size,gInjectTab_StaffSep=e.result.configure_staffsep,gInjectTab_MusicSpace=e.result.configure_musicspace,gInjectTab_TabLocation=e.result.configure_tab_location,gInjectTab_ConcertinaStyle=e.result.configure_concertina_style,gInjectTab_ConcertinaFingering=e.result.configure_concertina_fingering,gInjectTab_StripChords=e.result.configure_strip_chords,gInjectTab_GaryCoover=e.result.configure_gary_coover,""==(gInjectTab_PushGlyph=e.result.configure_pushglyph)&&(gInjectTab_PushGlyph="↓"),""==(gInjectTab_DrawGlyph=e.result.configure_drawglyph)&&(gInjectTab_DrawGlyph="↑"),gInjectTab_UseBarForDraw=e.result.configure_use_bar_for_draw,SaveConfigurationSettings())})}function idleOpenFonts(){gIsIOS&&document.getElementById("load_rendering_fonts_fs").removeAttribute("accept"),document.getElementById("load_rendering_fonts_fs").onchange=()=>{let e=document.getElementById("load_rendering_fonts_fs");if(0===e.files.length){var t="Please select a font settings file";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}loadFontSettings(e.files[0]),e.value=""}}function loadFontSettings(e){sendGoogleAnalytics("action","loadFontSettings");let t=new FileReader;t.addEventListener("load",e=>{var t=JSON.parse(e.target.result);if(!t.titlefont||!t.voicefont){var n="This is not a valid font settings file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}(gDialogRenderingFonts=t).tablabelfont||(gDialogRenderingFonts.tablabelfont="Trebuchet MS 14"),gDialogRenderingFonts.tabgracefont||(gDialogRenderingFonts.tabgracefont="Arial 8"),idleFontsDialog()}),t.readAsText(e)}function saveFontSettings(){sendGoogleAnalytics("action","saveFontSettings"),saveTextFile("Please enter a filename for your font settings:","abc_tool_fonts.txt",JSON.stringify({titlefont:$('[name="configure_titlefont"]').val(),subtitlefont:$('[name="configure_subtitlefont"]').val(),infofont:$('[name="configure_infofont"]').val(),partsfont:$('[name="configure_partsfont"]').val(),tempofont:$('[name="configure_tempofont"]').val(),textfont:$('[name="configure_textfont"]').val(),composerfont:$('[name="configure_composerfont"]').val(),annotationfont:$('[name="configure_annotationfont"]').val(),gchordfont:$('[name="configure_gchordfont"]').val(),vocalfont:$('[name="configure_vocalfont"]').val(),wordsfont:$('[name="configure_wordsfont"]').val(),tablabelfont:$('[name="configure_tablabelfont"]').val(),tabnumberfont:$('[name="configure_tabnumberfont"]').val(),tabgracefont:$('[name="configure_tabgracefont"]').val(),historyfont:$('[name="configure_historyfont"]').val(),voicefont:$('[name="configure_voicefont"]').val()}))}function idleFontsDialog(){$('[name="configure_titlefont"]').val(gDialogRenderingFonts.titlefont),$('[name="configure_subtitlefont"]').val(gDialogRenderingFonts.subtitlefont),$('[name="configure_infofont"]').val(gDialogRenderingFonts.infofont),$('[name="configure_partsfont"]').val(gDialogRenderingFonts.partsfont),$('[name="configure_tempofont"]').val(gDialogRenderingFonts.tempofont),$('[name="configure_textfont"]').val(gDialogRenderingFonts.textfont),$('[name="configure_composerfont"]').val(gDialogRenderingFonts.composerfont),$('[name="configure_annotationfont"]').val(gDialogRenderingFonts.annotationfont),$('[name="configure_gchordfont"]').val(gDialogRenderingFonts.gchordfont),$('[name="configure_vocalfont"]').val(gDialogRenderingFonts.vocalfont),$('[name="configure_wordsfont"]').val(gDialogRenderingFonts.wordsfont),$('[name="configure_tablabelfont"]').val(gDialogRenderingFonts.tablabelfont),$('[name="configure_tabnumberfont"]').val(gDialogRenderingFonts.tabnumberfont),$('[name="configure_tabgracefont"]').val(gDialogRenderingFonts.tabgracefont),$('[name="configure_historyfont"]').val(gDialogRenderingFonts.historyfont),$('[name="configure_voicefont"]').val(gDialogRenderingFonts.voicefont)}function resetABCRenderingFonts(){gDialogRenderingFonts={titlefont:"Palatino 18",subtitlefont:"Palatino 13",infofont:"Palatino 13",partsfont:"Palatino 13",tempofont:"Palatino 13",textfont:"Palatino 13",composerfont:"Palatino 13",annotationfont:"Palatino 13",gchordfont:"Verdana 12",vocalfont:"Palatino 13",wordsfont:"Palatino 13",tablabelfont:"Trebuchet MS 14",tabnumberfont:"Arial 12",tabgracefont:"Arial 8",historyfont:"Times New Roman 14",voicefont:"Times New Roman 13"}}function defaultFontSettings(){sendGoogleAnalytics("action","defaultFontSettings");var e="Are you sure you want to reset the ABC rendering fonts to their default values?";e=makeCenteredPromptString(e),DayPilot.Modal.confirm(e,{top:180,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||(resetABCRenderingFonts(),SaveConfigurationSettings(),idleFontsDialog())})}function ConfigureFonts(){sendGoogleAnalytics("dialog","ConfigureFonts");let e={configure_titlefont:gRenderingFonts.titlefont,configure_subtitlefont:gRenderingFonts.subtitlefont,configure_infofont:gRenderingFonts.infofont,configure_partsfont:gRenderingFonts.partsfont,configure_tempofont:gRenderingFonts.tempofont,configure_textfont:gRenderingFonts.textfont,configure_composerfont:gRenderingFonts.composerfont,configure_annotationfont:gRenderingFonts.annotationfont,configure_gchordfont:gRenderingFonts.gchordfont,configure_vocalfont:gRenderingFonts.vocalfont,configure_wordsfont:gRenderingFonts.wordsfont,configure_tablabelfont:gRenderingFonts.tablabelfont,configure_tabnumberfont:gRenderingFonts.tabnumberfont,configure_tabgracefont:gRenderingFonts.tabgracefont,configure_historyfont:gRenderingFonts.historyfont,configure_voicefont:gRenderingFonts.voicefont};setTimeout(function(){idleOpenFonts()},150),DayPilot.Modal.form([{html:'<p style="text-align:center;margin-bottom:20px;font-size:16pt;font-family:helvetica;margin-left:15px;">Configure ABC Rendering Fonts&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#configure_fonts" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{name:"Title font (Default: Palatino 18):",id:"configure_titlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Subtitle font (Default: Palatino 13):",id:"configure_subtitlefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Info font (Default: Palatino 13):",id:"configure_infofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Composer font (Default: Palatino 13):",id:"configure_composerfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tempo font (Default: Palatino 13):",id:"configure_tempofont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Guitar chord font (Default: Verdana 12):",id:"configure_gchordfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab label font (Default: Trebuchet MS 14):",id:"configure_tablabelfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab number font (Default: Arial 12):",id:"configure_tabnumberfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Tab grace font (Default: Arial 8):",id:"configure_tabgracefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"History font (Default: Times New Roman 14):",id:"configure_historyfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Text font (Default: Palatino 13):",id:"configure_textfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Annotation font (Default: Palatino 13):",id:"configure_annotationfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Voice font (Default: Times New Roman 13):",id:"configure_voicefont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Parts font (Default: Palatino 13):",id:"configure_partsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Vocal font (Default: Palatino 13):",id:"configure_vocalfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{name:"Words font (Default: Palatino 13):",id:"configure_wordsfont",type:"text",cssClass:"configure_font_settings_form_text_wide"},{html:'<p style="text-align:center;margin-top:22px;"><input id="save_rendering_fonts" class="btn btn-top save_rendering_fonts" onclick="saveFontSettings()" type="button" value="Save to File" title="Saves the ABC rendering font settings to a file"><input type="file" id="load_rendering_fonts_fs" accept=".txt,.TXT" hidden/><label class="btn btn-top load_rendering_fonts" for="load_rendering_fonts_fs" id="load_rendering_fonts" title="Loads the ABC rendering font settings from a file">Load from File</label><input id="default_rendering_fonts" class="btn btn-clearbutton default_rendering_fonts" onclick="defaultFontSettings()" type="button" value="Reset to Default" title="Reset the ABC rendering fonts to their default values"></p>'}],e,{theme:"modal_flat",top:10,width:600,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){e.canceled||(gRenderingFonts.titlefont=e.result.configure_titlefont,gRenderingFonts.subtitlefont=e.result.configure_subtitlefont,gRenderingFonts.infofont=e.result.configure_infofont,gRenderingFonts.partsfont=e.result.configure_partsfont,gRenderingFonts.tempofont=e.result.configure_tempofont,gRenderingFonts.textfont=e.result.configure_textfont,gRenderingFonts.composerfont=e.result.configure_composerfont,gRenderingFonts.annotationfont=e.result.configure_annotationfont,gRenderingFonts.gchordfont=e.result.configure_gchordfont,gRenderingFonts.vocalfont=e.result.configure_vocalfont,gRenderingFonts.wordsfont=e.result.configure_wordsfont,gRenderingFonts.tablabelfont=e.result.configure_tablabelfont,gRenderingFonts.tabnumberfont=e.result.configure_tabnumberfont,gRenderingFonts.tabgracefont=e.result.configure_tabgracefont,gRenderingFonts.historyfont=e.result.configure_historyfont,gRenderingFonts.voicefont=e.result.configure_voicefont,SaveConfigurationSettings(),RenderAsync(!0,null))})}function AddAutoPlay(){var e=urltextbox.value;-1==e.indexOf("&play=1")&&(e+="&play=1"),urltextbox.value=e,document.getElementById("addautoplay").value="Auto-Play Added!",setTimeout(function(){document.getElementById("addautoplay").value="Add Auto-Play"},1500)}function AddDisableEditing(){var e=urltextbox.value;-1==e.indexOf("&dx=1")&&(e+="&dx=1"),urltextbox.value=e,document.getElementById("adddisableediting").value="Disable Editing Added!",setTimeout(function(){document.getElementById("adddisableediting").value="Add Disable Editing"},1500)}function SharingControlsDialog(){sendGoogleAnalytics("dialog","SharingControlsDialog");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Sharing Controls&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#sharing_controls" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>';e+='<div id="sharing-controls-dialog">',e+='<p style="margin-top:28px;">',e+='<input id="testurl" class="urlcontrols btn btn-urlcontrols" onclick="TestShareURL()" type="button" value="Test Share URL" title="Opens the Share URL in a new tab">',e+='<input id="copyurl" class="urlcontrols btn btn-urlcontrols" onclick="CopyShareURL()" type="button" value="Copy Share URL" title="Copies the Share URL to the clipboard">',e+='<input id="saveurl" class="urlcontrols btn btn-urlcontrols" onclick="SaveShareURL()" type="button" value="Save Share URL" title="Saves the Share URL to a file">',e+='<input id="shortenurl" class="urlcontrols btn btn-urlcontrols" onclick="ShortenURL()" type="button" value="Shorten URL" title="Shortens the Share URL and copies it to the clipboard">',e+='<input id="generateqrcode" class="urlcontrolslast btn btn-urlcontrols" onclick="GenerateQRCode(event)" type="button" value="Generate QR Code" title="Generates a QR Code for the Share URL.&nbsp;&nbsp;Even if this button is greyed-out, Shift-click attempts to generate a QR code from the text in the Share URL box.">',e+="</p>",e+='<p style="margin-top:24px;">',e+='<textarea id="urltextbox" rows="10" cols="80" spellcheck="false" autocorrect="off" autocapitalize="off" placeholder="URL for sharing will appear here" >',e+="</textarea>",e+="</p>",e+='<p id="shareurlcaption">Share URL</p>',e+='<p style="text-align:center;margin-top:36px;"><input id="addautoplay" class="urlcontrols btn btn-urlcontrols" onclick="AddAutoPlay()" type="button" value="Add Auto-Play" title="Adds &play=1 to the ShareURL.&nbsp;&nbsp;Tune will open in the player."><input id="adddisableediting" class="urlcontrolslast btn btn-urlcontrols" onclick="AddDisableEditing()" type="button" value="Add Disable Editing" title="Adds &dx=1 to the ShareURL.&nbsp;&nbsp;Entering the editor from the full screen tune view will be disabled."></p>',e+="</div>",setTimeout(function(){CreateURLfromHTML()},200),DayPilot.Modal.alert(e,{theme:"modal_flat",top:100,width:800,scrollWithPage:AllowDialogsToScroll()}).then(function(){})}function idlePDFExportDialog(){function e(e){if("incipits"!=e){var t=document.getElementsByName("configure_incipitscolumns");t&&0!=t.length&&(t[0].disabled=!0,t[0].style.opacity=.4)}else{var t=document.getElementsByName("configure_incipitscolumns");t&&0!=t.length&&(t[0].disabled=!1,t[0].style.opacity=1)}}var t=document.getElementsByName("configure_tunelayout");t&&0!=t.length&&(e(t[0].value),t[0].onchange=function(){e(this.value)})}function PDFExportDialog(){if(gRenderingPDF)return;var e,t=!0;gIsMaximized&&(t=!1),t?sendGoogleAnalytics("dialog","PDFExportDialog"):sendGoogleAnalytics("dialog","PDFExportDialogFS");let n=[{name:"  Letter",id:"letter"},{name:"  A4",id:"a4"},],o=[{name:"  Portrait",id:"portrait"},{name:"  Landscape",id:"landscape"},],a=[{name:"  One Tune per Page",id:"one"},{name:"  Multiple Tunes per Page",id:"multi"},{name:"  Notes Incipits",id:"incipits"},{name:"  ABC Text Incipits",id:"incipits_abc"},{name:"  ABC Text Incipits Sorted",id:"incipits_abc_sort"},{name:"  ABC Text Complete Tunes",id:"incipits_abc_full"},{name:"  ABC Text Complete Tunes - Comhaltas ABC",id:"incipits_abc_full_cce"},{name:"  QR Code for Each Tune",id:"all_qr_codes"},{name:"  Notation + QR Code for Each Tune",id:"mixed_notation_qr"},],r=[{name:"  One Column",id:1},{name:"  Two Columns",id:2},],l=[{name:"  None",id:"none"},{name:"  Top Left",id:"tl"},{name:"  Top Center",id:"tc"},{name:"  Top Right",id:"tr"},{name:"  Bottom Left",id:"bl"},{name:"  Bottom Center",id:"bc"},{name:"  Bottom Right",id:"br"},{name:"  Alternating Top Left/Right",id:"tlr"},{name:"  Alternating Top Right/Left",id:"trl"},{name:"  Alternating Bottom Left/Right",id:"blr"},{name:"  Alternating Bottom Right/Left",id:"brl"},],s=[{name:"  Times",id:"Times"},{name:"  Helvetica",id:"Helvetica"},{name:"  Courier",id:"Courier"},],g=[{name:"  Normal",id:"Normal"},{name:"  Bold",id:"Bold"},{name:"  Oblique",id:"Oblique"},{name:"  Bold Oblique",id:"BoldOblique"},];var c="letter",d=document.getElementById("pdfformat").value;-1!=d.indexOf("a4")&&(c="a4",d=d.replace("_a4",""));var u=document.getElementById("pagenumbers").value,p=document.getElementById("firstpage").value,m=gPDFFont,h=m.toLowerCase();"times"!=h&&"helvetica"!=h&&"courier"!=h&&(m="Times");var f=gPDFFontStyle;if(""==f)f="Normal";else{var T=f.toLowerCase();"Times"==m&&("italic"==T&&(f="Oblique"),"bolditalic"==T&&(f="BoldOblique")),"normal"!=(T=f.toLowerCase())&&"bold"!=T&&"oblique"!=T&&"boldoblique"!=T&&(f="Normal")}let A={configure_papersize:c,configure_tunelayout:d,configure_orientation:gPDFOrientation,configure_incipitscolumns:gIncipitsColumns,configure_pagenumber:u,configure_pagenumberonfirstpage:"yes"==p,configure_fontname:m,configure_fontstyle:f};e=t?[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="text-align:center;margin-top:24px;"><input id="tunebookbuilder" class="advancedcontrols btn btn-injectcontrols-tunebookbuilder" onclick="PDFTunebookBuilder();" type="button" value="Configure PDF Tunebook Features" title="Easily add features to your PDF tunebook including: Title Page, Table of Contents, Index, Page Headers, Page Footers, playback links, and custom QR Code"><input id="pdfinjectlargeprint" class="advancedcontrols btn btn-injectcontrols-headers-pdf" onclick="NotationSpacingExplorer()" type="button" value="Notation Spacing Explorer" title="Find the right spacing and scale values for your notation"></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:n,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:o,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:a,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:r,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:l,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</strong></p>'},{name:"Font:",id:"configure_fontname",type:"select",options:s,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:g,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="font-size:3pt;">&nbsp;</p>'}]:[{html:'<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">Export PDF Tunebook&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#export_pdf_tunebook" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{name:"Paper Size:",id:"configure_papersize",type:"select",options:n,cssClass:"configure_pdf_papersize_select"},{name:"Orientation:",id:"configure_orientation",type:"select",options:o,cssClass:"configure_pdf_orientation_select"},{name:"Tune Layout:",id:"configure_tunelayout",type:"select",options:a,cssClass:"configure_pdf_tunelayout_select"},{name:"Notes Incipits Columns:",id:"configure_incipitscolumns",type:"select",options:r,cssClass:"configure_pdf_incipitscolumns_select"},{name:"Page Number Location:",id:"configure_pagenumber",type:"select",options:l,cssClass:"configure_pdf_pagenumber_select"},{name:"            Page Number on First Page",id:"configure_pagenumberonfirstpage",type:"checkbox",cssClass:"configure_pdf_settings_form_text"},{html:'<p style="margin-top:36px;font-size:12pt;line-height:18px;font-family:helvetica;">Font for Title Page, Table of Contents, Index, Page Headers/Footers, Page Numbers, Text Incipits:</strong></p>'},{name:"Font:",id:"configure_fontname",type:"select",options:s,cssClass:"configure_pdf_fontname_select"},{name:"Font Style:",id:"configure_fontstyle",type:"select",options:g,cssClass:"configure_pdf_fontstyle_select"},{html:'<p style="font-size:3pt;">&nbsp;</p>'}],setTimeout(function(){idlePDFExportDialog()},150),DayPilot.Modal.form(e,A,{theme:"modal_flat",top:100,width:760,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(!e.canceled){gIncipitsColumns=e.result.configure_incipitscolumns;var t=e.result.configure_papersize;gPDFPaperSize=t;var n=e.result.configure_tunelayout;"a4"==t&&("incipits_abc"==n?n="incipits_a4_abc":"incipits_abc_sort"==n?n="incipits_a4_abc_sort":"incipits_abc_full"==n?n="incipits_a4_abc_full":"incipits_abc_full_cce"==n?n="incipits_a4_abc_full_cce":"all_qr_codes"==n?n="all_qr_codes_a4":"mixed_notation_qr"==n?n="mixed_notation_qr_a4":n+="_a4"),sendGoogleAnalytics("pdf_orientation",gPDFOrientation=e.result.configure_orientation),"portrait"==gPDFOrientation?(gRenderPixelRatio=2,"letter"==t?(gPageWidth=535,gTPTOPOFFSET=435,gINDEXTOPOFFSET=330,gTOCTOPOFFSET=330,gPAGENUMBERTOP=296,gTEXTINCIPITTOPOFFSET=330,gTEXTINCIPITLEFTMARGIN=45,gTEXTINCIPITRIGHTMARGIN=200):(gPageWidth=535,gTPTOPOFFSET=455,gINDEXTOPOFFSET=350,gTOCTOPOFFSET=350,gPAGENUMBERTOP=313,gTEXTINCIPITTOPOFFSET=350,gTEXTINCIPITLEFTMARGIN=45,gTEXTINCIPITRIGHTMARGIN=195)):(gRenderPixelRatio=3,"letter"==t?(gPageWidth=718,gTPTOPOFFSET=330,gINDEXTOPOFFSET=265,gTOCTOPOFFSET=265,gPAGENUMBERTOP=232,gTEXTINCIPITTOPOFFSET=265,gTEXTINCIPITLEFTMARGIN=100,gTEXTINCIPITRIGHTMARGIN=250):(gPageWidth=785,gTPTOPOFFSET=350,gINDEXTOPOFFSET=255,gTOCTOPOFFSET=255,gPAGENUMBERTOP=232,gTEXTINCIPITTOPOFFSET=255,gTEXTINCIPITLEFTMARGIN=105,gTEXTINCIPITRIGHTMARGIN=281)),document.getElementById("pdfformat").value=n;var o=e.result.configure_pagenumber;document.getElementById("pagenumbers").value=o,e.result.configure_pagenumberonfirstpage?document.getElementById("firstpage").value="yes":document.getElementById("firstpage").value="no";var a=e.result.configure_fontname;gPDFFont=a;var r=e.result.configure_fontstyle;"Normal"==r?r="":"Times"===a&&("oblique"==r.toLowerCase()?r="Italic":"boldoblique"==r.toLowerCase()&&(r="BoldItalic")),gPDFFontStyle=r,SavePDFSettings(),ExportPDF()}})}var gMoreABCToolsOKButton=null;function Configure_AdvancedControlsDialog_UI(){var e=gFeaturesShowTablatures,t=gFeaturesShowExplorers,n=gFeaturesShowExport;let o={showtablatures:gFeaturesShowTablatures,showexplorers:gFeaturesShowExplorers,showexport:gFeaturesShowExport};var a=[{html:'<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-left:15px;">More ABC Tools Feature Options</p>'},{name:"          Show Tablature Injectors",id:"showtablatures",type:"checkbox",cssClass:"configure_ui_options_form_text"},{name:"          Show MIDI, Swing, Grace, and Roll Explorers",id:"showexplorers",type:"checkbox",cssClass:"configure_ui_options_form_text"},];isDesktopBrowser()?a.push({name:"          Show Export, Sort, and Comhaltas features",id:"showexport",type:"checkbox",cssClass:"configure_ui_options_form_text"}):a.push({name:"          Show Sort and Comhaltas features",id:"showexport",type:"checkbox",cssClass:"configure_ui_options_form_text"}),DayPilot.Modal.form(a,o,{theme:"modal_flat",top:100,width:500,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(o){!o.canceled&&(gFeaturesShowTablatures=o.result.showtablatures,gFeaturesShowExplorers=o.result.showexplorers,gFeaturesShowExport=o.result.showexport,(gFeaturesShowTablatures!=e||gFeaturesShowExplorers!=t||gFeaturesShowExport!=n)&&(SaveConfigurationSettings(),gMoreABCToolsOKButton.click(),setTimeout(function(){AdvancedControlsDialog()},250)))})}function IdleMoreABCTools(){for(var e=document.getElementsByClassName("modal_flat_ok"),t=null,n=0;n<e.length;++n)if("OK"==(t=e[n]).innerText){gMoreABCToolsOKButton=t;break}}function AdvancedControlsDialog(){sendGoogleAnalytics("dialog","AdvancedControlsDialog");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica;margin-left:15px;">More ABC Tools&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#more_tools" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span><img id="moreabctoolssettings" class="moreabctoolssettings" src="img/settings.png"  title="More ABC Tools Settings" onclick="Configure_AdvancedControlsDialog_UI();"</img></p>';e+='<div id="advanced-controls-dialog">',e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">Show/Hide ABC Features</p>',e+='<p style="text-align:center;">',e+='<input id="toggleannotations" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleAnnotations(false)" type="button" value="Hide Annotations" title="Hides/Shows common annotations in the ABC notation">',e+='<input id="toggletext" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTextAnnotations(false)" type="button" value="Hide Text" title="Hides/Shows any text in the ABC notation">',e+='<input id="togglechords" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleChords(false)" type="button" value="Hide Chords" title="Hides/Shows any chords in the ABC notation">',e+='<input id="toggletab" class="advancedcontrolsdisabled btn btn-advancedcontrols" onclick="ToggleTab(false)" type="button" value="Hide Injected Tab" title="Hides/Shows any injected tablature">',e+="</p>",e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">Strip ABC Features</p>',e+='<p style="text-align:center;">',e+='<input id="stripannotations" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleAnnotations(true)" type="button" value="Strip Annotations" title="Strips common annotations from the ABC">',e+='<input id="striptext" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTextAnnotations(true)" type="button" value="Strip Text" title="Strips all text from the ABC">',e+='<input id="stripchords" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleChords(true)" type="button" value="Strip Chords" title="Strips all chords from the ABC">',e+='<input id="striptab" class="advancedcontrolsdisabled btn btn-injectcontrols" onclick="ToggleTab(true)" type="button" value="Strip Injected Tab" title="Strips all injected tablature">',e+="</p>",e+='<p style="text-align:center;font-size:14pt;font-family:helvetica;margin-top:22px;">ABC Injection Features</p>',e+='<p style="text-align:center;">',e+='<input id="injecttunenumbers" class="advancedcontrols btn btn-injectcontrols-headers" onclick="TuneTitlesNumbersDialog()" type="button" value="Inject Tune Title Numbers" title="Opens a dialog where you can add or remove numbers on the tune titles">',e+='<input id="injectsectionheader" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectSectionHeader()" type="button" value="Inject PDF Section Header" title="Injects a PDF section header placeholder tune at the cursor insertion point">',e+='<input id="injectallheaders" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectPDFHeaders()" type="button" value="Inject All PDF Annotations" title="Injects all available tool-specific PDF tunebook annotations for title page, table of contents, index generation, etc. at the top of the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectallmidiparams" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectAllMIDIParams()" type="button" value="Inject MIDI Programs and Volumes" title="Injects MIDI Soundfont, Melody program, Bass program, Chord program, and volume annotations into one or all tunes">',e+='<input id="injectmetronome" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectMetronome()" type="button" value="Inject Metronome" title="Injects ABC for a metronome into one or all tunes">',e+='<input id="injectclicktrackall" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectRepeatsAndClickTrackAll()" type="button" value="Inject Repeats + Intros" title="Injects repeated copies of tunes and optional style-adaptive two-bar click intros into every tune">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectheaderstring" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectHeaderString()" type="button" value="Inject ABC Header String" title="Injects a string into the top or bottom of the ABC header for one or all tunes">',e+='<input id="injectstaffwidth" class="advancedcontrols btn btn-injectcontrols-headers" onclick="InjectStaffWidth()" type="button" value="Inject %%staffwidth" title="Injects a %%staffwidth annotation into one or all tunes">',e+='<input id="injectlargeprint" class="advancedcontrols btn btn-injectcontrols-headers" onclick="NotationSpacingExplorer()" type="button" value="Notation Spacing Explorer" title="Find the right spacing and scale values for your notation">',e+="</p>",gFeaturesShowTablatures&&(e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectbctab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_BC()" type="button" value="Inject B/C Box Tab" title="Injects B/C box tablature into the ABC">',e+='<input id="injectcdtab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_CsD()" type="button" value="Inject C#/D Box Tab" title="Injects C#/D box tablature into the ABC">',e+='<input id="injectanglotab" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Anglo()" type="button" value="Inject Anglo Concertina Tab" title="Injects Anglo Concertina tablature into the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;">',e+='<input id="injectfiddlefingerings" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Fiddle_Fingerings()" type="button" value="Inject Fiddle Fingerings" title="Injects Fiddle fingerings tablature into the ABC">',e+='<input id="injectmd" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_MD()" type="button" value="Inject Dulcimer Tab" title="Injects Mountain Dulcimer tablature into the ABC">',e+='<input id="injectbambooflute" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_Bamboo_Flute()" type="button" value="Inject Bamboo Flute Tab" title="Injects Bamboo flute tablature into the ABC">',e+="</p>",e+='<p style="text-align:center;margin-top:22px;"><input id="injectshapenotes" class="advancedcontrols btn btn-injectcontrols" onclick="DoInjectTablature_ShapeNotes()" type="button" value="Inject Shape Note/Solf\xe8ge" title="Injects Shape Note shapes and/or Solf\xe8ge note names into the ABC"><input id="configure_box_advanced" class="btn btn-subdialog configure_box_advanced " onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"></p>'),gFeaturesShowExplorers&&(e+='<p style="text-align:center;margin-top:22px;"><input id="configure_instrument_explorer" class="configure_instrument_explorer button btn btn-instrumentexplorer" onclick="InstrumentExplorer();" type="button" value="MIDI Instrument Explorer" title="Brings up a tune player where you can experiment playing the current tune with different MIDI soundfonts and melody/chord instruments"><input id="configure_swing_explorer" class="btn btn-swingexplorer configure_swing_explorer " onclick="SwingExplorer()" type="button" value="Swing Explorer" title="Brings up a tune player where you can experiment with different swing factor and offset settings"><input id="configure_grace_explorer" class="btn btn-graceexplorer configure_grace_explorer " onclick="GraceExplorer()" type="button" value="Grace Duration Explorer" title="Brings up a tune player where you can experiment with different grace note duration settings"><input id="configure_roll_explorer" class="btn btn-rollexplorer configure_roll_explorer " onclick="RollExplorer()" type="button" value="Roll Explorer" title="Brings up a tune player where you can experiment with different roll parameters"></p>'),gFeaturesShowExport&&(e+='<p style="text-align:center;margin-top:22px;"><input id="configure_batch_mp3_export" class="btn btn-batchmp3export configure_batch_mp3_export " onclick="ExportAll()" type="button" value="Export All Audio or Images" title="Exports all the tunes in the ABC text area as audio or image files"><input class="sortbutton btn btn-sortbutton" id="sortbutton" onclick="SortDialog()" type="button" value="Sort by Specific Tag" title="Brings up the Sort by Specific Tag dialog"><input id="ceoltastransform" class="advancedcontrols btn btn-injectcontrols" onclick="DoCeoltasTransformDialog()" type="button" value="Comhaltas ABC Transform" title="Transforms the ABC to/from Comhaltas format."></p>'),e+="</div>";var t=GetRadioValue("notenodertab");setTimeout(function(){IdleMoreABCTools()},100),setTimeout(function(){IdleAdvancedControls(!0),IdleAllowShowTabNames()},200),DayPilot.Modal.alert(e,{theme:"modal_flat",top:20,width:740,scrollWithPage:AllowDialogsToScroll()}).then(function(){}),isMobileBrowser()?document.getElementById("configure_batch_mp3_export").style.display="none":"whistle"==t&&(document.getElementById("configure_batch_mp3_export").value="Export All Audio",document.getElementById("configure_batch_mp3_export").title="Exports all the tunes in the ABC text area as audio files")}function ResetRollDefaultParams(){$('[name="configure_roll2_default"]').val("0.95 0.8 1.0 0.75 0.9 1.0 0.75 1.0"),$('[name="configure_roll3_default"]').val("1.45 0.6 1.0 0.75 0.9 1.0 0.75 1.0")}function AdvancedSettings(){sendGoogleAnalytics("dialog","AdvancedSettings");var e=gRawHighlightColor,t=gUseComhaltasABC;let n={configure_fullscreen_scaling:gFullScreenScaling,configure_comhaltas:gUseComhaltasABC,configure_highlight_color:gRawHighlightColor,configure_player_status_on_left:gPlayerStatusOnLeft,configure_large_player_controls:gLargePlayerControls,configure_autoscrollplayer:gAutoscrollPlayer,configure_trainer_touch_controls:gTrainerTouchControls,configure_metronome_volume:gMetronomeVolume,configure_mp3_bitrate:gMP3Bitrate,configure_export_delayms:gBatchExportDelayMS,configure_mp3export_delayms:gBatchMP3ExportDelayMS,configure_RollUseRollForIrishRoll:gRollUseRollForIrishRoll,configure_roll2_default:gRoll2DefaultParams,configure_roll3_default:gRoll3DefaultParams,configure_TuneDatabaseRetryTimeMS:gTuneDatabaseRetryTimeMS,configure_TuneDatabaseRetryCount:gTuneDatabaseRetryCount,configure_DisableRendering:gDisableNotationRendering,configure_disable_selected_play:gDisableSelectedPlay};var o=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-bottom:24px;margin-left:15px;">Advanced Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#advanced_settings" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{html:'<p style="font-size:12pt;line-height:24px;font-family:helvetica;"><strong>Only change these values if you know what you are doing!</strong></p>'},{name:"    Disable abcjs notation rendering",id:"configure_DisableRendering",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Rolls indicated in the ABC with ~ use the custom abcjs roll playback solution",id:"configure_RollUseRollForIrishRoll",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Note name tablature uses Comhaltas style ABC (D' E' F' instead of d e f for octave notes)",id:"configure_comhaltas",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Autoscroll player when playing",id:"configure_autoscrollplayer",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player/Tune Trainer always plays full tune even if there is a selection region",id:"configure_disable_selected_play",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player uses large controls (easier to touch on phone/tablet)",id:"configure_large_player_controls",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player tunebook navigation controls on left side",id:"configure_player_status_on_left",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"    Player/Tune Trainer uses label L/R side click to decrement/increment values",id:"configure_trainer_touch_controls",type:"checkbox",cssClass:"advanced_settings2_form_text_checkbox"},{name:"Full screen tune display width scaling (percentage) (default is 50):",id:"configure_fullscreen_scaling",type:"number",cssClass:"advanced_settings2_form_text"},];isDesktopBrowser()&&(o=o.concat([{name:"Highlighting color (HTML format) (default is #F00000):",id:"configure_highlight_color",type:"text",cssClass:"advanced_settings2_form_text"}])),o=o.concat([{name:"Metronome volume (default is 48):",id:"configure_metronome_volume",type:"text",cssClass:"advanced_settings2_form_text"},{name:"MP3 audio export bitrate (kbit/sec) (default is 224):",id:"configure_mp3_bitrate",type:"number",cssClass:"advanced_settings2_form_text"},]),isDesktopBrowser()&&(o=o.concat([{name:"Image Batch Export Delay in milliseconds (default is 200):",id:"configure_export_delayms",type:"text",cssClass:"advanced_settings2_form_text"},{name:"MP3 Batch Export Delay in milliseconds (default is 250):",id:"configure_mp3export_delayms",type:"text",cssClass:"advanced_settings2_form_text"},])),o=o.concat([{name:"Tune search fetch retry delay in milliseconds (default is 3000):",id:"configure_TuneDatabaseRetryTimeMS",type:"text",cssClass:"advanced_settings2_form_text"},{name:"Tune search fetch retry maximum count (default is 10):",id:"configure_TuneDatabaseRetryCount",type:"text",cssClass:"advanced_settings2_form_text"},{name:"Default %roll_2_params:",id:"configure_roll2_default",type:"text",cssClass:"advanced_settings2_roll_text"},{name:"Default %roll_3_params:",id:"configure_roll3_default",type:"text",cssClass:"advanced_settings2_roll_text"},{html:'<p style="text-align:center;margin-top:22px;"><input id="reset_roll_parameters" class="btn btn-subdialog reset_roll_parameters" onclick="ResetRollDefaultParams()" type="button" value="Reset Roll Parameter Strings to Defaults" title="Resets the roll parameter strings to known good default values"></p>'},]),DayPilot.Modal.form(o,n,{theme:"modal_flat",top:10,width:720,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(n){if(!n.canceled){if(gDisableNotationRendering=n.result.configure_DisableRendering){sendGoogleAnalytics("action","RenderDisable"),gTheNotation.innerHTML="";var o=document.getElementById("rawmodebutton");gRawLastIndex=-1,o.value="Highlighting Off",o.classList.add("btn-rawmode-off"),o.classList.remove("btn-rawmode-on"),gTheABC.style.backgroundColor="white",gRawMode=!1}(gFullScreenScaling=isNaN(parseInt(gFullScreenScaling=(gFullScreenScaling=n.result.configure_fullscreen_scaling).replace("%","")))?50:parseInt(gFullScreenScaling))<25&&(gFullScreenScaling=25),gFullScreenScaling>100&&(gFullScreenScaling=100),gPlayerStatusOnLeft=n.result.configure_player_status_on_left,gRollUseRollForIrishRoll=n.result.configure_RollUseRollForIrishRoll,gLargePlayerControls=n.result.configure_large_player_controls,gAutoscrollPlayer=n.result.configure_autoscrollplayer,gTrainerTouchControls=n.result.configure_trainer_touch_controls,gUseComhaltasABC=n.result.configure_comhaltas,gDisableSelectedPlay=n.result.configure_disable_selected_play;var a=n.result.configure_metronome_volume;a=parseInt(a),!isNaN(a)&&a>=0&&a<128&&(gMetronomeVolume=a);var r=parseInt(n.result.configure_mp3_bitrate);!isNaN(r)&&((gMP3Bitrate=r)<96&&(gMP3Bitrate=96),gMP3Bitrate>384&&(gMP3Bitrate=384));var l=n.result.configure_TuneDatabaseRetryTimeMS;l=parseInt(l),!isNaN(l)&&l>0&&l<=1e4&&(gTuneDatabaseRetryTimeMS=l);var s=n.result.configure_TuneDatabaseRetryCount;s=parseInt(s),!isNaN(s)&&s>0&&l<=100&&(gTuneDatabaseRetryCount=s);var g=n.result.configure_roll2_default;g=g.trim();var c=n.result.configure_roll3_default;c=c.trim();var d=validate_roll_2_params(g,!1),u=validate_roll_3_params(c,!1);d&&u?(d=validate_roll_2_params(g,!0),u=validate_roll_3_params(c,!0),gRoll2DefaultParams=g,gRoll3DefaultParams=c):RollParameterIssueAlert(function(){setTimeout(function(){AdvancedSettings()},250)}),IdleAllowShowTabNames();var p=GetRadioValue("notenodertab");isDesktopBrowser()?(gRawHighlightColor=n.result.configure_highlight_color,a=parseInt(a=n.result.configure_export_delayms),!isNaN(a)&&a>=0&&(gBatchExportDelayMS=a),a=parseInt(a=n.result.configure_mp3export_delayms),!isNaN(a)&&a>=0&&(gBatchMP3ExportDelayMS=a),(gRawMode&&gRawHighlightColor!=e||"notenames"==p&&gUseComhaltasABC!=t)&&RenderAsync(!0,null)):"notenames"==p&&gUseComhaltasABC!=t&&RenderAsync(!0,null),SaveConfigurationSettings()}})}function ConfigureToolSettings(){sendGoogleAnalytics("dialog","ConfigureToolSettings");for(var e,t,n,o=[],a=0;a<138;++a)o.push({name:"  "+generalMIDISoundNames[a],id:a});var r=gSaveLastAutoSnapShot,l=gStaffSpacing-STAFFSPACEOFFSET,s=gForceLeftJustifyTitles,g=gShowTabNames,c=gCapo,d=gDefaultSoundFont,u=gUseCustomGMSounds,p=gAlwaysInjectPrograms,m=gTheMelodyProgram;e="mute"==m?0:parseInt(m)+1;var h=gTheChordProgram;t="mute"==h?0:parseInt(h)+1;var f=gTheBassProgram;n="mute"==f?0:parseInt(f)+1;var T=gAlwaysInjectVolumes,A=gTheBassVolume,y=gTheChordVolume,b=gOverridePlayMIDIParams,I=gAllowMIDIInput,v=gFeaturesShowTabButtons;let C={configure_save_exit_snapshot:gSaveLastAutoSnapShot,configure_staff_spacing:l,configure_left_justify_titles:gForceLeftJustifyTitles,configure_capo:gCapo,configure_show_tab_names:gShowTabNames,configure_soundfont:gDefaultSoundFont,configure_use_custom_gm_sounds:gUseCustomGMSounds,configure_inject_programs:p,configure_melody_program:e,configure_bass_program:n,configure_chord_program:t,configure_inject_volumes:T,configure_bass_volume:A,configure_chord_volume:y,configure_override_play_midi_params:b,configure_auto_swing_hornpipes:gAutoSwingHornpipes,configure_auto_swing_factor:gAutoSwingFactor,configure_allow_midi_input:gAllowMIDIInput,configure_show_tab_buttons:gFeaturesShowTabButtons};var S=[{html:'<p style="text-align:center;font-size:16pt;font-family:helvetica;margin-left:15px;">ABC Transcription Tools Settings&nbsp;&nbsp;<span style="font-size:24pt;" title="View documentation in new tab"><a href="https://michaeleskin.com/abctools/userguide.html#settings_dialog" target="_blank" style="text-decoration:none;position:absolute;left:20px;top:20px">?</a></span></p>'},{name:"          Show instrument tablature button bar below ABC editor",id:"configure_show_tab_buttons",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},];isDesktopBrowser()&&S.push({name:"   Save an Auto-Snapshot on browser tab close or reload (Restore it from the Add dialog)",id:"configure_save_exit_snapshot",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),S=S.concat([{name:"Space between the staves (default is 10, minimum is -40):",id:"configure_staff_spacing",type:"number",cssClass:"configure_settings_form_text"},{name:"          Left-justify all titles and subtitles",id:"configure_left_justify_titles",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Stringed instrument capo fret postion:",id:"configure_capo",type:"number",cssClass:"configure_settings_form_text"},{name:"    Show stringed instrument names on tablature (single-voice tunes only, not shown in the Player)",id:"configure_show_tab_names",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Default abcjs soundfont:",id:"configure_soundfont",type:"select",options:[{name:"  Fluid",id:"https://paulrosen.github.io/midi-js-soundfonts/FluidR3_GM/"},{name:"  Musyng Kite",id:"https://paulrosen.github.io/midi-js-soundfonts/MusyngKite/"},{name:"  FatBoy",id:"https://paulrosen.github.io/midi-js-soundfonts/FatBoy/"},{name:"  Canvas",id:"https://michaeleskin.com/abctools/soundfonts/canvas/"},{name:"  MScore",id:"https://michaeleskin.com/abctools/soundfonts/mscore/"},],cssClass:"configure_settings_select"},{name:"    Use AppCordions custom sounds for Dulcimer, Accordion, Flute, and Whistle",id:"configure_use_custom_gm_sounds",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Use Default Melody and Bass/Chord programs when playing tunes",id:"configure_inject_programs",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Default Melody MIDI program:",id:"configure_melody_program",type:"select",options:o,cssClass:"configure_midi_program_form_select"},{name:"Default Bass MIDI program:",id:"configure_bass_program",type:"select",options:o,cssClass:"configure_midi_program_form_select"},{name:"Default Chords MIDI program:",id:"configure_chord_program",type:"select",options:o,cssClass:"configure_midi_program_form_select"},{name:"            Use Default Bass/Chord volumes when playing tunes",id:"configure_inject_volumes",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Default Bass MIDI volume (0-127):",id:"configure_bass_volume",type:"number",cssClass:"configure_settings_form_text"},{name:"Default Chords MIDI volume (0-127):",id:"configure_chord_volume",type:"number",cssClass:"configure_settings_form_text"},{name:"            Override all MIDI programs and volumes in the ABC with the defaults when playing tunes",id:"configure_override_play_midi_params",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"            Automatically swing Hornpipes when playing (enabled if R:Hornpipe is found in the tune)",id:"configure_auto_swing_hornpipes",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"},{name:"Auto-swing scale factor (range is -0.9 to 0.9, default for Hornpipes is 0.25):",id:"configure_auto_swing_factor",type:"number",cssClass:"configure_settings_form_text"},]),browserSupportsMIDI()&&S.push({name:"    Allow MIDI input for ABC text entry",id:"configure_allow_midi_input",type:"checkbox",cssClass:"configure_settings_form_text_checkbox"}),S.push({html:'<p style="text-align:center;"><input id="configure_fonts" class="btn btn-subdialog configure_fonts" onclick="ConfigureFonts()" type="button" value="Font Settings" title="Configure the fonts used for rendering the ABC"><input id="configure_box" class="btn btn-subdialog configure_box" onclick="ConfigureTablatureSettings()" type="button" value="Tablature Injection Settings" title="Configure the tablature injection settings"><input id="configure_musicxml_import" class="btn btn-subdialog configure_musicxml_import" onclick="ConfigureMusicXMLImport()" type="button" value="MusicXML Settings" title="Configure MusicXML import parameters"><input id="configure_developer_settings" class="btn btn-subdialog configure_developer_settings" onclick="AdvancedSettings()" type="button" value="Advanced Settings" title="Configure low level tool settings"></p>'}),DayPilot.Modal.form(S,C,{theme:"modal_flat",top:10,width:780,scrollWithPage:AllowDialogsToScroll(),autoFocus:!1}).then(function(e){if(e.canceled)FocusAfterOperation();else{isDesktopBrowser()?(gSaveLastAutoSnapShot=e.result.configure_save_exit_snapshot)?r!=gSaveLastAutoSnapShot&&AddTabCloseListener():(gLocalStorageAvailable&&(localStorage.LastAutoSnapShot=""),r!=gSaveLastAutoSnapShot&&RemoveTabCloseListener()):gSaveLastAutoSnapShot=!1,gFeaturesShowTabButtons=e.result.configure_show_tab_buttons,!0==v&&!1==gFeaturesShowTabButtons&&sendGoogleAnalytics("action","HidingTabButtonBar"),!1==v&&!0==gFeaturesShowTabButtons&&sendGoogleAnalytics("action","ShowingTabButtonBar");var t=e.result.configure_staff_spacing;t=parseInt(t),isNaN(t)||void 0==t?t=gStaffSpacing:t<-1*STAFFSPACEOFFSET&&(t=-1*STAFFSPACEOFFSET),t!=l&&(gStaffSpacing=t+STAFFSPACEOFFSET),gForceLeftJustifyTitles=e.result.configure_left_justify_titles;var n=e.result.configure_capo;if(!isNaN(parseInt(n))){var o=parseInt(n);o>=0&&o<=12&&(gCapo=parseInt(n))}if(gShowTabNames=e.result.configure_show_tab_names,d!=(gDefaultSoundFont=e.result.configure_soundfont)&&(gTheActiveSoundFont=gDefaultSoundFont,gSoundsCacheABCJS={}),(gUseCustomGMSounds=e.result.configure_use_custom_gm_sounds)!=u&&(gSoundsCacheABCJS={}),gAlwaysInjectPrograms=e.result.configure_inject_programs,gTheMelodyProgram=e.result.configure_melody_program,gTheBassProgram=e.result.configure_bass_program,gTheChordProgram=e.result.configure_chord_program,0==gTheMelodyProgram?gTheMelodyProgram="mute":gTheMelodyProgram--,"mute"!=gTheMelodyProgram&&(isNaN(parseInt(gTheMelodyProgram))&&(gTheMelodyProgram=0),gTheMelodyProgram<0&&(gTheMelodyProgram=0),gTheMelodyProgram>137&&(gTheMelodyProgram=137)),0==gTheBassProgram?gTheBassProgram="mute":gTheBassProgram--,"mute"!=gTheBassProgram&&(isNaN(parseInt(gTheBassProgram))&&(gTheBassProgram=0),gTheBassProgram<0&&(gTheBassProgram=0),gTheBassProgram>137&&(gTheBassProgram=137)),0==gTheChordProgram?gTheChordProgram="mute":gTheChordProgram--,"mute"!=gTheChordProgram&&(isNaN(parseInt(gTheChordProgram))&&(gTheChordProgram=0),gTheChordProgram<0&&(gTheChordProgram=0),gTheChordProgram>137&&(gTheChordProgram=137)),gUseCustomGMSounds&&(gAlwaysInjectPrograms||gOverridePlayMIDIParams)&&("15"==gTheMelodyProgram||"15"==gTheBassProgram||"15"==gTheChordProgram)){var a='<p style="text-align:center;font-size:16pt;font-family:helvetica">Special Note on the Dulcimer (15) Instrument</p>';a+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">Selecting the Dulcimer (15) program for either the melody, bass, or chords automatically sets all note release decay times to 4 seconds to allow the notes to ring.</p>',a+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">This can be useful for tunes using solo melody instruments with long release times like Orchestral Harp (46) or Koto (107).</p>',a+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">For those instruments played solo, set the melody instrument program as desired and the chord instrument program to Dulcimer (15).</p>',a+='<p style="font-size:12pt;line-height:18pt;font-family:helvetica">In this case, you may not want to include any chords in the ABC, as they will be played using the Dulcimer (15) instrument.</p>',DayPilot.Modal.alert(a,{theme:"modal_flat",top:100,width:600,scrollWithPage:AllowDialogsToScroll()}).then(function(){FocusAfterOperation()})}gAlwaysInjectVolumes=e.result.configure_inject_volumes,gTheBassVolume=e.result.configure_bass_volume,gTheChordVolume=e.result.configure_chord_volume,isNaN(parseInt(gTheBassVolume))&&(gTheBassVolume=0),gTheBassVolume<0&&(gTheBassVolume=0),gTheBassVolume>127&&(gTheBassVolume=127),isNaN(parseInt(gTheChordVolume))&&(gTheChordVolume=0),gTheChordVolume<0&&(gTheChordVolume=0),gTheChordVolume>127&&(gTheChordVolume=127),gOverridePlayMIDIParams=e.result.configure_override_play_midi_params,gAutoSwingHornpipes=e.result.configure_auto_swing_hornpipes;var p=e.result.configure_auto_swing_factor;if(!isNaN(parseFloat(p))){var m=parseFloat(p);m>=-.9&&m<=.9&&(gAutoSwingFactor=m)}browserSupportsMIDI()&&I!=(gAllowMIDIInput=e.result.configure_allow_midi_input)&&gAllowMIDIInput&&(sendGoogleAnalytics("action","enable_MIDI"),initMIDI()),IdleAllowShowTabNames(),gLocalStorageAvailable&&(localStorage.abcStaffSpacing=t),SaveConfigurationSettings(),ShowHideTabButtons(),(t!=l||g!=gShowTabNames||gAllowShowTabNames&&gCapo!=c||gForceLeftJustifyTitles!=s)&&RenderAsync(!0,null,function(){FocusAfterOperation()})}})}function isXML(e){return -1!=e.slice(0,100).indexOf("<?xml")}function InjectQTag(e,t){for(var n=e.split("\n"),o=n.length,a=0;a<o;++a)if(0==n[a].trim().indexOf("Q:"))return e;for(var r="",l=!1,a=0;a<o;++a)if(0==(r=n[a]).trim().indexOf("M:")){l=!0,a<o-1&&(r=n[a+1]);break}if(l){var s=e.indexOf(r),g=e.substring(0,s),c=e.substring(s);e=g+"Q:"+t+"\n"+c}else{for(var d="",u=!1,a=0;a<o;++a)if(0==(d=n[a]).trim().indexOf("K:")){u=!0;break}if(u){var p=e.indexOf(d),g=e.substring(0,p),c=e.substring(p);e=g+"Q:"+t+"\n"+c}}return e}function importMusicXML(e){sendGoogleAnalytics("action","DoFileRead_XML");var t=$.parseXML(e),n=vertaal(t,gMusicXMLImportOptions)[0];return n=(n=(n=(n=(n=(n=(n=n.replaceAll("[K:treble]","")).replaceAll("[K:alto]","")).replaceAll("[K:alto1]","")).replaceAll("[K:alto2]","")).replaceAll("[K:tenor]","")).replaceAll("[K:bass]","")).replaceAll("[K:bass3]",""),1==gMusicXMLImportOptions.addq&&(n=InjectQTag(n,gMusicXMLImportOptions.q)),n}function DoFileRead(e,t){if(ensureABCFile(e.name)){var n=-1!=e.name.toLowerCase().indexOf(".mxl");if(t||(gTheABC.value="",Render(!0,null)),document.getElementById("abc-selected").innerText="Loading: "+e.name,gDisplayedName=e.name,n){new JSZip().loadAsync(e).then(function(e){e.files["META-INF/container.xml"].async("string").then(function(n){var o=$.parseXML(n).getElementsByTagName("rootfile")[0].getAttribute("full-path");e.files[o].async("string").then(function(e){if(isXML(e))e=importMusicXML(e);else{var n="This is not a valid MXL file.";n=makeCenteredPromptString(n),DayPilot.Modal.alert(n,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}if(t){if(CountTunes()>0){var o=gTheABC.value.length;"\n"!=gTheABC.value.substring(o-1)&&(gTheABC.value+="\n"),gTheABC.value+="\n"}gTheABC.value+=e,gIsDirty=!0,CleanSmartQuotes()}else gTheABC.value=e,CleanSmartQuotes();FocusABC(),setTimeout(function(){RestoreDefaults(),window.scrollTo({top:0}),gABCFromFile=!0,t||(gIsFromShare=!1,RestoreSavedStaffSpacing(),gIsDirty=!1),RenderAsync(!0,null,function(){if(UpdateNotationTopPosition(),t){var e=CountTunes(),n=getTuneByIndex(e-1),o=gTheABC.value.length-n.length;if(!gIsMaximized){if(ScrollABCTextIntoView(gTheABC,o,o,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}MakeTuneVisible(!0)}})},100)})},function(){var e="This is not a valid MXL file.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})})},function(){var e="This is not a valid MXL file.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()})});return}let o=new FileReader;o.addEventListener("load",e=>{var n=e.target.result;if(isXML(n)?n=importMusicXML(n):sendGoogleAnalytics("action","DoFileRead_ABC"),t){if(CountTunes()>0){var o=gTheABC.value.length;"\n"!=gTheABC.value.substring(o-1)&&(gTheABC.value+="\n"),gTheABC.value+="\n"}gTheABC.value+=n,gIsDirty=!0,CleanSmartQuotes()}else gTheABC.value=n,CleanSmartQuotes();FocusABC(),setTimeout(function(){RestoreDefaults(),window.scrollTo({top:0}),gABCFromFile=!0,t||(gIsFromShare=!1,RestoreSavedStaffSpacing(),gIsDirty=!1),RenderAsync(!0,null,function(){if(UpdateNotationTopPosition(),t){var e=CountTunes(),n=getTuneByIndex(e-1),o=gTheABC.value.length-n.length;if(!gIsMaximized){if(ScrollABCTextIntoView(gTheABC,o,o,10),isMobileBrowser())return;gTheABC.blur(),gTheABC.focus()}MakeTuneVisible(!0)}})},100)}),o.readAsText(e)}}function ShowTopBar(){var e=document.getElementById("topbar");e.style.display="block",e.style.opacity=1,gTopBarShowing=!0;var e=document.getElementById("abc-selected");e.style.marginTop="15px",e.style.marginBottom="1px",(e=document.getElementById("toggletopbar")).value="▲",gAllowControlToggle&&ShowAllControls()}function HideTopBar(){var e=document.getElementById("topbar");e.style.display="none",gTopBarShowing=!1;var e=document.getElementById("abc-selected");gIsIPhone||gIsAndroid?(e.style.marginTop="18px",e.style.marginBottom="38px"):e.style.marginTop="4px",(e=document.getElementById("toggletopbar")).value="▼",gAllowControlToggle&&HideAllControls()}function ToggleTopBar(){gTopBarShowing?HideTopBar():ShowTopBar(),UpdateNotationTopPosition(),gIsOneColumn&&MakeTuneVisible(!0),UpdateLocalStorage()}function isFirstRun(){return!!gLocalStorageAvailable&&!localStorage.abcTab&&!localStorage.abcTunesPerPage&&!localStorage.abcPageNumberLocation&&!localStorage.abcPageNumberOnPageOne&&!localStorage.abcStaffSpacing&&!localStorage.abcHideTopBar}function restoreStateFromLocalStorage(){var e=localStorage.abcTab;e&&(SetRadioValue("notenodertab",e),"whistle"==e&&PrepareWhistleFont(),gCurrentTab=e);var t=localStorage.abcTunesPerPage;t&&(document.getElementById("pdfformat").value=t);var n=localStorage.abcPageNumberLocation;n&&(document.getElementById("pagenumbers").value=n);var o=localStorage.abcPageNumberOnPageOne;o&&(document.getElementById("firstpage").value=o);var a=localStorage.abcCapo;a&&(gCapo=parseInt(a));var r=localStorage.abcStaffSpacing;r&&(gStaffSpacing=STAFFSPACEOFFSET+parseInt(r));var l=localStorage.abcHideTopBar;l&&"true"==l&&HideTopBar(),gIsFirstRun&&(UpdateLocalStorage(),showWelcomeScreen())}function DoDrop(e){e.stopPropagation(),e.preventDefault(),gIsDirty=!0;DoFileRead(e.dataTransfer.files[0],!0)}function HideZoomBanner(){document.getElementById("zoombanner").style.display="none",gZoomBannerHidden=!0,UpdateNotationTopPosition()}function HandleWindowResize(){if(isDesktopBrowser()){if(gIsMaximized){var e=document.getElementById("app-container");e.style.marginLeft="0px"}else{var t=window.innerWidth;if(t<1798){var n=(t-850)/2,e=document.getElementById("app-container");e.style.marginLeft=n+"px",gTheABC.rows=12,gIsOneColumn=!0,gZoomBannerHidden||(document.getElementById("zoombanner").style.display="block"),(e=document.getElementById("notation-placeholder-text")).style.marginTop="64px"}else{var e=document.getElementById("app-container"),n=(t-1700)/2;e.style.marginLeft=n+"px";var o=window.innerHeight,a=(o-=540)/30;a<12&&(a=12),gTheABC.rows=a,gIsOneColumn=!1,document.getElementById("zoombanner").style.display="none",(e=document.getElementById("notation-placeholder-text")).style.marginTop="136px"}}}}function getMIDI_note_name(e){return({36:" ",37:"BACKSPACE",38:"|",39:"/",40:"2",41:"3",42:"4",43:"(3",44:"|:",45:":|",46:"||",47:"|]",48:"C,",49:"C,",50:"D,",51:"D,",52:"E,",53:"F,",54:"F,",55:"G,",56:"G,",57:"A,",58:"A,",59:"B,",60:"C",61:"C",62:"D",63:"D",64:"E",65:"F",66:"F",67:"G",68:"G",69:"A",70:"A",71:"B",72:"c",73:"c",74:"d",75:"d",76:"e",77:"f",78:"f",79:"g",80:"g",81:"a",82:"a",83:"b",84:"c'",85:"c'",86:"d'",87:"d'",88:"e'",89:"f'",90:"f'",91:"g'",92:"g'",93:"a'",94:"a'",95:"b'",96:"c''"})[""+e]}var gMIDIAccess=null;function MIDI_NoteOn(e){var t=getMIDI_note_name(e);if(t){var n=gTheABC.selectionStart,o=gTheABC.selectionEnd;if("BACKSPACE"!=t){var a=gTheABC.value.substring(0,n),r=gTheABC.value.substring(o);gTheABC.value=a+t+r,gIsDirty=!0,gTheABC.selectionStart=n+t.length,gTheABC.selectionEnd=gTheABC.selectionStart,OnABCTextChange()}else if(0!=n){var a=gTheABC.value.substring(0,n-1),r=gTheABC.value.substring(o);gTheABC.value=a+r,gIsDirty=!0,gTheABC.selectionStart=n-1,gTheABC.selectionEnd=gTheABC.selectionStart,OnABCTextChange()}}}function MIDI_Receive(e){if(gAllowMIDIInput){var t=e.data[0],n=e.data[1],o=e.data[2];(240&t)==144&&0!=o&&MIDI_NoteOn(n)}}function midiOnStateChange(e){console.log("midiOnStateChange");for(var t=gMIDIAccess.inputs.values(),n=t.next();n&&!n.done;n=t.next())n.value.onmidimessage=MIDI_Receive}function onMIDIInit(e){console.log("onMIDIInit");for(var t=(gMIDIAccess=e).inputs.values(),n=t.next();n&&!n.done;n=t.next())n.value.onmidimessage=MIDI_Receive;e.onstatechange=midiOnStateChange}function onMIDIReject(e){sendGoogleAnalytics("action","onMIDIReject");var t="The MIDI input system failed to start. MIDI input will be disabled.";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),localStorage&&(gAllowMIDIInput=!1,localStorage.AllowMIDIInput=!1)}function browserSupportsMIDI(){return!!navigator.requestMIDIAccess}function initMIDI(){if(browserSupportsMIDI()&&null==gMIDIAccess){if(navigator.requestMIDIAccess)navigator.requestMIDIAccess({sysex:!1}).then(onMIDIInit,onMIDIReject);else{var e="This browser does not support MIDI input.";e=makeCenteredPromptString(e),DayPilot.Modal.alert(e,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()}),localStorage&&(gAllowMIDIInput=!1,localStorage.AllowMIDIInput=!1)}}}function showWelcomeScreen(){sendGoogleAnalytics("dialog","showWelcomeScreen");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"><strong>Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</strong></p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">To begin, type or paste tunes in ABC format into the text area.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Each ABC tune <strong>must</strong> begin with an X: tag.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Notation updates instantly as you make changes to the ABC.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Open" to open an ABC or MusicXML file from your system.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Add" to add a new ABC tune or tune template.</p>',isDesktopBrowser()&&(e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">You may also drag-and-drop a single ABC or MusicXML file on the editor area to add it.</p>'),e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Search for Tunes" to find tunes by name.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">Click "Settings" to set common tools settings and select the default instrument sounds and volumes to use when playing tunes.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica"><strong>Once ABC has been entered and notation is displayed:</strong></p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">• Click the Zoom-Out arrows at the top-right to view the notation full screen.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">• Click "Save" to save all the ABC text to an ABC text file.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">• Click "Export PDF to export your tunebook in PDF format.</p>',e+='<p style="font-size:13pt;line-height:17pt;font-family:helvetica">• Click "Play" to play or train on the tune currently being edited.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:25,scrollWithPage:AllowDialogsToScroll()})}function showZoomInstructionsScreen(){sendGoogleAnalytics("dialog","showZoomInstructionsScreen");var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">Welcome to My ABC Transcription Tools!</p>';e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Since this is your first time using the tools, here is some useful information to help you get started:</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the Play button at the bottom-right to play or train on the current tune.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">From the Player you can also export the tune image or audio in multiple formats.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the PDF button at the bottom-left to export the tunes in PDF format.</p>',gDisableEditFromPlayLink||(e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">If you would like to edit the ABC for these tunes:</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the Zoom-In arrows at the top-right to close the full screen notation view and open the ABC editor.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">The ABC for all the tunes will be loaded in the editor.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows at the top-right to view notation full screen.</p>'),e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}function TipJarReminderDialog(){sendGoogleAnalytics("dialog","TipJarReminderDialog");var e='<p style="text-align:center;font-size:22pt;font-family:helvetica">Thank You!</p>';e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;">I hope my ABC Transcription Tools have been useful to you!</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">If so, please consider dropping something in one of my </p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;"><strong><a href="tipjars.html" target="_blank" title="My Virtual Tip Jars">Virtual Tip Jars</a>.</strong></p>',e+="<p style=\"font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;\">Don't worry, I won't bug you again.</p>",e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;margin-top:36px;">Cheers and thanks!</p>',e+='<div style="text-align:center"><img style="width:150px;" src="img/michael.jpg"/></div>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica;text-align:center;">Michael Eskin</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:75,scrollWithPage:AllowDialogsToScroll()})}function ShowHelp(){if(sendGoogleAnalytics("dialog","ShowHelp"),gIsMaximized){var e='<p style="text-align:center;font-size:18pt;font-family:helvetica">About the Full Screen Notation View</p>';e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In this view, you may scroll through the tune notation.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the Play button at the bottom-right to play or train on the current tune.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">From the Player you can also export the tune image or audio in multiple formats.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the PDF button at the bottom-left to export the tunes in PDF format.</p>',gDisableEditFromPlayLink||(e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">If you would like to edit the ABC for these tunes:</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Click the Zoom-In arrows at the top-right to close the full screen notation view and open the tunes in the ABC editor.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">The ABC for all the tunes will be loaded in the editor.</p>',e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">In the ABC editor, click the Zoom-Out arrows at the top-right to view the notation full screen.</p>'),e+='<p style="font-size:14pt;line-height:18pt;font-family:helvetica">Please visit my <a href="userguide.html" target="_blank" title="ABC Transcription Tools User Guide">User Guide</a> page for complete instructions and demo videos on how to use the tools.</p>',DayPilot.Modal.alert(e,{theme:"modal_flat",top:50,scrollWithPage:AllowDialogsToScroll()})}else window.open("https://michaeleskin.com/abctools/userguide.html")}var RESIZETEXTBOX_DEBOUNCEMS=20,gLastResizeTextboxTime=0;function ResizeTextBox(){if(!gIsMaximized){var e=Date.now();if(e-gLastResizeTextboxTime>RESIZETEXTBOX_DEBOUNCEMS){gLastResizeTextboxTime=e;var t=gTheABC.offsetWidth,n=(gInitialTextBoxContainerWidth-gInitialTextBoxWidth)/2;if(t>gInitialTextBoxContainerWidth){var o=(t-gInitialTextBoxWidth)/2-n;if(o<=gInitialTextBoxContainerLeft&&(gTheABC.style.marginLeft=-o+"px",!gIsOneColumn)){var a=document.getElementById("app-container"),r=a.style.marginLeft;r&&(theAppContainerMarginFloat=parseFloat(r=a.style.marginLeft.replace("px","")),!isNaN(theAppContainerMarginFloat)&&o<(theAppContainerMarginFloat-=48)&&(gTheNotation.style.marginLeft=o+"px"))}}else gTheABC.style.marginLeft="0px",gTheNotation.style.marginLeft=o+"px"}}}function AllowDialogsToScroll(){return!!isMobileBrowser()||window.innerHeight<950}function CleanSmartQuotes(){var e=gTheABC.value;e=(e=(e=(e=e.replaceAll("“",'"')).replaceAll("”",'"')).replaceAll("‘","'")).replaceAll("’","'"),gTheABC.value=e}function FixIOS17(){var e=navigator.userAgent;if(-1!=e.indexOf("Version/17")||-1!=e.indexOf("OS 17")||-1!=e.indexOf("FxiOS")){var t=gTheABC.value;try{t=decodeURI(t);try{t=decodeURI(t)}catch(n){}}catch(o){}t=(t=t.replaceAll("%3A",":")).replaceAll("x:","X:"),gTheABC.value=t}}function theTabCloseListener(e){DoSaveLastAutoSnapShot()}function AddTabCloseListener(){isDesktopBrowser()&&window.addEventListener("beforeunload",theTabCloseListener)}function fileOpenIntercept(e){var t=document.getElementById("selectabcfile");if(gIsDirty){var n='<p style="font-size:18pt;line-height:20pt;text-align:center;">You Have Unsaved Changes</p><p style="font-size:13pt;line-height:16pt;text-align:center;margin-top:30px;">Click "OK" to abandon your work and open a new file.<br/><br/>Click "Cancel" to go back.</p>';n=makeCenteredPromptString(n),DayPilot.Modal.confirm(n,{top:200,theme:"modal_flat",scrollWithPage:AllowDialogsToScroll()}).then(function(e){e.canceled||setTimeout(function(){t.click()},100)})}else t.click()}function RemoveTabCloseListener(){isDesktopBrowser()&&window.removeEventListener("beforeunload",theTabCloseListener)}function ShowHideTabButtons(){var e=document.getElementById("tabs-selection");gFeaturesShowTabButtons?(e.style.display="flex",(e=document.getElementById("transpose-controls")).style.marginTop="18px"):(e.style.display="none",(e=document.getElementById("transpose-controls")).style.marginTop="0px"),UpdateNotationTopPosition()}function isDesktopBrowser(){return!(gIsIOS||gIsAndroid)}function isMobileBrowser(){return gIsIOS||gIsAndroid}function makeCenteredPromptString(e){return'<p style="font-size:12pt;line-height:18pt;font-family:helvetica;text-align:center">'+e+"</p>"}function sendGoogleAnalytics(e,t,n){"undefined"!=typeof gtag&&gtag&&gtag instanceof Function&&(n||(n="none"),gtag("event","abc_"+e+"_"+t,{event_category:e,event_action:t,event_label:n}))}function isIOS(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isIPhone(){return!!/iPad|iPhone|iPod/.test(navigator.platform)}function isIPad(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function isAndroid(){return!!/Android/i.test(navigator.userAgent)}function isSafari(){return!!(/Safari/i.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))}function isChrome(){return!!/chrome|chromium|crios/i.test(navigator.userAgent)}function DoStartup(){if(gShowAdvancedControls=!1,gShowShareControls=!1,gStripAnnotations=!1,gStripTextAnnotations=!1,gStripChords=!1,gStripTab=!1,gRenderingPDF=!1,gAllowSave=!1,gAllowURLSave=!1,gShowAllControls=!1,gAllowControlToggle=!1,gAllowFilterAnnotations=!1,gAllowFilterText=!1,gAllowFilterChords=!1,gAllowFilterTab=!1,gIsMaximized=!1,gCapo=0,gABCFromFile=!1,gAllowCopy=!1,gAllowPDF=!1,gShowTabNames=!0,gAllowShowTabNames=!1,gLastAutoScrolledTune=-1,gLastClickedTune=-1,gTopBarShowing=!0,gCurrentTune=0,gTotalTunes=0,gCurrentTab="noten",gForceFullRender=!1,gIsOneColumn=!0,gLocalStorageAvailable=!1,gPDFQuality=.75,gIncludePageLinks=!0,gDoForcePDFFilename=!1,gForcePDFFilename="",gFullScreenScaling=50,gIsDirty=!1,HideMaximizeButton(),DoMaximize(),gIsChrome=!1,gIsSafari=!1,isChrome()&&(gIsChrome=!0),gIsIOS=!1,isIOS()&&(gIsIOS=!0),gIsIPad=!1,isIPad()&&(gIsIPad=!0),gIsIPhone=!1,isIPhone()&&(gIsIPhone=!0),gIsAndroid=!1,isAndroid()&&(gIsAndroid=!0),gIsIOS&&document.getElementById("selectabcfile").removeAttribute("accept"),isMobileBrowser()){var e=document.getElementById("toolpagetitle");(e.size=4,e.style.fontFamily="Helvetica",(e=document.getElementById("notenlinks")).style.paddingTop="20px",e=gTheABC,gIsIPhone||gIsAndroid)?(gIsIPhone?e.cols=60:e.cols=58,e.style.fontSize="16pt",e.style.lineHeight="18pt",document.querySelector("meta[name=viewport]").setAttribute("content","width=860,maximum-scale=1.0,user-scalable=0")):(e.cols=73,e.style.fontSize="13pt",e.style.lineHeight="15pt"),(e=document.getElementById("app-container")).style.width="860px",e.style.display="block",e.style.marginLeft="0px",(e=document.getElementById("notation-placeholder")).style.width="860px",e.style.display="none",(e=document.getElementById("noscroller")).style.width="860px",e.style.display="none",(e=gTheNotation).style.width="820px",e.style.display="block",e.style.marginLeft="20px",e.style.marginRight="0px",e.style.overflow="hidden",(e=document.getElementById("notation-spacer")).style.width="860px",e.style.display="block",e.style.marginRight="0px",(e=document.getElementById("uioverlay")).style.width="860px",e.style.display="block",(e=document.getElementById("loading-bar-spinner")).style.top="36px",e.style.left="36px",e.style.marginLeft="-16px",e.style.marginTop="-16px",(e=document.getElementById("spinner-icon")).style.width="32px",e.style.height="32px"}(gIsIPhone||gIsAndroid)&&(document.getElementById("zoombutton").style.right="21px",document.getElementById("helpbutton").style.left="21px",document.getElementById("playbuttonicon").style.right="21px",document.getElementById("pdfbuttonicon").style.left="21px"),gIsIPad&&(document.getElementById("zoombutton").style.width="36px",document.getElementById("zoombutton").style.height="36px",document.getElementById("zoombutton").style.top="8px",document.getElementById("zoombutton").style.right="8px",document.getElementById("helpbutton").style.width="36px",document.getElementById("helpbutton").style.height="36px",document.getElementById("helpbutton").style.top="8px",document.getElementById("helpbutton").style.left="8px",document.getElementById("playbuttonicon").style.width="36px",document.getElementById("playbuttonicon").style.height="36px",document.getElementById("playbuttonicon").style.bottom="8px",document.getElementById("playbuttonicon").style.right="8px",document.getElementById("pdfbuttonicon").style.width="36px",document.getElementById("pdfbuttonicon").style.height="36px",document.getElementById("pdfbuttonicon").style.bottom="8px",document.getElementById("pdfbuttonicon").style.left="8px"),document.getElementById("abc").oninput=debounce(()=>{gIsDirty=!0,gForceFullRender?RenderAsync(!0,null):OnABCTextChange(),gForceFullRender=!1},DEBOUNCEMS),document.getElementById("abc").onpaste=function(){setTimeout(function(){CleanSmartQuotes(),gIsDirty=!0,gIsIOS&&FixIOS17()},0)},document.getElementById("abc").onclick=debounce(()=>{MakeTuneVisible(!1),fireSelectionChanged()},AUTOSCROLLDEBOUNCEMS),document.getElementById("selectabcfile").onchange=()=>{let e=document.getElementById("selectabcfile");if(0===e.files.length){var t="Please select an ABC or MusicXML file";t=makeCenteredPromptString(t),DayPilot.Modal.alert(t,{theme:"modal_flat",top:200,scrollWithPage:AllowDialogsToScroll()});return}DoFileRead(e.files[0],!1)},window.localStorage&&(gLocalStorageAvailable=!0),gIsFirstRun=isFirstRun(),SetRadioValue("notenodertab","noten"),document.getElementById("pdfformat").value="one",document.getElementById("pagenumbers").value="none",document.getElementById("firstpage").value="yes",document.getElementById("zoombutton").onclick=function(){ToggleMaximize()},document.getElementById("helpbutton").onclick=function(){ShowHelp()},document.getElementById("playbuttonicon").onclick=function(){PlayABC()},document.getElementById("pdfbuttonicon").onclick=function(){PDFExportDialog()},gStaffSpacing=STAFFSPACEOFFSET+STAFFSPACEDEFAULT,ClearNoRender(),resetAngloButtonNames(),resetMusicXMLImportOptions(),gLocalStorageAvailable&&GetInitialConfigurationSettings(),isDesktopBrowser()&&gSaveLastAutoSnapShot&&AddTabCloseListener(),gForceInitialTextBoxRecalc=!1;var t=processShareLink();if(gIsFromShare=t,gForceInitialTextBoxRecalc=t,t?(ShowPlayButton(),ShowPDFButton(),gIsFirstRun&&showZoomInstructionsScreen(),UpdateLocalStorage(),sendGoogleAnalytics("start","from_share")):(DoMinimize(),document.getElementById("notation-placeholder").style.display="block",restoreStateFromLocalStorage(),sendGoogleAnalytics("start","no_share")),ShowHideTabButtons(),new ResizeObserver(TextBoxResizeHandler).observe(gTheABC),isDesktopBrowser()){gInitialTextBoxWidth=gTheABC.offsetWidth;var e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,gInitialTextBoxContainerLeft=(e=document.getElementById("noscroller")).offsetLeft,new ResizeObserver(ResizeTextBox).observe(gTheABC),window.onresize=function(){if(HandleWindowResize(),gIsMaximized)gGotWindowResizeWhileMaximized=!0;else{gTheABC.style.marginLeft="0px",gTheABC.style.width=gInitialTextBoxWidth+"px";var e=document.getElementById("notenlinks");gInitialTextBoxContainerWidth=e.offsetWidth,gInitialTextBoxContainerLeft=(e=document.getElementById("noscroller")).offsetLeft,gTheNotation.style.marginLeft="auto",ResizeTextBox(),gGotWindowResizeWhileMaximized=!1}}}HandleWindowResize(),ShowAllControls(),t||(document.getElementById("notenrechts").style.display="none",gAllowControlToggle=!1),isDesktopBrowser()?($.event.props.push("dataTransfer"),$("#abc").on("drop",function(e){$(this).toggleClass("indrag",!1),DoDrop(e)}),$("#abc").on("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),$("#abc").on("dragenter dragleave",function(){$(this).toggleClass("indrag")}),$("#abc").on("dragstart",function(e){e.preventDefault()})):(gTheABC.placeholder="Enter the ABC for your tunes here",document.getElementById("desktop_use_message").style.display="none",$("#abc").on("dragstart",function(e){e.preventDefault()})),isDesktopBrowser()&&(gTheABC.onmousedown=function(e){gRawMode&&setTimeout(function(){gRawIsDragging=!0,fireSelectionChanged()},0)},gTheABC.onmouseup=function(e){gRawMode&&(gRawIsDragging=!1,fireSelectionChanged())},gTheABC.onmousemove=function(e){gRawMode&&gRawIsDragging&&fireSelectionChanged()},gAllowRawMode=!0),!t&&(gTipJarCount++,gLocalStorageAvailable&&(localStorage.TipJarCount=gTipJarCount)),25==gTipJarCount&&TipJarReminderDialog(),gAllowMIDIInput&&initMIDI(),ShowHelpButton(),SetupRawModeUI(),gTheABC.focus()}function WaitForReady(e){if("loading"!==document.readyState){e();return}document.addEventListener("DOMContentLoaded",e)}WaitForReady(DoStartup);